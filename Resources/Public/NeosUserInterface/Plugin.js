"use strict";(()=>{var cn=Object.create;var ke=Object.defineProperty;var It=Object.getOwnPropertyDescriptor;var un=Object.getOwnPropertyNames;var dn=Object.getPrototypeOf,ln=Object.prototype.hasOwnProperty;var fn=(e,t,r)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var pn=(e,t)=>()=>(e&&(t=e(e=0)),t);var z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var hn=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of un(t))!ln.call(e,i)&&i!==r&&ke(e,i,{get:()=>t[i],enumerable:!(n=It(t,i))||n.enumerable});return e};var _=(e,t,r)=>(r=e!=null?cn(dn(e)):{},hn(t||!e||!e.__esModule?ke(r,"default",{value:e,enumerable:!0}):r,e));var se=(e,t,r,n)=>{for(var i=n>1?void 0:n?It(t,r):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(n?o(t,r,i):o(i))||i);return n&&i&&ke(t,r,i),i};var d=(e,t,r)=>(fn(e,typeof t!="symbol"?t+"":t,r),r);function C(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var I=pn(()=>{});var R=z((qs,Wt)=>{I();Wt.exports=C("NeosProjectPackages")().NeosUiReduxStore});var kr=z((Se,ue)=>{var En=200,On="Expected a function",Pt="__lodash_hash_undefined__",Ue=1,de=2,or=1/0,ar=9007199254740991,je="[object Arguments]",vt="[object Array]",cr="[object Boolean]",ur="[object Date]",dr="[object Error]",lr="[object Function]",xn="[object GeneratorFunction]",We="[object Map]",fr="[object Number]",ce="[object Object]",Xt="[object Promise]",pr="[object RegExp]",ze="[object Set]",hr="[object String]",gr="[object Symbol]",St="[object WeakMap]",mr="[object ArrayBuffer]",Be="[object DataView]",kn="[object Float32Array]",Tn="[object Float64Array]",Dn="[object Int8Array]",Fn="[object Int16Array]",In="[object Int32Array]",Mn="[object Uint8Array]",Rn="[object Uint8ClampedArray]",jn="[object Uint16Array]",Wn="[object Uint32Array]",zn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Bn=/^\w*$/,Kn=/^\./,Ln=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Hn=/[\\^$.*+?()[\]{}|]/g,Un=/\\(\\)?/g,Gn=/^\[object .+?Constructor\]$/,$n=/^(?:0|[1-9]\d*)$/,A={};A[kn]=A[Tn]=A[Dn]=A[Fn]=A[In]=A[Mn]=A[Rn]=A[jn]=A[Wn]=!0;A[je]=A[vt]=A[mr]=A[cr]=A[Be]=A[ur]=A[dr]=A[lr]=A[We]=A[fr]=A[ce]=A[pr]=A[ze]=A[hr]=A[St]=!1;var yr=typeof global=="object"&&global&&global.Object===Object&&global,qn=typeof self=="object"&&self&&self.Object===Object&&self,J=yr||qn||Function("return this")(),_r=typeof Se=="object"&&Se&&!Se.nodeType&&Se,Zt=_r&&typeof ue=="object"&&ue&&!ue.nodeType&&ue,Jn=Zt&&Zt.exports===_r,Qt=Jn&&yr.process,er=function(){try{return Qt&&Qt.binding("util")}catch{}}(),tr=er&&er.isTypedArray;function Yn(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function Vn(e){return function(t){return t?.[e]}}function Xn(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Zn(e){return function(t){return e(t)}}function Qn(e,t){return e?.[t]}function At(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function ei(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function ti(e,t){return function(r){return e(t(r))}}function ri(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var ni=Array.prototype,ii=Function.prototype,Ge=Object.prototype,yt=J["__core-js_shared__"],rr=function(){var e=/[^.]+$/.exec(yt&&yt.keys&&yt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),vr=ii.toString,K=Ge.hasOwnProperty,le=Ge.toString,si=RegExp("^"+vr.call(K).replace(Hn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nr=J.Symbol,ir=J.Uint8Array,oi=Ge.propertyIsEnumerable,ai=ni.splice,ci=ti(Object.keys,Object),Nt=fe(J,"DataView"),Ae=fe(J,"Map"),Ct=fe(J,"Promise"),wt=fe(J,"Set"),bt=fe(J,"WeakMap"),Ne=fe(Object,"create"),ui=re(Nt),di=re(Ae),li=re(Ct),fi=re(wt),pi=re(bt),Ke=nr?nr.prototype:void 0,_t=Ke?Ke.valueOf:void 0,sr=Ke?Ke.toString:void 0;function ee(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function hi(){this.__data__=Ne?Ne(null):{}}function gi(e){return this.has(e)&&delete this.__data__[e]}function mi(e){var t=this.__data__;if(Ne){var r=t[e];return r===Pt?void 0:r}return K.call(t,e)?t[e]:void 0}function yi(e){var t=this.__data__;return Ne?t[e]!==void 0:K.call(t,e)}function _i(e,t){var r=this.__data__;return r[e]=Ne&&t===void 0?Pt:t,this}ee.prototype.clear=hi;ee.prototype.delete=gi;ee.prototype.get=mi;ee.prototype.has=yi;ee.prototype.set=_i;function L(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function vi(){this.__data__=[]}function Si(e){var t=this.__data__,r=$e(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():ai.call(t,r,1),!0}function Ai(e){var t=this.__data__,r=$e(t,e);return r<0?void 0:t[r][1]}function Ni(e){return $e(this.__data__,e)>-1}function Ci(e,t){var r=this.__data__,n=$e(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}L.prototype.clear=vi;L.prototype.delete=Si;L.prototype.get=Ai;L.prototype.has=Ni;L.prototype.set=Ci;function H(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function wi(){this.__data__={hash:new ee,map:new(Ae||L),string:new ee}}function bi(e){return qe(this,e).delete(e)}function Pi(e){return qe(this,e).get(e)}function Ei(e){return qe(this,e).has(e)}function Oi(e,t){return qe(this,e).set(e,t),this}H.prototype.clear=wi;H.prototype.delete=bi;H.prototype.get=Pi;H.prototype.has=Ei;H.prototype.set=Oi;function Le(e){var t=-1,r=e?e.length:0;for(this.__data__=new H;++t<r;)this.add(e[t])}function xi(e){return this.__data__.set(e,Pt),this}function ki(e){return this.__data__.has(e)}Le.prototype.add=Le.prototype.push=xi;Le.prototype.has=ki;function B(e){this.__data__=new L(e)}function Ti(){this.__data__=new L}function Di(e){return this.__data__.delete(e)}function Fi(e){return this.__data__.get(e)}function Ii(e){return this.__data__.has(e)}function Mi(e,t){var r=this.__data__;if(r instanceof L){var n=r.__data__;if(!Ae||n.length<En-1)return n.push([e,t]),this;r=this.__data__=new H(n)}return r.set(e,t),this}B.prototype.clear=Ti;B.prototype.delete=Di;B.prototype.get=Fi;B.prototype.has=Ii;B.prototype.set=Mi;function Ri(e,t){var r=te(e)||Er(e)?Xn(e.length,String):[],n=r.length,i=!!n;for(var s in e)(t||K.call(e,s))&&!(i&&(s=="length"||Cr(s,n)))&&r.push(s);return r}function $e(e,t){for(var r=e.length;r--;)if(Pr(e[r][0],t))return r;return-1}var ji=Xi();function Wi(e,t){return e&&ji(e,t,He)}function Sr(e,t){t=Je(t,e)?[t]:Ar(t);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Ye(t[r++])];return r&&r==n?e:void 0}function zi(e){return le.call(e)}function Bi(e,t){return e!=null&&t in Object(e)}function Et(e,t,r,n,i){return e===t?!0:e==null||t==null||!Ve(e)&&!Xe(t)?e!==e&&t!==t:Ki(e,t,Et,r,n,i)}function Ki(e,t,r,n,i,s){var o=te(e),a=te(t),c=vt,l=vt;o||(c=q(e),c=c==je?ce:c),a||(l=q(t),l=l==je?ce:l);var u=c==ce&&!At(e),h=l==ce&&!At(t),g=c==l;if(g&&!u)return s||(s=new B),o||as(e)?Nr(e,t,r,n,i,s):Zi(e,t,c,r,n,i,s);if(!(i&de)){var p=u&&K.call(e,"__wrapped__"),m=h&&K.call(t,"__wrapped__");if(p||m){var S=p?e.value():e,O=m?t.value():t;return s||(s=new B),r(S,O,n,i,s)}}return g?(s||(s=new B),Qi(e,t,r,n,i,s)):!1}function Li(e,t,r,n){var i=r.length,s=i,o=!n;if(e==null)return!s;for(e=Object(e);i--;){var a=r[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){a=r[i];var c=a[0],l=e[c],u=a[1];if(o&&a[2]){if(l===void 0&&!(c in e))return!1}else{var h=new B;if(n)var g=n(l,u,c,e,t,h);if(!(g===void 0?Et(u,l,n,Ue|de,h):g))return!1}}return!0}function Hi(e){if(!Ve(e)||ns(e))return!1;var t=xr(e)||At(e)?si:Gn;return t.test(re(e))}function Ui(e){return Xe(e)&&xt(e.length)&&!!A[le.call(e)]}function Gi(e){return typeof e=="function"?e:e==null?fs:typeof e=="object"?te(e)?Ji(e[0],e[1]):qi(e):ps(e)}function $i(e){if(!is(e))return ci(e);var t=[];for(var r in Object(e))K.call(e,r)&&r!="constructor"&&t.push(r);return t}function qi(e){var t=es(e);return t.length==1&&t[0][2]?br(t[0][0],t[0][1]):function(r){return r===e||Li(r,e,t)}}function Ji(e,t){return Je(e)&&wr(t)?br(Ye(e),t):function(r){var n=us(r,e);return n===void 0&&n===t?ds(r,e):Et(t,n,void 0,Ue|de)}}function Yi(e){return function(t){return Sr(t,e)}}function Vi(e){if(typeof e=="string")return e;if(kt(e))return sr?sr.call(e):"";var t=e+"";return t=="0"&&1/e==-or?"-0":t}function Ar(e){return te(e)?e:ss(e)}function Xi(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(r(s[c],c,s)===!1)break}return t}}function Nr(e,t,r,n,i,s){var o=i&de,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(e);if(l&&s.get(t))return l==t;var u=-1,h=!0,g=i&Ue?new Le:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var p=e[u],m=t[u];if(n)var S=o?n(m,p,u,t,e,s):n(p,m,u,e,t,s);if(S!==void 0){if(S)continue;h=!1;break}if(g){if(!Yn(t,function(O,f){if(!g.has(f)&&(p===O||r(p,O,n,i,s)))return g.add(f)})){h=!1;break}}else if(!(p===m||r(p,m,n,i,s))){h=!1;break}}return s.delete(e),s.delete(t),h}function Zi(e,t,r,n,i,s,o){switch(r){case Be:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case mr:return!(e.byteLength!=t.byteLength||!n(new ir(e),new ir(t)));case cr:case ur:case fr:return Pr(+e,+t);case dr:return e.name==t.name&&e.message==t.message;case pr:case hr:return e==t+"";case We:var a=ei;case ze:var c=s&de;if(a||(a=ri),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;s|=Ue,o.set(e,t);var u=Nr(a(e),a(t),n,i,s,o);return o.delete(e),u;case gr:if(_t)return _t.call(e)==_t.call(t)}return!1}function Qi(e,t,r,n,i,s){var o=i&de,a=He(e),c=a.length,l=He(t),u=l.length;if(c!=u&&!o)return!1;for(var h=c;h--;){var g=a[h];if(!(o?g in t:K.call(t,g)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var m=!0;s.set(e,t),s.set(t,e);for(var S=o;++h<c;){g=a[h];var O=e[g],f=t[g];if(n)var y=o?n(f,O,g,t,e,s):n(O,f,g,e,t,s);if(!(y===void 0?O===f||r(O,f,n,i,s):y)){m=!1;break}S||(S=g=="constructor")}if(m&&!S){var v=e.constructor,w=t.constructor;v!=w&&"constructor"in e&&"constructor"in t&&!(typeof v=="function"&&v instanceof v&&typeof w=="function"&&w instanceof w)&&(m=!1)}return s.delete(e),s.delete(t),m}function qe(e,t){var r=e.__data__;return rs(t)?r[typeof t=="string"?"string":"hash"]:r.map}function es(e){for(var t=He(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,wr(i)]}return t}function fe(e,t){var r=Qn(e,t);return Hi(r)?r:void 0}var q=zi;(Nt&&q(new Nt(new ArrayBuffer(1)))!=Be||Ae&&q(new Ae)!=We||Ct&&q(Ct.resolve())!=Xt||wt&&q(new wt)!=ze||bt&&q(new bt)!=St)&&(q=function(e){var t=le.call(e),r=t==ce?e.constructor:void 0,n=r?re(r):void 0;if(n)switch(n){case ui:return Be;case di:return We;case li:return Xt;case fi:return ze;case pi:return St}return t});function ts(e,t,r){t=Je(t,e)?[t]:Ar(t);for(var n,i=-1,o=t.length;++i<o;){var s=Ye(t[i]);if(!(n=e!=null&&r(e,s)))break;e=e[s]}if(n)return n;var o=e?e.length:0;return!!o&&xt(o)&&Cr(s,o)&&(te(e)||Er(e))}function Cr(e,t){return t=t??ar,!!t&&(typeof e=="number"||$n.test(e))&&e>-1&&e%1==0&&e<t}function Je(e,t){if(te(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||kt(e)?!0:Bn.test(e)||!zn.test(e)||t!=null&&e in Object(t)}function rs(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ns(e){return!!rr&&rr in e}function is(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Ge;return e===r}function wr(e){return e===e&&!Ve(e)}function br(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var ss=Ot(function(e){e=cs(e);var t=[];return Kn.test(e)&&t.push(""),e.replace(Ln,function(r,n,i,s){t.push(i?s.replace(Un,"$1"):n||r)}),t});function Ye(e){if(typeof e=="string"||kt(e))return e;var t=e+"";return t=="0"&&1/e==-or?"-0":t}function re(e){if(e!=null){try{return vr.call(e)}catch{}try{return e+""}catch{}}return""}function Ot(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(On);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o),o};return r.cache=new(Ot.Cache||H),r}Ot.Cache=H;function Pr(e,t){return e===t||e!==e&&t!==t}function Er(e){return os(e)&&K.call(e,"callee")&&(!oi.call(e,"callee")||le.call(e)==je)}var te=Array.isArray;function Or(e){return e!=null&&xt(e.length)&&!xr(e)}function os(e){return Xe(e)&&Or(e)}function xr(e){var t=Ve(e)?le.call(e):"";return t==lr||t==xn}function xt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ar}function Ve(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Xe(e){return!!e&&typeof e=="object"}function kt(e){return typeof e=="symbol"||Xe(e)&&le.call(e)==gr}var as=tr?Zn(tr):Ui;function cs(e){return e==null?"":Vi(e)}function us(e,t,r){var n=e==null?void 0:Sr(e,t);return n===void 0?r:n}function ds(e,t){return e!=null&&ts(e,t,Bi)}function He(e){return Or(e)?Ri(e):$i(e)}function ls(e,t){var r={};return t=Gi(t,3),Wi(e,function(n,i,s){r[i]=t(n,i,s)}),r}function fs(e){return e}function ps(e){return Je(e)?Vn(Ye(e)):Yi(e)}ue.exports=ls});var Rr=z((lo,Mr)=>{I();Mr.exports=C("NeosProjectPackages")().NeosUiEditors});var Ce=z((po,jr)=>{I();jr.exports=C("vendor")().React});var we=z((go,Wr)=>{I();Wr.exports=C("vendor")().reactRedux});var Ze=z((yo,zr)=>{I();zr.exports=C("vendor")().PropTypes});var Qe=z((vo,Br)=>{I();Br.exports=C("NeosProjectPackages")().NeosUiDecorators});var be=z((Ao,Kr)=>{I();Kr.exports=C("NeosProjectPackages")().ReactUiComponents});var tt=z((To,Yr)=>{I();Yr.exports=C("vendor")().reduxSagaEffects});I();var me=class{constructor(t){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=t}};var gn=(e,t="position",r="key")=>{let n=typeof t=="string"?f=>f[t]:t,i={},s={},o={},a={},c={},l={};e.forEach((f,y)=>{let v=f[r]?f[r]:String(y);i[v]=y;let w=n(f),k=String(w||y),xe=!1;if(k.startsWith("start")){let N=k.match(/start\s+(\d+)/),b=N&&N[1]?Number(N[1]):0;o[b]||(o[b]=[]),o[b].push(v)}else if(k.startsWith("end")){let N=k.match(/end\s+(\d+)/),b=N&&N[1]?Number(N[1]):0;a[b]||(a[b]=[]),a[b].push(v)}else if(k.startsWith("before")){let N=k.match(/before\s+(\S+)(\s+(\d+))?/);if(!N)xe=!0;else{let b=N[1],V=N[3]?Number(N[3]):0;c[b]||(c[b]={}),c[b][V]||(c[b][V]=[]),c[b][V].push(v)}}else if(k.startsWith("after")){let N=k.match(/after\s+(\S+)(\s+(\d+))?/);if(!N)xe=!0;else{let b=N[1],V=N[3]?Number(N[3]):0;l[b]||(l[b]={}),l[b][V]||(l[b][V]=[]),l[b][V].push(v)}}else xe=!0;if(xe){let N=parseFloat(k);(isNaN(N)||!isFinite(N))&&(N=y),s[N]||(s[N]=[]),s[N].push(v)}});let u=[],h=[],g=[],p=[],m=(f,y)=>{let v=Object.keys(f).map(w=>Number(w)).sort((w,k)=>w-k);return y?v:v.reverse()},S=(f,y)=>{f.forEach(v=>{if(!(p.indexOf(v)>=0)){if(p.push(v),c[v]){let w=m(c[v],!0);for(let k of w)S(c[v][k],y)}if(y.push(v),l[v]){let w=m(l[v],!1);for(let k of w)S(l[v][k],y)}}})};for(let f of m(o,!1))S(o[f],u);for(let f of m(s,!0))S(s[f],h);for(let f of m(a,!0))S(a[f],g);for(let f of Object.keys(c))if(!(p.indexOf(f)>=0))for(let y of m(c[f],!1))S(c[f][y],u);for(let f of Object.keys(l))if(!(p.indexOf(f)>=0))for(let y of m(l[f],!1))S(l[f][y],h);return[...u,...h,...g].map(f=>i[f]).map(f=>e[f])},st=gn;var $=class extends me{constructor(t){super(t),this._registry=[]}set(t,r,n=0){if(typeof t!="string")throw new Error("Key must be a string");if(typeof n!="string"&&typeof n!="number")throw new Error("Position must be a string or a number");let i={key:t,value:r};n&&(i.position=n);let s=this._registry.findIndex(o=>o.key===t);return s===-1?this._registry.push(i):this._registry[s]=i,r}get(t){if(typeof t!="string")return console.error("Key must be a string"),null;let r=this._registry.find(n=>n.key===t);return r?r.value:null}_getChildrenWrapped(t){let r=this._registry.filter(n=>n.key.indexOf(t+"/")===0);return st(r)}getChildrenAsObject(t){let r={};return this._getChildrenWrapped(t).forEach(n=>{r[n.key]=n.value}),r}getChildren(t){return this._getChildrenWrapped(t).map(r=>r.value)}has(t){return typeof t!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(r=>r.key===t)}_getAllWrapped(){return st(this._registry)}getAllAsObject(){let t={};return this._getAllWrapped().forEach(r=>{t[r.key]=r.value}),t}getAllAsList(){return this._getAllWrapped().map(t=>Object.assign({id:t.key},t.value))}};var Mt=C("manifest");var x=class extends Error{constructor(r,n,i=""){super(r);d(this,"code");d(this,"severity","error");d(this,"externalMessage");this.code=n,this.externalMessage=i}};var Rt=e=>{let t=e["NEOSidekick.AiAssistant"];return new ot(t.apiDomain,t.apiKey)},ot=class{constructor(t,r){d(this,"apiDomain","");d(this,"apiKey","");d(this,"hasApiKey",()=>this.apiKey!==null&&this.apiKey!=="");d(this,"generate",async(t,r,n={})=>{if(!this.apiKey)throw new x("This feature is not available in the free version.","1688157373215");let i=await fetch(`${this.apiDomain}/api/v1/chat?language=${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:t,platform:"neos",user_input:n})}),s=await i.json();if(i.status===401)throw new x("The NEOSidekick api key provided is not valid.","1688158193038");if(i.status<200||i.status>=400)throw new x("An error occurred while asking NEOSidekick.","1688158257149",s?.message);let o=s?.data?.message?.message;return o.startsWith('"')&&o.endsWith('"')&&(o=o.substr(1,o.length-2)),o});this.apiDomain=t,this.apiKey=r}};I();var jt=C("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:Us}=C("NeosProjectPackages")().NeosUiBackendConnector;var pe=_(R());var Ut=Symbol.for("immer-nothing"),zt=Symbol.for("immer-draftable"),T=Symbol.for("immer-state");function M(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var oe=Object.getPrototypeOf;function ae(e){return!!e&&!!e[T]}function Z(e){return e?Gt(e)||Array.isArray(e)||!!e[zt]||!!e.constructor?.[zt]||Ie(e)||Me(e):!1}var yn=Object.prototype.constructor.toString();function Gt(e){if(!e||typeof e!="object")return!1;let t=oe(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===yn}function ye(e,t){Fe(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function Fe(e){let t=e[T];return t?t.type_:Array.isArray(e)?1:Ie(e)?2:Me(e)?3:0}function ut(e,t){return Fe(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function $t(e,t,r){let n=Fe(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function _n(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Ie(e){return e instanceof Map}function Me(e){return e instanceof Set}function X(e){return e.copy_||e.base_}function dt(e,t){if(Ie(e))return new Map(e);if(Me(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&Gt(e))return oe(e)?{...e}:Object.assign(Object.create(null),e);let r=Object.getOwnPropertyDescriptors(e);delete r[T];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){let s=n[i],o=r[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(oe(e),r)}function gt(e,t=!1){return Re(e)||ae(e)||!Z(e)||(Fe(e)>1&&(e.set=e.add=e.clear=e.delete=vn),Object.freeze(e),t&&ye(e,(r,n)=>gt(n,!0),!0)),e}function vn(){M(2)}function Re(e){return Object.isFrozen(e)}var Sn={};function Q(e){let t=Sn[e];return t||M(0,e),t}var _e;function qt(){return _e}function An(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Bt(e,t){t&&(Q("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function lt(e){ft(e),e.drafts_.forEach(Nn),e.drafts_=null}function ft(e){e===_e&&(_e=e.parent_)}function Kt(e){return _e=An(_e,e)}function Nn(e){let t=e[T];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Lt(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[T].modified_&&(lt(t),M(4)),Z(e)&&(e=Te(t,e),t.parent_||De(t,e)),t.patches_&&Q("Patches").generateReplacementPatches_(r[T].base_,e,t.patches_,t.inversePatches_)):e=Te(t,r,[]),lt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Ut?e:void 0}function Te(e,t,r){if(Re(t))return t;let n=t[T];if(!n)return ye(t,(i,s)=>Ht(e,n,t,i,s,r),!0),t;if(n.scope_!==e)return t;if(!n.modified_)return De(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let i=n.copy_,s=i,o=!1;n.type_===3&&(s=new Set(i),i.clear(),o=!0),ye(s,(a,c)=>Ht(e,n,i,a,c,r,o)),De(e,i,!1),r&&e.patches_&&Q("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function Ht(e,t,r,n,i,s,o){if(ae(i)){let a=s&&t&&t.type_!==3&&!ut(t.assigned_,n)?s.concat(n):void 0,c=Te(e,i,a);if($t(r,n,c),ae(c))e.canAutoFreeze_=!1;else return}else o&&r.add(i);if(Z(i)&&!Re(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Te(e,i),(!t||!t.scope_.parent_)&&De(e,i)}}function De(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&gt(t,r)}function Cn(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:qt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=n,s=mt;r&&(i=[n],s=ve);let{revoke:o,proxy:a}=Proxy.revocable(i,s);return n.draft_=a,n.revoke_=o,a}var mt={get(e,t){if(t===T)return e;let r=X(e);if(!ut(r,t))return wn(e,r,t);let n=r[t];return e.finalized_||!Z(n)?n:n===at(e.base_,t)?(ct(e),e.copy_[t]=ht(n,e)):n},has(e,t){return t in X(e)},ownKeys(e){return Reflect.ownKeys(X(e))},set(e,t,r){let n=Jt(X(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let i=at(X(e),t),s=i?.[T];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(_n(r,i)&&(r!==void 0||ut(e.base_,t)))return!0;ct(e),pt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return at(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ct(e),pt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=X(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){M(11)},getPrototypeOf(e){return oe(e.base_)},setPrototypeOf(){M(12)}},ve={};ye(mt,(e,t)=>{ve[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});ve.deleteProperty=function(e,t){return ve.set.call(this,e,t,void 0)};ve.set=function(e,t,r){return mt.set.call(this,e[0],t,r,e[0])};function at(e,t){let r=e[T];return(r?X(r):e)[t]}function wn(e,t,r){let n=Jt(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function Jt(e,t){if(!(t in e))return;let r=oe(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=oe(r)}}function pt(e){e.modified_||(e.modified_=!0,e.parent_&&pt(e.parent_))}function ct(e){e.copy_||(e.copy_=dt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var bn=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let s=r;r=t;let o=this;return function(c=s,...l){return o.produce(c,u=>r.call(this,u,...l))}}typeof r!="function"&&M(6),n!==void 0&&typeof n!="function"&&M(7);let i;if(Z(t)){let s=Kt(this),o=ht(t,void 0),a=!0;try{i=r(o),a=!1}finally{a?lt(s):ft(s)}return Bt(s,n),Lt(i,s)}else if(!t||typeof t!="object"){if(i=r(t),i===void 0&&(i=t),i===Ut&&(i=void 0),this.autoFreeze_&&gt(i,!0),n){let s=[],o=[];Q("Patches").generateReplacementPatches_(t,i,s,o),n(s,o)}return i}else M(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let n,i;return[this.produce(t,r,(o,a)=>{n=o,i=a}),n,i]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Z(e)||M(8),ae(e)&&(e=Pn(e));let t=Kt(this),r=ht(e,void 0);return r[T].isManual_=!0,ft(t),r}finishDraft(e,t){let r=e&&e[T];(!r||!r.isManual_)&&M(9);let{scope_:n}=r;return Bt(n,t),Lt(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let i=t[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(t=t.slice(r+1));let n=Q("Patches").applyPatches_;return ae(e)?n(e,t):this.produce(e,i=>n(i,t))}};function ht(e,t){let r=Ie(e)?Q("MapSet").proxyMap_(e,t):Me(e)?Q("MapSet").proxySet_(e,t):Cn(e,t);return(t?t.scope_:qt()).drafts_.push(r),r}function Pn(e){return ae(e)||M(10,e),Yt(e)}function Yt(e){if(!Z(e)||Re(e))return e;let t=e[T],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=dt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=dt(e,!0);return ye(r,(n,i)=>{$t(r,n,Yt(i))}),t&&(t.finalized_=!1),r}var D=new bn,Vt=D.produce,Js=D.produceWithPatches.bind(D),Ys=D.setAutoFreeze.bind(D),Vs=D.setUseStrictShallowCopy.bind(D),Xs=D.applyPatches.bind(D),Zs=D.createDraft.bind(D),Qs=D.finishDraft.bind(D);var Tr=_(kr());var Dr=(e,t)=>new Tt(e,t),Tt=class{constructor(t,r){d(this,"globalRegistry");d(this,"store");d(this,"nodeTypesRegistry");d(this,"externalService");d(this,"getGuestFrameDocumentTitle",()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title);d(this,"getGuestFrameDocumentHtml",()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML);d(this,"getCurrentDocumentNode",()=>{let t=this.store.getState(),r=t?.cr?.nodes?.documentNode;return t?.cr?.nodes?.byContextPath[r]});d(this,"getCurrentDocumentParentNode",()=>{let t=this.store.getState(),r=this.getCurrentDocumentNode();return t?.cr?.nodes?.byContextPath[r.parent]});d(this,"getCurrentDocumentNodeType",()=>{let t=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(t?.nodeType)});d(this,"getCurrentDocumentTargetAudience",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return t?await this.processClientEval(t):null});d(this,"getCurrentDocumentPageBriefing",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return t?await this.processClientEval(t):null});d(this,"getCurrentDocumentFocusKeyword",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return t?await this.processClientEval(t):null});d(this,"processClientEval",async(t,r=null,n=null)=>{if(typeof t=="string"&&(t.startsWith("SidekickClientEval:")||t.startsWith("ClientEval:")))try{r=r??this.getCurrentDocumentNode();let i=pe.selectors.UI.Inspector.transientValues(this.store.getState());r=this.generateNodeForContext(r,i),n=n??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),a=await this.getImageMetadata,c=Object.getPrototypeOf(async function(){}).constructor;return await new c("node,parentNode,documentTitle,documentContent,AssetUri","return "+t.replace("SidekickClientEval:","").replace("ClientEval:",""))(r,n,s,o,a)}catch(i){throw i instanceof x?i:(console.error(i),new x('An error occurred while trying to evaluate "'+t+'"',"1694682118365",t))}return t});d(this,"processValueWithClientEval",async(t,r=null,n=null)=>{if(typeof t=="string")return this.processClientEval(t,r,n);if(typeof t=="object"&&t!==null)return this.processObjectWithClientEval(t,r,n);if(Array.isArray(t))return Promise.all(t.map(async i=>this.processObjectWithClientEval(i,r,n)))});d(this,"processObjectWithClientEval",async(t,r=null,n=null)=>{let i={};return await Promise.all(Object.keys(t).map(async s=>{let o=t[s];i[s]=await this.processValueWithClientEval(o,r,n)})),i});d(this,"getImageMetadata",async t=>{if(!t||!t?.__identity)throw new x("The property does not have a valid image.","1694595562191");let{loadImageMetadata:r}=jt.get().endpoints,n,i;try{let o=await r(t?.__identity);n=o?.originalImageResourceUri,i=o?.previewImageResourceUri}catch{throw new x("Could not fetch image object.","1694595598880")}if(!n||n==="")throw new x("The given image does not have a correct url.","1694595462402");let s=[];return s.push(this.prependConfiguredDomainToImageUri(n)),i&&s.push(this.prependConfiguredDomainToImageUri(i)),s});this.globalRegistry=t,this.store=r,this.nodeTypesRegistry=t.get("@neos-project/neos-ui-contentrepository"),this.externalService=t.get("NEOSidekick.AiAssistant").get("externalService")}prependConfiguredDomainToImageUri(t){let r=this.globalRegistry.get("NEOSidekick.AiAssistant").get("configuration").domain;return t=t.replace("http://","").replace("https://").split("/"),t.shift(),t.unshift(r),t.join("/")}getCurrentlyFocusedNodePathAndProperty(){let t=this.store.getState(),r=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),n=t?.cr?.nodes?.focused?.contextPaths[0],i=n?pe.selectors.CR.Nodes.nodeByContextPath(t)(n):null;return{nodePath:n,node:i,property:t?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:i?r.get(i?.nodeType):null,parentNode:i?pe.selectors.CR.Nodes.nodesByContextPathSelector(t)[i.parent]:null}}async evaluateNodeTypeConfigurationAndStartGeneration(t,r,n,i=null,s=!1){if(!n||r[0]==="_")return;let o=n.properties[r];try{if(o?.options?.sidekick?.onCreate?.module)throw new x("Please do not use options.sidekick.onCreate.module anymore. Read the docs to find out about the new configuration.","1696264259260");if(!o?.options?.sidekick?.module||s&&o?.options?.sidekick?.onCreate!==!0)return;if(!o?.ui?.inlineEditable)throw new x("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new x("This feature is not available in the free version.","1688157373215")}catch(h){let g=this.globalRegistry.get("i18n");this.store.dispatch(pe.actions.UI.FlashMessages.add(h?.code??h?.message,h?.code?g.translate("NEOSidekick.AiAssistant:Error:"+h.code):h?.message,h?.severity??"error"));return}let a=JSON.parse(JSON.stringify(o.options.sidekick)),c=this.globalRegistry.get("NEOSidekick.AiAssistant").get("assistantService"),l=await this.processObjectWithClientEval(a,t,i),u={version:"1.0",eventName:"call-module",data:{platform:"neos",target:{nodePath:t.contextPath,propertyName:r},...l}};c.sendMessageToIframe(u)}generateNodeForContext(t,r){return r?Vt(t,n=>{let i=(0,Tr.default)(r,s=>s?.value);n.properties=Object.assign({},n.properties,i)}):t}};var Fr=_(R());var Ir=(e,t)=>new Dt(e,t),Dt=class{constructor(t,r){d(this,"globalRegistry");d(this,"store");d(this,"currentlyHandledNodePath");d(this,"sendMessageToIframe",t=>{if(this.currentlyHandledNodePath&&["page-changed","page-updated"].indexOf(t?.eventName)>-1)return;if(this.currentlyHandledNodePath&&["call-module"].indexOf(t?.eventName)>-1){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}t?.eventName==="call-module"&&(this.currentlyHandledNodePath=t?.data?.target?.nodePath);let r=setInterval(()=>{let n=document.getElementById("neosidekickAssistant");if(n.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",t),n.contentWindow.postMessage(t,"*"),clearInterval(r),t?.eventName==="call-module"&&this.resetCurrentlyHandledNodePathDebounced();else{console.log("not loaded, waiting...");return}},250)});d(this,"listenToMessages",()=>{let t=setInterval(()=>{let r=document.getElementById("neosidekickAssistant");if(r?.dataset?.hasOwnProperty("loaded"))window.addEventListener("message",i=>{let s=r.contentWindow;i.source===s&&(console.log(i),this.handleMessage(i))}),clearInterval(t);else return},250)});d(this,"handleMessage",t=>{if(console.info("Handle Sidekick Message: "+t.data.eventName),t?.data?.eventName==="write-content"){let{nodePath:r,propertyName:n,value:i,isFinished:s}=t.data.data;this.currentlyHandledNodePath=r,this.changePropertyValue(r,n,i,s)}else if(t?.data?.eventName==="stopped-generation")this.resetTypingCaret(),this.resetCurrentlyHandledNodePath();else if(t?.data?.eventName==="error"){let r=t?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+r,"error",r),this.resetTypingCaret(),this.resetCurrentlyHandledNodePath()}this.resetCurrentlyHandledNodePathDebounced()});d(this,"changePropertyValue",(t,r,n,i=!1)=>{let a=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(`[data-__neos-editable-node-contextpath="${t}"][data-__neos-property="${r}"]`);if(!a){this.resetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(t)){a.classList.remove("typing-caret"),this.resetCurrentlyHandledNodePath();return}a?.ckeditorInstance?.setData(n),a?.classList.toggle("typing-caret",!i),i&&this.resetCurrentlyHandledNodePath()});this.globalRegistry=t,this.store=r,this.currentlyHandledNodePath=null}resetTypingCaret(){let n=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(".typing-caret");n&&n.classList.remove("typing-caret")}resetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetCurrentlyHandledNodePathDebounced(){let t,r=1e3;return()=>{clearTimeout(t),t=setTimeout(()=>{this.currentlyHandledNodePath=null},r)}}addFlashMessage(t,r,n="error",i=null){let s=this.globalRegistry.get("i18n");this.store.dispatch(Fr.actions.UI.FlashMessages.add(t,s.translate("NEOSidekick.AiAssistant:Error:"+t,r,{0:i}),n))}};var et=_(Rr());var j=_(Ce()),Lr=_(we()),P=_(Ze()),Hr=_(Qe()),ne=_(be()),he=_(R());var hs={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},U=class extends j.Component{constructor(r){super(r);d(this,"state",{loading:!1});d(this,"getIcon",r=>r?j.default.createElement(ne.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):j.default.createElement(ne.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}));d(this,"fetch",async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:l,node:u,parentNode:h,frontendConfiguration:g}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,u,h),n=Object.keys(n).map(m=>({identifier:m,value:n[m]}));let p=await s.generate(r,a.language?a.language[0]:g.defaultLanguage,n);i(p)}catch(p){c(p?.code??p?.message,p?.code?l.translate("NEOSidekick.AiAssistant:Error:"+p.code,p.message,{0:p.externalMessage}):p.message,p?.severity??"error")}finally{this.setState({loading:!1})}})}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:l}=this.props,u=Object.assign({},hs,o),h=o&&o.placeholder&&a.translate(unescape(o.placeholder)),g=!(u.readonly||u.disabled);return j.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},j.default.createElement("div",null,j.default.createElement(ne.TextInput,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:h,onKeyPress:c,onEnterKey:l})),g?j.default.createElement("div",{style:{"margin-top":"4px"}},j.default.createElement(ne.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};d(U,"propTypes",{className:P.default.string,value:P.default.oneOfType([P.default.string,P.default.number]),commit:P.default.func.isRequired,options:P.default.object,onKeyPress:P.default.func,onEnterKey:P.default.func,id:P.default.string,activeContentDimensions:P.default.object.isRequired,node:P.default.object,parentNode:P.default.object,i18nRegistry:P.default.object.isRequired,externalService:P.default.object.isRequired,contentService:P.default.object.isRequired,addFlashMessage:P.default.func.isRequired,frontendConfiguration:P.default.object}),d(U,"defaultProps",{options:{}}),U=se([(0,Hr.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Lr.connect)(e=>t=>{let r=he.selectors.CR.ContentDimensions.active(t),n=he.selectors.CR.Nodes.focusedSelector(t),i=he.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:he.actions.UI.FlashMessages.add})],U);var W=_(Ce()),Ur=_(we()),E=_(Ze()),Gr=_(Qe()),ie=_(be()),ge=_(R());var gs={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},G=class extends W.Component{constructor(r){super(r);d(this,"getIcon",r=>r?W.default.createElement(ie.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):W.default.createElement(ie.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}));d(this,"fetch",async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:l,node:u,parentNode:h,frontendConfiguration:g}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,u,h),n=Object.keys(n).map(m=>({identifier:m,value:n[m]}));let p=await s.generate(r,a.language?a.language[0]:g.defaultLanguage,n);i(p)}catch(p){c(p?.code??p?.message,p?.code?l.translate("NEOSidekick.AiAssistant:Error:"+p.code,p.message,{0:p.externalMessage}):p.message,p?.severity??"error")}finally{this.setState({loading:!1})}});this.state={loading:!1}}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:l}=this.props,u=Object.assign({},gs,o),h=o&&o.placeholder&&a.translate(unescape(o.placeholder)),g=!(u.readonly||u.disabled);return W.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},W.default.createElement("div",null,W.default.createElement(ie.TextArea,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:h,minRows:u.minRows,expandedRows:u.expandedRows,onKeyPress:c,onEnterKey:l})),g?W.default.createElement("div",null,W.default.createElement(ie.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};d(G,"propTypes",{className:E.default.string,value:E.default.oneOfType([E.default.string,E.default.number]),commit:E.default.func.isRequired,options:E.default.object,onKeyPress:E.default.func,onEnterKey:E.default.func,id:E.default.string,activeContentDimensions:E.default.object.isRequired,node:E.default.object,parentNode:E.default.object,i18nRegistry:E.default.object.isRequired,externalService:E.default.object.isRequired,contentService:E.default.object.isRequired,addFlashMessage:E.default.func.isRequired,frontendConfiguration:E.default.object}),d(G,"defaultProps",{options:{}}),G=se([(0,Gr.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Ur.connect)(e=>t=>{let r=ge.selectors.CR.ContentDimensions.active(t),n=ge.selectors.CR.Nodes.focusedSelector(t),i=ge.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:ge.actions.UI.FlashMessages.add})],G);var $r=(e,t)=>{let r=e.get("inspector").get("editors");r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:t?U:et.TextField}),r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:t?G:et.TextArea})};var F=_(Ce()),Pe=_(be()),Ft=_(we()),qr=_(R()),Jr=(e,t)=>{let r=e.get("containers"),n=r.get("App"),i=s=>{let o=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[a,c]=F.default.useState(o?.open),l=y=>{c(y),o.open=y,localStorage.setItem("NEOSidekick",JSON.stringify(o))},[u,h]=F.default.useState(o?.fullscreen),g=y=>{h(y),o.fullscreen=y,localStorage.setItem("NEOSidekick",JSON.stringify(o))},p=(y,v,w)=>{if(y)return F.default.createElement(Pe.IconButton,{icon:v?"compress":"expand",onClick:w})},m=(y,v,w)=>{if(!v)return F.default.createElement(Pe.IconButton,{icon:y?"chevron-circle-right":"chevron-circle-left",onClick:w})},S=(0,Ft.useSelector)(qr.selectors.CR.ContentDimensions.active),O=(0,Ft.useSelector)(y=>y?.user?.preferences?.interfaceLanguage),f=new URL(`${t.apiDomain}/chat/`);return f.searchParams.append("contentLanguage",S.language?S.language[0]:t.defaultLanguage),f.searchParams.append("interfaceLanguage",O),f.searchParams.append("userId",t.userId),f.searchParams.append("plattform","neos"),f.searchParams.append("domain",t.domain),f.searchParams.append("siteName",t.siteName),t?.referral&&f.searchParams.append("referral",t?.referral),t?.apiKey&&f.searchParams.append("apikey",t?.apiKey),F.default.createElement("div",{className:`neosidekick_appWrapper ${a?"neosidekick_appWrapper--sidebar-open":""}  ${u?"neosidekick_appWrapper--sidebar-fullscreen":""}`},F.default.createElement(n,{...s}),F.default.createElement("div",{className:"neosidekick_sideBar"},F.default.createElement("div",{className:"neosidekick_sideBar__title"},F.default.createElement(Pe.Headline,{className:`neosidekick_sideBar__title-headline ${a?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),F.default.createElement("div",null,p(a,u,()=>g(!u)),m(a,u,()=>l(!a)))),F.default.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${a?"neosidekick_sideBar__frame--open":""}`,src:f.toString(),allow:"clipboard-write",onLoad:y=>y.target.dataset.loaded=!0})))};r.set("App",i)};var Ee=_(R()),tn=_(tt());var Vr=_(tt()),rt=_(R()),Xr=(e,t)=>function*(){yield(0,Vr.takeEvery)(rt.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(r){r.payload.feedbackEnvelope.feedbacks.forEach(n=>{if(n.type!=="Neos.Neos.Ui:NodeCreated")return;let s=n.payload.contextPath.split("@")[0],o=t.getState(),a=rt.selectors.CR.Nodes.nodesByContextPathSelector(o),c=e.get("@neos-project/neos-ui-contentrepository"),l=e.get("i18n"),u=e.get("NEOSidekick.AiAssistant").get("contentService"),h=e.get("NEOSidekick.AiAssistant").get("assistantService"),g=e.get("NEOSidekick.AiAssistant").get("externalService");Object.keys(a).forEach(p=>{if(!p.split("@")[0].startsWith(s))return;let S=a[p],O=a[S.parent],f=c.get(S.nodeType);Object.keys(f.properties).forEach(y=>{u.evaluateNodeTypeConfigurationAndStartGeneration(S,y,f,O,!0)})})})})};var Zr=_(tt()),Qr=_(R()),en=(e,t)=>function*(){yield(0,Zr.takeEvery)(Qr.actionTypes.CR.Nodes.REMOVE,function*(r){console.log("Payload: ",r);let n=e.get("NEOSidekick.AiAssistant").get("assistantService");if(n.currentlyHandledNodePath===r.payload){n.resetCurrentlyHandledNodePath();let i={version:"1.0",eventName:"cancel-call-module"};console.log("Message: ",i),n.sendMessageToIframe(i)}})};function ms(e){return new Promise(t=>setTimeout(t,e))}var rn=(e,t,r,n)=>{let i=!1,s=function*(){yield(0,tn.takeLatest)([Ee.actionTypes.UI.ContentCanvas.SET_SRC,Ee.actionTypes.UI.ContentCanvas.RELOAD,Ee.actionTypes.CR.Nodes.MERGE],async function*(a){a.type===Ee.actionTypes.UI.ContentCanvas.SET_SRC&&(i=!0),yield ms(500);let c=e.get("@neos-project/neos-ui-contentrepository"),l=t.getState(),u=l?.ui?.contentCanvas?.previewUrl,h=n.getCurrentDocumentNode(),g=h?.contextPath,p=Object.values(l?.cr?.nodes?.byContextPath||{}).filter(m=>{let S=c.getRole("document");if(!S)throw new Error("Document role is not loaded!");let O=c.getSubTypesOf(S);return g&&m.contextPath.indexOf(g.split("@")[0])===0&&(m.contextPath===g||!O.includes(m.nodeType))});r.sendMessageToIframe({version:"1.0",eventName:i?"page-changed":"page-updated",data:{url:u,title:h?.properties?.title||n.getGuestFrameDocumentTitle(),content:n.getGuestFrameDocumentHtml(),structuredContent:p,targetAudience:await n.getCurrentDocumentTargetAudience(),pageBriefing:await n.getCurrentDocumentPageBriefing(),focusKeyword:await n.getCurrentDocumentFocusKeyword()}}),i=!1})},o=e.get("sagas");o.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:s}),o.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:Xr(e,t)}),o.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:en(e,t)})};var Oe=_(Ce()),nn=_(we()),nt=_(Ze()),it=_(be()),sn=_(Qe()),on=_(R());var Y=class extends Oe.PureComponent{constructor(r){super(r);d(this,"state",{show:!1,enabled:!0});d(this,"evaluateFocusedNodeAndPropertyAndShowButton",(r=5)=>{let{nodeType:n,property:i}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();if(!n||!i){if(r===0)return;setTimeout(()=>this.evaluateFocusedNodeAndPropertyAndShowButton(r-1),100);return}let s=n.properties[i];this.setState({show:s?.ui?.inlineEditable===!0&&s?.options?.sidekick?.module!==void 0})});d(this,"onClick",async()=>{let{addFlashMessage:r,i18nRegistry:n,contentService:i}=this.props;try{this.setState({enabled:!1});let{node:s,nodeType:o,parentNode:a,property:c}=i.getCurrentlyFocusedNodePathAndProperty();await i.evaluateNodeTypeConfigurationAndStartGeneration(s,c,o,a)}catch(s){r(s?.code??s?.message,s?.code?n.translate("NEOSidekick.AiAssistant:Error:"+s.code,s.message,{0:s.externalMessage}):s.message,s?.severity??"error")}finally{setTimeout(()=>{this.setState({enabled:!0})},2500)}})}componentDidMount(){this.evaluateFocusedNodeAndPropertyAndShowButton()}render(){let{i18nRegistry:r}=this.props;return this.state.show?Oe.default.createElement(it.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:r.translate("NEOSidekick.AiAssistant:Main:generate")},Oe.default.createElement(it.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),r.translate("NEOSidekick.AiAssistant:Main:generate")):""}};d(Y,"propTypes",{contentService:nt.default.object.isRequired,i18nRegistry:nt.default.object.isRequired,addFlashMessage:nt.default.func.isRequired}),Y=se([(0,sn.neos)(e=>({contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:e.get("i18n")})),(0,nn.connect)(()=>{},{addFlashMessage:on.actions.UI.FlashMessages.add})],Y);var an=e=>{e.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:generate",{component:Y,isVisible:()=>!0},"end")};Mt("NEOSidekick.AiAssistant",{},(e,{store:t,frontendConfiguration:r})=>{let n=r["NEOSidekick.AiAssistant"],i=!!n&&n.enabled!==!1;if($r(e,i),!i)return;if(!n.hasOwnProperty("defaultLanguage")||!n.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}e.set("NEOSidekick.AiAssistant",new $("")),e.get("NEOSidekick.AiAssistant").set("configuration",n);let s=Rt(r);e.get("NEOSidekick.AiAssistant").set("externalService",s);let o=Dr(e,t);e.get("NEOSidekick.AiAssistant").set("contentService",o);let a=Ir(e,t);e.get("NEOSidekick.AiAssistant").set("assistantService",a),a.listenToMessages(),Jr(e,n),rn(e,t,a,o),an(e)});})();
//# sourceMappingURL=Plugin.js.map
