(()=>{var un=Object.create;var at=Object.defineProperty;var Wt=Object.getOwnPropertyDescriptor;var dn=Object.getOwnPropertyNames;var fn=Object.getPrototypeOf,ln=Object.prototype.hasOwnProperty;var pn=(e,t)=>()=>(e&&(t=e(e=0)),t);var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var hn=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of dn(t))!ln.call(e,i)&&i!==r&&at(e,i,{get:()=>t[i],enumerable:!(n=Wt(t,i))||n.enumerable});return e};var g=(e,t,r)=>(r=e!=null?un(fn(e)):{},hn(t||!e||!e.__esModule?at(r,"default",{value:e,enumerable:!0}):r,e));var ce=(e,t,r,n)=>{for(var i=n>1?void 0:n?Wt(t,r):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(n?o(t,r,i):o(i))||i);return n&&i&&at(t,r,i),i};function w(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var M=pn(()=>{});var Se=K((Ws,Kt)=>{M();Kt.exports=w("NeosProjectPackages")().ReactUiComponents});var L=K((Ks,Lt)=>{M();Lt.exports=w("NeosProjectPackages")().NeosUiReduxStore});var Ae=K((zs,zt)=>{M();zt.exports=w("vendor")().React});var Ne=K((Us,Ht)=>{M();Ht.exports=w("vendor")().reactRedux});var Te=K((Gs,Ut)=>{M();Ut.exports=w("vendor")().reduxSagaEffects});var De=K((Js,$t)=>{M();$t.exports=w("vendor")().PropTypes});var Fe=K((Vs,Gt)=>{M();Gt.exports=w("NeosProjectPackages")().NeosUiDecorators});var Ur=K((Pe,he)=>{var xn=200,kn="Expected a function",xt="__lodash_hash_undefined__",qe=1,ge=2,Sr=1/0,Ar=9007199254740991,Ke="[object Arguments]",Nt="[object Array]",Nr="[object Boolean]",wr="[object Date]",Cr="[object Error]",br="[object Function]",Tn="[object GeneratorFunction]",Le="[object Map]",Pr="[object Number]",pe="[object Object]",fr="[object Promise]",Er="[object RegExp]",ze="[object Set]",Or="[object String]",xr="[object Symbol]",wt="[object WeakMap]",kr="[object ArrayBuffer]",He="[object DataView]",Dn="[object Float32Array]",Fn="[object Float64Array]",In="[object Int8Array]",Mn="[object Int16Array]",Rn="[object Int32Array]",jn="[object Uint8Array]",Wn="[object Uint8ClampedArray]",Bn="[object Uint16Array]",Kn="[object Uint32Array]",Ln=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zn=/^\w*$/,Hn=/^\./,Un=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,$n=/[\\^$.*+?()[\]{}|]/g,Gn=/\\(\\)?/g,qn=/^\[object .+?Constructor\]$/,Jn=/^(?:0|[1-9]\d*)$/,S={};S[Dn]=S[Fn]=S[In]=S[Mn]=S[Rn]=S[jn]=S[Wn]=S[Bn]=S[Kn]=!0;S[Ke]=S[Nt]=S[kr]=S[Nr]=S[He]=S[wr]=S[Cr]=S[br]=S[Le]=S[Pr]=S[pe]=S[Er]=S[ze]=S[Or]=S[wt]=!1;var Tr=typeof global=="object"&&global&&global.Object===Object&&global,Yn=typeof self=="object"&&self&&self.Object===Object&&self,X=Tr||Yn||Function("return this")(),Dr=typeof Pe=="object"&&Pe&&!Pe.nodeType&&Pe,lr=Dr&&typeof he=="object"&&he&&!he.nodeType&&he,Vn=lr&&lr.exports===Dr,pr=Vn&&Tr.process,hr=function(){try{return pr&&pr.binding("util")}catch{}}(),gr=hr&&hr.isTypedArray;function Xn(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function Zn(e){return function(t){return t?.[e]}}function Qn(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function ei(e){return function(t){return e(t)}}function ti(e,t){return e?.[t]}function Ct(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function ri(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function ni(e,t){return function(r){return e(t(r))}}function ii(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var si=Array.prototype,oi=Function.prototype,Je=Object.prototype,St=X["__core-js_shared__"],mr=function(){var e=/[^.]+$/.exec(St&&St.keys&&St.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Fr=oi.toString,$=Je.hasOwnProperty,me=Je.toString,ai=RegExp("^"+Fr.call($).replace($n,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yr=X.Symbol,_r=X.Uint8Array,ci=Je.propertyIsEnumerable,ui=si.splice,di=ni(Object.keys,Object),bt=ye(X,"DataView"),Ee=ye(X,"Map"),Pt=ye(X,"Promise"),Et=ye(X,"Set"),Ot=ye(X,"WeakMap"),Oe=ye(Object,"create"),fi=oe(bt),li=oe(Ee),pi=oe(Pt),hi=oe(Et),gi=oe(Ot),Ue=yr?yr.prototype:void 0,At=Ue?Ue.valueOf:void 0,vr=Ue?Ue.toString:void 0;function ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function mi(){this.__data__=Oe?Oe(null):{}}function yi(e){return this.has(e)&&delete this.__data__[e]}function _i(e){var t=this.__data__;if(Oe){var r=t[e];return r===xt?void 0:r}return $.call(t,e)?t[e]:void 0}function vi(e){var t=this.__data__;return Oe?t[e]!==void 0:$.call(t,e)}function Si(e,t){var r=this.__data__;return r[e]=Oe&&t===void 0?xt:t,this}ie.prototype.clear=mi;ie.prototype.delete=yi;ie.prototype.get=_i;ie.prototype.has=vi;ie.prototype.set=Si;function G(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ai(){this.__data__=[]}function Ni(e){var t=this.__data__,r=Ye(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():ui.call(t,r,1),!0}function wi(e){var t=this.__data__,r=Ye(t,e);return r<0?void 0:t[r][1]}function Ci(e){return Ye(this.__data__,e)>-1}function bi(e,t){var r=this.__data__,n=Ye(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}G.prototype.clear=Ai;G.prototype.delete=Ni;G.prototype.get=wi;G.prototype.has=Ci;G.prototype.set=bi;function q(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Pi(){this.__data__={hash:new ie,map:new(Ee||G),string:new ie}}function Ei(e){return Ve(this,e).delete(e)}function Oi(e){return Ve(this,e).get(e)}function xi(e){return Ve(this,e).has(e)}function ki(e,t){return Ve(this,e).set(e,t),this}q.prototype.clear=Pi;q.prototype.delete=Ei;q.prototype.get=Oi;q.prototype.has=xi;q.prototype.set=ki;function $e(e){var t=-1,r=e?e.length:0;for(this.__data__=new q;++t<r;)this.add(e[t])}function Ti(e){return this.__data__.set(e,xt),this}function Di(e){return this.__data__.has(e)}$e.prototype.add=$e.prototype.push=Ti;$e.prototype.has=Di;function U(e){this.__data__=new G(e)}function Fi(){this.__data__=new G}function Ii(e){return this.__data__.delete(e)}function Mi(e){return this.__data__.get(e)}function Ri(e){return this.__data__.has(e)}function ji(e,t){var r=this.__data__;if(r instanceof G){var n=r.__data__;if(!Ee||n.length<xn-1)return n.push([e,t]),this;r=this.__data__=new q(n)}return r.set(e,t),this}U.prototype.clear=Fi;U.prototype.delete=Ii;U.prototype.get=Mi;U.prototype.has=Ri;U.prototype.set=ji;function Wi(e,t){var r=se(e)||Lr(e)?Qn(e.length,String):[],n=r.length,i=!!n;for(var s in e)(t||$.call(e,s))&&!(i&&(s=="length"||jr(s,n)))&&r.push(s);return r}function Ye(e,t){for(var r=e.length;r--;)if(Kr(e[r][0],t))return r;return-1}var Bi=Qi();function Ki(e,t){return e&&Bi(e,t,Ge)}function Ir(e,t){t=Xe(t,e)?[t]:Mr(t);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Ze(t[r++])];return r&&r==n?e:void 0}function Li(e){return me.call(e)}function zi(e,t){return e!=null&&t in Object(e)}function kt(e,t,r,n,i){return e===t?!0:e==null||t==null||!Qe(e)&&!et(t)?e!==e&&t!==t:Hi(e,t,kt,r,n,i)}function Hi(e,t,r,n,i,s){var o=se(e),a=se(t),c=Nt,f=Nt;o||(c=V(e),c=c==Ke?pe:c),a||(f=V(t),f=f==Ke?pe:f);var u=c==pe&&!Ct(e),p=f==pe&&!Ct(t),h=c==f;if(h&&!u)return s||(s=new U),o||us(e)?Rr(e,t,r,n,i,s):es(e,t,c,r,n,i,s);if(!(i&ge)){var l=u&&$.call(e,"__wrapped__"),_=p&&$.call(t,"__wrapped__");if(l||_){var C=l?e.value():e,O=_?t.value():t;return s||(s=new U),r(C,O,n,i,s)}}return h?(s||(s=new U),ts(e,t,r,n,i,s)):!1}function Ui(e,t,r,n){var i=r.length,s=i,o=!n;if(e==null)return!s;for(e=Object(e);i--;){var a=r[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){a=r[i];var c=a[0],f=e[c],u=a[1];if(o&&a[2]){if(f===void 0&&!(c in e))return!1}else{var p=new U;if(n)var h=n(f,u,c,e,t,p);if(!(h===void 0?kt(u,f,n,qe|ge,p):h))return!1}}return!0}function $i(e){if(!Qe(e)||ss(e))return!1;var t=Hr(e)||Ct(e)?ai:qn;return t.test(oe(e))}function Gi(e){return et(e)&&Dt(e.length)&&!!S[me.call(e)]}function qi(e){return typeof e=="function"?e:e==null?hs:typeof e=="object"?se(e)?Vi(e[0],e[1]):Yi(e):gs(e)}function Ji(e){if(!os(e))return di(e);var t=[];for(var r in Object(e))$.call(e,r)&&r!="constructor"&&t.push(r);return t}function Yi(e){var t=rs(e);return t.length==1&&t[0][2]?Br(t[0][0],t[0][1]):function(r){return r===e||Ui(r,e,t)}}function Vi(e,t){return Xe(e)&&Wr(t)?Br(Ze(e),t):function(r){var n=fs(r,e);return n===void 0&&n===t?ls(r,e):kt(t,n,void 0,qe|ge)}}function Xi(e){return function(t){return Ir(t,e)}}function Zi(e){if(typeof e=="string")return e;if(Ft(e))return vr?vr.call(e):"";var t=e+"";return t=="0"&&1/e==-Sr?"-0":t}function Mr(e){return se(e)?e:as(e)}function Qi(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(r(s[c],c,s)===!1)break}return t}}function Rr(e,t,r,n,i,s){var o=i&ge,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var f=s.get(e);if(f&&s.get(t))return f==t;var u=-1,p=!0,h=i&qe?new $e:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var l=e[u],_=t[u];if(n)var C=o?n(_,l,u,t,e,s):n(l,_,u,e,t,s);if(C!==void 0){if(C)continue;p=!1;break}if(h){if(!Xn(t,function(O,d){if(!h.has(d)&&(l===O||r(l,O,n,i,s)))return h.add(d)})){p=!1;break}}else if(!(l===_||r(l,_,n,i,s))){p=!1;break}}return s.delete(e),s.delete(t),p}function es(e,t,r,n,i,s,o){switch(r){case He:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case kr:return!(e.byteLength!=t.byteLength||!n(new _r(e),new _r(t)));case Nr:case wr:case Pr:return Kr(+e,+t);case Cr:return e.name==t.name&&e.message==t.message;case Er:case Or:return e==t+"";case Le:var a=ri;case ze:var c=s&ge;if(a||(a=ii),e.size!=t.size&&!c)return!1;var f=o.get(e);if(f)return f==t;s|=qe,o.set(e,t);var u=Rr(a(e),a(t),n,i,s,o);return o.delete(e),u;case xr:if(At)return At.call(e)==At.call(t)}return!1}function ts(e,t,r,n,i,s){var o=i&ge,a=Ge(e),c=a.length,f=Ge(t),u=f.length;if(c!=u&&!o)return!1;for(var p=c;p--;){var h=a[p];if(!(o?h in t:$.call(t,h)))return!1}var l=s.get(e);if(l&&s.get(t))return l==t;var _=!0;s.set(e,t),s.set(t,e);for(var C=o;++p<c;){h=a[p];var O=e[h],d=t[h];if(n)var y=o?n(d,O,h,t,e,s):n(O,d,h,e,t,s);if(!(y===void 0?O===d||r(O,d,n,i,s):y)){_=!1;break}C||(C=h=="constructor")}if(_&&!C){var v=e.constructor,b=t.constructor;v!=b&&"constructor"in e&&"constructor"in t&&!(typeof v=="function"&&v instanceof v&&typeof b=="function"&&b instanceof b)&&(_=!1)}return s.delete(e),s.delete(t),_}function Ve(e,t){var r=e.__data__;return is(t)?r[typeof t=="string"?"string":"hash"]:r.map}function rs(e){for(var t=Ge(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Wr(i)]}return t}function ye(e,t){var r=ti(e,t);return $i(r)?r:void 0}var V=Li;(bt&&V(new bt(new ArrayBuffer(1)))!=He||Ee&&V(new Ee)!=Le||Pt&&V(Pt.resolve())!=fr||Et&&V(new Et)!=ze||Ot&&V(new Ot)!=wt)&&(V=function(e){var t=me.call(e),r=t==pe?e.constructor:void 0,n=r?oe(r):void 0;if(n)switch(n){case fi:return He;case li:return Le;case pi:return fr;case hi:return ze;case gi:return wt}return t});function ns(e,t,r){t=Xe(t,e)?[t]:Mr(t);for(var n,i=-1,o=t.length;++i<o;){var s=Ze(t[i]);if(!(n=e!=null&&r(e,s)))break;e=e[s]}if(n)return n;var o=e?e.length:0;return!!o&&Dt(o)&&jr(s,o)&&(se(e)||Lr(e))}function jr(e,t){return t=t??Ar,!!t&&(typeof e=="number"||Jn.test(e))&&e>-1&&e%1==0&&e<t}function Xe(e,t){if(se(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Ft(e)?!0:zn.test(e)||!Ln.test(e)||t!=null&&e in Object(t)}function is(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function ss(e){return!!mr&&mr in e}function os(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Je;return e===r}function Wr(e){return e===e&&!Qe(e)}function Br(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var as=Tt(function(e){e=ds(e);var t=[];return Hn.test(e)&&t.push(""),e.replace(Un,function(r,n,i,s){t.push(i?s.replace(Gn,"$1"):n||r)}),t});function Ze(e){if(typeof e=="string"||Ft(e))return e;var t=e+"";return t=="0"&&1/e==-Sr?"-0":t}function oe(e){if(e!=null){try{return Fr.call(e)}catch{}try{return e+""}catch{}}return""}function Tt(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(kn);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o),o};return r.cache=new(Tt.Cache||q),r}Tt.Cache=q;function Kr(e,t){return e===t||e!==e&&t!==t}function Lr(e){return cs(e)&&$.call(e,"callee")&&(!ci.call(e,"callee")||me.call(e)==Ke)}var se=Array.isArray;function zr(e){return e!=null&&Dt(e.length)&&!Hr(e)}function cs(e){return et(e)&&zr(e)}function Hr(e){var t=Qe(e)?me.call(e):"";return t==br||t==Tn}function Dt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Ar}function Qe(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function et(e){return!!e&&typeof e=="object"}function Ft(e){return typeof e=="symbol"||et(e)&&me.call(e)==xr}var us=gr?ei(gr):Gi;function ds(e){return e==null?"":Zi(e)}function fs(e,t,r){var n=e==null?void 0:Ir(e,t);return n===void 0?r:n}function ls(e,t){return e!=null&&ns(e,t,zi)}function Ge(e){return zr(e)?Wi(e):Ji(e)}function ps(e,t){var r={};return t=qi(t,3),Ki(e,function(n,i,s){r[i]=t(n,i,s)}),r}function hs(e){return e}function gs(e){return Xe(e)?Zn(Ze(e)):Xi(e)}he.exports=ps});var sn=K((Po,nn)=>{M();nn.exports=w("NeosProjectPackages")().NeosUiEditors});M();var ve=class{constructor(t){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=t}};var gn=(e,t="position",r="key")=>{let n=typeof t=="string"?d=>d[t]:t,i={},s={},o={},a={},c={},f={};e.forEach((d,y)=>{let v=d[r]?d[r]:String(y);i[v]=y;let b=n(d),A=String(b||y),J=!1;if(A.startsWith("start")){let m=A.match(/start\s+(\d+)/),N=m&&m[1]?Number(m[1]):0;o[N]||(o[N]=[]),o[N].push(v)}else if(A.startsWith("end")){let m=A.match(/end\s+(\d+)/),N=m&&m[1]?Number(m[1]):0;a[N]||(a[N]=[]),a[N].push(v)}else if(A.startsWith("before")){let m=A.match(/before\s+(\S+)(\s+(\d+))?/);if(!m)J=!0;else{let N=m[1],I=m[3]?Number(m[3]):0;c[N]||(c[N]={}),c[N][I]||(c[N][I]=[]),c[N][I].push(v)}}else if(A.startsWith("after")){let m=A.match(/after\s+(\S+)(\s+(\d+))?/);if(!m)J=!0;else{let N=m[1],I=m[3]?Number(m[3]):0;f[N]||(f[N]={}),f[N][I]||(f[N][I]=[]),f[N][I].push(v)}}else J=!0;if(J){let m=parseFloat(A);(isNaN(m)||!isFinite(m))&&(m=y),s[m]||(s[m]=[]),s[m].push(v)}});let u=[],p=[],h=[],l=[],_=(d,y)=>{let v=Object.keys(d).map(b=>Number(b)).sort((b,A)=>b-A);return y?v:v.reverse()},C=(d,y)=>{d.forEach(v=>{if(!(l.indexOf(v)>=0)){if(l.push(v),c[v]){let b=_(c[v],!0);for(let A of b)C(c[v][A],y)}if(y.push(v),f[v]){let b=_(f[v],!1);for(let A of b)C(f[v][A],y)}}})};for(let d of _(o,!1))C(o[d],u);for(let d of _(s,!0))C(s[d],p);for(let d of _(a,!0))C(a[d],h);for(let d of Object.keys(c))if(!(l.indexOf(d)>=0))for(let y of _(c[d],!1))C(c[d][y],u);for(let d of Object.keys(f))if(!(l.indexOf(d)>=0))for(let y of _(f[d],!1))C(f[d][y],p);return[...u,...p,...h].map(d=>i[d]).map(d=>e[d])},ct=gn;var Y=class extends ve{constructor(t){super(t),this._registry=[]}set(t,r,n=0){if(typeof t!="string")throw new Error("Key must be a string");if(typeof n!="string"&&typeof n!="number")throw new Error("Position must be a string or a number");let i={key:t,value:r};n&&(i.position=n);let s=this._registry.findIndex(o=>o.key===t);return s===-1?this._registry.push(i):this._registry[s]=i,r}get(t){if(typeof t!="string")return console.error("Key must be a string"),null;let r=this._registry.find(n=>n.key===t);return r?r.value:null}_getChildrenWrapped(t){let r=this._registry.filter(n=>n.key.indexOf(t+"/")===0);return ct(r)}getChildrenAsObject(t){let r={};return this._getChildrenWrapped(t).forEach(n=>{r[n.key]=n.value}),r}getChildren(t){return this._getChildrenWrapped(t).map(r=>r.value)}has(t){return typeof t!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(r=>r.key===t)}_getAllWrapped(){return ct(this._registry)}getAllAsObject(){let t={};return this._getAllWrapped().forEach(r=>{t[r.key]=r.value}),t}getAllAsList(){return this._getAllWrapped().map(t=>Object.assign({id:t.key},t.value))}};var Bt=w("manifest");var ke=g(Se()),ae=g(L()),F=g(Ae()),Rt=g(Ne()),on=g(Te());var j=g(Ae()),qt=g(Ne()),P=g(De()),Jt=g(Fe()),Q=g(Se()),ue=g(L());var yn={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},z=class extends j.Component{constructor(r){super(r);this.state={loading:!1};this.getIcon=r=>r?j.default.createElement(Q.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):j.default.createElement(Q.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:f,node:u,parentNode:p,frontendConfiguration:h}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,u,p),n=Object.keys(n).map(_=>({identifier:_,value:n[_]}));let l=await s.generate(r,a.language?a.language[0]:h.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?f.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}}}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:f}=this.props,u=Object.assign({},yn,o),p=o&&o.placeholder&&a.translate(unescape(o.placeholder)),h=!(u.readonly||u.disabled);return j.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},j.default.createElement("div",null,j.default.createElement(Q.TextInput,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:p,onKeyPress:c,onEnterKey:f})),h?j.default.createElement("div",{style:{"margin-top":"4px"}},j.default.createElement(Q.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};z.propTypes={className:P.default.string,value:P.default.oneOfType([P.default.string,P.default.number]),commit:P.default.func.isRequired,options:P.default.object,onKeyPress:P.default.func,onEnterKey:P.default.func,id:P.default.string,activeContentDimensions:P.default.object.isRequired,node:P.default.object,parentNode:P.default.object,i18nRegistry:P.default.object.isRequired,externalService:P.default.object.isRequired,contentService:P.default.object.isRequired,addFlashMessage:P.default.func.isRequired,frontendConfiguration:P.default.object},z.defaultProps={options:{}},z=ce([(0,Jt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,qt.connect)(e=>t=>{let r=ue.selectors.CR.ContentDimensions.active(t),n=ue.selectors.CR.Nodes.focusedSelector(t),i=ue.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:ue.actions.UI.FlashMessages.add})],z);var W=g(Ae()),Yt=g(Ne()),E=g(De()),Vt=g(Fe()),ee=g(Se()),de=g(L());var _n={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},H=class extends W.Component{constructor(r){super(r);this.getIcon=r=>r?W.default.createElement(ee.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):W.default.createElement(ee.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:f,node:u,parentNode:p,frontendConfiguration:h}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,u,p),n=Object.keys(n).map(_=>({identifier:_,value:n[_]}));let l=await s.generate(r,a.language?a.language[0]:h.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?f.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}};this.state={loading:!1}}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:f}=this.props,u=Object.assign({},_n,o),p=o&&o.placeholder&&a.translate(unescape(o.placeholder)),h=!(u.readonly||u.disabled);return W.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},W.default.createElement("div",null,W.default.createElement(ee.TextArea,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:p,minRows:u.minRows,expandedRows:u.expandedRows,onKeyPress:c,onEnterKey:f})),h?W.default.createElement("div",null,W.default.createElement(ee.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};H.propTypes={className:E.default.string,value:E.default.oneOfType([E.default.string,E.default.number]),commit:E.default.func.isRequired,options:E.default.object,onKeyPress:E.default.func,onEnterKey:E.default.func,id:E.default.string,activeContentDimensions:E.default.object.isRequired,node:E.default.object,parentNode:E.default.object,i18nRegistry:E.default.object.isRequired,externalService:E.default.object.isRequired,contentService:E.default.object.isRequired,addFlashMessage:E.default.func.isRequired,frontendConfiguration:E.default.object},H.defaultProps={options:{}},H=ce([(0,Vt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Yt.connect)(e=>t=>{let r=de.selectors.CR.ContentDimensions.active(t),n=de.selectors.CR.Nodes.focusedSelector(t),i=de.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:de.actions.UI.FlashMessages.add})],H);var x=class extends Error{constructor(r,n,i=""){super(r);this.severity="error";this.code=n,this.externalMessage=i}};var Xt=e=>{let t=e["NEOSidekick.AiAssistant"];return new ut(t.apiDomain,t.apiKey)},ut=class{constructor(t,r){this.apiDomain="";this.apiKey="";this.hasApiKey=()=>this.apiKey!==null&&this.apiKey!=="";this.generate=async(t,r,n={})=>{if(!this.apiKey)throw new x("This feature is not available in the free version.","1688157373215");let i=await fetch(`${this.apiDomain}/api/v1/chat?language=${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:t,platform:"neos",user_input:n})}),s=await i.json();if(i.status===401)throw new x("The NEOSidekick api key provided is not valid.","1688158193038");if(i.status<200||i.status>=400)throw new x("An error occurred while asking NEOSidekick.","1688158257149",s?.message);let o=s?.data?.message?.message;return o.startsWith('"')&&o.endsWith('"')&&(o=o.substr(1,o.length-2)),o};this.apiDomain=t,this.apiKey=r}};M();var Zt=w("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:so}=w("NeosProjectPackages")().NeosUiBackendConnector;var _e=g(L());var ir=Symbol.for("immer-nothing"),Qt=Symbol.for("immer-draftable"),T=Symbol.for("immer-state");function R(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var fe=Object.getPrototypeOf;function le(e){return!!e&&!!e[T]}function re(e){return e?sr(e)||Array.isArray(e)||!!e[Qt]||!!e.constructor?.[Qt]||je(e)||We(e):!1}var vn=Object.prototype.constructor.toString();function sr(e){if(!e||typeof e!="object")return!1;let t=fe(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===vn}function we(e,t){Re(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function Re(e){let t=e[T];return t?t.type_:Array.isArray(e)?1:je(e)?2:We(e)?3:0}function lt(e,t){return Re(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function or(e,t,r){let n=Re(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Sn(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function je(e){return e instanceof Map}function We(e){return e instanceof Set}function te(e){return e.copy_||e.base_}function pt(e,t){if(je(e))return new Map(e);if(We(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&sr(e))return fe(e)?{...e}:Object.assign(Object.create(null),e);let r=Object.getOwnPropertyDescriptors(e);delete r[T];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){let s=n[i],o=r[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(fe(e),r)}function _t(e,t=!1){return Be(e)||le(e)||!re(e)||(Re(e)>1&&(e.set=e.add=e.clear=e.delete=An),Object.freeze(e),t&&we(e,(r,n)=>_t(n,!0),!0)),e}function An(){R(2)}function Be(e){return Object.isFrozen(e)}var Nn={};function ne(e){let t=Nn[e];return t||R(0,e),t}var Ce;function ar(){return Ce}function wn(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function er(e,t){t&&(ne("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function ht(e){gt(e),e.drafts_.forEach(Cn),e.drafts_=null}function gt(e){e===Ce&&(Ce=e.parent_)}function tr(e){return Ce=wn(Ce,e)}function Cn(e){let t=e[T];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function rr(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[T].modified_&&(ht(t),R(4)),re(e)&&(e=Ie(t,e),t.parent_||Me(t,e)),t.patches_&&ne("Patches").generateReplacementPatches_(r[T].base_,e,t.patches_,t.inversePatches_)):e=Ie(t,r,[]),ht(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ir?e:void 0}function Ie(e,t,r){if(Be(t))return t;let n=t[T];if(!n)return we(t,(i,s)=>nr(e,n,t,i,s,r),!0),t;if(n.scope_!==e)return t;if(!n.modified_)return Me(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let i=n.copy_,s=i,o=!1;n.type_===3&&(s=new Set(i),i.clear(),o=!0),we(s,(a,c)=>nr(e,n,i,a,c,r,o)),Me(e,i,!1),r&&e.patches_&&ne("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function nr(e,t,r,n,i,s,o){if(le(i)){let a=s&&t&&t.type_!==3&&!lt(t.assigned_,n)?s.concat(n):void 0,c=Ie(e,i,a);if(or(r,n,c),le(c))e.canAutoFreeze_=!1;else return}else o&&r.add(i);if(re(i)&&!Be(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ie(e,i),(!t||!t.scope_.parent_)&&Me(e,i)}}function Me(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&_t(t,r)}function bn(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:ar(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=n,s=vt;r&&(i=[n],s=be);let{revoke:o,proxy:a}=Proxy.revocable(i,s);return n.draft_=a,n.revoke_=o,a}var vt={get(e,t){if(t===T)return e;let r=te(e);if(!lt(r,t))return Pn(e,r,t);let n=r[t];return e.finalized_||!re(n)?n:n===dt(e.base_,t)?(ft(e),e.copy_[t]=yt(n,e)):n},has(e,t){return t in te(e)},ownKeys(e){return Reflect.ownKeys(te(e))},set(e,t,r){let n=cr(te(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let i=dt(te(e),t),s=i?.[T];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Sn(r,i)&&(r!==void 0||lt(e.base_,t)))return!0;ft(e),mt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return dt(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ft(e),mt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=te(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){R(11)},getPrototypeOf(e){return fe(e.base_)},setPrototypeOf(){R(12)}},be={};we(vt,(e,t)=>{be[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});be.deleteProperty=function(e,t){return be.set.call(this,e,t,void 0)};be.set=function(e,t,r){return vt.set.call(this,e[0],t,r,e[0])};function dt(e,t){let r=e[T];return(r?te(r):e)[t]}function Pn(e,t,r){let n=cr(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function cr(e,t){if(!(t in e))return;let r=fe(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=fe(r)}}function mt(e){e.modified_||(e.modified_=!0,e.parent_&&mt(e.parent_))}function ft(e){e.copy_||(e.copy_=pt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var En=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let s=r;r=t;let o=this;return function(c=s,...f){return o.produce(c,u=>r.call(this,u,...f))}}typeof r!="function"&&R(6),n!==void 0&&typeof n!="function"&&R(7);let i;if(re(t)){let s=tr(this),o=yt(t,void 0),a=!0;try{i=r(o),a=!1}finally{a?ht(s):gt(s)}return er(s,n),rr(i,s)}else if(!t||typeof t!="object"){if(i=r(t),i===void 0&&(i=t),i===ir&&(i=void 0),this.autoFreeze_&&_t(i,!0),n){let s=[],o=[];ne("Patches").generateReplacementPatches_(t,i,s,o),n(s,o)}return i}else R(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let n,i;return[this.produce(t,r,(o,a)=>{n=o,i=a}),n,i]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){re(e)||R(8),le(e)&&(e=On(e));let t=tr(this),r=yt(e,void 0);return r[T].isManual_=!0,gt(t),r}finishDraft(e,t){let r=e&&e[T];(!r||!r.isManual_)&&R(9);let{scope_:n}=r;return er(n,t),rr(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let i=t[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(t=t.slice(r+1));let n=ne("Patches").applyPatches_;return le(e)?n(e,t):this.produce(e,i=>n(i,t))}};function yt(e,t){let r=je(e)?ne("MapSet").proxyMap_(e,t):We(e)?ne("MapSet").proxySet_(e,t):bn(e,t);return(t?t.scope_:ar()).drafts_.push(r),r}function On(e){return le(e)||R(10,e),ur(e)}function ur(e){if(!re(e)||Be(e))return e;let t=e[T],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=pt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=pt(e,!0);return we(r,(n,i)=>{or(r,n,ur(i))}),t&&(t.finalized_=!1),r}var D=new En,dr=D.produce,ao=D.produceWithPatches.bind(D),co=D.setAutoFreeze.bind(D),uo=D.setUseStrictShallowCopy.bind(D),fo=D.applyPatches.bind(D),lo=D.createDraft.bind(D),po=D.finishDraft.bind(D);var $r=g(Ur()),Gr=(e,t)=>new It(e,t),It=class{constructor(t,r){this.getGuestFrameDocumentTitle=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title;this.getGuestFrameDocumentHtml=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML;this.getCurrentDocumentNode=()=>{let t=this.store.getState(),r=t?.cr?.nodes?.documentNode;return t?.cr?.nodes?.byContextPath[r]};this.getCurrentDocumentParentNode=()=>{let t=this.store.getState(),r=this.getCurrentDocumentNode();return t?.cr?.nodes?.byContextPath[r.parent]};this.getCurrentDocumentNodeType=()=>{let t=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(t?.nodeType)};this.getCurrentDocumentTargetAudience=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return t?await this.processClientEval(t):null};this.getCurrentDocumentPageBriefing=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return t?await this.processClientEval(t):null};this.getCurrentDocumentFocusKeyword=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return t?await this.processClientEval(t):null};this.processClientEval=async(t,r=null,n=null)=>{if(typeof t=="string"&&(t.startsWith("SidekickClientEval:")||t.startsWith("ClientEval:")))try{r=r??this.getCurrentDocumentNode();let i=_e.selectors.UI.Inspector.transientValues(this.store.getState());r=this.generateNodeForContext(r,i),n=n??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),a=await this.getImageMetadata,c=Object.getPrototypeOf(async function(){}).constructor;return await new c("node,parentNode,documentTitle,documentContent,AssetUri","return "+t.replace("SidekickClientEval:","").replace("ClientEval:",""))(r,n,s,o,a)}catch(i){throw i instanceof x?i:(console.error(i),new x('An error occurred while trying to evaluate "'+t+'"',"1694682118365",t))}return t};this.processValueWithClientEval=async(t,r=null,n=null)=>{if(typeof t=="string")return this.processClientEval(t,r,n);if(typeof t=="object"&&t!==null)return this.processObjectWithClientEval(t,r,n);if(Array.isArray(t))return Promise.all(t.map(async i=>this.processObjectWithClientEval(i,r,n)))};this.processObjectWithClientEval=async(t,r=null,n=null)=>{let i={};return await Promise.all(Object.keys(t).map(async s=>{let o=t[s];i[s]=await this.processValueWithClientEval(o,r,n)})),i};this.getImageMetadata=async t=>{if(!t||!t?.__identity)throw new x("The property does not have a valid image.","1694595562191");let{loadImageMetadata:r}=Zt.get().endpoints,n,i;try{let o=await r(t?.__identity);n=o?.originalImageResourceUri,i=o?.previewImageResourceUri}catch{throw new x("Could not fetch image object.","1694595598880")}if(!n||n==="")throw new x("The given image does not have a correct url.","1694595462402");let s=[];return s.push(this.prependConfiguredDomainToImageUri(n)),i&&s.push(this.prependConfiguredDomainToImageUri(i)),s};this.globalRegistry=t,this.store=r,this.nodeTypesRegistry=t.get("@neos-project/neos-ui-contentrepository"),this.externalService=t.get("NEOSidekick.AiAssistant").get("externalService")}prependConfiguredDomainToImageUri(t){let r=this.globalRegistry.get("NEOSidekick.AiAssistant").get("configuration").domain;return t=t.replace("http://","").replace("https://").split("/"),t.shift(),t.unshift(r),t.join("/")}getCurrentlyFocusedNodePathAndProperty(){let t=this.store.getState(),r=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),n=t?.cr?.nodes?.focused?.contextPaths[0],i=n?_e.selectors.CR.Nodes.nodeByContextPath(t)(n):null;return{nodePath:n,node:i,property:t?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:i?r.get(i?.nodeType):null,parentNode:i?_e.selectors.CR.Nodes.nodesByContextPathSelector(t)[i.parent]:null}}async evaluateNodeTypeConfigurationAndStartGeneration(t,r,n,i=null,s=!1){if(!n||r[0]==="_")return;let o=n.properties[r];try{if(o?.options?.sidekick?.onCreate?.module)throw new x("Please do not use options.sidekick.onCreate.module anymore. Read the docs to find out about the new configuration.","1696264259260");if(!o?.options?.sidekick?.module||s&&o?.options?.sidekick?.onCreate!==!0)return;if(!o?.ui?.inlineEditable)throw new x("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new x("This feature is not available in the free version.","1688157373215")}catch(p){let h=this.globalRegistry.get("i18n");this.store.dispatch(_e.actions.UI.FlashMessages.add(p?.code??p?.message,p?.code?h.translate("NEOSidekick.AiAssistant:Error:"+p.code):p?.message,p?.severity??"error"));return}let a=JSON.parse(JSON.stringify(o.options.sidekick)),c=this.globalRegistry.get("NEOSidekick.AiAssistant").get("assistantService"),f=await this.processObjectWithClientEval(a,t,i),u={version:"1.0",eventName:"call-module",data:{platform:"neos",target:{nodePath:t.contextPath,propertyName:r},...f}};c.sendMessageToIframe(u)}generateNodeForContext(t,r){return r?dr(t,n=>{let i=(0,$r.default)(r,s=>s?.value);n.properties=Object.assign({},n.properties,i)}):t}};var qr=g(Te()),tt=g(L()),Jr=(e,t)=>function*(){yield(0,qr.takeEvery)(tt.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(r){r.payload.feedbackEnvelope.feedbacks.forEach(n=>{if(n.type!=="Neos.Neos.Ui:NodeCreated")return;let s=n.payload.contextPath.split("@")[0],o=t.getState(),a=tt.selectors.CR.Nodes.nodesByContextPathSelector(o),c=e.get("@neos-project/neos-ui-contentrepository"),f=e.get("i18n"),u=e.get("NEOSidekick.AiAssistant").get("contentService"),p=e.get("NEOSidekick.AiAssistant").get("assistantService"),h=e.get("NEOSidekick.AiAssistant").get("externalService");Object.keys(a).forEach(l=>{if(!l.split("@")[0].startsWith(s))return;let C=a[l],O=a[C.parent],d=c.get(C.nodeType);Object.keys(d.properties).forEach(y=>{u.evaluateNodeTypeConfigurationAndStartGeneration(C,y,d,O,!0)})})})})};var Yr=g(Te()),Vr=g(L()),Xr=(e,t)=>function*(){yield(0,Yr.takeEvery)(Vr.actionTypes.CR.Nodes.REMOVE,function*(r){console.log("Payload: ",r);let n=e.get("NEOSidekick.AiAssistant").get("assistantService");if(n.currentlyHandledNodePath===r.payload){n.resetCurrentlyHandledNodePath();let i={version:"1.0",eventName:"cancel-call-module"};console.log("Message: ",i),n.sendMessageToIframe(i)}})};var Zr=g(L()),Qr=(e,t)=>new Mt(e,t),Mt=class{constructor(t,r){this.sendMessageToIframe=t=>{if(this.currentlyHandledNodePath&&["page-changed","page-updated"].indexOf(t?.eventName)>-1)return;if(this.currentlyHandledNodePath&&["call-module"].indexOf(t?.eventName)>-1){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}t?.eventName==="call-module"&&(this.currentlyHandledNodePath=t?.data?.target?.nodePath);let r=setInterval(()=>{let n=document.getElementById("neosidekickAssistant");if(n.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",t),n.contentWindow.postMessage(t,"*"),clearInterval(r),t?.eventName==="call-module"&&this.resetCurrentlyHandledNodePathDebounced();else{console.log("not loaded, waiting...");return}},250)};this.listenToMessages=()=>{let t=setInterval(()=>{let r=document.getElementById("neosidekickAssistant");if(r?.dataset?.hasOwnProperty("loaded"))window.addEventListener("message",i=>{let s=r.contentWindow;i.source===s&&(console.log(i),this.handleMessage(i))}),clearInterval(t);else return},250)};this.handleMessage=t=>{if(console.info("Handle Sidekick Message: "+t.data.eventName),t?.data?.eventName==="write-content"){let{nodePath:r,propertyName:n,value:i,isFinished:s}=t.data.data;this.currentlyHandledNodePath=r,this.changePropertyValue(r,n,i,s)}else if(t?.data?.eventName==="stopped-generation")this.resetTypingCaret(),this.resetCurrentlyHandledNodePath();else if(t?.data?.eventName==="error"){let r=t?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+r,"error",r),this.resetTypingCaret(),this.resetCurrentlyHandledNodePath()}this.resetCurrentlyHandledNodePathDebounced()};this.changePropertyValue=(t,r,n,i=!1)=>{let a=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(`[data-__neos-editable-node-contextpath="${t}"][data-__neos-property="${r}"]`);if(!a){this.resetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(t)){a.classList.remove("typing-caret"),this.resetCurrentlyHandledNodePath();return}a?.ckeditorInstance?.setData(n),a?.classList.toggle("typing-caret",!i),i&&this.resetCurrentlyHandledNodePath()};this.globalRegistry=t,this.store=r,this.currentlyHandledNodePath=null}resetTypingCaret(){let n=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(".typing-caret");n&&n.classList.remove("typing-caret")}resetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetCurrentlyHandledNodePathDebounced(){let t,r=1e3;return()=>{clearTimeout(t),t=setTimeout(()=>{this.currentlyHandledNodePath=null},r)}}addFlashMessage(t,r,n="error",i=null){let s=this.globalRegistry.get("i18n");this.store.dispatch(Zr.actions.UI.FlashMessages.add(t,s.translate("NEOSidekick.AiAssistant:Error:"+t,r,{0:i}),n))}};var xe=g(Ae()),en=g(Ne()),rt=g(De()),nt=g(Se()),tn=g(Fe()),rn=g(L());var Z=class extends xe.PureComponent{constructor(r){super(r);this.state={show:!1,enabled:!0};this.evaluateFocusedNodeAndPropertyAndShowButton=(r=5)=>{let{nodeType:n,property:i}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();if(!n||!i){if(r===0)return;setTimeout(()=>this.evaluateFocusedNodeAndPropertyAndShowButton(r-1),100);return}let s=n.properties[i];this.setState({show:s?.ui?.inlineEditable===!0&&s?.options?.sidekick?.module!==void 0})};this.onClick=async()=>{let{addFlashMessage:r,i18nRegistry:n,contentService:i}=this.props;try{this.setState({enabled:!1});let{node:s,nodeType:o,parentNode:a,property:c}=i.getCurrentlyFocusedNodePathAndProperty();await i.evaluateNodeTypeConfigurationAndStartGeneration(s,c,o,a)}catch(s){r(s?.code??s?.message,s?.code?n.translate("NEOSidekick.AiAssistant:Error:"+s.code,s.message,{0:s.externalMessage}):s.message,s?.severity??"error")}finally{setTimeout(()=>{this.setState({enabled:!0})},2500)}}}componentDidMount(){this.evaluateFocusedNodeAndPropertyAndShowButton()}render(){let{i18nRegistry:r}=this.props;return this.state.show?xe.default.createElement(nt.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:r.translate("NEOSidekick.AiAssistant:Main:generate")},xe.default.createElement(nt.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),r.translate("NEOSidekick.AiAssistant:Main:generate")):""}};Z.propTypes={contentService:rt.default.object.isRequired,i18nRegistry:rt.default.object.isRequired,addFlashMessage:rt.default.func.isRequired},Z=ce([(0,tn.neos)(e=>({contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:e.get("i18n")})),(0,en.connect)(()=>{},{addFlashMessage:rn.actions.UI.FlashMessages.add})],Z);var it=g(sn());function an(e){return new Promise(t=>setTimeout(t,e))}Bt("NEOSidekick.AiAssistant",{},(e,{store:t,frontendConfiguration:r})=>{let n=e.get("inspector").get("editors");n.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:it.TextField}),n.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:it.TextArea});let i=r["NEOSidekick.AiAssistant"];if(i===null||i.enabled===!1)return;if(!i.hasOwnProperty("defaultLanguage")||!i.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}e.set("NEOSidekick.AiAssistant",new Y("")),e.get("NEOSidekick.AiAssistant").set("configuration",i);let s=Xt(r);e.get("NEOSidekick.AiAssistant").set("externalService",s);let o=Gr(e,t);e.get("NEOSidekick.AiAssistant").set("contentService",o);let a=Qr(e,t);e.get("NEOSidekick.AiAssistant").set("assistantService",a),a.listenToMessages();let c=e.get("containers"),f=c.get("App"),u=O=>{let d=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[y,v]=F.default.useState(d?.open),b=k=>{v(k),d.open=k,localStorage.setItem("NEOSidekick",JSON.stringify(d))},[A,J]=F.default.useState(d?.fullscreen),m=k=>{J(k),d.fullscreen=k,localStorage.setItem("NEOSidekick",JSON.stringify(d))},N=(k,st,ot)=>{if(k)return F.default.createElement(ke.IconButton,{icon:st?"compress":"expand",onClick:ot})},I=(k,st,ot)=>{if(!st)return F.default.createElement(ke.IconButton,{icon:k?"chevron-circle-right":"chevron-circle-left",onClick:ot})},jt=(0,Rt.useSelector)(ae.selectors.CR.ContentDimensions.active),cn=(0,Rt.useSelector)(k=>k?.user?.preferences?.interfaceLanguage),B=new URL(`${i.apiDomain}/chat/`);return B.searchParams.append("contentLanguage",jt.language?jt.language[0]:i.defaultLanguage),B.searchParams.append("interfaceLanguage",cn),B.searchParams.append("userId",i.userId),B.searchParams.append("plattform","neos"),B.searchParams.append("domain",i.domain),B.searchParams.append("siteName",i.siteName),i?.referral&&B.searchParams.append("referral",i?.referral),i?.apiKey&&B.searchParams.append("apikey",i?.apiKey),F.default.createElement("div",{className:`neosidekick_appWrapper ${y?"neosidekick_appWrapper--sidebar-open":""}  ${A?"neosidekick_appWrapper--sidebar-fullscreen":""}`},F.default.createElement(f,{...O}),F.default.createElement("div",{className:"neosidekick_sideBar"},F.default.createElement("div",{className:"neosidekick_sideBar__title"},F.default.createElement(ke.Headline,{className:`neosidekick_sideBar__title-headline ${y?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),F.default.createElement("div",null,N(y,A,()=>m(!A)),I(y,A,()=>b(!y)))),F.default.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${y?"neosidekick_sideBar__frame--open":""}`,src:B.toString(),allow:"clipboard-write",onLoad:k=>k.target.dataset.loaded=!0})))};c.set("App",u);let p=!1,h=function*(){yield(0,on.takeLatest)([ae.actionTypes.UI.ContentCanvas.SET_SRC,ae.actionTypes.UI.ContentCanvas.RELOAD,ae.actionTypes.CR.Nodes.MERGE],async function*(O){O.type===ae.actionTypes.UI.ContentCanvas.SET_SRC&&(p=!0),yield an(500);let d=e.get("@neos-project/neos-ui-contentrepository"),y=t.getState(),v=y?.ui?.contentCanvas?.previewUrl,b=o.getCurrentDocumentNode(),A=b?.contextPath,J=Object.values(y?.cr?.nodes?.byContextPath||{}).filter(m=>{let N=d.getRole("document");if(!N)throw new Error("Document role is not loaded!");let I=d.getSubTypesOf(N);return A&&m.contextPath.indexOf(A.split("@")[0])===0&&(m.contextPath===A||!I.includes(m.nodeType))});a.sendMessageToIframe({version:"1.0",eventName:p?"page-changed":"page-updated",data:{url:v,title:b?.properties?.title||o.getGuestFrameDocumentTitle(),content:o.getGuestFrameDocumentHtml(),structuredContent:J,targetAudience:await o.getCurrentDocumentTargetAudience(),pageBriefing:await o.getCurrentDocumentPageBriefing(),focusKeyword:await o.getCurrentDocumentFocusKeyword()}}),p=!1})},l=e.get("sagas");l.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:h}),l.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:Jr(e,t)}),l.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:Xr(e,t)}),n.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:z}),n.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:H}),e.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:generate",{component:Z,isVisible:()=>!0},"end")});})();
//# sourceMappingURL=Plugin.js.map
