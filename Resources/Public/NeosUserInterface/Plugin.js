(()=>{var ar=Object.create;var ot=Object.defineProperty;var Bt=Object.getOwnPropertyDescriptor;var cr=Object.getOwnPropertyNames;var ur=Object.getPrototypeOf,dr=Object.prototype.hasOwnProperty;var fr=(e,t)=>()=>(e&&(t=e(e=0)),t);var K=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var lr=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of cr(t))!dr.call(e,i)&&i!==n&&ot(e,i,{get:()=>t[i],enumerable:!(r=Bt(t,i))||r.enumerable});return e};var y=(e,t,n)=>(n=e!=null?ar(ur(e)):{},lr(t||!e||!e.__esModule?ot(n,"default",{value:e,enumerable:!0}):n,e));var ce=(e,t,n,r)=>{for(var i=r>1?void 0:r?Bt(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&ot(t,n,i),i};function w(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var M=fr(()=>{});var Se=K((Rs,Kt)=>{M();Kt.exports=w("NeosProjectPackages")().ReactUiComponents});var Y=K((Bs,Lt)=>{M();Lt.exports=w("NeosProjectPackages")().NeosUiReduxStore});var Ae=K((Ks,zt)=>{M();zt.exports=w("vendor")().React});var ke=K((zs,Ht)=>{M();Ht.exports=w("vendor")().reactRedux});var Te=K((Us,Ut)=>{M();Ut.exports=w("vendor")().reduxSagaEffects});var De=K((Gs,$t)=>{M();$t.exports=w("vendor")().PropTypes});var Fe=K((Js,Gt)=>{M();Gt.exports=w("NeosProjectPackages")().NeosUiDecorators});var $n=K((be,he)=>{var Er=200,Or="Expected a function",Ot="__lodash_hash_undefined__",qe=1,ge=2,An=1/0,Nn=9007199254740991,Ke="[object Arguments]",At="[object Array]",wn="[object Boolean]",Cn="[object Date]",bn="[object Error]",Pn="[object Function]",xr="[object GeneratorFunction]",Le="[object Map]",En="[object Number]",pe="[object Object]",ln="[object Promise]",On="[object RegExp]",ze="[object Set]",xn="[object String]",kn="[object Symbol]",Nt="[object WeakMap]",Tn="[object ArrayBuffer]",He="[object DataView]",kr="[object Float32Array]",Tr="[object Float64Array]",Dr="[object Int8Array]",Fr="[object Int16Array]",Ir="[object Int32Array]",Mr="[object Uint8Array]",Rr="[object Uint8ClampedArray]",jr="[object Uint16Array]",Br="[object Uint32Array]",Wr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Kr=/^\w*$/,Lr=/^\./,zr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Hr=/[\\^$.*+?()[\]{}|]/g,Ur=/\\(\\)?/g,$r=/^\[object .+?Constructor\]$/,Gr=/^(?:0|[1-9]\d*)$/,S={};S[kr]=S[Tr]=S[Dr]=S[Fr]=S[Ir]=S[Mr]=S[Rr]=S[jr]=S[Br]=!0;S[Ke]=S[At]=S[Tn]=S[wn]=S[He]=S[Cn]=S[bn]=S[Pn]=S[Le]=S[En]=S[pe]=S[On]=S[ze]=S[xn]=S[Nt]=!1;var Dn=typeof global=="object"&&global&&global.Object===Object&&global,qr=typeof self=="object"&&self&&self.Object===Object&&self,X=Dn||qr||Function("return this")(),Fn=typeof be=="object"&&be&&!be.nodeType&&be,pn=Fn&&typeof he=="object"&&he&&!he.nodeType&&he,Jr=pn&&pn.exports===Fn,hn=Jr&&Dn.process,gn=function(){try{return hn&&hn.binding("util")}catch{}}(),mn=gn&&gn.isTypedArray;function Yr(e,t){for(var n=-1,r=e?e.length:0;++n<r;)if(t(e[n],n,e))return!0;return!1}function Vr(e){return function(t){return t?.[e]}}function Xr(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Zr(e){return function(t){return e(t)}}function Qr(e,t){return e?.[t]}function wt(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function ei(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function ti(e,t){return function(n){return e(t(n))}}function ni(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var ri=Array.prototype,ii=Function.prototype,Je=Object.prototype,vt=X["__core-js_shared__"],yn=function(){var e=/[^.]+$/.exec(vt&&vt.keys&&vt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),In=ii.toString,U=Je.hasOwnProperty,me=Je.toString,si=RegExp("^"+In.call(U).replace(Hr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_n=X.Symbol,vn=X.Uint8Array,oi=Je.propertyIsEnumerable,ai=ri.splice,ci=ti(Object.keys,Object),Ct=ye(X,"DataView"),Pe=ye(X,"Map"),bt=ye(X,"Promise"),Pt=ye(X,"Set"),Et=ye(X,"WeakMap"),Ee=ye(Object,"create"),ui=oe(Ct),di=oe(Pe),fi=oe(bt),li=oe(Pt),pi=oe(Et),Ue=_n?_n.prototype:void 0,St=Ue?Ue.valueOf:void 0,Sn=Ue?Ue.toString:void 0;function ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function hi(){this.__data__=Ee?Ee(null):{}}function gi(e){return this.has(e)&&delete this.__data__[e]}function mi(e){var t=this.__data__;if(Ee){var n=t[e];return n===Ot?void 0:n}return U.call(t,e)?t[e]:void 0}function yi(e){var t=this.__data__;return Ee?t[e]!==void 0:U.call(t,e)}function _i(e,t){var n=this.__data__;return n[e]=Ee&&t===void 0?Ot:t,this}ie.prototype.clear=hi;ie.prototype.delete=gi;ie.prototype.get=mi;ie.prototype.has=yi;ie.prototype.set=_i;function $(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function vi(){this.__data__=[]}function Si(e){var t=this.__data__,n=Ye(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():ai.call(t,n,1),!0}function Ai(e){var t=this.__data__,n=Ye(t,e);return n<0?void 0:t[n][1]}function Ni(e){return Ye(this.__data__,e)>-1}function wi(e,t){var n=this.__data__,r=Ye(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}$.prototype.clear=vi;$.prototype.delete=Si;$.prototype.get=Ai;$.prototype.has=Ni;$.prototype.set=wi;function G(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ci(){this.__data__={hash:new ie,map:new(Pe||$),string:new ie}}function bi(e){return Ve(this,e).delete(e)}function Pi(e){return Ve(this,e).get(e)}function Ei(e){return Ve(this,e).has(e)}function Oi(e,t){return Ve(this,e).set(e,t),this}G.prototype.clear=Ci;G.prototype.delete=bi;G.prototype.get=Pi;G.prototype.has=Ei;G.prototype.set=Oi;function $e(e){var t=-1,n=e?e.length:0;for(this.__data__=new G;++t<n;)this.add(e[t])}function xi(e){return this.__data__.set(e,Ot),this}function ki(e){return this.__data__.has(e)}$e.prototype.add=$e.prototype.push=xi;$e.prototype.has=ki;function H(e){this.__data__=new $(e)}function Ti(){this.__data__=new $}function Di(e){return this.__data__.delete(e)}function Fi(e){return this.__data__.get(e)}function Ii(e){return this.__data__.has(e)}function Mi(e,t){var n=this.__data__;if(n instanceof $){var r=n.__data__;if(!Pe||r.length<Er-1)return r.push([e,t]),this;n=this.__data__=new G(r)}return n.set(e,t),this}H.prototype.clear=Ti;H.prototype.delete=Di;H.prototype.get=Fi;H.prototype.has=Ii;H.prototype.set=Mi;function Ri(e,t){var n=se(e)||zn(e)?Xr(e.length,String):[],r=n.length,i=!!r;for(var s in e)(t||U.call(e,s))&&!(i&&(s=="length"||Bn(s,r)))&&n.push(s);return n}function Ye(e,t){for(var n=e.length;n--;)if(Ln(e[n][0],t))return n;return-1}var ji=Xi();function Bi(e,t){return e&&ji(e,t,Ge)}function Mn(e,t){t=Xe(t,e)?[t]:Rn(t);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Ze(t[n++])];return n&&n==r?e:void 0}function Wi(e){return me.call(e)}function Ki(e,t){return e!=null&&t in Object(e)}function xt(e,t,n,r,i){return e===t?!0:e==null||t==null||!Qe(e)&&!et(t)?e!==e&&t!==t:Li(e,t,xt,n,r,i)}function Li(e,t,n,r,i,s){var o=se(e),a=se(t),c=At,u=At;o||(c=V(e),c=c==Ke?pe:c),a||(u=V(t),u=u==Ke?pe:u);var d=c==pe&&!wt(e),h=u==pe&&!wt(t),p=c==u;if(p&&!d)return s||(s=new H),o||as(e)?jn(e,t,n,r,i,s):Zi(e,t,c,n,r,i,s);if(!(i&ge)){var l=d&&U.call(e,"__wrapped__"),_=h&&U.call(t,"__wrapped__");if(l||_){var C=l?e.value():e,O=_?t.value():t;return s||(s=new H),n(C,O,r,i,s)}}return p?(s||(s=new H),Qi(e,t,n,r,i,s)):!1}function zi(e,t,n,r){var i=n.length,s=i,o=!r;if(e==null)return!s;for(e=Object(e);i--;){var a=n[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){a=n[i];var c=a[0],u=e[c],d=a[1];if(o&&a[2]){if(u===void 0&&!(c in e))return!1}else{var h=new H;if(r)var p=r(u,d,c,e,t,h);if(!(p===void 0?xt(d,u,r,qe|ge,h):p))return!1}}return!0}function Hi(e){if(!Qe(e)||rs(e))return!1;var t=Un(e)||wt(e)?si:$r;return t.test(oe(e))}function Ui(e){return et(e)&&Tt(e.length)&&!!S[me.call(e)]}function $i(e){return typeof e=="function"?e:e==null?ls:typeof e=="object"?se(e)?Ji(e[0],e[1]):qi(e):ps(e)}function Gi(e){if(!is(e))return ci(e);var t=[];for(var n in Object(e))U.call(e,n)&&n!="constructor"&&t.push(n);return t}function qi(e){var t=es(e);return t.length==1&&t[0][2]?Kn(t[0][0],t[0][1]):function(n){return n===e||zi(n,e,t)}}function Ji(e,t){return Xe(e)&&Wn(t)?Kn(Ze(e),t):function(n){var r=us(n,e);return r===void 0&&r===t?ds(n,e):xt(t,r,void 0,qe|ge)}}function Yi(e){return function(t){return Mn(t,e)}}function Vi(e){if(typeof e=="string")return e;if(Dt(e))return Sn?Sn.call(e):"";var t=e+"";return t=="0"&&1/e==-An?"-0":t}function Rn(e){return se(e)?e:ss(e)}function Xi(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[e?a:++i];if(n(s[c],c,s)===!1)break}return t}}function jn(e,t,n,r,i,s){var o=i&ge,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e);if(u&&s.get(t))return u==t;var d=-1,h=!0,p=i&qe?new $e:void 0;for(s.set(e,t),s.set(t,e);++d<a;){var l=e[d],_=t[d];if(r)var C=o?r(_,l,d,t,e,s):r(l,_,d,e,t,s);if(C!==void 0){if(C)continue;h=!1;break}if(p){if(!Yr(t,function(O,f){if(!p.has(f)&&(l===O||n(l,O,r,i,s)))return p.add(f)})){h=!1;break}}else if(!(l===_||n(l,_,r,i,s))){h=!1;break}}return s.delete(e),s.delete(t),h}function Zi(e,t,n,r,i,s,o){switch(n){case He:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Tn:return!(e.byteLength!=t.byteLength||!r(new vn(e),new vn(t)));case wn:case Cn:case En:return Ln(+e,+t);case bn:return e.name==t.name&&e.message==t.message;case On:case xn:return e==t+"";case Le:var a=ei;case ze:var c=s&ge;if(a||(a=ni),e.size!=t.size&&!c)return!1;var u=o.get(e);if(u)return u==t;s|=qe,o.set(e,t);var d=jn(a(e),a(t),r,i,s,o);return o.delete(e),d;case kn:if(St)return St.call(e)==St.call(t)}return!1}function Qi(e,t,n,r,i,s){var o=i&ge,a=Ge(e),c=a.length,u=Ge(t),d=u.length;if(c!=d&&!o)return!1;for(var h=c;h--;){var p=a[h];if(!(o?p in t:U.call(t,p)))return!1}var l=s.get(e);if(l&&s.get(t))return l==t;var _=!0;s.set(e,t),s.set(t,e);for(var C=o;++h<c;){p=a[h];var O=e[p],f=t[p];if(r)var m=o?r(f,O,p,t,e,s):r(O,f,p,e,t,s);if(!(m===void 0?O===f||n(O,f,r,i,s):m)){_=!1;break}C||(C=p=="constructor")}if(_&&!C){var v=e.constructor,b=t.constructor;v!=b&&"constructor"in e&&"constructor"in t&&!(typeof v=="function"&&v instanceof v&&typeof b=="function"&&b instanceof b)&&(_=!1)}return s.delete(e),s.delete(t),_}function Ve(e,t){var n=e.__data__;return ns(t)?n[typeof t=="string"?"string":"hash"]:n.map}function es(e){for(var t=Ge(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Wn(i)]}return t}function ye(e,t){var n=Qr(e,t);return Hi(n)?n:void 0}var V=Wi;(Ct&&V(new Ct(new ArrayBuffer(1)))!=He||Pe&&V(new Pe)!=Le||bt&&V(bt.resolve())!=ln||Pt&&V(new Pt)!=ze||Et&&V(new Et)!=Nt)&&(V=function(e){var t=me.call(e),n=t==pe?e.constructor:void 0,r=n?oe(n):void 0;if(r)switch(r){case ui:return He;case di:return Le;case fi:return ln;case li:return ze;case pi:return Nt}return t});function ts(e,t,n){t=Xe(t,e)?[t]:Rn(t);for(var r,i=-1,o=t.length;++i<o;){var s=Ze(t[i]);if(!(r=e!=null&&n(e,s)))break;e=e[s]}if(r)return r;var o=e?e.length:0;return!!o&&Tt(o)&&Bn(s,o)&&(se(e)||zn(e))}function Bn(e,t){return t=t??Nn,!!t&&(typeof e=="number"||Gr.test(e))&&e>-1&&e%1==0&&e<t}function Xe(e,t){if(se(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Dt(e)?!0:Kr.test(e)||!Wr.test(e)||t!=null&&e in Object(t)}function ns(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function rs(e){return!!yn&&yn in e}function is(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Je;return e===n}function Wn(e){return e===e&&!Qe(e)}function Kn(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var ss=kt(function(e){e=cs(e);var t=[];return Lr.test(e)&&t.push(""),e.replace(zr,function(n,r,i,s){t.push(i?s.replace(Ur,"$1"):r||n)}),t});function Ze(e){if(typeof e=="string"||Dt(e))return e;var t=e+"";return t=="0"&&1/e==-An?"-0":t}function oe(e){if(e!=null){try{return In.call(e)}catch{}try{return e+""}catch{}}return""}function kt(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(Or);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o),o};return n.cache=new(kt.Cache||G),n}kt.Cache=G;function Ln(e,t){return e===t||e!==e&&t!==t}function zn(e){return os(e)&&U.call(e,"callee")&&(!oi.call(e,"callee")||me.call(e)==Ke)}var se=Array.isArray;function Hn(e){return e!=null&&Tt(e.length)&&!Un(e)}function os(e){return et(e)&&Hn(e)}function Un(e){var t=Qe(e)?me.call(e):"";return t==Pn||t==xr}function Tt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Nn}function Qe(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function et(e){return!!e&&typeof e=="object"}function Dt(e){return typeof e=="symbol"||et(e)&&me.call(e)==kn}var as=mn?Zr(mn):Ui;function cs(e){return e==null?"":Vi(e)}function us(e,t,n){var r=e==null?void 0:Mn(e,t);return r===void 0?n:r}function ds(e,t){return e!=null&&ts(e,t,Ki)}function Ge(e){return Hn(e)?Ri(e):Gi(e)}function fs(e,t){var n={};return t=$i(t,3),Bi(e,function(r,i,s){n[i]=t(r,i,s)}),n}function ls(e){return e}function ps(e){return Xe(e)?Vr(Ze(e)):Yi(e)}he.exports=fs});var rr=K((Co,nr)=>{M();nr.exports=w("NeosProjectPackages")().NeosUiEditors});M();var ve=class{constructor(t){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=t}};var pr=(e,t="position",n="key")=>{let r=typeof t=="string"?f=>f[t]:t,i={},s={},o={},a={},c={},u={};e.forEach((f,m)=>{let v=f[n]?f[n]:String(m);i[v]=m;let b=r(f),A=String(b||m),q=!1;if(A.startsWith("start")){let g=A.match(/start\s+(\d+)/),N=g&&g[1]?Number(g[1]):0;o[N]||(o[N]=[]),o[N].push(v)}else if(A.startsWith("end")){let g=A.match(/end\s+(\d+)/),N=g&&g[1]?Number(g[1]):0;a[N]||(a[N]=[]),a[N].push(v)}else if(A.startsWith("before")){let g=A.match(/before\s+(\S+)(\s+(\d+))?/);if(!g)q=!0;else{let N=g[1],I=g[3]?Number(g[3]):0;c[N]||(c[N]={}),c[N][I]||(c[N][I]=[]),c[N][I].push(v)}}else if(A.startsWith("after")){let g=A.match(/after\s+(\S+)(\s+(\d+))?/);if(!g)q=!0;else{let N=g[1],I=g[3]?Number(g[3]):0;u[N]||(u[N]={}),u[N][I]||(u[N][I]=[]),u[N][I].push(v)}}else q=!0;if(q){let g=parseFloat(A);(isNaN(g)||!isFinite(g))&&(g=m),s[g]||(s[g]=[]),s[g].push(v)}});let d=[],h=[],p=[],l=[],_=(f,m)=>{let v=Object.keys(f).map(b=>Number(b)).sort((b,A)=>b-A);return m?v:v.reverse()},C=(f,m)=>{f.forEach(v=>{if(!(l.indexOf(v)>=0)){if(l.push(v),c[v]){let b=_(c[v],!0);for(let A of b)C(c[v][A],m)}if(m.push(v),u[v]){let b=_(u[v],!1);for(let A of b)C(u[v][A],m)}}})};for(let f of _(o,!1))C(o[f],d);for(let f of _(s,!0))C(s[f],h);for(let f of _(a,!0))C(a[f],p);for(let f of Object.keys(c))if(!(l.indexOf(f)>=0))for(let m of _(c[f],!1))C(c[f][m],d);for(let f of Object.keys(u))if(!(l.indexOf(f)>=0))for(let m of _(u[f],!1))C(u[f][m],h);return[...d,...h,...p].map(f=>i[f]).map(f=>e[f])},at=pr;var J=class extends ve{constructor(t){super(t),this._registry=[]}set(t,n,r=0){if(typeof t!="string")throw new Error("Key must be a string");if(typeof r!="string"&&typeof r!="number")throw new Error("Position must be a string or a number");let i={key:t,value:n};r&&(i.position=r);let s=this._registry.findIndex(o=>o.key===t);return s===-1?this._registry.push(i):this._registry[s]=i,n}get(t){if(typeof t!="string")return console.error("Key must be a string"),null;let n=this._registry.find(r=>r.key===t);return n?n.value:null}_getChildrenWrapped(t){let n=this._registry.filter(r=>r.key.indexOf(t+"/")===0);return at(n)}getChildrenAsObject(t){let n={};return this._getChildrenWrapped(t).forEach(r=>{n[r.key]=r.value}),n}getChildren(t){return this._getChildrenWrapped(t).map(n=>n.value)}has(t){return typeof t!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(n=>n.key===t)}_getAllWrapped(){return at(this._registry)}getAllAsObject(){let t={};return this._getAllWrapped().forEach(n=>{t[n.key]=n.value}),t}getAllAsList(){return this._getAllWrapped().map(t=>Object.assign({id:t.key},t.value))}};var Wt=w("manifest");var xe=y(Se()),ae=y(Y()),F=y(Ae()),Rt=y(ke()),ir=y(Te());var j=y(Ae()),qt=y(ke()),P=y(De()),Jt=y(Fe()),Q=y(Se()),ue=y(Y());var gr={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},L=class extends j.Component{constructor(n){super(n);this.state={loading:!1};this.getIcon=n=>n?j.default.createElement(Q.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):j.default.createElement(Q.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(n,r)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:u,node:d,parentNode:h,frontendConfiguration:p}=this.props;this.setState({loading:!0});try{r=await o.processObjectWithClientEval(Object.assign({},r),d,h),r=Object.keys(r).map(_=>({identifier:_,value:r[_]}));let l=await s.generate(n,a.language?a.language[0]:p.defaultLanguage,r);i(l)}catch(l){c(l?.code??l?.message,l?.code?u.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}}}render(){let{id:n,value:r,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:u}=this.props,d=Object.assign({},gr,o),h=o&&o.placeholder&&a.translate(unescape(o.placeholder)),p=!(d.readonly||d.disabled);return j.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},j.default.createElement("div",null,j.default.createElement(Q.TextInput,{id:n,value:r,onChange:s,disabled:d.disabled||this.state.loading,maxLength:d.maxlength,readOnly:d.readonly,placeholder:h,onKeyPress:c,onEnterKey:u})),p?j.default.createElement("div",{style:{"margin-top":"4px"}},j.default.createElement(Q.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(d.module,d.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};L.propTypes={className:P.default.string,value:P.default.oneOfType([P.default.string,P.default.number]),commit:P.default.func.isRequired,options:P.default.object,onKeyPress:P.default.func,onEnterKey:P.default.func,id:P.default.string,activeContentDimensions:P.default.object.isRequired,node:P.default.object,parentNode:P.default.object,i18nRegistry:P.default.object.isRequired,externalService:P.default.object.isRequired,contentService:P.default.object.isRequired,addFlashMessage:P.default.func.isRequired,frontendConfiguration:P.default.object},L.defaultProps={options:{}},L=ce([(0,Jt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,qt.connect)(e=>t=>{let n=ue.selectors.CR.ContentDimensions.active(t),r=ue.selectors.CR.Nodes.focusedSelector(t),i=ue.selectors.CR.Nodes.nodeByContextPath(t)(r.parent);return{activeContentDimensions:n,node:r,parentNode:i}},{addFlashMessage:ue.actions.UI.FlashMessages.add})],L);var B=y(Ae()),Yt=y(ke()),E=y(De()),Vt=y(Fe()),ee=y(Se()),de=y(Y());var mr={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},z=class extends B.Component{constructor(n){super(n);this.getIcon=n=>n?B.default.createElement(ee.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):B.default.createElement(ee.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(n,r)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:u,node:d,parentNode:h,frontendConfiguration:p}=this.props;this.setState({loading:!0});try{r=await o.processObjectWithClientEval(Object.assign({},r),d,h),r=Object.keys(r).map(_=>({identifier:_,value:r[_]}));let l=await s.generate(n,a.language?a.language[0]:p.defaultLanguage,r);i(l)}catch(l){c(l?.code??l?.message,l?.code?u.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}};this.state={loading:!1}}render(){let{id:n,value:r,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:u}=this.props,d=Object.assign({},mr,o),h=o&&o.placeholder&&a.translate(unescape(o.placeholder)),p=!(d.readonly||d.disabled);return B.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},B.default.createElement("div",null,B.default.createElement(ee.TextArea,{id:n,value:r,onChange:s,disabled:d.disabled||this.state.loading,maxLength:d.maxlength,readOnly:d.readonly,placeholder:h,minRows:d.minRows,expandedRows:d.expandedRows,onKeyPress:c,onEnterKey:u})),p?B.default.createElement("div",null,B.default.createElement(ee.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(d.module,d.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};z.propTypes={className:E.default.string,value:E.default.oneOfType([E.default.string,E.default.number]),commit:E.default.func.isRequired,options:E.default.object,onKeyPress:E.default.func,onEnterKey:E.default.func,id:E.default.string,activeContentDimensions:E.default.object.isRequired,node:E.default.object,parentNode:E.default.object,i18nRegistry:E.default.object.isRequired,externalService:E.default.object.isRequired,contentService:E.default.object.isRequired,addFlashMessage:E.default.func.isRequired,frontendConfiguration:E.default.object},z.defaultProps={options:{}},z=ce([(0,Vt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Yt.connect)(e=>t=>{let n=de.selectors.CR.ContentDimensions.active(t),r=de.selectors.CR.Nodes.focusedSelector(t),i=de.selectors.CR.Nodes.nodeByContextPath(t)(r.parent);return{activeContentDimensions:n,node:r,parentNode:i}},{addFlashMessage:de.actions.UI.FlashMessages.add})],z);var x=class extends Error{constructor(n,r,i){super(n);this.severity="error";this.code=r,this.externalMessage=i}};var Xt=e=>{let t=e["NEOSidekick.AiAssistant"];return new ct(t.apiDomain,t.apiKey)},ct=class{constructor(t,n){this.apiDomain="";this.apiKey="";this.hasApiKey=()=>this.apiKey!==null&&this.apiKey!=="";this.generate=async(t,n,r={})=>{if(!this.apiKey)throw new x("This feature is not available in the free version.","1688157373215");let i=await fetch(`${this.apiDomain}/api/v1/chat?language=${n}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:t,platform:"neos",user_input:r})}),s=await i.json();if(i.status===401)throw new x("The NEOSidekick api key provided is not valid.","1688158193038");if(i.status<200||i.status>=400)throw new x("An error occurred while asking NEOSidekick.","1688158257149",s?.message);let o=s?.data?.message?.message;return o.startsWith('"')&&o.endsWith('"')&&(o=o.substr(1,o.length-2)),o};this.apiDomain=t,this.apiKey=n}};M();var Zt=w("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:ro}=w("NeosProjectPackages")().NeosUiBackendConnector;var _e=y(Y());var sn=Symbol.for("immer-nothing"),Qt=Symbol.for("immer-draftable"),T=Symbol.for("immer-state");function R(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var fe=Object.getPrototypeOf;function le(e){return!!e&&!!e[T]}function ne(e){return e?on(e)||Array.isArray(e)||!!e[Qt]||!!e.constructor?.[Qt]||je(e)||Be(e):!1}var yr=Object.prototype.constructor.toString();function on(e){if(!e||typeof e!="object")return!1;let t=fe(e);if(t===null)return!0;let n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===yr}function Ne(e,t){Re(e)===0?Object.entries(e).forEach(([n,r])=>{t(n,r,e)}):e.forEach((n,r)=>t(r,n,e))}function Re(e){let t=e[T];return t?t.type_:Array.isArray(e)?1:je(e)?2:Be(e)?3:0}function ft(e,t){return Re(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function an(e,t,n){let r=Re(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function _r(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function je(e){return e instanceof Map}function Be(e){return e instanceof Set}function te(e){return e.copy_||e.base_}function lt(e,t){if(je(e))return new Map(e);if(Be(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&on(e))return fe(e)?{...e}:Object.assign(Object.create(null),e);let n=Object.getOwnPropertyDescriptors(e);delete n[T];let r=Reflect.ownKeys(n);for(let i=0;i<r.length;i++){let s=r[i],o=n[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(n[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(fe(e),n)}function yt(e,t=!1){return We(e)||le(e)||!ne(e)||(Re(e)>1&&(e.set=e.add=e.clear=e.delete=vr),Object.freeze(e),t&&Ne(e,(n,r)=>yt(r,!0),!0)),e}function vr(){R(2)}function We(e){return Object.isFrozen(e)}var Sr={};function re(e){let t=Sr[e];return t||R(0,e),t}var we;function cn(){return we}function Ar(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function en(e,t){t&&(re("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function pt(e){ht(e),e.drafts_.forEach(Nr),e.drafts_=null}function ht(e){e===we&&(we=e.parent_)}function tn(e){return we=Ar(we,e)}function Nr(e){let t=e[T];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function nn(e,t){t.unfinalizedDrafts_=t.drafts_.length;let n=t.drafts_[0];return e!==void 0&&e!==n?(n[T].modified_&&(pt(t),R(4)),ne(e)&&(e=Ie(t,e),t.parent_||Me(t,e)),t.patches_&&re("Patches").generateReplacementPatches_(n[T].base_,e,t.patches_,t.inversePatches_)):e=Ie(t,n,[]),pt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==sn?e:void 0}function Ie(e,t,n){if(We(t))return t;let r=t[T];if(!r)return Ne(t,(i,s)=>rn(e,r,t,i,s,n),!0),t;if(r.scope_!==e)return t;if(!r.modified_)return Me(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;let i=r.copy_,s=i,o=!1;r.type_===3&&(s=new Set(i),i.clear(),o=!0),Ne(s,(a,c)=>rn(e,r,i,a,c,n,o)),Me(e,i,!1),n&&e.patches_&&re("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function rn(e,t,n,r,i,s,o){if(le(i)){let a=s&&t&&t.type_!==3&&!ft(t.assigned_,r)?s.concat(r):void 0,c=Ie(e,i,a);if(an(n,r,c),le(c))e.canAutoFreeze_=!1;else return}else o&&n.add(i);if(ne(i)&&!We(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ie(e,i),(!t||!t.scope_.parent_)&&Me(e,i)}}function Me(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&yt(t,n)}function wr(e,t){let n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:cn(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=r,s=_t;n&&(i=[r],s=Ce);let{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}var _t={get(e,t){if(t===T)return e;let n=te(e);if(!ft(n,t))return Cr(e,n,t);let r=n[t];return e.finalized_||!ne(r)?r:r===ut(e.base_,t)?(dt(e),e.copy_[t]=mt(r,e)):r},has(e,t){return t in te(e)},ownKeys(e){return Reflect.ownKeys(te(e))},set(e,t,n){let r=un(te(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){let i=ut(te(e),t),s=i?.[T];if(s&&s.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(_r(n,i)&&(n!==void 0||ft(e.base_,t)))return!0;dt(e),gt(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return ut(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,dt(e),gt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let n=te(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},defineProperty(){R(11)},getPrototypeOf(e){return fe(e.base_)},setPrototypeOf(){R(12)}},Ce={};Ne(_t,(e,t)=>{Ce[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Ce.deleteProperty=function(e,t){return Ce.set.call(this,e,t,void 0)};Ce.set=function(e,t,n){return _t.set.call(this,e[0],t,n,e[0])};function ut(e,t){let n=e[T];return(n?te(n):e)[t]}function Cr(e,t,n){let r=un(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}function un(e,t){if(!(t in e))return;let n=fe(e);for(;n;){let r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=fe(n)}}function gt(e){e.modified_||(e.modified_=!0,e.parent_&&gt(e.parent_))}function dt(e){e.copy_||(e.copy_=lt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var br=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,r)=>{if(typeof t=="function"&&typeof n!="function"){let s=n;n=t;let o=this;return function(c=s,...u){return o.produce(c,d=>n.call(this,d,...u))}}typeof n!="function"&&R(6),r!==void 0&&typeof r!="function"&&R(7);let i;if(ne(t)){let s=tn(this),o=mt(t,void 0),a=!0;try{i=n(o),a=!1}finally{a?pt(s):ht(s)}return en(s,r),nn(i,s)}else if(!t||typeof t!="object"){if(i=n(t),i===void 0&&(i=t),i===sn&&(i=void 0),this.autoFreeze_&&yt(i,!0),r){let s=[],o=[];re("Patches").generateReplacementPatches_(t,i,s,o),r(s,o)}return i}else R(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let r,i;return[this.produce(t,n,(o,a)=>{r=o,i=a}),r,i]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){ne(e)||R(8),le(e)&&(e=Pr(e));let t=tn(this),n=mt(e,void 0);return n[T].isManual_=!0,ht(t),n}finishDraft(e,t){let n=e&&e[T];(!n||!n.isManual_)&&R(9);let{scope_:r}=n;return en(r,t),nn(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){let i=t[n];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}n>-1&&(t=t.slice(n+1));let r=re("Patches").applyPatches_;return le(e)?r(e,t):this.produce(e,i=>r(i,t))}};function mt(e,t){let n=je(e)?re("MapSet").proxyMap_(e,t):Be(e)?re("MapSet").proxySet_(e,t):wr(e,t);return(t?t.scope_:cn()).drafts_.push(n),n}function Pr(e){return le(e)||R(10,e),dn(e)}function dn(e){if(!ne(e)||We(e))return e;let t=e[T],n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=lt(e,t.scope_.immer_.useStrictShallowCopy_)}else n=lt(e,!0);return Ne(n,(r,i)=>{an(n,r,dn(i))}),t&&(t.finalized_=!1),n}var D=new br,fn=D.produce,so=D.produceWithPatches.bind(D),oo=D.setAutoFreeze.bind(D),ao=D.setUseStrictShallowCopy.bind(D),co=D.applyPatches.bind(D),uo=D.createDraft.bind(D),fo=D.finishDraft.bind(D);var Gn=y($n()),qn=(e,t)=>new Ft(e,t),Ft=class{constructor(t,n){this.getGuestFrameDocumentTitle=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title;this.getGuestFrameDocumentHtml=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML;this.getCurrentDocumentNode=()=>{let t=this.store.getState(),n=t?.cr?.nodes?.documentNode;return t?.cr?.nodes?.byContextPath[n]};this.getCurrentDocumentParentNode=()=>{let t=this.store.getState(),n=this.getCurrentDocumentNode();return t?.cr?.nodes?.byContextPath[n.parent]};this.getCurrentDocumentNodeType=()=>{let t=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(t?.nodeType)};this.getCurrentDocumentTargetAudience=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return t?await this.processClientEval(t):null};this.getCurrentDocumentPageBriefing=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return t?await this.processClientEval(t):null};this.getCurrentDocumentFocusKeyword=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return t?await this.processClientEval(t):null};this.processClientEval=async(t,n=null,r=null)=>{if(typeof t=="string"&&(t.startsWith("SidekickClientEval:")||t.startsWith("ClientEval:")))try{n=n??this.getCurrentDocumentNode();let i=_e.selectors.UI.Inspector.transientValues(this.store.getState());n=this.generateNodeForContext(n,i),r=r??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),a=await this.getImageMetadata,c=Object.getPrototypeOf(async function(){}).constructor;return await new c("node,parentNode,documentTitle,documentContent,AssetUri","return "+t.replace("SidekickClientEval:","").replace("ClientEval:",""))(n,r,s,o,a)}catch(i){throw i instanceof x?i:(console.error(i),new x('An error occurred while trying to evaluate "'+t+'"',1694682118365,t))}return t};this.processObjectWithClientEval=async(t,n=null,r=null)=>(await Promise.all(Object.keys(t).map(async i=>{let s=t[i];typeof s=="string"&&(t[i]=await this.processClientEval(s,n,r)),typeof s=="object"&&s!==null&&(t[i]=await this.processObjectWithClientEval(s,n,r)),Array.isArray(s)&&(t[i]=await Promise.all(s.map(async o=>await this.processObjectWithClientEval(o,n,r))))})),t);this.getImageMetadata=async t=>{if(!t||!t?.__identity)throw new x("The property does not have a valid image.",1694595562191);let{loadImageMetadata:n}=Zt.get().endpoints,r,i;try{let o=await n(t?.__identity);r=o?.originalImageResourceUri,i=o?.previewImageResourceUri}catch{throw new x("Could not fetch image object.",1694595598880)}if(!r||r==="")throw new x("The given image does not have a correct url.",1694595462402);let s=[];return s.push(this.prependConfiguredDomainToImageUri(r)),i&&s.push(this.prependConfiguredDomainToImageUri(i)),s};this.globalRegistry=t,this.store=n,this.nodeTypesRegistry=t.get("@neos-project/neos-ui-contentrepository"),this.externalService=t.get("NEOSidekick.AiAssistant").get("externalService")}prependConfiguredDomainToImageUri(t){let n=this.globalRegistry.get("NEOSidekick.AiAssistant").get("configuration").domain;return t=t.replace("http://","").replace("https://").split("/"),t.shift(),t.unshift(n),t.join("/")}getCurrentlyFocusedNodePathAndProperty(){let t=this.store.getState(),n=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),r=t?.cr?.nodes?.focused?.contextPaths[0],i=r?_e.selectors.CR.Nodes.nodeByContextPath(t)(r):null;return{nodePath:r,node:i,property:t?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:i?n.get(i?.nodeType):null,parentNode:i?_e.selectors.CR.Nodes.nodesByContextPathSelector(t)[i.parent]:null}}evaluateNodeTypeConfigurationAndStartGeneration(t,n,r,i=null,s=!1){if(!r||n[0]==="_")return;let o=r.properties[n];try{if(o?.options?.sidekick?.onCreate?.module)throw new x("Please do not use options.sidekick.onCreate.module anymore. Read the docs to find out about the new configuration.","1696264259260");if(!o?.options?.sidekick?.module||s&&o?.options?.sidekick?.onCreate!==!0)return;if(!o?.ui?.inlineEditable)throw new x("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new x("This feature is not available in the free version.","1688157373215")}catch(u){let d=this.globalRegistry.get("i18n");this.store.dispatch(_e.actions.UI.FlashMessages.add(u?.code??u?.message,u?.code?d.translate("NEOSidekick.AiAssistant:Error:"+u.code):u?.message,u?.severity??"error"));return}let a=JSON.parse(JSON.stringify(o.options.sidekick)),c=this.globalRegistry.get("NEOSidekick.AiAssistant").get("assistantService");this.processObjectWithClientEval(a,t,i).then(u=>{let d={version:"1.0",eventName:"call-module",data:{platform:"neos",target:{nodePath:t.contextPath,propertyName:n},...u}};c.sendMessageToIframe(d)})}generateNodeForContext(t,n){return n?fn(t,r=>{let i=(0,Gn.default)(n,s=>s?.value);r.properties=Object.assign({},r.properties,i)}):t}};var Jn=y(Te()),tt=y(Y()),Yn=(e,t)=>function*(){yield(0,Jn.takeEvery)(tt.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(n){n.payload.feedbackEnvelope.feedbacks.forEach(r=>{if(r.type!=="Neos.Neos.Ui:NodeCreated")return;let s=r.payload.contextPath.split("@")[0],o=t.getState(),a=tt.selectors.CR.Nodes.nodesByContextPathSelector(o),c=e.get("@neos-project/neos-ui-contentrepository"),u=e.get("i18n"),d=e.get("NEOSidekick.AiAssistant").get("contentService"),h=e.get("NEOSidekick.AiAssistant").get("assistantService"),p=e.get("NEOSidekick.AiAssistant").get("externalService");Object.keys(a).forEach(l=>{if(!l.split("@")[0].startsWith(s))return;let C=a[l],O=a[C.parent],f=c.get(C.nodeType);Object.keys(f.properties).forEach(m=>{d.evaluateNodeTypeConfigurationAndStartGeneration(C,m,f,O,!0)})})})})};var Vn=y(Te()),Xn=y(Y()),Zn=(e,t)=>function*(){yield(0,Vn.takeEvery)(Xn.actionTypes.CR.Nodes.REMOVE,function*(n){console.log("Payload: ",n);let r=e.get("NEOSidekick.AiAssistant").get("assistantService");if(r.currentlyHandledNodePath===n.payload){r.resetCurrentlyHandledNodePath();let i={version:"1.0",eventName:"cancel-call-module"};console.log("Message: ",i),r.sendMessageToIframe(i)}})};var Qn=y(Y()),er=(e,t)=>new It(e,t),It=class{constructor(t,n){this.sendMessageToIframe=t=>{if(this.currentlyHandledNodePath&&["page-changed","page-updated"].indexOf(t?.eventName)>-1)return;if(this.currentlyHandledNodePath&&["call-module"].indexOf(t?.eventName)>-1){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}t?.eventName==="call-module"&&(this.currentlyHandledNodePath=t?.data?.target?.nodePath);let n=setInterval(()=>{let r=document.getElementById("neosidekickAssistant");if(r.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",t),r.contentWindow.postMessage(t,"*"),clearInterval(n),t?.eventName==="call-module"&&this.resetCurrentlyHandledNodePathDebounced();else{console.log("not loaded, waiting...");return}},250)};this.listenToMessages=()=>{let t=setInterval(()=>{let n=document.getElementById("neosidekickAssistant");if(n?.dataset?.hasOwnProperty("loaded"))window.addEventListener("message",i=>{let s=n.contentWindow;i.source===s&&(console.log(i),this.handleMessage(i))}),clearInterval(t);else return},250)};this.handleMessage=t=>{if(console.info("Handle Sidekick Message: "+t.data.eventName),t?.data?.eventName==="write-content"){let{nodePath:n,propertyName:r,value:i,isFinished:s}=t.data.data;this.currentlyHandledNodePath=n,this.changePropertyValue(n,r,i,s)}else if(t?.data?.eventName==="stopped-generation")this.resetTypingCaret(),this.resetCurrentlyHandledNodePath();else if(t?.data?.eventName==="error"){let n=t?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+n,"error",n),this.resetTypingCaret(),this.resetCurrentlyHandledNodePath()}this.resetCurrentlyHandledNodePathDebounced()};this.changePropertyValue=(t,n,r,i=!1)=>{let a=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(`[data-__neos-editable-node-contextpath="${t}"][data-__neos-property="${n}"]`);if(!a){this.resetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(t)){a.classList.remove("typing-caret"),this.resetCurrentlyHandledNodePath();return}a?.ckeditorInstance?.setData(r),a?.classList.toggle("typing-caret",!i),i&&this.resetCurrentlyHandledNodePath()};this.globalRegistry=t,this.store=n,this.currentlyHandledNodePath=null}resetTypingCaret(){let r=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(".typing-caret");r&&r.classList.remove("typing-caret")}resetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetCurrentlyHandledNodePathDebounced(){let t,n=1e3;return()=>{clearTimeout(t),t=setTimeout(()=>{this.currentlyHandledNodePath=null},n)}}addFlashMessage(t,n,r="error",i=null){let s=this.globalRegistry.get("i18n");this.store.dispatch(Qn.actions.UI.FlashMessages.add(t,s.translate("NEOSidekick.AiAssistant:Error:"+t,n,{0:i}),r))}};var Oe=y(Ae()),Mt=y(De()),nt=y(Se()),tr=y(Fe());var Z=class extends Oe.PureComponent{constructor(n){super(n);this.state={show:!1,enabled:!0};this.evaluateFocusedNodeAndPropertyAndShowButton=(n=5)=>{let{nodeType:r,property:i}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();if(!r||!i){if(n===0)return;setTimeout(()=>this.evaluateFocusedNodeAndPropertyAndShowButton(n-1),100);return}let s=r.properties[i];this.setState({show:s?.ui?.inlineEditable===!0&&s?.options?.sidekick?.module!==void 0})};this.onClick=()=>{this.setState({enabled:!1});let{node:n,nodeType:r,parentNode:i,property:s}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();this.props.contentService.evaluateNodeTypeConfigurationAndStartGeneration(n,s,r,i),setTimeout(()=>{this.setState({enabled:!0})},2500)}}componentDidMount(){this.evaluateFocusedNodeAndPropertyAndShowButton()}render(){let{i18nRegistry:n}=this.props;return this.state.show?Oe.default.createElement(nt.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:n.translate("NEOSidekick.AiAssistant:Main:generate")},Oe.default.createElement(nt.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),n.translate("NEOSidekick.AiAssistant:Main:generate")):""}};Z.propTypes={contentService:Mt.default.object.isRequired,i18nRegistry:Mt.default.object.isRequired},Z=ce([(0,tr.neos)(e=>({contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:e.get("i18n")}))],Z);var rt=y(rr());function sr(e){return new Promise(t=>setTimeout(t,e))}Wt("NEOSidekick.AiAssistant",{},(e,{store:t,frontendConfiguration:n})=>{let r=e.get("inspector").get("editors");r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:rt.TextField}),r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:rt.TextArea});let i=n["NEOSidekick.AiAssistant"];if(i===null||i.enabled===!1)return;if(!i.hasOwnProperty("defaultLanguage")||!i.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}e.set("NEOSidekick.AiAssistant",new J("")),e.get("NEOSidekick.AiAssistant").set("configuration",i);let s=Xt(n);e.get("NEOSidekick.AiAssistant").set("externalService",s);let o=qn(e,t);e.get("NEOSidekick.AiAssistant").set("contentService",o);let a=er(e,t);e.get("NEOSidekick.AiAssistant").set("assistantService",a),a.listenToMessages();let c=e.get("containers"),u=c.get("App"),d=O=>{let f=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[m,v]=F.default.useState(f?.open),b=k=>{v(k),f.open=k,localStorage.setItem("NEOSidekick",JSON.stringify(f))},[A,q]=F.default.useState(f?.fullscreen),g=k=>{q(k),f.fullscreen=k,localStorage.setItem("NEOSidekick",JSON.stringify(f))},N=(k,it,st)=>{if(k)return F.default.createElement(xe.IconButton,{icon:it?"compress":"expand",onClick:st})},I=(k,it,st)=>{if(!it)return F.default.createElement(xe.IconButton,{icon:k?"chevron-circle-right":"chevron-circle-left",onClick:st})},jt=(0,Rt.useSelector)(ae.selectors.CR.ContentDimensions.active),or=(0,Rt.useSelector)(k=>k?.user?.preferences?.interfaceLanguage),W=new URL(`${i.apiDomain}/chat/`);return W.searchParams.append("contentLanguage",jt.language?jt.language[0]:i.defaultLanguage),W.searchParams.append("interfaceLanguage",or),W.searchParams.append("userId",i.userId),W.searchParams.append("plattform","neos"),W.searchParams.append("domain",i.domain),W.searchParams.append("siteName",i.siteName),i?.referral&&W.searchParams.append("referral",i?.referral),i?.apiKey&&W.searchParams.append("apikey",i?.apiKey),F.default.createElement("div",{className:`neosidekick_appWrapper ${m?"neosidekick_appWrapper--sidebar-open":""}  ${A?"neosidekick_appWrapper--sidebar-fullscreen":""}`},F.default.createElement(u,{...O}),F.default.createElement("div",{className:"neosidekick_sideBar"},F.default.createElement("div",{className:"neosidekick_sideBar__title"},F.default.createElement(xe.Headline,{className:`neosidekick_sideBar__title-headline ${m?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),F.default.createElement("div",null,N(m,A,()=>g(!A)),I(m,A,()=>b(!m)))),F.default.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${m?"neosidekick_sideBar__frame--open":""}`,src:W.toString(),allow:"clipboard-write",onLoad:k=>k.target.dataset.loaded=!0})))};c.set("App",d);let h=!1,p=function*(){yield(0,ir.takeLatest)([ae.actionTypes.UI.ContentCanvas.SET_SRC,ae.actionTypes.UI.ContentCanvas.RELOAD,ae.actionTypes.CR.Nodes.MERGE],async function*(O){O.type===ae.actionTypes.UI.ContentCanvas.SET_SRC&&(h=!0),yield sr(500);let f=e.get("@neos-project/neos-ui-contentrepository"),m=t.getState(),v=m?.ui?.contentCanvas?.previewUrl,b=o.getCurrentDocumentNode(),A=b?.contextPath,q=Object.values(m?.cr?.nodes?.byContextPath||{}).filter(g=>{let N=f.getRole("document");if(!N)throw new Error("Document role is not loaded!");let I=f.getSubTypesOf(N);return A&&g.contextPath.indexOf(A.split("@")[0])===0&&(g.contextPath===A||!I.includes(g.nodeType))});a.sendMessageToIframe({version:"1.0",eventName:h?"page-changed":"page-updated",data:{url:v,title:b?.properties?.title||o.getGuestFrameDocumentTitle(),content:o.getGuestFrameDocumentHtml(),structuredContent:q,targetAudience:await o.getCurrentDocumentTargetAudience(),pageBriefing:await o.getCurrentDocumentPageBriefing(),focusKeyword:await o.getCurrentDocumentFocusKeyword()}}),h=!1})},l=e.get("sagas");l.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:p}),l.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:Yn(e,t)}),l.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:Zn(e,t)}),r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:L}),r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:z}),e.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:generate",{component:Z,isVisible:()=>!0},"end")});})();
//# sourceMappingURL=Plugin.js.map
