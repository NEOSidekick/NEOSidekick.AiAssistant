(()=>{var qe=Object.create;var de=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var Ge=Object.getOwnPropertyNames;var $e=Object.getPrototypeOf,ze=Object.prototype.hasOwnProperty;var Ve=(r,e)=>()=>(r&&(e=r(r=0)),e);var H=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Je=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ge(e))!ze.call(r,s)&&s!==t&&de(r,s,{get:()=>e[s],enumerable:!(n=ye(e,s))||n.enumerable});return r};var g=(r,e,t)=>(t=r!=null?qe($e(r)):{},Je(e||!r||!r.__esModule?de(t,"default",{value:r,enumerable:!0}):t,r));var G=(r,e,t,n)=>{for(var s=n>1?void 0:n?ye(e,t):e,o=r.length-1,i;o>=0;o--)(i=r[o])&&(s=(n?i(e,t,s):i(s))||s);return n&&s&&de(e,t,s),s};function S(r){return(...e)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${r}`])return window["@Neos:HostPluginAPI"][`@${r}`](...e);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var D=Ve(()=>{});var J=H((Ct,Se)=>{D();Se.exports=S("NeosProjectPackages")().ReactUiComponents});var K=H((Et,Ne)=>{D();Ne.exports=S("NeosProjectPackages")().NeosUiReduxStore});var Y=H((wt,ke)=>{D();ke.exports=S("vendor")().React});var ne=H((xt,Ce)=>{D();Ce.exports=S("vendor")().reactRedux});var se=H((Dt,Ae)=>{D();Ae.exports=S("vendor")().reduxSagaEffects});var re=H((Ft,Ee)=>{D();Ee.exports=S("vendor")().PropTypes});var oe=H((Rt,be)=>{D();be.exports=S("NeosProjectPackages")().NeosUiDecorators});D();var V=class{constructor(e){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=e}};var Ye=(r,e="position",t="key")=>{let n=typeof e=="string"?a=>a[e]:e,s={},o={},i={},u={},c={},m={};r.forEach((a,h)=>{let v=a[t]?a[t]:String(h);s[v]=h;let E=n(a),f=String(E||h),I=!1;if(f.startsWith("start")){let p=f.match(/start\s+(\d+)/),y=p&&p[1]?Number(p[1]):0;i[y]||(i[y]=[]),i[y].push(v)}else if(f.startsWith("end")){let p=f.match(/end\s+(\d+)/),y=p&&p[1]?Number(p[1]):0;u[y]||(u[y]=[]),u[y].push(v)}else if(f.startsWith("before")){let p=f.match(/before\s+(\S+)(\s+(\d+))?/);if(!p)I=!0;else{let y=p[1],O=p[3]?Number(p[3]):0;c[y]||(c[y]={}),c[y][O]||(c[y][O]=[]),c[y][O].push(v)}}else if(f.startsWith("after")){let p=f.match(/after\s+(\S+)(\s+(\d+))?/);if(!p)I=!0;else{let y=p[1],O=p[3]?Number(p[3]):0;m[y]||(m[y]={}),m[y][O]||(m[y][O]=[]),m[y][O].push(v)}}else I=!0;if(I){let p=parseFloat(f);(isNaN(p)||!isFinite(p))&&(p=h),o[p]||(o[p]=[]),o[p].push(v)}});let d=[],A=[],C=[],l=[],w=(a,h)=>{let v=Object.keys(a).map(E=>Number(E)).sort((E,f)=>E-f);return h?v:v.reverse()},M=(a,h)=>{a.forEach(v=>{if(!(l.indexOf(v)>=0)){if(l.push(v),c[v]){let E=w(c[v],!0);for(let f of E)M(c[v][f],h)}if(h.push(v),m[v]){let E=w(m[v],!1);for(let f of E)M(m[v][f],h)}}})};for(let a of w(i,!1))M(i[a],d);for(let a of w(o,!0))M(o[a],A);for(let a of w(u,!0))M(u[a],C);for(let a of Object.keys(c))if(!(l.indexOf(a)>=0))for(let h of w(c[a],!1))M(c[a][h],d);for(let a of Object.keys(m))if(!(l.indexOf(a)>=0))for(let h of w(m[a],!1))M(m[a][h],A);return[...d,...A,...C].map(a=>s[a]).map(a=>r[a])},le=Ye;var W=class extends V{constructor(e){super(e),this._registry=[]}set(e,t,n=0){if(typeof e!="string")throw new Error("Key must be a string");if(typeof n!="string"&&typeof n!="number")throw new Error("Position must be a string or a number");let s={key:e,value:t};n&&(s.position=n);let o=this._registry.findIndex(i=>i.key===e);return o===-1?this._registry.push(s):this._registry[o]=s,t}get(e){if(typeof e!="string")return console.error("Key must be a string"),null;let t=this._registry.find(n=>n.key===e);return t?t.value:null}_getChildrenWrapped(e){let t=this._registry.filter(n=>n.key.indexOf(e+"/")===0);return le(t)}getChildrenAsObject(e){let t={};return this._getChildrenWrapped(e).forEach(n=>{t[n.key]=n.value}),t}getChildren(e){return this._getChildrenWrapped(e).map(t=>t.value)}has(e){return typeof e!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(t=>t.key===e)}_getAllWrapped(){return le(this._registry)}getAllAsObject(){let e={};return this._getAllWrapped().forEach(t=>{e[t.key]=t.value}),e}getAllAsList(){return this._getAllWrapped().map(e=>Object.assign({id:e.key},e.value))}};var ve=S("manifest");var ee=g(J()),q=g(K()),x=g(Y()),he=g(ne()),He=g(se());var T=g(Y()),we=g(ne()),N=g(re()),Pe=g(oe()),L=g(J()),$=g(K());var Xe={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},R=class extends T.Component{constructor(t){super(t);this.state={loading:!1};this.getIcon=t=>t?T.default.createElement(L.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):T.default.createElement(L.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(t,n)=>{let{commit:s,externalService:o,contentService:i,activeContentDimensions:u,addFlashMessage:c,i18nRegistry:m,node:d,parentNode:A,frontendConfiguration:C}=this.props;this.setState({loading:!0});try{n=await i.processObjectWithClientEval(Object.assign({},n),d,A),n=Object.keys(n).map(w=>({identifier:w,value:n[w]}));let l=await o.generate(t,u.language?u.language[0]:C.defaultLanguage,n);s(l)}catch(l){c(l?.code??l?.message,l?.code?m.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}}}render(){let{id:t,value:n,className:s,commit:o,options:i,i18nRegistry:u,onKeyPress:c,onEnterKey:m}=this.props,d=Object.assign({},Xe,i),A=i&&i.placeholder&&u.translate(unescape(i.placeholder)),C=!(d.readonly||d.disabled);return T.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:s},T.default.createElement("div",null,T.default.createElement(L.TextInput,{id:t,value:n,onChange:o,disabled:d.disabled||this.state.loading,maxLength:d.maxlength,readOnly:d.readonly,placeholder:A,onKeyPress:c,onEnterKey:m})),C?T.default.createElement("div",{style:{"margin-top":"4px"}},T.default.createElement(L.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(d.module,d.arguments??{})},u.translate("NEOSidekick.AiAssistant:Main:generate"),"\xA0",this.getIcon(this.state.loading))):null)}};R.propTypes={className:N.default.string,value:N.default.oneOfType([N.default.string,N.default.number]),commit:N.default.func.isRequired,options:N.default.object,onKeyPress:N.default.func,onEnterKey:N.default.func,id:N.default.string,activeContentDimensions:N.default.object.isRequired,node:N.default.object,parentNode:N.default.object,i18nRegistry:N.default.object.isRequired,externalService:N.default.object.isRequired,contentService:N.default.object.isRequired,addFlashMessage:N.default.func.isRequired,frontendConfiguration:N.default.object},R.defaultProps={options:{}},R=G([(0,Pe.neos)(r=>({i18nRegistry:r.get("i18n"),externalService:r.get("NEOSidekick.AiAssistant").get("externalService"),contentService:r.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:r.get("NEOSidekick.AiAssistant").get("configuration")})),(0,we.connect)(r=>e=>{let t=$.selectors.CR.ContentDimensions.active(e),n=$.selectors.CR.Nodes.focusedSelector(e),s=$.selectors.CR.Nodes.nodeByContextPath(e)(n.parent);return{activeContentDimensions:t,node:n,parentNode:s}},{addFlashMessage:$.actions.UI.FlashMessages.add})],R);var F=g(Y()),xe=g(ne()),k=g(re()),Oe=g(oe()),U=g(J()),z=g(K());var Ze={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},_=class extends F.Component{constructor(t){super(t);this.getIcon=t=>t?F.default.createElement(U.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):F.default.createElement(U.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(t,n)=>{let{commit:s,externalService:o,contentService:i,activeContentDimensions:u,addFlashMessage:c,i18nRegistry:m,node:d,parentNode:A,frontendConfiguration:C}=this.props;this.setState({loading:!0});try{n=await i.processObjectWithClientEval(Object.assign({},n),d,A),n=Object.keys(n).map(w=>({identifier:w,value:n[w]}));let l=await o.generate(t,u.language?u.language[0]:C.defaultLanguage,n);s(l)}catch(l){c(l?.code??l?.message,l?.code?m.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}};this.state={loading:!1}}render(){let{id:t,value:n,className:s,commit:o,options:i,i18nRegistry:u,onKeyPress:c,onEnterKey:m}=this.props,d=Object.assign({},Ze,i),A=i&&i.placeholder&&u.translate(unescape(i.placeholder)),C=!(d.readonly||d.disabled);return F.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:s},F.default.createElement("div",null,F.default.createElement(U.TextArea,{id:t,value:n,onChange:o,disabled:d.disabled||this.state.loading,maxLength:d.maxlength,readOnly:d.readonly,placeholder:A,minRows:d.minRows,expandedRows:d.expandedRows,onKeyPress:c,onEnterKey:m})),C?F.default.createElement("div",null,F.default.createElement(U.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(d.module,d.arguments??{})},u.translate("NEOSidekick.AiAssistant:Main:generate"),"\xA0",this.getIcon(this.state.loading))):null)}};_.propTypes={className:k.default.string,value:k.default.oneOfType([k.default.string,k.default.number]),commit:k.default.func.isRequired,options:k.default.object,onKeyPress:k.default.func,onEnterKey:k.default.func,id:k.default.string,activeContentDimensions:k.default.object.isRequired,node:k.default.object,parentNode:k.default.object,i18nRegistry:k.default.object.isRequired,externalService:k.default.object.isRequired,contentService:k.default.object.isRequired,addFlashMessage:k.default.func.isRequired,frontendConfiguration:k.default.object},_.defaultProps={options:{}},_=G([(0,Oe.neos)(r=>({i18nRegistry:r.get("i18n"),externalService:r.get("NEOSidekick.AiAssistant").get("externalService"),contentService:r.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:r.get("NEOSidekick.AiAssistant").get("configuration")})),(0,xe.connect)(r=>e=>{let t=z.selectors.CR.ContentDimensions.active(e),n=z.selectors.CR.Nodes.focusedSelector(e),s=z.selectors.CR.Nodes.nodeByContextPath(e)(n.parent);return{activeContentDimensions:t,node:n,parentNode:s}},{addFlashMessage:z.actions.UI.FlashMessages.add})],_);var b=class extends Error{constructor(t,n,s){super(t);this.severity="error";this.code=n,this.externalMessage=s}};var De=r=>{let e=r["NEOSidekick.AiAssistant"];return new ue(e.apiDomain,e.apiKey)},ue=class{constructor(e,t){this.apiDomain="";this.apiKey="";this.hasApiKey=()=>this.apiKey!==null&&this.apiKey!=="";this.generate=async(e,t,n={})=>{if(!this.apiKey)throw new b("This feature is not available in the free version.","1688157373215");let s=await fetch(`${this.apiDomain}/api/v1/chat?language=${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:e,platform:"neos",user_input:n})}),o=await s.json();if(s.status===401)throw new b("The NEOSidekick api key provided is not valid.","1688158193038");if(s.status<200||s.status>=400)throw new b("An error occurred while asking NEOSidekick.","1688158257149",o?.message);let i=o?.data?.message?.message;return i.startsWith('"')&&i.endsWith('"')&&(i=i.substr(1,i.length-2)),i};this.apiDomain=e,this.apiKey=t}};D();var Te=S("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:Ut}=S("NeosProjectPackages")().NeosUiBackendConnector;var Q=g(K()),Fe=(r,e)=>new pe(r,e),pe=class{constructor(e,t){this.getGuestFrameDocumentTitle=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title;this.getGuestFrameDocumentHtml=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML;this.getCurrentDocumentNode=()=>{let e=this.store.getState(),t=e?.cr?.nodes?.documentNode;return e?.cr?.nodes?.byContextPath[t]};this.getCurrentDocumentParentNode=()=>{let e=this.store.getState(),t=this.getCurrentDocumentNode();return e?.cr?.nodes?.byContextPath[t.parent]};this.getCurrentDocumentNodeType=()=>{let e=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(e?.nodeType)};this.getCurrentDocumentTargetAudience=async()=>{let e=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return e?await this.processClientEval(e):null};this.getCurrentDocumentPageBriefing=async()=>{let e=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return e?await this.processClientEval(e):null};this.getCurrentDocumentFocusKeyword=async()=>{let e=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return e?await this.processClientEval(e):null};this.processClientEval=async(e,t=null,n=null)=>{if(typeof e=="string"&&(e.startsWith("SidekickClientEval:")||e.startsWith("ClientEval:")))try{t=t??this.getCurrentDocumentNode(),n=n??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),i=await this.getImageMetadata,u=Object.getPrototypeOf(async function(){}).constructor;return await new u("node,parentNode,documentTitle,documentContent,AssetUri","return "+e.replace("SidekickClientEval:","").replace("ClientEval:",""))(t,n,s,o,i)}catch(s){throw s instanceof b?s:(console.error(s),new b('An error occurred while trying to evaluate "'+e+'"',1694682118365,e))}return e};this.processObjectWithClientEval=async(e,t=null,n=null)=>(await Promise.all(Object.keys(e).map(async s=>{let o=e[s];typeof o=="string"&&(e[s]=await this.processClientEval(o,t,n)),typeof o=="object"&&o!==null&&(e[s]=await this.processObjectWithClientEval(o,t,n)),Array.isArray(o)&&(e[s]=await Promise.all(o.map(async i=>await this.processObjectWithClientEval(i,t,n))))})),e);this.getImageMetadata=async e=>{if(!e||!e?.__identity)throw new b("The property does not have a valid image.",1694595562191);let{loadImageMetadata:t}=Te.get().endpoints,n;try{n=(await t(e?.__identity))?.originalImageResourceUri}catch{throw new b("Could not fetch image object.",1694595598880)}if(!n||n==="")throw new b("The given image does not have a correct url.",1694595462402);let s=this.globalRegistry.get("NEOSidekick.AiAssistant").get("configuration").domain;return n=n.replace("http://","").replace("https://").split("/"),n.shift(),n.unshift(s),n.join("/")};this.globalRegistry=e,this.store=t,this.nodeTypesRegistry=e.get("@neos-project/neos-ui-contentrepository"),this.externalService=e.get("NEOSidekick.AiAssistant").get("externalService")}getCurrentlyFocusedNodePathAndProperty(){let e=this.store.getState(),t=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),n=e?.cr?.nodes?.focused?.contextPaths[0],s=Q.selectors.CR.Nodes.nodeByContextPath(e)(n);return{nodePath:n,node:s,property:e?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:t.get(s?.nodeType),parentNode:Q.selectors.CR.Nodes.nodesByContextPathSelector(e)[s.parent]}}evaluateNodeTypeConfigurationAndStartGeneration(e,t,n,s=null){if(!n||t[0]==="_")return;let o=n.properties[t];if(!o?.options?.sidekick?.onCreate)return;try{if(!o?.ui?.inlineEditable)throw new b("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new b("This feature is not available in the free version.","1688157373215")}catch(c){this.store.dispatch(Q.actions.UI.FlashMessages.add(c?.code??c?.message,c?.code?i18nRegistry.translate("NEOSidekick.AiAssistant:Error:"+c.code):c?.message,c?.severity??"error"))}let i=JSON.parse(JSON.stringify(o.options.sidekick.onCreate)),u=this.globalRegistry.get("NEOSidekick.AiAssistant").get("assistantService");this.processObjectWithClientEval(i,e,s).then(c=>{let m={version:"1.0",eventName:"call-module",data:{platform:"neos",target:{nodePath:e.contextPath,propertyName:t},...c}};u.sendMessageToIframe(m)})}};var je=g(se()),X=g(K()),Re=(r,e)=>function*(){yield(0,je.takeEvery)(X.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(t){t.payload.feedbackEnvelope.feedbacks.forEach(n=>{if(n.type!=="Neos.Neos.Ui:NodeCreated")return;let s=r.get("@neos-project/neos-ui-contentrepository"),o=r.get("i18n"),i=r.get("NEOSidekick.AiAssistant").get("contentService"),u=r.get("NEOSidekick.AiAssistant").get("assistantService"),c=r.get("NEOSidekick.AiAssistant").get("externalService"),m=e.getState(),d=X.selectors.CR.Nodes.nodesByContextPathSelector(m)[n.payload.contextPath],A=X.selectors.CR.Nodes.nodesByContextPathSelector(m)[d.parent],C=s.get(d.nodeType);Object.keys(C.properties).forEach(l=>{i.evaluateNodeTypeConfigurationAndStartGeneration(d,l,C,A)})})})};var _e=g(se()),Me=g(K()),Ie=(r,e)=>function*(){yield(0,_e.takeEvery)(Me.actionTypes.CR.Nodes.REMOVE,function*(t){console.log("Payload: ",t);let n=r.get("NEOSidekick.AiAssistant").get("assistantService");if(n.currentlyHandledNodePath===t.payload){n.resetCurrentlyHandledNodePath();let s={version:"1.0",eventName:"cancel-call-module"};console.log("Message: ",s),n.sendMessageToIframe(s)}})};var We=g(K()),Ke=(r,e)=>new ge(r,e),ge=class{constructor(e,t){this.sendMessageToIframe=e=>{if(this.currentlyHandledNodePath&&e?.eventName==="call-module"){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}e?.eventName==="call-module"&&(this.currentlyHandledNodePath=e?.data?.target?.nodePath);let t=setInterval(()=>{let n=document.getElementById("neosidekickAssistant");if(n.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",e),n.contentWindow.postMessage(e,"*"),clearInterval(t),e?.eventName==="call-module"&&this.resetCurrentlyHandledNodePathDebounced();else{console.log("not loaded, waiting...");return}},250)};this.listenToMessages=()=>{let e=setInterval(()=>{let t=document.getElementById("neosidekickAssistant");if(t?.dataset?.hasOwnProperty("loaded"))window.addEventListener("message",s=>{let o=t.contentWindow;s.source===o&&(console.log(s),this.handleMessage(s))}),clearInterval(e);else return},250)};this.handleMessage=e=>{if(console.info("Handle Sidekick Message: "+e.data.eventName),e?.data?.eventName==="write-content"){let{nodePath:t,propertyName:n,value:s,isFinished:o}=e.data.data;this.currentlyHandledNodePath=t,this.changePropertyValue(t,n,s,o)}else if(e?.data?.eventName==="stopped-generation")this.resetTypingCaret(),this.resetCurrentlyHandledNodePath();else if(e?.data?.eventName==="error"){let t=e?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+t,"error",t),this.resetTypingCaret(),this.resetCurrentlyHandledNodePath()}this.resetCurrentlyHandledNodePathDebounced()};this.changePropertyValue=(e,t,n,s=!1)=>{let u=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(`[data-__neos-editable-node-contextpath="${e}"][data-__neos-property="${t}"]`);if(!u){this.resetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(e)){u.classList.remove("typing-caret"),this.resetCurrentlyHandledNodePath();return}u?.ckeditorInstance?.setData(n),u?.classList.toggle("typing-caret",!s),s&&this.resetCurrentlyHandledNodePath()};this.globalRegistry=e,this.store=t,this.currentlyHandledNodePath=null}resetTypingCaret(){let n=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(".typing-caret");n&&n.classList.remove("typing-caret")}resetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetCurrentlyHandledNodePathDebounced(){let e,t=1e3;return()=>{clearTimeout(e),e=setTimeout(()=>{this.currentlyHandledNodePath=null},t)}}addFlashMessage(e,t,n="error",s=null){let o=this.globalRegistry.get("i18n");this.store.dispatch(We.actions.UI.FlashMessages.add(e,o.translate("NEOSidekick.AiAssistant:Error:"+e,t,{0:s}),n))}};var Z=g(Y()),me=g(re()),ie=g(J()),Be=g(oe());var B=class extends Z.PureComponent{constructor(t){super(t);this.state={show:!1,enabled:!0};this.onClick=()=>{this.setState({enabled:!1});let{node:t,nodeType:n,parentNode:s,property:o}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();this.props.contentService.evaluateNodeTypeConfigurationAndStartGeneration(t,o,n,s),setTimeout(()=>{this.setState({enabled:!0})},2500)};setTimeout(()=>{let{nodeType:n,property:s}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty(),o=n.properties[s];this.setState({show:o?.ui?.inlineEditable===!0&&o?.options?.sidekick?.onCreate})},25)}render(){let{i18nRegistry:t}=this.props;return this.state.show?Z.default.createElement(ie.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:t.translate("NEOSidekick.AiAssistant:Main:regenerate")},Z.default.createElement(ie.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),"\xA0",t.translate("NEOSidekick.AiAssistant:Main:regenerate")):""}};B.propTypes={contentService:me.default.object.isRequired,i18nRegistry:me.default.object.isRequired},B=G([(0,Be.neos)(r=>({contentService:r.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:r.get("i18n")}))],B);function Le(r){return new Promise(e=>setTimeout(e,r))}ve("NEOSidekick.AiAssistant",{},(r,{store:e,frontendConfiguration:t})=>{let n=t["NEOSidekick.AiAssistant"];if(n===null||n.enabled===!1)return;if(!n.hasOwnProperty("defaultLanguage")||!n.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}r.set("NEOSidekick.AiAssistant",new W),r.get("NEOSidekick.AiAssistant").set("configuration",n);let s=De(t);r.get("NEOSidekick.AiAssistant").set("externalService",s);let o=Fe(r,e);r.get("NEOSidekick.AiAssistant").set("contentService",o);let i=Ke(r,e);r.get("NEOSidekick.AiAssistant").set("assistantService",i),i.listenToMessages();let u=r.get("containers"),c=u.get("App"),m=te=>{let a=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[h,v]=x.default.useState(a?.open),E=P=>{v(P),a.open=P,localStorage.setItem("NEOSidekick",JSON.stringify(a))},[f,I]=x.default.useState(a?.fullscreen),p=P=>{I(P),a.fullscreen=P,localStorage.setItem("NEOSidekick",JSON.stringify(a))},y=(P,ae,ce)=>{if(P)return x.default.createElement(ee.IconButton,{icon:ae?"compress":"expand",onClick:ce})},O=(P,ae,ce)=>{if(!ae)return x.default.createElement(ee.IconButton,{icon:P?"chevron-circle-right":"chevron-circle-left",onClick:ce})},fe=(0,he.useSelector)(q.selectors.CR.ContentDimensions.active),Ue=(0,he.useSelector)(P=>P?.user?.preferences?.interfaceLanguage),j=new URL(`${n.apiDomain}/chat/`);return j.searchParams.append("contentLanguage",fe.language?fe.language[0]:n.defaultLanguage),j.searchParams.append("interfaceLanguage",Ue),j.searchParams.append("userId",n.userId),j.searchParams.append("plattform","neos"),j.searchParams.append("domain",n.domain),j.searchParams.append("siteName",n.siteName),n?.referral&&j.searchParams.append("referral",n?.referral),n?.apiKey&&j.searchParams.append("apikey",n?.apiKey),x.default.createElement("div",{className:`neosidekick_appWrapper ${h?"neosidekick_appWrapper--sidebar-open":""}  ${f?"neosidekick_appWrapper--sidebar-fullscreen":""}`},x.default.createElement(c,{...te}),x.default.createElement("div",{className:"neosidekick_sideBar"},x.default.createElement("div",{className:"neosidekick_sideBar__title"},x.default.createElement(ee.Headline,{className:`neosidekick_sideBar__title-headline ${h?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),x.default.createElement("div",null,y(h,f,()=>p(!f)),O(h,f,()=>E(!h)))),x.default.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${h?"neosidekick_sideBar__frame--open":""}`,src:j.toString(),allow:"clipboard-write",onLoad:P=>P.target.dataset.loaded=!0})))};u.set("App",m);let d=!1,A=function*(){yield(0,He.takeLatest)([q.actionTypes.UI.ContentCanvas.SET_SRC,q.actionTypes.UI.ContentCanvas.RELOAD,q.actionTypes.CR.Nodes.MERGE],async function*(te){te.type===q.actionTypes.UI.ContentCanvas.SET_SRC&&(d=!0),yield Le(500);let a=r.get("@neos-project/neos-ui-contentrepository"),h=e.getState(),v=h?.ui?.contentCanvas?.previewUrl,E=o.getCurrentDocumentNode(),f=E?.contextPath,I=Object.values(h?.cr?.nodes?.byContextPath||{}).filter(p=>{let y=a.getRole("document");if(!y)throw new Error("Document role is not loaded!");let O=a.getSubTypesOf(y);return f&&p.contextPath.indexOf(f.split("@")[0])===0&&(p.contextPath===f||!O.includes(p.nodeType))});i.sendMessageToIframe({version:"1.0",eventName:d?"page-changed":"page-updated",data:{url:v,title:E?.properties?.title||o.getGuestFrameDocumentTitle(),content:o.getGuestFrameDocumentHtml(),structuredContent:I,targetAudience:await o.getCurrentDocumentTargetAudience(),pageBriefing:await o.getCurrentDocumentPageBriefing(),focusKeyword:await o.getCurrentDocumentFocusKeyword()}}),d=!1})},C=r.get("sagas");C.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:A}),C.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:Re(r,e)}),C.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:Ie(r,e)});let l=r.get("inspector").get("editors");l.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:R}),l.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:_}),r.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:regenerate",{component:B,isVisible:()=>!0},"end")});})();
//# sourceMappingURL=Plugin.js.map
