"use strict";(()=>{var ln=Object.create;var Me=Object.defineProperty;var Rt=Object.getOwnPropertyDescriptor;var pn=Object.getOwnPropertyNames;var gn=Object.getPrototypeOf,hn=Object.prototype.hasOwnProperty;var mn=(e,t,r)=>t in e?Me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var yn=(e,t)=>()=>(e&&(t=e(e=0)),t);var z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var _n=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of pn(t))!hn.call(e,i)&&i!==r&&Me(e,i,{get:()=>t[i],enumerable:!(n=Rt(t,i))||n.enumerable});return e};var m=(e,t,r)=>(r=e!=null?ln(gn(e)):{},_n(t||!e||!e.__esModule?Me(r,"default",{value:e,enumerable:!0}):r,e));var $=(e,t,r,n)=>{for(var i=n>1?void 0:n?Rt(t,r):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(n?o(t,r,i):o(i))||i);return n&&i&&Me(t,r,i),i};var d=(e,t,r)=>(mn(e,typeof t!="symbol"?t+"":t,r),r);function N(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var M=yn(()=>{});var R=z((Xs,Lt)=>{M();Lt.exports=N("NeosProjectPackages")().NeosUiReduxStore});var Dr=z((Ne,de)=>{var Tn=200,Dn="Expected a function",xt="__lodash_hash_undefined__",Je=1,fe=2,cr=1/0,ur=9007199254740991,Be="[object Arguments]",Nt="[object Array]",dr="[object Boolean]",fr="[object Date]",lr="[object Error]",pr="[object Function]",Fn="[object GeneratorFunction]",Ke="[object Map]",gr="[object Number]",ue="[object Object]",Qt="[object Promise]",hr="[object RegExp]",Ue="[object Set]",mr="[object String]",yr="[object Symbol]",Ct="[object WeakMap]",_r="[object ArrayBuffer]",He="[object DataView]",Mn="[object Float32Array]",In="[object Float64Array]",Rn="[object Int8Array]",jn="[object Int16Array]",Wn="[object Int32Array]",zn="[object Uint8Array]",Ln="[object Uint8ClampedArray]",Bn="[object Uint16Array]",Kn="[object Uint32Array]",Un=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hn=/^\w*$/,Gn=/^\./,$n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qn=/[\\^$.*+?()[\]{}|]/g,Jn=/\\(\\)?/g,Yn=/^\[object .+?Constructor\]$/,Vn=/^(?:0|[1-9]\d*)$/,v={};v[Mn]=v[In]=v[Rn]=v[jn]=v[Wn]=v[zn]=v[Ln]=v[Bn]=v[Kn]=!0;v[Be]=v[Nt]=v[_r]=v[dr]=v[He]=v[fr]=v[lr]=v[pr]=v[Ke]=v[gr]=v[ue]=v[hr]=v[Ue]=v[mr]=v[Ct]=!1;var vr=typeof global=="object"&&global&&global.Object===Object&&global,Xn=typeof self=="object"&&self&&self.Object===Object&&self,Y=vr||Xn||Function("return this")(),Sr=typeof Ne=="object"&&Ne&&!Ne.nodeType&&Ne,er=Sr&&typeof de=="object"&&de&&!de.nodeType&&de,Zn=er&&er.exports===Sr,tr=Zn&&vr.process,rr=function(){try{return tr&&tr.binding("util")}catch{}}(),nr=rr&&rr.isTypedArray;function Qn(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function ei(e){return function(t){return t?.[e]}}function ti(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function ri(e){return function(t){return e(t)}}function ni(e,t){return e?.[t]}function wt(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function ii(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function si(e,t){return function(r){return e(t(r))}}function oi(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var ai=Array.prototype,ci=Function.prototype,Ye=Object.prototype,St=Y["__core-js_shared__"],ir=function(){var e=/[^.]+$/.exec(St&&St.keys&&St.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ar=ci.toString,B=Ye.hasOwnProperty,le=Ye.toString,ui=RegExp("^"+Ar.call(B).replace(qn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),sr=Y.Symbol,or=Y.Uint8Array,di=Ye.propertyIsEnumerable,fi=ai.splice,li=si(Object.keys,Object),bt=pe(Y,"DataView"),Ce=pe(Y,"Map"),Pt=pe(Y,"Promise"),Et=pe(Y,"Set"),Ot=pe(Y,"WeakMap"),we=pe(Object,"create"),pi=ie(bt),gi=ie(Ce),hi=ie(Pt),mi=ie(Et),yi=ie(Ot),Ge=sr?sr.prototype:void 0,At=Ge?Ge.valueOf:void 0,ar=Ge?Ge.toString:void 0;function re(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function _i(){this.__data__=we?we(null):{}}function vi(e){return this.has(e)&&delete this.__data__[e]}function Si(e){var t=this.__data__;if(we){var r=t[e];return r===xt?void 0:r}return B.call(t,e)?t[e]:void 0}function Ai(e){var t=this.__data__;return we?t[e]!==void 0:B.call(t,e)}function Ni(e,t){var r=this.__data__;return r[e]=we&&t===void 0?xt:t,this}re.prototype.clear=_i;re.prototype.delete=vi;re.prototype.get=Si;re.prototype.has=Ai;re.prototype.set=Ni;function K(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ci(){this.__data__=[]}function wi(e){var t=this.__data__,r=Ve(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():fi.call(t,r,1),!0}function bi(e){var t=this.__data__,r=Ve(t,e);return r<0?void 0:t[r][1]}function Pi(e){return Ve(this.__data__,e)>-1}function Ei(e,t){var r=this.__data__,n=Ve(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}K.prototype.clear=Ci;K.prototype.delete=wi;K.prototype.get=bi;K.prototype.has=Pi;K.prototype.set=Ei;function U(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Oi(){this.__data__={hash:new re,map:new(Ce||K),string:new re}}function xi(e){return Xe(this,e).delete(e)}function ki(e){return Xe(this,e).get(e)}function Ti(e){return Xe(this,e).has(e)}function Di(e,t){return Xe(this,e).set(e,t),this}U.prototype.clear=Oi;U.prototype.delete=xi;U.prototype.get=ki;U.prototype.has=Ti;U.prototype.set=Di;function $e(e){var t=-1,r=e?e.length:0;for(this.__data__=new U;++t<r;)this.add(e[t])}function Fi(e){return this.__data__.set(e,xt),this}function Mi(e){return this.__data__.has(e)}$e.prototype.add=$e.prototype.push=Fi;$e.prototype.has=Mi;function L(e){this.__data__=new K(e)}function Ii(){this.__data__=new K}function Ri(e){return this.__data__.delete(e)}function ji(e){return this.__data__.get(e)}function Wi(e){return this.__data__.has(e)}function zi(e,t){var r=this.__data__;if(r instanceof K){var n=r.__data__;if(!Ce||n.length<Tn-1)return n.push([e,t]),this;r=this.__data__=new U(n)}return r.set(e,t),this}L.prototype.clear=Ii;L.prototype.delete=Ri;L.prototype.get=ji;L.prototype.has=Wi;L.prototype.set=zi;function Li(e,t){var r=ne(e)||xr(e)?ti(e.length,String):[],n=r.length,i=!!n;for(var s in e)(t||B.call(e,s))&&!(i&&(s=="length"||br(s,n)))&&r.push(s);return r}function Ve(e,t){for(var r=e.length;r--;)if(Or(e[r][0],t))return r;return-1}var Bi=ts();function Ki(e,t){return e&&Bi(e,t,qe)}function Nr(e,t){t=Ze(t,e)?[t]:Cr(t);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Qe(t[r++])];return r&&r==n?e:void 0}function Ui(e){return le.call(e)}function Hi(e,t){return e!=null&&t in Object(e)}function kt(e,t,r,n,i){return e===t?!0:e==null||t==null||!et(e)&&!tt(t)?e!==e&&t!==t:Gi(e,t,kt,r,n,i)}function Gi(e,t,r,n,i,s){var o=ne(e),a=ne(t),c=Nt,f=Nt;o||(c=J(e),c=c==Be?ue:c),a||(f=J(t),f=f==Be?ue:f);var u=c==ue&&!wt(e),g=f==ue&&!wt(t),h=c==f;if(h&&!u)return s||(s=new L),o||fs(e)?wr(e,t,r,n,i,s):rs(e,t,c,r,n,i,s);if(!(i&fe)){var l=u&&B.call(e,"__wrapped__"),y=g&&B.call(t,"__wrapped__");if(l||y){var _=l?e.value():e,b=y?t.value():t;return s||(s=new L),r(_,b,n,i,s)}}return h?(s||(s=new L),ns(e,t,r,n,i,s)):!1}function $i(e,t,r,n){var i=r.length,s=i,o=!n;if(e==null)return!s;for(e=Object(e);i--;){var a=r[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){a=r[i];var c=a[0],f=e[c],u=a[1];if(o&&a[2]){if(f===void 0&&!(c in e))return!1}else{var g=new L;if(n)var h=n(f,u,c,e,t,g);if(!(h===void 0?kt(u,f,n,Je|fe,g):h))return!1}}return!0}function qi(e){if(!et(e)||as(e))return!1;var t=Tr(e)||wt(e)?ui:Yn;return t.test(ie(e))}function Ji(e){return tt(e)&&Dt(e.length)&&!!v[le.call(e)]}function Yi(e){return typeof e=="function"?e:e==null?ms:typeof e=="object"?ne(e)?Zi(e[0],e[1]):Xi(e):ys(e)}function Vi(e){if(!cs(e))return li(e);var t=[];for(var r in Object(e))B.call(e,r)&&r!="constructor"&&t.push(r);return t}function Xi(e){var t=is(e);return t.length==1&&t[0][2]?Er(t[0][0],t[0][1]):function(r){return r===e||$i(r,e,t)}}function Zi(e,t){return Ze(e)&&Pr(t)?Er(Qe(e),t):function(r){var n=ps(r,e);return n===void 0&&n===t?gs(r,e):kt(t,n,void 0,Je|fe)}}function Qi(e){return function(t){return Nr(t,e)}}function es(e){if(typeof e=="string")return e;if(Ft(e))return ar?ar.call(e):"";var t=e+"";return t=="0"&&1/e==-cr?"-0":t}function Cr(e){return ne(e)?e:us(e)}function ts(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(r(s[c],c,s)===!1)break}return t}}function wr(e,t,r,n,i,s){var o=i&fe,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var f=s.get(e);if(f&&s.get(t))return f==t;var u=-1,g=!0,h=i&Je?new $e:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var l=e[u],y=t[u];if(n)var _=o?n(y,l,u,t,e,s):n(l,y,u,e,t,s);if(_!==void 0){if(_)continue;g=!1;break}if(h){if(!Qn(t,function(b,p){if(!h.has(p)&&(l===b||r(l,b,n,i,s)))return h.add(p)})){g=!1;break}}else if(!(l===y||r(l,y,n,i,s))){g=!1;break}}return s.delete(e),s.delete(t),g}function rs(e,t,r,n,i,s,o){switch(r){case He:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case _r:return!(e.byteLength!=t.byteLength||!n(new or(e),new or(t)));case dr:case fr:case gr:return Or(+e,+t);case lr:return e.name==t.name&&e.message==t.message;case hr:case mr:return e==t+"";case Ke:var a=ii;case Ue:var c=s&fe;if(a||(a=oi),e.size!=t.size&&!c)return!1;var f=o.get(e);if(f)return f==t;s|=Je,o.set(e,t);var u=wr(a(e),a(t),n,i,s,o);return o.delete(e),u;case yr:if(At)return At.call(e)==At.call(t)}return!1}function ns(e,t,r,n,i,s){var o=i&fe,a=qe(e),c=a.length,f=qe(t),u=f.length;if(c!=u&&!o)return!1;for(var g=c;g--;){var h=a[g];if(!(o?h in t:B.call(t,h)))return!1}var l=s.get(e);if(l&&s.get(t))return l==t;var y=!0;s.set(e,t),s.set(t,e);for(var _=o;++g<c;){h=a[g];var b=e[h],p=t[h];if(n)var C=o?n(p,b,h,t,e,s):n(b,p,h,e,t,s);if(!(C===void 0?b===p||r(b,p,n,i,s):C)){y=!1;break}_||(_=h=="constructor")}if(y&&!_){var S=e.constructor,x=t.constructor;S!=x&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(y=!1)}return s.delete(e),s.delete(t),y}function Xe(e,t){var r=e.__data__;return os(t)?r[typeof t=="string"?"string":"hash"]:r.map}function is(e){for(var t=qe(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Pr(i)]}return t}function pe(e,t){var r=ni(e,t);return qi(r)?r:void 0}var J=Ui;(bt&&J(new bt(new ArrayBuffer(1)))!=He||Ce&&J(new Ce)!=Ke||Pt&&J(Pt.resolve())!=Qt||Et&&J(new Et)!=Ue||Ot&&J(new Ot)!=Ct)&&(J=function(e){var t=le.call(e),r=t==ue?e.constructor:void 0,n=r?ie(r):void 0;if(n)switch(n){case pi:return He;case gi:return Ke;case hi:return Qt;case mi:return Ue;case yi:return Ct}return t});function ss(e,t,r){t=Ze(t,e)?[t]:Cr(t);for(var n,i=-1,o=t.length;++i<o;){var s=Qe(t[i]);if(!(n=e!=null&&r(e,s)))break;e=e[s]}if(n)return n;var o=e?e.length:0;return!!o&&Dt(o)&&br(s,o)&&(ne(e)||xr(e))}function br(e,t){return t=t??ur,!!t&&(typeof e=="number"||Vn.test(e))&&e>-1&&e%1==0&&e<t}function Ze(e,t){if(ne(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Ft(e)?!0:Hn.test(e)||!Un.test(e)||t!=null&&e in Object(t)}function os(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function as(e){return!!ir&&ir in e}function cs(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Ye;return e===r}function Pr(e){return e===e&&!et(e)}function Er(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var us=Tt(function(e){e=ls(e);var t=[];return Gn.test(e)&&t.push(""),e.replace($n,function(r,n,i,s){t.push(i?s.replace(Jn,"$1"):n||r)}),t});function Qe(e){if(typeof e=="string"||Ft(e))return e;var t=e+"";return t=="0"&&1/e==-cr?"-0":t}function ie(e){if(e!=null){try{return Ar.call(e)}catch{}try{return e+""}catch{}}return""}function Tt(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(Dn);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o),o};return r.cache=new(Tt.Cache||U),r}Tt.Cache=U;function Or(e,t){return e===t||e!==e&&t!==t}function xr(e){return ds(e)&&B.call(e,"callee")&&(!di.call(e,"callee")||le.call(e)==Be)}var ne=Array.isArray;function kr(e){return e!=null&&Dt(e.length)&&!Tr(e)}function ds(e){return tt(e)&&kr(e)}function Tr(e){var t=et(e)?le.call(e):"";return t==pr||t==Fn}function Dt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ur}function et(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function tt(e){return!!e&&typeof e=="object"}function Ft(e){return typeof e=="symbol"||tt(e)&&le.call(e)==yr}var fs=nr?ri(nr):Ji;function ls(e){return e==null?"":es(e)}function ps(e,t,r){var n=e==null?void 0:Nr(e,t);return n===void 0?r:n}function gs(e,t){return e!=null&&ss(e,t,Hi)}function qe(e){return kr(e)?Li(e):Vi(e)}function hs(e,t){var r={};return t=Yi(t,3),Ki(e,function(n,i,s){r[i]=t(n,i,s)}),r}function ms(e){return e}function ys(e){return Ze(e)?ei(Qe(e)):Qi(e)}de.exports=hs});var Wr=z((ho,jr)=>{M();jr.exports=N("NeosProjectPackages")().NeosUiEditors});var he=z((yo,zr)=>{M();zr.exports=N("vendor")().React});var be=z((vo,Lr)=>{M();Lr.exports=N("vendor")().reactRedux});var Pe=z((Ao,Br)=>{M();Br.exports=N("vendor")().PropTypes});var Ee=z((Co,Kr)=>{M();Kr.exports=N("NeosProjectPackages")().NeosUiDecorators});var Oe=z((bo,Ur)=>{M();Ur.exports=N("NeosProjectPackages")().ReactUiComponents});var it=z((Wo,Qr)=>{M();Qr.exports=N("vendor")().reduxSagaEffects});M();var _e=class{constructor(t){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=t}};var vn=(e,t="position",r="key")=>{let n=typeof t=="string"?p=>p[t]:t,i={},s={},o={},a={},c={},f={};e.forEach((p,C)=>{let S=p[r]?p[r]:String(C);i[S]=C;let x=n(p),k=String(x||C),Fe=!1;if(k.startsWith("start")){let A=k.match(/start\s+(\d+)/),w=A&&A[1]?Number(A[1]):0;o[w]||(o[w]=[]),o[w].push(S)}else if(k.startsWith("end")){let A=k.match(/end\s+(\d+)/),w=A&&A[1]?Number(A[1]):0;a[w]||(a[w]=[]),a[w].push(S)}else if(k.startsWith("before")){let A=k.match(/before\s+(\S+)(\s+(\d+))?/);if(!A)Fe=!0;else{let w=A[1],Z=A[3]?Number(A[3]):0;c[w]||(c[w]={}),c[w][Z]||(c[w][Z]=[]),c[w][Z].push(S)}}else if(k.startsWith("after")){let A=k.match(/after\s+(\S+)(\s+(\d+))?/);if(!A)Fe=!0;else{let w=A[1],Z=A[3]?Number(A[3]):0;f[w]||(f[w]={}),f[w][Z]||(f[w][Z]=[]),f[w][Z].push(S)}}else Fe=!0;if(Fe){let A=parseFloat(k);(isNaN(A)||!isFinite(A))&&(A=C),s[A]||(s[A]=[]),s[A].push(S)}});let u=[],g=[],h=[],l=[],y=(p,C)=>{let S=Object.keys(p).map(x=>Number(x)).sort((x,k)=>x-k);return C?S:S.reverse()},_=(p,C)=>{p.forEach(S=>{if(!(l.indexOf(S)>=0)){if(l.push(S),c[S]){let x=y(c[S],!0);for(let k of x)_(c[S][k],C)}if(C.push(S),f[S]){let x=y(f[S],!1);for(let k of x)_(f[S][k],C)}}})};for(let p of y(o,!1))_(o[p],u);for(let p of y(s,!0))_(s[p],g);for(let p of y(a,!0))_(a[p],h);for(let p of Object.keys(c))if(!(l.indexOf(p)>=0))for(let C of y(c[p],!1))_(c[p][C],u);for(let p of Object.keys(f))if(!(l.indexOf(p)>=0))for(let C of y(f[p],!1))_(f[p][C],g);return[...u,...g,...h].map(p=>i[p]).map(p=>e[p])},ct=vn;var q=class extends _e{constructor(t){super(t),this._registry=[]}set(t,r,n=0){if(typeof t!="string")throw new Error("Key must be a string");if(typeof n!="string"&&typeof n!="number")throw new Error("Position must be a string or a number");let i={key:t,value:r};n&&(i.position=n);let s=this._registry.findIndex(o=>o.key===t);return s===-1?this._registry.push(i):this._registry[s]=i,r}get(t){if(typeof t!="string")return console.error("Key must be a string"),null;let r=this._registry.find(n=>n.key===t);return r?r.value:null}_getChildrenWrapped(t){let r=this._registry.filter(n=>n.key.indexOf(t+"/")===0);return ct(r)}getChildrenAsObject(t){let r={};return this._getChildrenWrapped(t).forEach(n=>{r[n.key]=n.value}),r}getChildren(t){return this._getChildrenWrapped(t).map(r=>r.value)}has(t){return typeof t!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(r=>r.key===t)}_getAllWrapped(){return ct(this._registry)}getAllAsObject(){let t={};return this._getAllWrapped().forEach(r=>{t[r.key]=r.value}),t}getAllAsList(){return this._getAllWrapped().map(t=>Object.assign({id:t.key},t.value))}};var jt=N("manifest");var O=class extends Error{constructor(r,n,i=""){super(r);d(this,"code");d(this,"severity","error");d(this,"externalMessage");this.code=n,this.externalMessage=i}};var Wt=e=>{let t=e["NEOSidekick.AiAssistant"];return new ut(t.apiDomain,t.apiKey)},ut=class{constructor(t,r){d(this,"apiDomain","");d(this,"apiKey","");d(this,"hasApiKey",()=>this.apiKey!==null&&this.apiKey!=="");d(this,"generate",async(t,r,n={})=>{if(!this.apiKey)throw new O("This feature is not available in the free version.","1688157373215");let i=await fetch(`${this.apiDomain}/api/v1/chat?language=${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:t,platform:"neos",user_input:n})}),s=await i.json();if(i.status===401)throw new O("The NEOSidekick api key provided is not valid.","1688158193038");if(i.status<200||i.status>=400)throw new O("An error occurred while asking NEOSidekick.","1688158257149",s?.message);let o=s?.data?.message?.message;return o.startsWith('"')&&o.endsWith('"')&&(o=o.substr(1,o.length-2)),o});this.apiDomain=t,this.apiKey=r}};M();var zt=N("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:Js}=N("NeosProjectPackages")().NeosUiBackendConnector;var ge=m(R());var $t=Symbol.for("immer-nothing"),Bt=Symbol.for("immer-draftable"),T=Symbol.for("immer-state");function I(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var ae=Object.getPrototypeOf;function ce(e){return!!e&&!!e[T]}function ee(e){return e?qt(e)||Array.isArray(e)||!!e[Bt]||!!e.constructor?.[Bt]||We(e)||ze(e):!1}var An=Object.prototype.constructor.toString();function qt(e){if(!e||typeof e!="object")return!1;let t=ae(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===An}function ve(e,t){je(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function je(e){let t=e[T];return t?t.type_:Array.isArray(e)?1:We(e)?2:ze(e)?3:0}function lt(e,t){return je(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Jt(e,t,r){let n=je(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Nn(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function We(e){return e instanceof Map}function ze(e){return e instanceof Set}function Q(e){return e.copy_||e.base_}function pt(e,t){if(We(e))return new Map(e);if(ze(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&qt(e))return ae(e)?{...e}:Object.assign(Object.create(null),e);let r=Object.getOwnPropertyDescriptors(e);delete r[T];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){let s=n[i],o=r[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(ae(e),r)}function _t(e,t=!1){return Le(e)||ce(e)||!ee(e)||(je(e)>1&&(e.set=e.add=e.clear=e.delete=Cn),Object.freeze(e),t&&ve(e,(r,n)=>_t(n,!0),!0)),e}function Cn(){I(2)}function Le(e){return Object.isFrozen(e)}var wn={};function te(e){let t=wn[e];return t||I(0,e),t}var Se;function Yt(){return Se}function bn(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Kt(e,t){t&&(te("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function gt(e){ht(e),e.drafts_.forEach(Pn),e.drafts_=null}function ht(e){e===Se&&(Se=e.parent_)}function Ut(e){return Se=bn(Se,e)}function Pn(e){let t=e[T];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Ht(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[T].modified_&&(gt(t),I(4)),ee(e)&&(e=Ie(t,e),t.parent_||Re(t,e)),t.patches_&&te("Patches").generateReplacementPatches_(r[T].base_,e,t.patches_,t.inversePatches_)):e=Ie(t,r,[]),gt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==$t?e:void 0}function Ie(e,t,r){if(Le(t))return t;let n=t[T];if(!n)return ve(t,(i,s)=>Gt(e,n,t,i,s,r),!0),t;if(n.scope_!==e)return t;if(!n.modified_)return Re(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let i=n.copy_,s=i,o=!1;n.type_===3&&(s=new Set(i),i.clear(),o=!0),ve(s,(a,c)=>Gt(e,n,i,a,c,r,o)),Re(e,i,!1),r&&e.patches_&&te("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function Gt(e,t,r,n,i,s,o){if(ce(i)){let a=s&&t&&t.type_!==3&&!lt(t.assigned_,n)?s.concat(n):void 0,c=Ie(e,i,a);if(Jt(r,n,c),ce(c))e.canAutoFreeze_=!1;else return}else o&&r.add(i);if(ee(i)&&!Le(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ie(e,i),(!t||!t.scope_.parent_)&&Re(e,i)}}function Re(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&_t(t,r)}function En(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Yt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=n,s=vt;r&&(i=[n],s=Ae);let{revoke:o,proxy:a}=Proxy.revocable(i,s);return n.draft_=a,n.revoke_=o,a}var vt={get(e,t){if(t===T)return e;let r=Q(e);if(!lt(r,t))return On(e,r,t);let n=r[t];return e.finalized_||!ee(n)?n:n===dt(e.base_,t)?(ft(e),e.copy_[t]=yt(n,e)):n},has(e,t){return t in Q(e)},ownKeys(e){return Reflect.ownKeys(Q(e))},set(e,t,r){let n=Vt(Q(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let i=dt(Q(e),t),s=i?.[T];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Nn(r,i)&&(r!==void 0||lt(e.base_,t)))return!0;ft(e),mt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return dt(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ft(e),mt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=Q(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){I(11)},getPrototypeOf(e){return ae(e.base_)},setPrototypeOf(){I(12)}},Ae={};ve(vt,(e,t)=>{Ae[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Ae.deleteProperty=function(e,t){return Ae.set.call(this,e,t,void 0)};Ae.set=function(e,t,r){return vt.set.call(this,e[0],t,r,e[0])};function dt(e,t){let r=e[T];return(r?Q(r):e)[t]}function On(e,t,r){let n=Vt(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function Vt(e,t){if(!(t in e))return;let r=ae(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=ae(r)}}function mt(e){e.modified_||(e.modified_=!0,e.parent_&&mt(e.parent_))}function ft(e){e.copy_||(e.copy_=pt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var xn=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let s=r;r=t;let o=this;return function(c=s,...f){return o.produce(c,u=>r.call(this,u,...f))}}typeof r!="function"&&I(6),n!==void 0&&typeof n!="function"&&I(7);let i;if(ee(t)){let s=Ut(this),o=yt(t,void 0),a=!0;try{i=r(o),a=!1}finally{a?gt(s):ht(s)}return Kt(s,n),Ht(i,s)}else if(!t||typeof t!="object"){if(i=r(t),i===void 0&&(i=t),i===$t&&(i=void 0),this.autoFreeze_&&_t(i,!0),n){let s=[],o=[];te("Patches").generateReplacementPatches_(t,i,s,o),n(s,o)}return i}else I(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let n,i;return[this.produce(t,r,(o,a)=>{n=o,i=a}),n,i]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){ee(e)||I(8),ce(e)&&(e=kn(e));let t=Ut(this),r=yt(e,void 0);return r[T].isManual_=!0,ht(t),r}finishDraft(e,t){let r=e&&e[T];(!r||!r.isManual_)&&I(9);let{scope_:n}=r;return Kt(n,t),Ht(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let i=t[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(t=t.slice(r+1));let n=te("Patches").applyPatches_;return ce(e)?n(e,t):this.produce(e,i=>n(i,t))}};function yt(e,t){let r=We(e)?te("MapSet").proxyMap_(e,t):ze(e)?te("MapSet").proxySet_(e,t):En(e,t);return(t?t.scope_:Yt()).drafts_.push(r),r}function kn(e){return ce(e)||I(10,e),Xt(e)}function Xt(e){if(!ee(e)||Le(e))return e;let t=e[T],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=pt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=pt(e,!0);return ve(r,(n,i)=>{Jt(r,n,Xt(i))}),t&&(t.finalized_=!1),r}var D=new xn,Zt=D.produce,Zs=D.produceWithPatches.bind(D),Qs=D.setAutoFreeze.bind(D),eo=D.setUseStrictShallowCopy.bind(D),to=D.applyPatches.bind(D),ro=D.createDraft.bind(D),no=D.finishDraft.bind(D);var Fr=m(Dr());var Mr=(e,t)=>new Mt(e,t),Mt=class{constructor(t,r){d(this,"globalRegistry");d(this,"store");d(this,"nodeTypesRegistry");d(this,"externalService");d(this,"getGuestFrameDocumentTitle",()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title);d(this,"getGuestFrameDocumentHtml",()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML);d(this,"getCurrentDocumentNode",()=>{let t=this.store.getState(),r=t?.cr?.nodes?.documentNode;return t?.cr?.nodes?.byContextPath[r]});d(this,"getCurrentDocumentParentNode",()=>{let t=this.store.getState(),r=this.getCurrentDocumentNode();return t?.cr?.nodes?.byContextPath[r.parent]});d(this,"getCurrentDocumentNodeType",()=>{let t=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(t?.nodeType)});d(this,"getCurrentDocumentTargetAudience",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return t?await this.processClientEval(t):null});d(this,"getCurrentDocumentPageBriefing",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return t?await this.processClientEval(t):null});d(this,"getCurrentDocumentFocusKeyword",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return t?await this.processClientEval(t):null});d(this,"processClientEval",async(t,r=null,n=null)=>{if(typeof t=="string"&&(t.startsWith("SidekickClientEval:")||t.startsWith("ClientEval:")))try{r=r??this.getCurrentDocumentNode();let i=ge.selectors.UI.Inspector.transientValues(this.store.getState());r=this.generateNodeForContext(r,i),n=n??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),a=await this.getImageMetadata,c=Object.getPrototypeOf(async function(){}).constructor;return await new c("node,parentNode,documentTitle,documentContent,AssetUri","return "+t.replace("SidekickClientEval:","").replace("ClientEval:",""))(r,n,s,o,a)}catch(i){throw i instanceof O?i:(console.error(i),new O('An error occurred while trying to evaluate "'+t+'"',"1694682118365",t))}return t});d(this,"processValueWithClientEval",async(t,r=null,n=null)=>{if(typeof t=="string")return this.processClientEval(t,r,n);if(typeof t=="object"&&t!==null)return this.processObjectWithClientEval(t,r,n);if(Array.isArray(t))return Promise.all(t.map(async i=>this.processObjectWithClientEval(i,r,n)))});d(this,"processObjectWithClientEval",async(t,r=null,n=null)=>{let i={};return await Promise.all(Object.keys(t).map(async s=>{let o=t[s];i[s]=await this.processValueWithClientEval(o,r,n)})),i});d(this,"getImageMetadata",async t=>{if(!t||!t?.__identity)throw new O("The property does not have a valid image.","1694595562191");let{loadImageMetadata:r}=zt.get().endpoints,n,i;try{let o=await r(t?.__identity);n=o?.originalImageResourceUri,i=o?.previewImageResourceUri}catch{throw new O("Could not fetch image object.","1694595598880")}if(!n||n==="")throw new O("The given image does not have a correct url.","1694595462402");let s=[];return s.push(this.prependConfiguredDomainToImageUri(n)),i&&s.push(this.prependConfiguredDomainToImageUri(i)),s});this.globalRegistry=t,this.store=r,this.nodeTypesRegistry=t.get("@neos-project/neos-ui-contentrepository"),this.externalService=t.get("NEOSidekick.AiAssistant").get("externalService")}prependConfiguredDomainToImageUri(t){let r=this.globalRegistry.get("NEOSidekick.AiAssistant").get("configuration").domain;return t=t.replace("http://","").replace("https://").split("/"),t.shift(),t.unshift(r),t.join("/")}getCurrentlyFocusedNodePathAndProperty(){let t=this.store.getState(),r=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),n=t?.cr?.nodes?.focused?.contextPaths[0],i=n?ge.selectors.CR.Nodes.nodeByContextPath(t)(n):null;return{nodePath:n,node:i,property:t?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:i?r.get(i?.nodeType):null,parentNode:i?ge.selectors.CR.Nodes.nodesByContextPathSelector(t)[i.parent]:null}}async evaluateNodeTypeConfigurationAndStartGeneration(t,r,n,i=null,s=!1){if(!n||r[0]==="_")return;let o=n.properties[r];try{if(o?.options?.sidekick?.onCreate?.module)throw new O("Please do not use options.sidekick.onCreate.module anymore. Read the docs to find out about the new configuration.","1696264259260");if(!o?.options?.sidekick?.module||s&&o?.options?.sidekick?.onCreate!==!0)return;if(!o?.ui?.inlineEditable)throw new O("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new O("This feature is not available in the free version.","1688157373215")}catch(g){let h=this.globalRegistry.get("i18n");this.store.dispatch(ge.actions.UI.FlashMessages.add(g?.code??g?.message,g?.code?h.translate("NEOSidekick.AiAssistant:Error:"+g.code):g?.message,g?.severity??"error"));return}let a=JSON.parse(JSON.stringify(o.options.sidekick)),c=this.globalRegistry.get("NEOSidekick.AiAssistant").get("assistantService"),f=await this.processObjectWithClientEval(a,t,i),u={version:"1.0",eventName:"call-module",data:{platform:"neos",target:{nodePath:t.contextPath,propertyName:r},...f}};c.sendMessageToIframe(u)}generateNodeForContext(t,r){return r?Zt(t,n=>{let i=(0,Fr.default)(r,s=>s?.value);n.properties=Object.assign({},n.properties,i)}):t}};var Ir=m(R());var Rr=(e,t)=>new It(e,t),It=class{constructor(t,r){d(this,"globalRegistry");d(this,"store");d(this,"currentlyHandledNodePath");d(this,"sendMessageToIframe",t=>{if(this.currentlyHandledNodePath&&["page-changed","page-updated"].indexOf(t?.eventName)>-1)return;if(this.currentlyHandledNodePath&&["call-module"].indexOf(t?.eventName)>-1){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}t?.eventName==="call-module"&&(this.currentlyHandledNodePath=t?.data?.target?.nodePath);let r=setInterval(()=>{let n=document.getElementById("neosidekickAssistant");if(n.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",t),n.contentWindow.postMessage(t,"*"),clearInterval(r),t?.eventName==="call-module"&&this.resetCurrentlyHandledNodePathDebounced();else{console.log("not loaded, waiting...");return}},250)});d(this,"listenToMessages",()=>{let t=setInterval(()=>{let r=document.getElementById("neosidekickAssistant");if(r?.dataset?.hasOwnProperty("loaded"))window.addEventListener("message",i=>{let s=r.contentWindow;i.source===s&&(console.log(i),this.handleMessage(i))}),clearInterval(t);else return},250)});d(this,"handleMessage",t=>{if(console.info("Handle Sidekick Message: "+t.data.eventName),t?.data?.eventName==="write-content"){let{nodePath:r,propertyName:n,value:i,isFinished:s}=t.data.data;this.currentlyHandledNodePath=r,this.changePropertyValue(r,n,i,s)}else if(t?.data?.eventName==="stopped-generation")this.resetTypingCaret(),this.resetCurrentlyHandledNodePath();else if(t?.data?.eventName==="error"){let r=t?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+r,"error",r),this.resetTypingCaret(),this.resetCurrentlyHandledNodePath()}this.resetCurrentlyHandledNodePathDebounced()});d(this,"changePropertyValue",(t,r,n,i=!1)=>{let a=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(`[data-__neos-editable-node-contextpath="${t}"][data-__neos-property="${r}"]`);if(!a){this.resetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(t)){a.classList.remove("typing-caret"),this.resetCurrentlyHandledNodePath();return}a?.ckeditorInstance?.setData(n),a?.classList.toggle("typing-caret",!i),i&&this.resetCurrentlyHandledNodePath()});this.globalRegistry=t,this.store=r,this.currentlyHandledNodePath=null}resetTypingCaret(){let n=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(".typing-caret");n&&n.classList.remove("typing-caret")}resetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetCurrentlyHandledNodePathDebounced(){let t,r=1e3;return()=>{clearTimeout(t),t=setTimeout(()=>{this.currentlyHandledNodePath=null},r)}}addFlashMessage(t,r,n="error",i=null){let s=this.globalRegistry.get("i18n");this.store.dispatch(Ir.actions.UI.FlashMessages.add(t,s.translate("NEOSidekick.AiAssistant:Error:"+t,r,{0:i}),n))}};var rt=m(Wr());var j=m(he()),Hr=m(be()),P=m(Pe()),Gr=m(Ee()),se=m(Oe()),me=m(R());var _s={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},H=class extends j.Component{constructor(r){super(r);d(this,"state",{loading:!1});d(this,"getIcon",r=>r?j.default.createElement(se.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):j.default.createElement(se.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}));d(this,"fetch",async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:f,node:u,parentNode:g,frontendConfiguration:h}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,u,g),n=Object.keys(n).map(y=>({identifier:y,value:n[y]}));let l=await s.generate(r,a.language?a.language[0]:h.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?f.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}})}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:f}=this.props,u=Object.assign({},_s,o),g=o&&o.placeholder&&a.translate(unescape(o.placeholder)),h=!(u.readonly||u.disabled);return j.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},j.default.createElement("div",null,j.default.createElement(se.TextInput,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:g,onKeyPress:c,onEnterKey:f})),h?j.default.createElement("div",{style:{"margin-top":"4px"}},j.default.createElement(se.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};d(H,"propTypes",{className:P.default.string,value:P.default.oneOfType([P.default.string,P.default.number]),commit:P.default.func.isRequired,options:P.default.object,onKeyPress:P.default.func,onEnterKey:P.default.func,id:P.default.string,activeContentDimensions:P.default.object.isRequired,node:P.default.object,parentNode:P.default.object,i18nRegistry:P.default.object.isRequired,externalService:P.default.object.isRequired,contentService:P.default.object.isRequired,addFlashMessage:P.default.func.isRequired,frontendConfiguration:P.default.object}),d(H,"defaultProps",{options:{}}),H=$([(0,Gr.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Hr.connect)(e=>t=>{let r=me.selectors.CR.ContentDimensions.active(t),n=me.selectors.CR.Nodes.focusedSelector(t),i=me.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:me.actions.UI.FlashMessages.add})],H);var W=m(he()),$r=m(be()),E=m(Pe()),qr=m(Ee()),oe=m(Oe()),ye=m(R());var vs={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},G=class extends W.Component{constructor(r){super(r);d(this,"getIcon",r=>r?W.default.createElement(oe.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):W.default.createElement(oe.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}));d(this,"fetch",async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:f,node:u,parentNode:g,frontendConfiguration:h}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,u,g),n=Object.keys(n).map(y=>({identifier:y,value:n[y]}));let l=await s.generate(r,a.language?a.language[0]:h.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?f.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}});this.state={loading:!1}}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:f}=this.props,u=Object.assign({},vs,o),g=o&&o.placeholder&&a.translate(unescape(o.placeholder)),h=!(u.readonly||u.disabled);return W.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},W.default.createElement("div",null,W.default.createElement(oe.TextArea,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:g,minRows:u.minRows,expandedRows:u.expandedRows,onKeyPress:c,onEnterKey:f})),h?W.default.createElement("div",null,W.default.createElement(oe.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};d(G,"propTypes",{className:E.default.string,value:E.default.oneOfType([E.default.string,E.default.number]),commit:E.default.func.isRequired,options:E.default.object,onKeyPress:E.default.func,onEnterKey:E.default.func,id:E.default.string,activeContentDimensions:E.default.object.isRequired,node:E.default.object,parentNode:E.default.object,i18nRegistry:E.default.object.isRequired,externalService:E.default.object.isRequired,contentService:E.default.object.isRequired,addFlashMessage:E.default.func.isRequired,frontendConfiguration:E.default.object}),d(G,"defaultProps",{options:{}}),G=$([(0,qr.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,$r.connect)(e=>t=>{let r=ye.selectors.CR.ContentDimensions.active(t),n=ye.selectors.CR.Nodes.focusedSelector(t),i=ye.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:ye.actions.UI.FlashMessages.add})],G);var Jr=(e,t)=>{let r=e.get("inspector").get("editors");r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:t?H:rt.TextField}),r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:t?G:rt.TextArea})};var F=m(he()),ke=m(Oe());var nt=m(he()),Yr=m(be()),xe=m(Pe()),Vr=m(R()),Xr=m(Ee());var V=class extends nt.PureComponent{getUri(){let{configuration:t,activeContentDimensions:r,interfaceLanguage:n}=this.props,i=new URL(`${t.apiDomain}/chat/`);return i.searchParams.append("contentLanguage",r.language?r.language[0]:t.defaultLanguage),i.searchParams.append("interfaceLanguage",n),i.searchParams.append("userId",t.userId),i.searchParams.append("plattform","neos"),i.searchParams.append("domain",t.domain),i.searchParams.append("siteName",t.siteName),t?.referral&&i.searchParams.append("referral",t?.referral),t?.apiKey&&i.searchParams.append("apikey",t?.apiKey),i}render(){let{className:t}=this.props;return nt.default.createElement("iframe",{id:"neosidekickAssistant",className:t,src:this.getUri().toString(),allow:"clipboard-write",onLoad:r=>r.target.dataset.loaded=!0})}};d(V,"propTypes",{configuration:xe.default.object.isRequired,activeContentDimensions:xe.default.object.isRequired,interfaceLanguage:xe.default.object.isRequired,className:xe.default.string}),V=$([(0,Xr.neos)(e=>({configuration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Yr.connect)(e=>({activeContentDimensions:Vr.selectors.CR.ContentDimensions.active(e),interfaceLanguage:t=>t?.user?.preferences?.interfaceLanguage}),{})],V);var Zr=(e,t)=>{let r=e.get("containers"),n=r.get("App"),i=s=>{let o=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[a,c]=F.default.useState(o?.open),f=_=>{c(_),o.open=_,localStorage.setItem("NEOSidekick",JSON.stringify(o))},[u,g]=F.default.useState(o?.fullscreen),h=_=>{g(_),o.fullscreen=_,localStorage.setItem("NEOSidekick",JSON.stringify(o))},l=(_,b,p)=>{if(_)return F.default.createElement(ke.IconButton,{icon:b?"compress":"expand",onClick:p})},y=(_,b,p)=>{if(!b)return F.default.createElement(ke.IconButton,{icon:_?"chevron-circle-right":"chevron-circle-left",onClick:p})};return F.default.createElement("div",{className:`neosidekick_appWrapper ${a?"neosidekick_appWrapper--sidebar-open":""}  ${u?"neosidekick_appWrapper--sidebar-fullscreen":""}`},F.default.createElement(n,{...s}),F.default.createElement("div",{className:"neosidekick_sideBar"},F.default.createElement("div",{className:"neosidekick_sideBar__title"},F.default.createElement(ke.Headline,{className:`neosidekick_sideBar__title-headline ${a?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),F.default.createElement("div",null,l(a,u,()=>h(!u)),y(a,u,()=>f(!a)))),F.default.createElement(V,{className:`neosidekick_sideBar__frame ${a?"neosidekick_sideBar__frame--open":""}`})))};r.set("App",i)};var Te=m(R()),on=m(it());var en=m(it()),st=m(R()),tn=(e,t)=>function*(){yield(0,en.takeEvery)(st.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(r){r.payload.feedbackEnvelope.feedbacks.forEach(n=>{if(n.type!=="Neos.Neos.Ui:NodeCreated")return;let s=n.payload.contextPath.split("@")[0],o=t.getState(),a=st.selectors.CR.Nodes.nodesByContextPathSelector(o),c=e.get("@neos-project/neos-ui-contentrepository"),f=e.get("i18n"),u=e.get("NEOSidekick.AiAssistant").get("contentService"),g=e.get("NEOSidekick.AiAssistant").get("assistantService"),h=e.get("NEOSidekick.AiAssistant").get("externalService");Object.keys(a).forEach(l=>{if(!l.split("@")[0].startsWith(s))return;let _=a[l],b=a[_.parent],p=c.get(_.nodeType);Object.keys(p.properties).forEach(C=>{u.evaluateNodeTypeConfigurationAndStartGeneration(_,C,p,b,!0)})})})})};var rn=m(it()),nn=m(R()),sn=(e,t)=>function*(){yield(0,rn.takeEvery)(nn.actionTypes.CR.Nodes.REMOVE,function*(r){console.log("Payload: ",r);let n=e.get("NEOSidekick.AiAssistant").get("assistantService");if(n.currentlyHandledNodePath===r.payload){n.resetCurrentlyHandledNodePath();let i={version:"1.0",eventName:"cancel-call-module"};console.log("Message: ",i),n.sendMessageToIframe(i)}})};function Ss(e){return new Promise(t=>setTimeout(t,e))}var an=(e,t,r,n)=>{let i=!1,s=function*(){yield(0,on.takeLatest)([Te.actionTypes.UI.ContentCanvas.SET_SRC,Te.actionTypes.UI.ContentCanvas.RELOAD,Te.actionTypes.CR.Nodes.MERGE],async function*(a){a.type===Te.actionTypes.UI.ContentCanvas.SET_SRC&&(i=!0),yield Ss(500);let c=e.get("@neos-project/neos-ui-contentrepository"),f=t.getState(),u=f?.ui?.contentCanvas?.previewUrl,g=n.getCurrentDocumentNode(),h=g?.contextPath,l=Object.values(f?.cr?.nodes?.byContextPath||{}).filter(y=>{let _=c.getRole("document");if(!_)throw new Error("Document role is not loaded!");let b=c.getSubTypesOf(_);return h&&y.contextPath.indexOf(h.split("@")[0])===0&&(y.contextPath===h||!b.includes(y.nodeType))});r.sendMessageToIframe({version:"1.0",eventName:i?"page-changed":"page-updated",data:{url:u,title:g?.properties?.title||n.getGuestFrameDocumentTitle(),content:n.getGuestFrameDocumentHtml(),structuredContent:l,targetAudience:await n.getCurrentDocumentTargetAudience(),pageBriefing:await n.getCurrentDocumentPageBriefing(),focusKeyword:await n.getCurrentDocumentFocusKeyword()}}),i=!1})},o=e.get("sagas");o.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:s}),o.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:tn(e,t)}),o.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:sn(e,t)})};var De=m(he()),cn=m(be()),ot=m(Pe()),at=m(Oe()),un=m(Ee()),dn=m(R());var X=class extends De.PureComponent{constructor(r){super(r);d(this,"state",{show:!1,enabled:!0});d(this,"evaluateFocusedNodeAndPropertyAndShowButton",(r=5)=>{let{nodeType:n,property:i}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();if(!n||!i){if(r===0)return;setTimeout(()=>this.evaluateFocusedNodeAndPropertyAndShowButton(r-1),100);return}let s=n.properties[i];this.setState({show:s?.ui?.inlineEditable===!0&&s?.options?.sidekick?.module!==void 0})});d(this,"onClick",async()=>{let{addFlashMessage:r,i18nRegistry:n,contentService:i}=this.props;try{this.setState({enabled:!1});let{node:s,nodeType:o,parentNode:a,property:c}=i.getCurrentlyFocusedNodePathAndProperty();await i.evaluateNodeTypeConfigurationAndStartGeneration(s,c,o,a)}catch(s){r(s?.code??s?.message,s?.code?n.translate("NEOSidekick.AiAssistant:Error:"+s.code,s.message,{0:s.externalMessage}):s.message,s?.severity??"error")}finally{setTimeout(()=>{this.setState({enabled:!0})},2500)}})}componentDidMount(){this.evaluateFocusedNodeAndPropertyAndShowButton()}render(){let{i18nRegistry:r}=this.props;return this.state.show?De.default.createElement(at.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:r.translate("NEOSidekick.AiAssistant:Main:generate")},De.default.createElement(at.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),r.translate("NEOSidekick.AiAssistant:Main:generate")):""}};d(X,"propTypes",{contentService:ot.default.object.isRequired,i18nRegistry:ot.default.object.isRequired,addFlashMessage:ot.default.func.isRequired}),X=$([(0,un.neos)(e=>({contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:e.get("i18n")})),(0,cn.connect)(()=>{},{addFlashMessage:dn.actions.UI.FlashMessages.add})],X);var fn=e=>{e.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:generate",{component:X,isVisible:()=>!0},"end")};jt("NEOSidekick.AiAssistant",{},(e,{store:t,frontendConfiguration:r})=>{let n=r["NEOSidekick.AiAssistant"],i=!!n&&n.enabled!==!1;if(Jr(e,i),!i)return;if(!n.hasOwnProperty("defaultLanguage")||!n.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}e.set("NEOSidekick.AiAssistant",new q("")),e.get("NEOSidekick.AiAssistant").set("configuration",n);let s=Wt(r);e.get("NEOSidekick.AiAssistant").set("externalService",s);let o=Mr(e,t);e.get("NEOSidekick.AiAssistant").set("contentService",o);let a=Rr(e,t);e.get("NEOSidekick.AiAssistant").set("assistantService",a),a.listenToMessages(),Zr(e,n),an(e,t,a,o),fn(e)});})();
//# sourceMappingURL=Plugin.js.map
