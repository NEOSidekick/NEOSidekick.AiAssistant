(()=>{var nn=Object.create;var st=Object.defineProperty;var jt=Object.getOwnPropertyDescriptor;var sn=Object.getOwnPropertyNames;var on=Object.getPrototypeOf,an=Object.prototype.hasOwnProperty;var cn=(e,t)=>()=>(e&&(t=e(e=0)),t);var q=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var un=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of sn(t))!an.call(e,i)&&i!==r&&st(e,i,{get:()=>t[i],enumerable:!(n=jt(t,i))||n.enumerable});return e};var y=(e,t,r)=>(r=e!=null?nn(on(e)):{},un(t||!e||!e.__esModule?st(r,"default",{value:e,enumerable:!0}):r,e));var ce=(e,t,r,n)=>{for(var i=n>1?void 0:n?jt(t,r):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(n?o(t,r,i):o(i))||i);return n&&i&&st(t,r,i),i};function C(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var R=cn(()=>{});var Se=q((Fs,Lt)=>{R();Lt.exports=C("NeosProjectPackages")().ReactUiComponents});var Y=q((Ms,zt)=>{R();zt.exports=C("NeosProjectPackages")().NeosUiReduxStore});var Ae=q((js,Bt)=>{R();Bt.exports=C("vendor")().React});var ke=q((Ls,Wt)=>{R();Wt.exports=C("vendor")().reactRedux});var De=q((Bs,Ht)=>{R();Ht.exports=C("vendor")().reduxSagaEffects});var Fe=q((Hs,Ut)=>{R();Ut.exports=C("vendor")().PropTypes});var Ie=q(($s,$t)=>{R();$t.exports=C("NeosProjectPackages")().NeosUiDecorators});var Hr=q((be,ge)=>{var Cn=200,bn="Expected a function",Et="__lodash_hash_undefined__",Je=1,he=2,vr=1/0,Sr=9007199254740991,Be="[object Arguments]",St="[object Array]",Ar="[object Boolean]",Nr="[object Date]",wr="[object Error]",Cr="[object Function]",Pn="[object GeneratorFunction]",We="[object Map]",br="[object Number]",pe="[object Object]",dr="[object Promise]",Pr="[object RegExp]",He="[object Set]",Er="[object String]",Or="[object Symbol]",At="[object WeakMap]",xr="[object ArrayBuffer]",Ue="[object DataView]",En="[object Float32Array]",On="[object Float64Array]",xn="[object Int8Array]",Tn="[object Int16Array]",kn="[object Int32Array]",Dn="[object Uint8Array]",Fn="[object Uint8ClampedArray]",In="[object Uint16Array]",Mn="[object Uint32Array]",Rn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jn=/^\w*$/,Kn=/^\./,Ln=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zn=/[\\^$.*+?()[\]{}|]/g,Bn=/\\(\\)?/g,Wn=/^\[object .+?Constructor\]$/,Hn=/^(?:0|[1-9]\d*)$/,S={};S[En]=S[On]=S[xn]=S[Tn]=S[kn]=S[Dn]=S[Fn]=S[In]=S[Mn]=!0;S[Be]=S[St]=S[xr]=S[Ar]=S[Ue]=S[Nr]=S[wr]=S[Cr]=S[We]=S[br]=S[pe]=S[Pr]=S[He]=S[Er]=S[At]=!1;var Tr=typeof global=="object"&&global&&global.Object===Object&&global,Un=typeof self=="object"&&self&&self.Object===Object&&self,X=Tr||Un||Function("return this")(),kr=typeof be=="object"&&be&&!be.nodeType&&be,fr=kr&&typeof ge=="object"&&ge&&!ge.nodeType&&ge,$n=fr&&fr.exports===kr,lr=$n&&Tr.process,pr=function(){try{return lr&&lr.binding("util")}catch{}}(),gr=pr&&pr.isTypedArray;function Gn(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function qn(e){return function(t){return t?.[e]}}function Jn(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function Yn(e){return function(t){return e(t)}}function Vn(e,t){return e?.[t]}function Nt(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function Xn(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function Zn(e,t){return function(r){return e(t(r))}}function Qn(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var ei=Array.prototype,ti=Function.prototype,Ye=Object.prototype,_t=X["__core-js_shared__"],hr=function(){var e=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Dr=ti.toString,H=Ye.hasOwnProperty,me=Ye.toString,ri=RegExp("^"+Dr.call(H).replace(zn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),mr=X.Symbol,yr=X.Uint8Array,ni=Ye.propertyIsEnumerable,ii=ei.splice,si=Zn(Object.keys,Object),wt=ye(X,"DataView"),Pe=ye(X,"Map"),Ct=ye(X,"Promise"),bt=ye(X,"Set"),Pt=ye(X,"WeakMap"),Ee=ye(Object,"create"),oi=oe(wt),ai=oe(Pe),ci=oe(Ct),ui=oe(bt),di=oe(Pt),$e=mr?mr.prototype:void 0,vt=$e?$e.valueOf:void 0,_r=$e?$e.toString:void 0;function ie(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function fi(){this.__data__=Ee?Ee(null):{}}function li(e){return this.has(e)&&delete this.__data__[e]}function pi(e){var t=this.__data__;if(Ee){var r=t[e];return r===Et?void 0:r}return H.call(t,e)?t[e]:void 0}function gi(e){var t=this.__data__;return Ee?t[e]!==void 0:H.call(t,e)}function hi(e,t){var r=this.__data__;return r[e]=Ee&&t===void 0?Et:t,this}ie.prototype.clear=fi;ie.prototype.delete=li;ie.prototype.get=pi;ie.prototype.has=gi;ie.prototype.set=hi;function U(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function mi(){this.__data__=[]}function yi(e){var t=this.__data__,r=Ve(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():ii.call(t,r,1),!0}function _i(e){var t=this.__data__,r=Ve(t,e);return r<0?void 0:t[r][1]}function vi(e){return Ve(this.__data__,e)>-1}function Si(e,t){var r=this.__data__,n=Ve(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}U.prototype.clear=mi;U.prototype.delete=yi;U.prototype.get=_i;U.prototype.has=vi;U.prototype.set=Si;function $(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ai(){this.__data__={hash:new ie,map:new(Pe||U),string:new ie}}function Ni(e){return Xe(this,e).delete(e)}function wi(e){return Xe(this,e).get(e)}function Ci(e){return Xe(this,e).has(e)}function bi(e,t){return Xe(this,e).set(e,t),this}$.prototype.clear=Ai;$.prototype.delete=Ni;$.prototype.get=wi;$.prototype.has=Ci;$.prototype.set=bi;function Ge(e){var t=-1,r=e?e.length:0;for(this.__data__=new $;++t<r;)this.add(e[t])}function Pi(e){return this.__data__.set(e,Et),this}function Ei(e){return this.__data__.has(e)}Ge.prototype.add=Ge.prototype.push=Pi;Ge.prototype.has=Ei;function W(e){this.__data__=new U(e)}function Oi(){this.__data__=new U}function xi(e){return this.__data__.delete(e)}function Ti(e){return this.__data__.get(e)}function ki(e){return this.__data__.has(e)}function Di(e,t){var r=this.__data__;if(r instanceof U){var n=r.__data__;if(!Pe||n.length<Cn-1)return n.push([e,t]),this;r=this.__data__=new $(n)}return r.set(e,t),this}W.prototype.clear=Oi;W.prototype.delete=xi;W.prototype.get=Ti;W.prototype.has=ki;W.prototype.set=Di;function Fi(e,t){var r=se(e)||zr(e)?Jn(e.length,String):[],n=r.length,i=!!n;for(var s in e)(t||H.call(e,s))&&!(i&&(s=="length"||Rr(s,n)))&&r.push(s);return r}function Ve(e,t){for(var r=e.length;r--;)if(Lr(e[r][0],t))return r;return-1}var Ii=Ji();function Mi(e,t){return e&&Ii(e,t,qe)}function Fr(e,t){t=Ze(t,e)?[t]:Ir(t);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Qe(t[r++])];return r&&r==n?e:void 0}function Ri(e){return me.call(e)}function ji(e,t){return e!=null&&t in Object(e)}function Ot(e,t,r,n,i){return e===t?!0:e==null||t==null||!et(e)&&!tt(t)?e!==e&&t!==t:Ki(e,t,Ot,r,n,i)}function Ki(e,t,r,n,i,s){var o=se(e),a=se(t),c=St,d=St;o||(c=V(e),c=c==Be?pe:c),a||(d=V(t),d=d==Be?pe:d);var u=c==pe&&!Nt(e),g=d==pe&&!Nt(t),p=c==d;if(p&&!u)return s||(s=new W),o||is(e)?Mr(e,t,r,n,i,s):Yi(e,t,c,r,n,i,s);if(!(i&he)){var l=u&&H.call(e,"__wrapped__"),_=g&&H.call(t,"__wrapped__");if(l||_){var E=l?e.value():e,x=_?t.value():t;return s||(s=new W),r(E,x,n,i,s)}}return p?(s||(s=new W),Vi(e,t,r,n,i,s)):!1}function Li(e,t,r,n){var i=r.length,s=i,o=!n;if(e==null)return!s;for(e=Object(e);i--;){var a=r[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){a=r[i];var c=a[0],d=e[c],u=a[1];if(o&&a[2]){if(d===void 0&&!(c in e))return!1}else{var g=new W;if(n)var p=n(d,u,c,e,t,g);if(!(p===void 0?Ot(u,d,n,Je|he,g):p))return!1}}return!0}function zi(e){if(!et(e)||es(e))return!1;var t=Wr(e)||Nt(e)?ri:Wn;return t.test(oe(e))}function Bi(e){return tt(e)&&Tt(e.length)&&!!S[me.call(e)]}function Wi(e){return typeof e=="function"?e:e==null?us:typeof e=="object"?se(e)?$i(e[0],e[1]):Ui(e):ds(e)}function Hi(e){if(!ts(e))return si(e);var t=[];for(var r in Object(e))H.call(e,r)&&r!="constructor"&&t.push(r);return t}function Ui(e){var t=Xi(e);return t.length==1&&t[0][2]?Kr(t[0][0],t[0][1]):function(r){return r===e||Li(r,e,t)}}function $i(e,t){return Ze(e)&&jr(t)?Kr(Qe(e),t):function(r){var n=os(r,e);return n===void 0&&n===t?as(r,e):Ot(t,n,void 0,Je|he)}}function Gi(e){return function(t){return Fr(t,e)}}function qi(e){if(typeof e=="string")return e;if(kt(e))return _r?_r.call(e):"";var t=e+"";return t=="0"&&1/e==-vr?"-0":t}function Ir(e){return se(e)?e:rs(e)}function Ji(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(r(s[c],c,s)===!1)break}return t}}function Mr(e,t,r,n,i,s){var o=i&he,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var d=s.get(e);if(d&&s.get(t))return d==t;var u=-1,g=!0,p=i&Je?new Ge:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var l=e[u],_=t[u];if(n)var E=o?n(_,l,u,t,e,s):n(l,_,u,e,t,s);if(E!==void 0){if(E)continue;g=!1;break}if(p){if(!Gn(t,function(x,f){if(!p.has(f)&&(l===x||r(l,x,n,i,s)))return p.add(f)})){g=!1;break}}else if(!(l===_||r(l,_,n,i,s))){g=!1;break}}return s.delete(e),s.delete(t),g}function Yi(e,t,r,n,i,s,o){switch(r){case Ue:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case xr:return!(e.byteLength!=t.byteLength||!n(new yr(e),new yr(t)));case Ar:case Nr:case br:return Lr(+e,+t);case wr:return e.name==t.name&&e.message==t.message;case Pr:case Er:return e==t+"";case We:var a=Xn;case He:var c=s&he;if(a||(a=Qn),e.size!=t.size&&!c)return!1;var d=o.get(e);if(d)return d==t;s|=Je,o.set(e,t);var u=Mr(a(e),a(t),n,i,s,o);return o.delete(e),u;case Or:if(vt)return vt.call(e)==vt.call(t)}return!1}function Vi(e,t,r,n,i,s){var o=i&he,a=qe(e),c=a.length,d=qe(t),u=d.length;if(c!=u&&!o)return!1;for(var g=c;g--;){var p=a[g];if(!(o?p in t:H.call(t,p)))return!1}var l=s.get(e);if(l&&s.get(t))return l==t;var _=!0;s.set(e,t),s.set(t,e);for(var E=o;++g<c;){p=a[g];var x=e[p],f=t[p];if(n)var v=o?n(f,x,p,t,e,s):n(x,f,p,e,t,s);if(!(v===void 0?x===f||r(x,f,n,i,s):v)){_=!1;break}E||(E=p=="constructor")}if(_&&!E){var m=e.constructor,w=t.constructor;m!=w&&"constructor"in e&&"constructor"in t&&!(typeof m=="function"&&m instanceof m&&typeof w=="function"&&w instanceof w)&&(_=!1)}return s.delete(e),s.delete(t),_}function Xe(e,t){var r=e.__data__;return Qi(t)?r[typeof t=="string"?"string":"hash"]:r.map}function Xi(e){for(var t=qe(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,jr(i)]}return t}function ye(e,t){var r=Vn(e,t);return zi(r)?r:void 0}var V=Ri;(wt&&V(new wt(new ArrayBuffer(1)))!=Ue||Pe&&V(new Pe)!=We||Ct&&V(Ct.resolve())!=dr||bt&&V(new bt)!=He||Pt&&V(new Pt)!=At)&&(V=function(e){var t=me.call(e),r=t==pe?e.constructor:void 0,n=r?oe(r):void 0;if(n)switch(n){case oi:return Ue;case ai:return We;case ci:return dr;case ui:return He;case di:return At}return t});function Zi(e,t,r){t=Ze(t,e)?[t]:Ir(t);for(var n,i=-1,o=t.length;++i<o;){var s=Qe(t[i]);if(!(n=e!=null&&r(e,s)))break;e=e[s]}if(n)return n;var o=e?e.length:0;return!!o&&Tt(o)&&Rr(s,o)&&(se(e)||zr(e))}function Rr(e,t){return t=t??Sr,!!t&&(typeof e=="number"||Hn.test(e))&&e>-1&&e%1==0&&e<t}function Ze(e,t){if(se(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||kt(e)?!0:jn.test(e)||!Rn.test(e)||t!=null&&e in Object(t)}function Qi(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function es(e){return!!hr&&hr in e}function ts(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Ye;return e===r}function jr(e){return e===e&&!et(e)}function Kr(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var rs=xt(function(e){e=ss(e);var t=[];return Kn.test(e)&&t.push(""),e.replace(Ln,function(r,n,i,s){t.push(i?s.replace(Bn,"$1"):n||r)}),t});function Qe(e){if(typeof e=="string"||kt(e))return e;var t=e+"";return t=="0"&&1/e==-vr?"-0":t}function oe(e){if(e!=null){try{return Dr.call(e)}catch{}try{return e+""}catch{}}return""}function xt(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(bn);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o),o};return r.cache=new(xt.Cache||$),r}xt.Cache=$;function Lr(e,t){return e===t||e!==e&&t!==t}function zr(e){return ns(e)&&H.call(e,"callee")&&(!ni.call(e,"callee")||me.call(e)==Be)}var se=Array.isArray;function Br(e){return e!=null&&Tt(e.length)&&!Wr(e)}function ns(e){return tt(e)&&Br(e)}function Wr(e){var t=et(e)?me.call(e):"";return t==Cr||t==Pn}function Tt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Sr}function et(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function tt(e){return!!e&&typeof e=="object"}function kt(e){return typeof e=="symbol"||tt(e)&&me.call(e)==Or}var is=gr?Yn(gr):Bi;function ss(e){return e==null?"":qi(e)}function os(e,t,r){var n=e==null?void 0:Fr(e,t);return n===void 0?r:n}function as(e,t){return e!=null&&Zi(e,t,ji)}function qe(e){return Br(e)?Fi(e):Hi(e)}function cs(e,t){var r={};return t=Wi(t,3),Mi(e,function(n,i,s){r[i]=t(n,i,s)}),r}function us(e){return e}function ds(e){return Ze(e)?qn(Qe(e)):Gi(e)}ge.exports=cs});R();var ve=class{constructor(t){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=t}};var dn=(e,t="position",r="key")=>{let n=typeof t=="string"?f=>f[t]:t,i={},s={},o={},a={},c={},d={};e.forEach((f,v)=>{let m=f[r]?f[r]:String(v);i[m]=v;let w=n(f),A=String(w||v),G=!1;if(A.startsWith("start")){let h=A.match(/start\s+(\d+)/),N=h&&h[1]?Number(h[1]):0;o[N]||(o[N]=[]),o[N].push(m)}else if(A.startsWith("end")){let h=A.match(/end\s+(\d+)/),N=h&&h[1]?Number(h[1]):0;a[N]||(a[N]=[]),a[N].push(m)}else if(A.startsWith("before")){let h=A.match(/before\s+(\S+)(\s+(\d+))?/);if(!h)G=!0;else{let N=h[1],I=h[3]?Number(h[3]):0;c[N]||(c[N]={}),c[N][I]||(c[N][I]=[]),c[N][I].push(m)}}else if(A.startsWith("after")){let h=A.match(/after\s+(\S+)(\s+(\d+))?/);if(!h)G=!0;else{let N=h[1],I=h[3]?Number(h[3]):0;d[N]||(d[N]={}),d[N][I]||(d[N][I]=[]),d[N][I].push(m)}}else G=!0;if(G){let h=parseFloat(A);(isNaN(h)||!isFinite(h))&&(h=v),s[h]||(s[h]=[]),s[h].push(m)}});let u=[],g=[],p=[],l=[],_=(f,v)=>{let m=Object.keys(f).map(w=>Number(w)).sort((w,A)=>w-A);return v?m:m.reverse()},E=(f,v)=>{f.forEach(m=>{if(!(l.indexOf(m)>=0)){if(l.push(m),c[m]){let w=_(c[m],!0);for(let A of w)E(c[m][A],v)}if(v.push(m),d[m]){let w=_(d[m],!1);for(let A of w)E(d[m][A],v)}}})};for(let f of _(o,!1))E(o[f],u);for(let f of _(s,!0))E(s[f],g);for(let f of _(a,!0))E(a[f],p);for(let f of Object.keys(c))if(!(l.indexOf(f)>=0))for(let v of _(c[f],!1))E(c[f][v],u);for(let f of Object.keys(d))if(!(l.indexOf(f)>=0))for(let v of _(d[f],!1))E(d[f][v],g);return[...u,...g,...p].map(f=>i[f]).map(f=>e[f])},ot=dn;var J=class extends ve{constructor(t){super(t),this._registry=[]}set(t,r,n=0){if(typeof t!="string")throw new Error("Key must be a string");if(typeof n!="string"&&typeof n!="number")throw new Error("Position must be a string or a number");let i={key:t,value:r};n&&(i.position=n);let s=this._registry.findIndex(o=>o.key===t);return s===-1?this._registry.push(i):this._registry[s]=i,r}get(t){if(typeof t!="string")return console.error("Key must be a string"),null;let r=this._registry.find(n=>n.key===t);return r?r.value:null}_getChildrenWrapped(t){let r=this._registry.filter(n=>n.key.indexOf(t+"/")===0);return ot(r)}getChildrenAsObject(t){let r={};return this._getChildrenWrapped(t).forEach(n=>{r[n.key]=n.value}),r}getChildren(t){return this._getChildrenWrapped(t).map(r=>r.value)}has(t){return typeof t!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(r=>r.key===t)}_getAllWrapped(){return ot(this._registry)}getAllAsObject(){let t={};return this._getAllWrapped().forEach(r=>{t[r.key]=r.value}),t}getAllAsList(){return this._getAllWrapped().map(t=>Object.assign({id:t.key},t.value))}};var Kt=C("manifest");var Te=y(Se()),ae=y(Y()),F=y(Ae()),Mt=y(ke()),en=y(De());var j=y(Ae()),Gt=y(ke()),b=y(Fe()),qt=y(Ie()),Q=y(Se()),ue=y(Y());var ln={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},z=class extends j.Component{constructor(r){super(r);this.state={loading:!1};this.getIcon=r=>r?j.default.createElement(Q.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):j.default.createElement(Q.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:d,node:u,parentNode:g,frontendConfiguration:p}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(Object.assign({},n),u,g),n=Object.keys(n).map(_=>({identifier:_,value:n[_]}));let l=await s.generate(r,a.language?a.language[0]:p.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?d.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}}}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:d}=this.props,u=Object.assign({},ln,o),g=o&&o.placeholder&&a.translate(unescape(o.placeholder)),p=!(u.readonly||u.disabled);return j.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},j.default.createElement("div",null,j.default.createElement(Q.TextInput,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:g,onKeyPress:c,onEnterKey:d})),p?j.default.createElement("div",{style:{"margin-top":"4px"}},j.default.createElement(Q.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generate"),"\xA0",this.getIcon(this.state.loading))):null)}};z.propTypes={className:b.default.string,value:b.default.oneOfType([b.default.string,b.default.number]),commit:b.default.func.isRequired,options:b.default.object,onKeyPress:b.default.func,onEnterKey:b.default.func,id:b.default.string,activeContentDimensions:b.default.object.isRequired,node:b.default.object,parentNode:b.default.object,i18nRegistry:b.default.object.isRequired,externalService:b.default.object.isRequired,contentService:b.default.object.isRequired,addFlashMessage:b.default.func.isRequired,frontendConfiguration:b.default.object},z.defaultProps={options:{}},z=ce([(0,qt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Gt.connect)(e=>t=>{let r=ue.selectors.CR.ContentDimensions.active(t),n=ue.selectors.CR.Nodes.focusedSelector(t),i=ue.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:ue.actions.UI.FlashMessages.add})],z);var K=y(Ae()),Jt=y(ke()),P=y(Fe()),Yt=y(Ie()),ee=y(Se()),de=y(Y());var pn={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},B=class extends K.Component{constructor(r){super(r);this.getIcon=r=>r?K.default.createElement(ee.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):K.default.createElement(ee.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:d,node:u,parentNode:g,frontendConfiguration:p}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(Object.assign({},n),u,g),n=Object.keys(n).map(_=>({identifier:_,value:n[_]}));let l=await s.generate(r,a.language?a.language[0]:p.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?d.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}};this.state={loading:!1}}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:d}=this.props,u=Object.assign({},pn,o),g=o&&o.placeholder&&a.translate(unescape(o.placeholder)),p=!(u.readonly||u.disabled);return K.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},K.default.createElement("div",null,K.default.createElement(ee.TextArea,{id:r,value:n,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:g,minRows:u.minRows,expandedRows:u.expandedRows,onKeyPress:c,onEnterKey:d})),p?K.default.createElement("div",null,K.default.createElement(ee.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generate"),"\xA0",this.getIcon(this.state.loading))):null)}};B.propTypes={className:P.default.string,value:P.default.oneOfType([P.default.string,P.default.number]),commit:P.default.func.isRequired,options:P.default.object,onKeyPress:P.default.func,onEnterKey:P.default.func,id:P.default.string,activeContentDimensions:P.default.object.isRequired,node:P.default.object,parentNode:P.default.object,i18nRegistry:P.default.object.isRequired,externalService:P.default.object.isRequired,contentService:P.default.object.isRequired,addFlashMessage:P.default.func.isRequired,frontendConfiguration:P.default.object},B.defaultProps={options:{}},B=ce([(0,Yt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Jt.connect)(e=>t=>{let r=de.selectors.CR.ContentDimensions.active(t),n=de.selectors.CR.Nodes.focusedSelector(t),i=de.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:de.actions.UI.FlashMessages.add})],B);var O=class extends Error{constructor(r,n,i){super(r);this.severity="error";this.code=n,this.externalMessage=i}};var Vt=e=>{let t=e["NEOSidekick.AiAssistant"];return new at(t.apiDomain,t.apiKey)},at=class{constructor(t,r){this.apiDomain="";this.apiKey="";this.hasApiKey=()=>this.apiKey!==null&&this.apiKey!=="";this.generate=async(t,r,n={})=>{if(!this.apiKey)throw new O("This feature is not available in the free version.","1688157373215");let i=await fetch(`${this.apiDomain}/api/v1/chat?language=${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:t,platform:"neos",user_input:n})}),s=await i.json();if(i.status===401)throw new O("The NEOSidekick api key provided is not valid.","1688158193038");if(i.status<200||i.status>=400)throw new O("An error occurred while asking NEOSidekick.","1688158257149",s?.message);let o=s?.data?.message?.message;return o.startsWith('"')&&o.endsWith('"')&&(o=o.substr(1,o.length-2)),o};this.apiDomain=t,this.apiKey=r}};R();var Xt=C("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:eo}=C("NeosProjectPackages")().NeosUiBackendConnector;var _e=y(Y());var nr=Symbol.for("immer-nothing"),Zt=Symbol.for("immer-draftable"),k=Symbol.for("immer-state");function M(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var fe=Object.getPrototypeOf;function le(e){return!!e&&!!e[k]}function re(e){return e?ir(e)||Array.isArray(e)||!!e[Zt]||!!e.constructor?.[Zt]||Ke(e)||Le(e):!1}var gn=Object.prototype.constructor.toString();function ir(e){if(!e||typeof e!="object")return!1;let t=fe(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===gn}function Ne(e,t){je(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function je(e){let t=e[k];return t?t.type_:Array.isArray(e)?1:Ke(e)?2:Le(e)?3:0}function dt(e,t){return je(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function sr(e,t,r){let n=je(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function hn(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function Ke(e){return e instanceof Map}function Le(e){return e instanceof Set}function te(e){return e.copy_||e.base_}function ft(e,t){if(Ke(e))return new Map(e);if(Le(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&ir(e))return fe(e)?{...e}:Object.assign(Object.create(null),e);let r=Object.getOwnPropertyDescriptors(e);delete r[k];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){let s=n[i],o=r[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(fe(e),r)}function mt(e,t=!1){return ze(e)||le(e)||!re(e)||(je(e)>1&&(e.set=e.add=e.clear=e.delete=mn),Object.freeze(e),t&&Ne(e,(r,n)=>mt(n,!0),!0)),e}function mn(){M(2)}function ze(e){return Object.isFrozen(e)}var yn={};function ne(e){let t=yn[e];return t||M(0,e),t}var we;function or(){return we}function _n(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Qt(e,t){t&&(ne("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function lt(e){pt(e),e.drafts_.forEach(vn),e.drafts_=null}function pt(e){e===we&&(we=e.parent_)}function er(e){return we=_n(we,e)}function vn(e){let t=e[k];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function tr(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[k].modified_&&(lt(t),M(4)),re(e)&&(e=Me(t,e),t.parent_||Re(t,e)),t.patches_&&ne("Patches").generateReplacementPatches_(r[k].base_,e,t.patches_,t.inversePatches_)):e=Me(t,r,[]),lt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==nr?e:void 0}function Me(e,t,r){if(ze(t))return t;let n=t[k];if(!n)return Ne(t,(i,s)=>rr(e,n,t,i,s,r),!0),t;if(n.scope_!==e)return t;if(!n.modified_)return Re(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let i=n.copy_,s=i,o=!1;n.type_===3&&(s=new Set(i),i.clear(),o=!0),Ne(s,(a,c)=>rr(e,n,i,a,c,r,o)),Re(e,i,!1),r&&e.patches_&&ne("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function rr(e,t,r,n,i,s,o){if(le(i)){let a=s&&t&&t.type_!==3&&!dt(t.assigned_,n)?s.concat(n):void 0,c=Me(e,i,a);if(sr(r,n,c),le(c))e.canAutoFreeze_=!1;else return}else o&&r.add(i);if(re(i)&&!ze(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Me(e,i),(!t||!t.scope_.parent_)&&Re(e,i)}}function Re(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&mt(t,r)}function Sn(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:or(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=n,s=yt;r&&(i=[n],s=Ce);let{revoke:o,proxy:a}=Proxy.revocable(i,s);return n.draft_=a,n.revoke_=o,a}var yt={get(e,t){if(t===k)return e;let r=te(e);if(!dt(r,t))return An(e,r,t);let n=r[t];return e.finalized_||!re(n)?n:n===ct(e.base_,t)?(ut(e),e.copy_[t]=ht(n,e)):n},has(e,t){return t in te(e)},ownKeys(e){return Reflect.ownKeys(te(e))},set(e,t,r){let n=ar(te(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let i=ct(te(e),t),s=i?.[k];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(hn(r,i)&&(r!==void 0||dt(e.base_,t)))return!0;ut(e),gt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return ct(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ut(e),gt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=te(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){M(11)},getPrototypeOf(e){return fe(e.base_)},setPrototypeOf(){M(12)}},Ce={};Ne(yt,(e,t)=>{Ce[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Ce.deleteProperty=function(e,t){return Ce.set.call(this,e,t,void 0)};Ce.set=function(e,t,r){return yt.set.call(this,e[0],t,r,e[0])};function ct(e,t){let r=e[k];return(r?te(r):e)[t]}function An(e,t,r){let n=ar(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function ar(e,t){if(!(t in e))return;let r=fe(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=fe(r)}}function gt(e){e.modified_||(e.modified_=!0,e.parent_&&gt(e.parent_))}function ut(e){e.copy_||(e.copy_=ft(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Nn=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let s=r;r=t;let o=this;return function(c=s,...d){return o.produce(c,u=>r.call(this,u,...d))}}typeof r!="function"&&M(6),n!==void 0&&typeof n!="function"&&M(7);let i;if(re(t)){let s=er(this),o=ht(t,void 0),a=!0;try{i=r(o),a=!1}finally{a?lt(s):pt(s)}return Qt(s,n),tr(i,s)}else if(!t||typeof t!="object"){if(i=r(t),i===void 0&&(i=t),i===nr&&(i=void 0),this.autoFreeze_&&mt(i,!0),n){let s=[],o=[];ne("Patches").generateReplacementPatches_(t,i,s,o),n(s,o)}return i}else M(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let n,i;return[this.produce(t,r,(o,a)=>{n=o,i=a}),n,i]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){re(e)||M(8),le(e)&&(e=wn(e));let t=er(this),r=ht(e,void 0);return r[k].isManual_=!0,pt(t),r}finishDraft(e,t){let r=e&&e[k];(!r||!r.isManual_)&&M(9);let{scope_:n}=r;return Qt(n,t),tr(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let i=t[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(t=t.slice(r+1));let n=ne("Patches").applyPatches_;return le(e)?n(e,t):this.produce(e,i=>n(i,t))}};function ht(e,t){let r=Ke(e)?ne("MapSet").proxyMap_(e,t):Le(e)?ne("MapSet").proxySet_(e,t):Sn(e,t);return(t?t.scope_:or()).drafts_.push(r),r}function wn(e){return le(e)||M(10,e),cr(e)}function cr(e){if(!re(e)||ze(e))return e;let t=e[k],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=ft(e,t.scope_.immer_.useStrictShallowCopy_)}else r=ft(e,!0);return Ne(r,(n,i)=>{sr(r,n,cr(i))}),t&&(t.finalized_=!1),r}var D=new Nn,ur=D.produce,ro=D.produceWithPatches.bind(D),no=D.setAutoFreeze.bind(D),io=D.setUseStrictShallowCopy.bind(D),so=D.applyPatches.bind(D),oo=D.createDraft.bind(D),ao=D.finishDraft.bind(D);var Ur=y(Hr()),$r=(e,t)=>new Dt(e,t),Dt=class{constructor(t,r){this.getGuestFrameDocumentTitle=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title;this.getGuestFrameDocumentHtml=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML;this.getCurrentDocumentNode=()=>{let t=this.store.getState(),r=t?.cr?.nodes?.documentNode;return t?.cr?.nodes?.byContextPath[r]};this.getCurrentDocumentParentNode=()=>{let t=this.store.getState(),r=this.getCurrentDocumentNode();return t?.cr?.nodes?.byContextPath[r.parent]};this.getCurrentDocumentNodeType=()=>{let t=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(t?.nodeType)};this.getCurrentDocumentTargetAudience=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return t?await this.processClientEval(t):null};this.getCurrentDocumentPageBriefing=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return t?await this.processClientEval(t):null};this.getCurrentDocumentFocusKeyword=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return t?await this.processClientEval(t):null};this.processClientEval=async(t,r=null,n=null)=>{if(typeof t=="string"&&(t.startsWith("SidekickClientEval:")||t.startsWith("ClientEval:")))try{r=r??this.getCurrentDocumentNode();let i=_e.selectors.UI.Inspector.transientValues(this.store.getState());r=this.generateNodeForContext(r,i),n=n??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),a=await this.getImageMetadata,c=Object.getPrototypeOf(async function(){}).constructor;return await new c("node,parentNode,documentTitle,documentContent,AssetUri","return "+t.replace("SidekickClientEval:","").replace("ClientEval:",""))(r,n,s,o,a)}catch(i){throw i instanceof O?i:(console.error(i),new O('An error occurred while trying to evaluate "'+t+'"',1694682118365,t))}return t};this.processObjectWithClientEval=async(t,r=null,n=null)=>(await Promise.all(Object.keys(t).map(async i=>{let s=t[i];typeof s=="string"&&(t[i]=await this.processClientEval(s,r,n)),typeof s=="object"&&s!==null&&(t[i]=await this.processObjectWithClientEval(s,r,n)),Array.isArray(s)&&(t[i]=await Promise.all(s.map(async o=>await this.processObjectWithClientEval(o,r,n))))})),t);this.getImageMetadata=async t=>{if(!t||!t?.__identity)throw new O("The property does not have a valid image.",1694595562191);let{loadImageMetadata:r}=Xt.get().endpoints,n,i;try{let o=await r(t?.__identity);n=o?.originalImageResourceUri,i=o?.previewImageResourceUri}catch{throw new O("Could not fetch image object.",1694595598880)}if(!n||n==="")throw new O("The given image does not have a correct url.",1694595462402);let s=[];return s.push(this.prependConfiguredDomainToImageUri(n)),i&&s.push(this.prependConfiguredDomainToImageUri(i)),s};this.globalRegistry=t,this.store=r,this.nodeTypesRegistry=t.get("@neos-project/neos-ui-contentrepository"),this.externalService=t.get("NEOSidekick.AiAssistant").get("externalService")}prependConfiguredDomainToImageUri(t){let r="https://rested-pheasant-vocal.ngrok-free.app";return t=t.replace("http://","").replace("https://").split("/"),t.shift(),t.unshift(r),t.join("/")}getCurrentlyFocusedNodePathAndProperty(){let t=this.store.getState(),r=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),n=t?.cr?.nodes?.focused?.contextPaths[0],i=n?_e.selectors.CR.Nodes.nodeByContextPath(t)(n):null;return{nodePath:n,node:i,property:t?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:i?r.get(i?.nodeType):null,parentNode:i?_e.selectors.CR.Nodes.nodesByContextPathSelector(t)[i.parent]:null}}evaluateNodeTypeConfigurationAndStartGeneration(t,r,n,i=null){if(!n||r[0]==="_")return;let s=n.properties[r];if(!s?.options?.sidekick?.onCreate)return;try{if(!s?.ui?.inlineEditable)throw new O("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new O("This feature is not available in the free version.","1688157373215")}catch(c){this.store.dispatch(_e.actions.UI.FlashMessages.add(c?.code??c?.message,c?.code?i18nRegistry.translate("NEOSidekick.AiAssistant:Error:"+c.code):c?.message,c?.severity??"error"))}let o=JSON.parse(JSON.stringify(s.options.sidekick.onCreate)),a=this.globalRegistry.get("NEOSidekick.AiAssistant").get("assistantService");this.processObjectWithClientEval(o,t,i).then(c=>{let d={version:"1.0",eventName:"call-module",data:{platform:"neos",target:{nodePath:t.contextPath,propertyName:r},...c}};a.sendMessageToIframe(d)})}generateNodeForContext(t,r){return r?ur(t,n=>{let i=(0,Ur.default)(r,s=>s?.value);n.properties=Object.assign({},n.properties,i)}):t}};var Gr=y(De()),Oe=y(Y()),qr=(e,t)=>function*(){yield(0,Gr.takeEvery)(Oe.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(r){r.payload.feedbackEnvelope.feedbacks.forEach(n=>{if(n.type!=="Neos.Neos.Ui:NodeCreated")return;let i=e.get("@neos-project/neos-ui-contentrepository"),s=e.get("i18n"),o=e.get("NEOSidekick.AiAssistant").get("contentService"),a=e.get("NEOSidekick.AiAssistant").get("assistantService"),c=e.get("NEOSidekick.AiAssistant").get("externalService"),d=t.getState(),u=Oe.selectors.CR.Nodes.nodesByContextPathSelector(d)[n.payload.contextPath],g=Oe.selectors.CR.Nodes.nodesByContextPathSelector(d)[u.parent],p=i.get(u.nodeType);Object.keys(p.properties).forEach(l=>{o.evaluateNodeTypeConfigurationAndStartGeneration(u,l,p,g)})})})};var Jr=y(De()),Yr=y(Y()),Vr=(e,t)=>function*(){yield(0,Jr.takeEvery)(Yr.actionTypes.CR.Nodes.REMOVE,function*(r){console.log("Payload: ",r);let n=e.get("NEOSidekick.AiAssistant").get("assistantService");if(n.currentlyHandledNodePath===r.payload){n.resetCurrentlyHandledNodePath();let i={version:"1.0",eventName:"cancel-call-module"};console.log("Message: ",i),n.sendMessageToIframe(i)}})};var Xr=y(Y()),Zr=(e,t)=>new Ft(e,t),Ft=class{constructor(t,r){this.sendMessageToIframe=t=>{if(this.currentlyHandledNodePath&&t?.eventName==="call-module"){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}t?.eventName==="call-module"&&(this.currentlyHandledNodePath=t?.data?.target?.nodePath);let r=setInterval(()=>{let n=document.getElementById("neosidekickAssistant");if(n.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",t),n.contentWindow.postMessage(t,"*"),clearInterval(r),t?.eventName==="call-module"&&this.resetCurrentlyHandledNodePathDebounced();else{console.log("not loaded, waiting...");return}},250)};this.listenToMessages=()=>{let t=setInterval(()=>{let r=document.getElementById("neosidekickAssistant");if(r?.dataset?.hasOwnProperty("loaded"))window.addEventListener("message",i=>{let s=r.contentWindow;i.source===s&&(console.log(i),this.handleMessage(i))}),clearInterval(t);else return},250)};this.handleMessage=t=>{if(console.info("Handle Sidekick Message: "+t.data.eventName),t?.data?.eventName==="write-content"){let{nodePath:r,propertyName:n,value:i,isFinished:s}=t.data.data;this.currentlyHandledNodePath=r,this.changePropertyValue(r,n,i,s)}else if(t?.data?.eventName==="stopped-generation")this.resetTypingCaret(),this.resetCurrentlyHandledNodePath();else if(t?.data?.eventName==="error"){let r=t?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+r,"error",r),this.resetTypingCaret(),this.resetCurrentlyHandledNodePath()}this.resetCurrentlyHandledNodePathDebounced()};this.changePropertyValue=(t,r,n,i=!1)=>{let a=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(`[data-__neos-editable-node-contextpath="${t}"][data-__neos-property="${r}"]`);if(!a){this.resetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(t)){a.classList.remove("typing-caret"),this.resetCurrentlyHandledNodePath();return}a?.ckeditorInstance?.setData(n),a?.classList.toggle("typing-caret",!i),i&&this.resetCurrentlyHandledNodePath()};this.globalRegistry=t,this.store=r,this.currentlyHandledNodePath=null}resetTypingCaret(){let n=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(".typing-caret");n&&n.classList.remove("typing-caret")}resetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetCurrentlyHandledNodePathDebounced(){let t,r=1e3;return()=>{clearTimeout(t),t=setTimeout(()=>{this.currentlyHandledNodePath=null},r)}}addFlashMessage(t,r,n="error",i=null){let s=this.globalRegistry.get("i18n");this.store.dispatch(Xr.actions.UI.FlashMessages.add(t,s.translate("NEOSidekick.AiAssistant:Error:"+t,r,{0:i}),n))}};var xe=y(Ae()),It=y(Fe()),rt=y(Se()),Qr=y(Ie());var Z=class extends xe.PureComponent{constructor(r){super(r);this.state={show:!1,enabled:!0};this.onClick=()=>{this.setState({enabled:!1});let{node:r,nodeType:n,parentNode:i,property:s}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();this.props.contentService.evaluateNodeTypeConfigurationAndStartGeneration(r,s,n,i),setTimeout(()=>{this.setState({enabled:!0})},2500)};setTimeout(()=>{let{nodeType:n,property:i}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty(),s=n.properties[i];this.setState({show:s?.ui?.inlineEditable===!0&&s?.options?.sidekick?.onCreate})},25)}render(){let{i18nRegistry:r}=this.props;return this.state.show?xe.default.createElement(rt.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:r.translate("NEOSidekick.AiAssistant:Main:regenerate")},xe.default.createElement(rt.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),"\xA0",r.translate("NEOSidekick.AiAssistant:Main:regenerate")):""}};Z.propTypes={contentService:It.default.object.isRequired,i18nRegistry:It.default.object.isRequired},Z=ce([(0,Qr.neos)(e=>({contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:e.get("i18n")}))],Z);function tn(e){return new Promise(t=>setTimeout(t,e))}Kt("NEOSidekick.AiAssistant",{},(e,{store:t,frontendConfiguration:r})=>{let n=r["NEOSidekick.AiAssistant"];if(n===null||n.enabled===!1)return;if(!n.hasOwnProperty("defaultLanguage")||!n.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}e.set("NEOSidekick.AiAssistant",new J),e.get("NEOSidekick.AiAssistant").set("configuration",n);let i=Vt(r);e.get("NEOSidekick.AiAssistant").set("externalService",i);let s=$r(e,t);e.get("NEOSidekick.AiAssistant").set("contentService",s);let o=Zr(e,t);e.get("NEOSidekick.AiAssistant").set("assistantService",o),o.listenToMessages();let a=e.get("containers"),c=a.get("App"),d=x=>{let f=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[v,m]=F.default.useState(f?.open),w=T=>{m(T),f.open=T,localStorage.setItem("NEOSidekick",JSON.stringify(f))},[A,G]=F.default.useState(f?.fullscreen),h=T=>{G(T),f.fullscreen=T,localStorage.setItem("NEOSidekick",JSON.stringify(f))},N=(T,nt,it)=>{if(T)return F.default.createElement(Te.IconButton,{icon:nt?"compress":"expand",onClick:it})},I=(T,nt,it)=>{if(!nt)return F.default.createElement(Te.IconButton,{icon:T?"chevron-circle-right":"chevron-circle-left",onClick:it})},Rt=(0,Mt.useSelector)(ae.selectors.CR.ContentDimensions.active),rn=(0,Mt.useSelector)(T=>T?.user?.preferences?.interfaceLanguage),L=new URL(`${n.apiDomain}/chat/`);return L.searchParams.append("contentLanguage",Rt.language?Rt.language[0]:n.defaultLanguage),L.searchParams.append("interfaceLanguage",rn),L.searchParams.append("userId",n.userId),L.searchParams.append("plattform","neos"),L.searchParams.append("domain",n.domain),L.searchParams.append("siteName",n.siteName),n?.referral&&L.searchParams.append("referral",n?.referral),n?.apiKey&&L.searchParams.append("apikey",n?.apiKey),F.default.createElement("div",{className:`neosidekick_appWrapper ${v?"neosidekick_appWrapper--sidebar-open":""}  ${A?"neosidekick_appWrapper--sidebar-fullscreen":""}`},F.default.createElement(c,{...x}),F.default.createElement("div",{className:"neosidekick_sideBar"},F.default.createElement("div",{className:"neosidekick_sideBar__title"},F.default.createElement(Te.Headline,{className:`neosidekick_sideBar__title-headline ${v?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),F.default.createElement("div",null,N(v,A,()=>h(!A)),I(v,A,()=>w(!v)))),F.default.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${v?"neosidekick_sideBar__frame--open":""}`,src:L.toString(),allow:"clipboard-write",onLoad:T=>T.target.dataset.loaded=!0})))};a.set("App",d);let u=!1,g=function*(){yield(0,en.takeLatest)([ae.actionTypes.UI.ContentCanvas.SET_SRC,ae.actionTypes.UI.ContentCanvas.RELOAD,ae.actionTypes.CR.Nodes.MERGE],async function*(x){x.type===ae.actionTypes.UI.ContentCanvas.SET_SRC&&(u=!0),yield tn(500);let f=e.get("@neos-project/neos-ui-contentrepository"),v=t.getState(),m=v?.ui?.contentCanvas?.previewUrl,w=s.getCurrentDocumentNode(),A=w?.contextPath,G=Object.values(v?.cr?.nodes?.byContextPath||{}).filter(h=>{let N=f.getRole("document");if(!N)throw new Error("Document role is not loaded!");let I=f.getSubTypesOf(N);return A&&h.contextPath.indexOf(A.split("@")[0])===0&&(h.contextPath===A||!I.includes(h.nodeType))});o.sendMessageToIframe({version:"1.0",eventName:u?"page-changed":"page-updated",data:{url:m,title:w?.properties?.title||s.getGuestFrameDocumentTitle(),content:s.getGuestFrameDocumentHtml(),structuredContent:G,targetAudience:await s.getCurrentDocumentTargetAudience(),pageBriefing:await s.getCurrentDocumentPageBriefing(),focusKeyword:await s.getCurrentDocumentFocusKeyword()}}),u=!1})},p=e.get("sagas");p.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:g}),p.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:qr(e,t)}),p.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:Vr(e,t)});let l=e.get("inspector").get("editors");l.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:z}),l.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:B}),e.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:regenerate",{component:Z,isVisible:()=>!0},"end")});})();
//# sourceMappingURL=Plugin.js.map
