(()=>{var ir=Object.create;var st=Object.defineProperty;var Bt=Object.getOwnPropertyDescriptor;var sr=Object.getOwnPropertyNames;var or=Object.getPrototypeOf,ar=Object.prototype.hasOwnProperty;var cr=(e,t)=>()=>(e&&(t=e(e=0)),t);var q=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ur=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of sr(t))!ar.call(e,i)&&i!==n&&st(e,i,{get:()=>t[i],enumerable:!(r=Bt(t,i))||r.enumerable});return e};var y=(e,t,n)=>(n=e!=null?ir(or(e)):{},ur(t||!e||!e.__esModule?st(n,"default",{value:e,enumerable:!0}):n,e));var ce=(e,t,n,r)=>{for(var i=r>1?void 0:r?Bt(t,n):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(r?o(t,n,i):o(i))||i);return r&&i&&st(t,n,i),i};function C(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var R=cr(()=>{});var Se=q((Fs,Kt)=>{R();Kt.exports=C("NeosProjectPackages")().ReactUiComponents});var Y=q((Ms,Lt)=>{R();Lt.exports=C("NeosProjectPackages")().NeosUiReduxStore});var Ae=q((Bs,zt)=>{R();zt.exports=C("vendor")().React});var ke=q((Ks,Wt)=>{R();Wt.exports=C("vendor")().reactRedux});var De=q((zs,Ht)=>{R();Ht.exports=C("vendor")().reduxSagaEffects});var Fe=q((Hs,Ut)=>{R();Ut.exports=C("vendor")().PropTypes});var Ie=q(($s,$t)=>{R();$t.exports=C("NeosProjectPackages")().NeosUiDecorators});var Un=q((be,ge)=>{var Cr=200,br="Expected a function",Ot="__lodash_hash_undefined__",Je=1,he=2,Sn=1/0,An=9007199254740991,ze="[object Arguments]",St="[object Array]",Nn="[object Boolean]",wn="[object Date]",Cn="[object Error]",bn="[object Function]",Pr="[object GeneratorFunction]",We="[object Map]",Pn="[object Number]",pe="[object Object]",fn="[object Promise]",On="[object RegExp]",He="[object Set]",En="[object String]",xn="[object Symbol]",At="[object WeakMap]",Tn="[object ArrayBuffer]",Ue="[object DataView]",Or="[object Float32Array]",Er="[object Float64Array]",xr="[object Int8Array]",Tr="[object Int16Array]",kr="[object Int32Array]",Dr="[object Uint8Array]",Fr="[object Uint8ClampedArray]",Ir="[object Uint16Array]",Mr="[object Uint32Array]",Rr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Br=/^\w*$/,jr=/^\./,Kr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lr=/[\\^$.*+?()[\]{}|]/g,zr=/\\(\\)?/g,Wr=/^\[object .+?Constructor\]$/,Hr=/^(?:0|[1-9]\d*)$/,S={};S[Or]=S[Er]=S[xr]=S[Tr]=S[kr]=S[Dr]=S[Fr]=S[Ir]=S[Mr]=!0;S[ze]=S[St]=S[Tn]=S[Nn]=S[Ue]=S[wn]=S[Cn]=S[bn]=S[We]=S[Pn]=S[pe]=S[On]=S[He]=S[En]=S[At]=!1;var kn=typeof global=="object"&&global&&global.Object===Object&&global,Ur=typeof self=="object"&&self&&self.Object===Object&&self,X=kn||Ur||Function("return this")(),Dn=typeof be=="object"&&be&&!be.nodeType&&be,ln=Dn&&typeof ge=="object"&&ge&&!ge.nodeType&&ge,$r=ln&&ln.exports===Dn,pn=$r&&kn.process,gn=function(){try{return pn&&pn.binding("util")}catch{}}(),hn=gn&&gn.isTypedArray;function Gr(e,t){for(var n=-1,r=e?e.length:0;++n<r;)if(t(e[n],n,e))return!0;return!1}function qr(e){return function(t){return t?.[e]}}function Jr(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Yr(e){return function(t){return e(t)}}function Vr(e,t){return e?.[t]}function Nt(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function Xr(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function Zr(e,t){return function(n){return e(t(n))}}function Qr(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var ei=Array.prototype,ti=Function.prototype,Ye=Object.prototype,_t=X["__core-js_shared__"],mn=function(){var e=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Fn=ti.toString,H=Ye.hasOwnProperty,me=Ye.toString,ni=RegExp("^"+Fn.call(H).replace(Lr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yn=X.Symbol,_n=X.Uint8Array,ri=Ye.propertyIsEnumerable,ii=ei.splice,si=Zr(Object.keys,Object),wt=ye(X,"DataView"),Pe=ye(X,"Map"),Ct=ye(X,"Promise"),bt=ye(X,"Set"),Pt=ye(X,"WeakMap"),Oe=ye(Object,"create"),oi=oe(wt),ai=oe(Pe),ci=oe(Ct),ui=oe(bt),di=oe(Pt),$e=yn?yn.prototype:void 0,vt=$e?$e.valueOf:void 0,vn=$e?$e.toString:void 0;function ie(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function fi(){this.__data__=Oe?Oe(null):{}}function li(e){return this.has(e)&&delete this.__data__[e]}function pi(e){var t=this.__data__;if(Oe){var n=t[e];return n===Ot?void 0:n}return H.call(t,e)?t[e]:void 0}function gi(e){var t=this.__data__;return Oe?t[e]!==void 0:H.call(t,e)}function hi(e,t){var n=this.__data__;return n[e]=Oe&&t===void 0?Ot:t,this}ie.prototype.clear=fi;ie.prototype.delete=li;ie.prototype.get=pi;ie.prototype.has=gi;ie.prototype.set=hi;function U(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function mi(){this.__data__=[]}function yi(e){var t=this.__data__,n=Ve(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():ii.call(t,n,1),!0}function _i(e){var t=this.__data__,n=Ve(t,e);return n<0?void 0:t[n][1]}function vi(e){return Ve(this.__data__,e)>-1}function Si(e,t){var n=this.__data__,r=Ve(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}U.prototype.clear=mi;U.prototype.delete=yi;U.prototype.get=_i;U.prototype.has=vi;U.prototype.set=Si;function $(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ai(){this.__data__={hash:new ie,map:new(Pe||U),string:new ie}}function Ni(e){return Xe(this,e).delete(e)}function wi(e){return Xe(this,e).get(e)}function Ci(e){return Xe(this,e).has(e)}function bi(e,t){return Xe(this,e).set(e,t),this}$.prototype.clear=Ai;$.prototype.delete=Ni;$.prototype.get=wi;$.prototype.has=Ci;$.prototype.set=bi;function Ge(e){var t=-1,n=e?e.length:0;for(this.__data__=new $;++t<n;)this.add(e[t])}function Pi(e){return this.__data__.set(e,Ot),this}function Oi(e){return this.__data__.has(e)}Ge.prototype.add=Ge.prototype.push=Pi;Ge.prototype.has=Oi;function W(e){this.__data__=new U(e)}function Ei(){this.__data__=new U}function xi(e){return this.__data__.delete(e)}function Ti(e){return this.__data__.get(e)}function ki(e){return this.__data__.has(e)}function Di(e,t){var n=this.__data__;if(n instanceof U){var r=n.__data__;if(!Pe||r.length<Cr-1)return r.push([e,t]),this;n=this.__data__=new $(r)}return n.set(e,t),this}W.prototype.clear=Ei;W.prototype.delete=xi;W.prototype.get=Ti;W.prototype.has=ki;W.prototype.set=Di;function Fi(e,t){var n=se(e)||zn(e)?Jr(e.length,String):[],r=n.length,i=!!r;for(var s in e)(t||H.call(e,s))&&!(i&&(s=="length"||Bn(s,r)))&&n.push(s);return n}function Ve(e,t){for(var n=e.length;n--;)if(Ln(e[n][0],t))return n;return-1}var Ii=Ji();function Mi(e,t){return e&&Ii(e,t,qe)}function In(e,t){t=Ze(t,e)?[t]:Mn(t);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Qe(t[n++])];return n&&n==r?e:void 0}function Ri(e){return me.call(e)}function Bi(e,t){return e!=null&&t in Object(e)}function Et(e,t,n,r,i){return e===t?!0:e==null||t==null||!et(e)&&!tt(t)?e!==e&&t!==t:ji(e,t,Et,n,r,i)}function ji(e,t,n,r,i,s){var o=se(e),a=se(t),c=St,d=St;o||(c=V(e),c=c==ze?pe:c),a||(d=V(t),d=d==ze?pe:d);var u=c==pe&&!Nt(e),g=d==pe&&!Nt(t),p=c==d;if(p&&!u)return s||(s=new W),o||is(e)?Rn(e,t,n,r,i,s):Yi(e,t,c,n,r,i,s);if(!(i&he)){var l=u&&H.call(e,"__wrapped__"),_=g&&H.call(t,"__wrapped__");if(l||_){var O=l?e.value():e,x=_?t.value():t;return s||(s=new W),n(O,x,r,i,s)}}return p?(s||(s=new W),Vi(e,t,n,r,i,s)):!1}function Ki(e,t,n,r){var i=n.length,s=i,o=!r;if(e==null)return!s;for(e=Object(e);i--;){var a=n[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){a=n[i];var c=a[0],d=e[c],u=a[1];if(o&&a[2]){if(d===void 0&&!(c in e))return!1}else{var g=new W;if(r)var p=r(d,u,c,e,t,g);if(!(p===void 0?Et(u,d,r,Je|he,g):p))return!1}}return!0}function Li(e){if(!et(e)||es(e))return!1;var t=Hn(e)||Nt(e)?ni:Wr;return t.test(oe(e))}function zi(e){return tt(e)&&Tt(e.length)&&!!S[me.call(e)]}function Wi(e){return typeof e=="function"?e:e==null?us:typeof e=="object"?se(e)?$i(e[0],e[1]):Ui(e):ds(e)}function Hi(e){if(!ts(e))return si(e);var t=[];for(var n in Object(e))H.call(e,n)&&n!="constructor"&&t.push(n);return t}function Ui(e){var t=Xi(e);return t.length==1&&t[0][2]?Kn(t[0][0],t[0][1]):function(n){return n===e||Ki(n,e,t)}}function $i(e,t){return Ze(e)&&jn(t)?Kn(Qe(e),t):function(n){var r=os(n,e);return r===void 0&&r===t?as(n,e):Et(t,r,void 0,Je|he)}}function Gi(e){return function(t){return In(t,e)}}function qi(e){if(typeof e=="string")return e;if(kt(e))return vn?vn.call(e):"";var t=e+"";return t=="0"&&1/e==-Sn?"-0":t}function Mn(e){return se(e)?e:ns(e)}function Ji(e){return function(t,n,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[e?a:++i];if(n(s[c],c,s)===!1)break}return t}}function Rn(e,t,n,r,i,s){var o=i&he,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var d=s.get(e);if(d&&s.get(t))return d==t;var u=-1,g=!0,p=i&Je?new Ge:void 0;for(s.set(e,t),s.set(t,e);++u<a;){var l=e[u],_=t[u];if(r)var O=o?r(_,l,u,t,e,s):r(l,_,u,e,t,s);if(O!==void 0){if(O)continue;g=!1;break}if(p){if(!Gr(t,function(x,f){if(!p.has(f)&&(l===x||n(l,x,r,i,s)))return p.add(f)})){g=!1;break}}else if(!(l===_||n(l,_,r,i,s))){g=!1;break}}return s.delete(e),s.delete(t),g}function Yi(e,t,n,r,i,s,o){switch(n){case Ue:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Tn:return!(e.byteLength!=t.byteLength||!r(new _n(e),new _n(t)));case Nn:case wn:case Pn:return Ln(+e,+t);case Cn:return e.name==t.name&&e.message==t.message;case On:case En:return e==t+"";case We:var a=Xr;case He:var c=s&he;if(a||(a=Qr),e.size!=t.size&&!c)return!1;var d=o.get(e);if(d)return d==t;s|=Je,o.set(e,t);var u=Rn(a(e),a(t),r,i,s,o);return o.delete(e),u;case xn:if(vt)return vt.call(e)==vt.call(t)}return!1}function Vi(e,t,n,r,i,s){var o=i&he,a=qe(e),c=a.length,d=qe(t),u=d.length;if(c!=u&&!o)return!1;for(var g=c;g--;){var p=a[g];if(!(o?p in t:H.call(t,p)))return!1}var l=s.get(e);if(l&&s.get(t))return l==t;var _=!0;s.set(e,t),s.set(t,e);for(var O=o;++g<c;){p=a[g];var x=e[p],f=t[p];if(r)var v=o?r(f,x,p,t,e,s):r(x,f,p,e,t,s);if(!(v===void 0?x===f||n(x,f,r,i,s):v)){_=!1;break}O||(O=p=="constructor")}if(_&&!O){var m=e.constructor,w=t.constructor;m!=w&&"constructor"in e&&"constructor"in t&&!(typeof m=="function"&&m instanceof m&&typeof w=="function"&&w instanceof w)&&(_=!1)}return s.delete(e),s.delete(t),_}function Xe(e,t){var n=e.__data__;return Qi(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Xi(e){for(var t=qe(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,jn(i)]}return t}function ye(e,t){var n=Vr(e,t);return Li(n)?n:void 0}var V=Ri;(wt&&V(new wt(new ArrayBuffer(1)))!=Ue||Pe&&V(new Pe)!=We||Ct&&V(Ct.resolve())!=fn||bt&&V(new bt)!=He||Pt&&V(new Pt)!=At)&&(V=function(e){var t=me.call(e),n=t==pe?e.constructor:void 0,r=n?oe(n):void 0;if(r)switch(r){case oi:return Ue;case ai:return We;case ci:return fn;case ui:return He;case di:return At}return t});function Zi(e,t,n){t=Ze(t,e)?[t]:Mn(t);for(var r,i=-1,o=t.length;++i<o;){var s=Qe(t[i]);if(!(r=e!=null&&n(e,s)))break;e=e[s]}if(r)return r;var o=e?e.length:0;return!!o&&Tt(o)&&Bn(s,o)&&(se(e)||zn(e))}function Bn(e,t){return t=t??An,!!t&&(typeof e=="number"||Hr.test(e))&&e>-1&&e%1==0&&e<t}function Ze(e,t){if(se(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||kt(e)?!0:Br.test(e)||!Rr.test(e)||t!=null&&e in Object(t)}function Qi(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function es(e){return!!mn&&mn in e}function ts(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Ye;return e===n}function jn(e){return e===e&&!et(e)}function Kn(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var ns=xt(function(e){e=ss(e);var t=[];return jr.test(e)&&t.push(""),e.replace(Kr,function(n,r,i,s){t.push(i?s.replace(zr,"$1"):r||n)}),t});function Qe(e){if(typeof e=="string"||kt(e))return e;var t=e+"";return t=="0"&&1/e==-Sn?"-0":t}function oe(e){if(e!=null){try{return Fn.call(e)}catch{}try{return e+""}catch{}}return""}function xt(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(br);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o),o};return n.cache=new(xt.Cache||$),n}xt.Cache=$;function Ln(e,t){return e===t||e!==e&&t!==t}function zn(e){return rs(e)&&H.call(e,"callee")&&(!ri.call(e,"callee")||me.call(e)==ze)}var se=Array.isArray;function Wn(e){return e!=null&&Tt(e.length)&&!Hn(e)}function rs(e){return tt(e)&&Wn(e)}function Hn(e){var t=et(e)?me.call(e):"";return t==bn||t==Pr}function Tt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=An}function et(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function tt(e){return!!e&&typeof e=="object"}function kt(e){return typeof e=="symbol"||tt(e)&&me.call(e)==xn}var is=hn?Yr(hn):zi;function ss(e){return e==null?"":qi(e)}function os(e,t,n){var r=e==null?void 0:In(e,t);return r===void 0?n:r}function as(e,t){return e!=null&&Zi(e,t,Bi)}function qe(e){return Wn(e)?Fi(e):Hi(e)}function cs(e,t){var n={};return t=Wi(t,3),Mi(e,function(r,i,s){n[i]=t(r,i,s)}),n}function us(e){return e}function ds(e){return Ze(e)?qr(Qe(e)):Gi(e)}ge.exports=cs});R();var ve=class{constructor(t){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=t}};var dr=(e,t="position",n="key")=>{let r=typeof t=="string"?f=>f[t]:t,i={},s={},o={},a={},c={},d={};e.forEach((f,v)=>{let m=f[n]?f[n]:String(v);i[m]=v;let w=r(f),A=String(w||v),G=!1;if(A.startsWith("start")){let h=A.match(/start\s+(\d+)/),N=h&&h[1]?Number(h[1]):0;o[N]||(o[N]=[]),o[N].push(m)}else if(A.startsWith("end")){let h=A.match(/end\s+(\d+)/),N=h&&h[1]?Number(h[1]):0;a[N]||(a[N]=[]),a[N].push(m)}else if(A.startsWith("before")){let h=A.match(/before\s+(\S+)(\s+(\d+))?/);if(!h)G=!0;else{let N=h[1],I=h[3]?Number(h[3]):0;c[N]||(c[N]={}),c[N][I]||(c[N][I]=[]),c[N][I].push(m)}}else if(A.startsWith("after")){let h=A.match(/after\s+(\S+)(\s+(\d+))?/);if(!h)G=!0;else{let N=h[1],I=h[3]?Number(h[3]):0;d[N]||(d[N]={}),d[N][I]||(d[N][I]=[]),d[N][I].push(m)}}else G=!0;if(G){let h=parseFloat(A);(isNaN(h)||!isFinite(h))&&(h=v),s[h]||(s[h]=[]),s[h].push(m)}});let u=[],g=[],p=[],l=[],_=(f,v)=>{let m=Object.keys(f).map(w=>Number(w)).sort((w,A)=>w-A);return v?m:m.reverse()},O=(f,v)=>{f.forEach(m=>{if(!(l.indexOf(m)>=0)){if(l.push(m),c[m]){let w=_(c[m],!0);for(let A of w)O(c[m][A],v)}if(v.push(m),d[m]){let w=_(d[m],!1);for(let A of w)O(d[m][A],v)}}})};for(let f of _(o,!1))O(o[f],u);for(let f of _(s,!0))O(s[f],g);for(let f of _(a,!0))O(a[f],p);for(let f of Object.keys(c))if(!(l.indexOf(f)>=0))for(let v of _(c[f],!1))O(c[f][v],u);for(let f of Object.keys(d))if(!(l.indexOf(f)>=0))for(let v of _(d[f],!1))O(d[f][v],g);return[...u,...g,...p].map(f=>i[f]).map(f=>e[f])},ot=dr;var J=class extends ve{constructor(t){super(t),this._registry=[]}set(t,n,r=0){if(typeof t!="string")throw new Error("Key must be a string");if(typeof r!="string"&&typeof r!="number")throw new Error("Position must be a string or a number");let i={key:t,value:n};r&&(i.position=r);let s=this._registry.findIndex(o=>o.key===t);return s===-1?this._registry.push(i):this._registry[s]=i,n}get(t){if(typeof t!="string")return console.error("Key must be a string"),null;let n=this._registry.find(r=>r.key===t);return n?n.value:null}_getChildrenWrapped(t){let n=this._registry.filter(r=>r.key.indexOf(t+"/")===0);return ot(n)}getChildrenAsObject(t){let n={};return this._getChildrenWrapped(t).forEach(r=>{n[r.key]=r.value}),n}getChildren(t){return this._getChildrenWrapped(t).map(n=>n.value)}has(t){return typeof t!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(n=>n.key===t)}_getAllWrapped(){return ot(this._registry)}getAllAsObject(){let t={};return this._getAllWrapped().forEach(n=>{t[n.key]=n.value}),t}getAllAsList(){return this._getAllWrapped().map(t=>Object.assign({id:t.key},t.value))}};var jt=C("manifest");var Te=y(Se()),ae=y(Y()),F=y(Ae()),Mt=y(ke()),tr=y(De());var B=y(Ae()),Gt=y(ke()),b=y(Fe()),qt=y(Ie()),Q=y(Se()),ue=y(Y());var lr={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},L=class extends B.Component{constructor(n){super(n);this.state={loading:!1};this.getIcon=n=>n?B.default.createElement(Q.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):B.default.createElement(Q.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(n,r)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:d,node:u,parentNode:g,frontendConfiguration:p}=this.props;this.setState({loading:!0});try{r=await o.processObjectWithClientEval(Object.assign({},r),u,g),r=Object.keys(r).map(_=>({identifier:_,value:r[_]}));let l=await s.generate(n,a.language?a.language[0]:p.defaultLanguage,r);i(l)}catch(l){c(l?.code??l?.message,l?.code?d.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}}}render(){let{id:n,value:r,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:d}=this.props,u=Object.assign({},lr,o),g=o&&o.placeholder&&a.translate(unescape(o.placeholder)),p=!(u.readonly||u.disabled);return B.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},B.default.createElement("div",null,B.default.createElement(Q.TextInput,{id:n,value:r,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:g,onKeyPress:c,onEnterKey:d})),p?B.default.createElement("div",{style:{"margin-top":"4px"}},B.default.createElement(Q.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generate"),"\xA0",this.getIcon(this.state.loading))):null)}};L.propTypes={className:b.default.string,value:b.default.oneOfType([b.default.string,b.default.number]),commit:b.default.func.isRequired,options:b.default.object,onKeyPress:b.default.func,onEnterKey:b.default.func,id:b.default.string,activeContentDimensions:b.default.object.isRequired,node:b.default.object,parentNode:b.default.object,i18nRegistry:b.default.object.isRequired,externalService:b.default.object.isRequired,contentService:b.default.object.isRequired,addFlashMessage:b.default.func.isRequired,frontendConfiguration:b.default.object},L.defaultProps={options:{}},L=ce([(0,qt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Gt.connect)(e=>t=>{let n=ue.selectors.CR.ContentDimensions.active(t),r=ue.selectors.CR.Nodes.focusedSelector(t),i=ue.selectors.CR.Nodes.nodeByContextPath(t)(r.parent);return{activeContentDimensions:n,node:r,parentNode:i}},{addFlashMessage:ue.actions.UI.FlashMessages.add})],L);var j=y(Ae()),Jt=y(ke()),P=y(Fe()),Yt=y(Ie()),ee=y(Se()),de=y(Y());var pr={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},z=class extends j.Component{constructor(n){super(n);this.getIcon=n=>n?j.default.createElement(ee.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):j.default.createElement(ee.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async(n,r)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:d,node:u,parentNode:g,frontendConfiguration:p}=this.props;this.setState({loading:!0});try{r=await o.processObjectWithClientEval(Object.assign({},r),u,g),r=Object.keys(r).map(_=>({identifier:_,value:r[_]}));let l=await s.generate(n,a.language?a.language[0]:p.defaultLanguage,r);i(l)}catch(l){c(l?.code??l?.message,l?.code?d.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}};this.state={loading:!1}}render(){let{id:n,value:r,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:d}=this.props,u=Object.assign({},pr,o),g=o&&o.placeholder&&a.translate(unescape(o.placeholder)),p=!(u.readonly||u.disabled);return j.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},j.default.createElement("div",null,j.default.createElement(ee.TextArea,{id:n,value:r,onChange:s,disabled:u.disabled||this.state.loading,maxLength:u.maxlength,readOnly:u.readonly,placeholder:g,minRows:u.minRows,expandedRows:u.expandedRows,onKeyPress:c,onEnterKey:d})),p?j.default.createElement("div",null,j.default.createElement(ee.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(u.module,u.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generate"),"\xA0",this.getIcon(this.state.loading))):null)}};z.propTypes={className:P.default.string,value:P.default.oneOfType([P.default.string,P.default.number]),commit:P.default.func.isRequired,options:P.default.object,onKeyPress:P.default.func,onEnterKey:P.default.func,id:P.default.string,activeContentDimensions:P.default.object.isRequired,node:P.default.object,parentNode:P.default.object,i18nRegistry:P.default.object.isRequired,externalService:P.default.object.isRequired,contentService:P.default.object.isRequired,addFlashMessage:P.default.func.isRequired,frontendConfiguration:P.default.object},z.defaultProps={options:{}},z=ce([(0,Yt.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Jt.connect)(e=>t=>{let n=de.selectors.CR.ContentDimensions.active(t),r=de.selectors.CR.Nodes.focusedSelector(t),i=de.selectors.CR.Nodes.nodeByContextPath(t)(r.parent);return{activeContentDimensions:n,node:r,parentNode:i}},{addFlashMessage:de.actions.UI.FlashMessages.add})],z);var E=class extends Error{constructor(n,r,i){super(n);this.severity="error";this.code=r,this.externalMessage=i}};var Vt=e=>{let t=e["NEOSidekick.AiAssistant"];return new at(t.apiDomain,t.apiKey)},at=class{constructor(t,n){this.apiDomain="";this.apiKey="";this.hasApiKey=()=>this.apiKey!==null&&this.apiKey!=="";this.generate=async(t,n,r={})=>{if(!this.apiKey)throw new E("This feature is not available in the free version.","1688157373215");let i=await fetch(`${this.apiDomain}/api/v1/chat?language=${n}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:t,platform:"neos",user_input:r})}),s=await i.json();if(i.status===401)throw new E("The NEOSidekick api key provided is not valid.","1688158193038");if(i.status<200||i.status>=400)throw new E("An error occurred while asking NEOSidekick.","1688158257149",s?.message);let o=s?.data?.message?.message;return o.startsWith('"')&&o.endsWith('"')&&(o=o.substr(1,o.length-2)),o};this.apiDomain=t,this.apiKey=n}};R();var Xt=C("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:eo}=C("NeosProjectPackages")().NeosUiBackendConnector;var _e=y(Y());var rn=Symbol.for("immer-nothing"),Zt=Symbol.for("immer-draftable"),k=Symbol.for("immer-state");function M(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var fe=Object.getPrototypeOf;function le(e){return!!e&&!!e[k]}function ne(e){return e?sn(e)||Array.isArray(e)||!!e[Zt]||!!e.constructor?.[Zt]||je(e)||Ke(e):!1}var gr=Object.prototype.constructor.toString();function sn(e){if(!e||typeof e!="object")return!1;let t=fe(e);if(t===null)return!0;let n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object?!0:typeof n=="function"&&Function.toString.call(n)===gr}function Ne(e,t){Be(e)===0?Object.entries(e).forEach(([n,r])=>{t(n,r,e)}):e.forEach((n,r)=>t(r,n,e))}function Be(e){let t=e[k];return t?t.type_:Array.isArray(e)?1:je(e)?2:Ke(e)?3:0}function dt(e,t){return Be(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function on(e,t,n){let r=Be(e);r===2?e.set(t,n):r===3?e.add(n):e[t]=n}function hr(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function je(e){return e instanceof Map}function Ke(e){return e instanceof Set}function te(e){return e.copy_||e.base_}function ft(e,t){if(je(e))return new Map(e);if(Ke(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&sn(e))return fe(e)?{...e}:Object.assign(Object.create(null),e);let n=Object.getOwnPropertyDescriptors(e);delete n[k];let r=Reflect.ownKeys(n);for(let i=0;i<r.length;i++){let s=r[i],o=n[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(n[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(fe(e),n)}function mt(e,t=!1){return Le(e)||le(e)||!ne(e)||(Be(e)>1&&(e.set=e.add=e.clear=e.delete=mr),Object.freeze(e),t&&Ne(e,(n,r)=>mt(r,!0),!0)),e}function mr(){M(2)}function Le(e){return Object.isFrozen(e)}var yr={};function re(e){let t=yr[e];return t||M(0,e),t}var we;function an(){return we}function _r(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Qt(e,t){t&&(re("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function lt(e){pt(e),e.drafts_.forEach(vr),e.drafts_=null}function pt(e){e===we&&(we=e.parent_)}function en(e){return we=_r(we,e)}function vr(e){let t=e[k];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function tn(e,t){t.unfinalizedDrafts_=t.drafts_.length;let n=t.drafts_[0];return e!==void 0&&e!==n?(n[k].modified_&&(lt(t),M(4)),ne(e)&&(e=Me(t,e),t.parent_||Re(t,e)),t.patches_&&re("Patches").generateReplacementPatches_(n[k].base_,e,t.patches_,t.inversePatches_)):e=Me(t,n,[]),lt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==rn?e:void 0}function Me(e,t,n){if(Le(t))return t;let r=t[k];if(!r)return Ne(t,(i,s)=>nn(e,r,t,i,s,n),!0),t;if(r.scope_!==e)return t;if(!r.modified_)return Re(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;let i=r.copy_,s=i,o=!1;r.type_===3&&(s=new Set(i),i.clear(),o=!0),Ne(s,(a,c)=>nn(e,r,i,a,c,n,o)),Re(e,i,!1),n&&e.patches_&&re("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function nn(e,t,n,r,i,s,o){if(le(i)){let a=s&&t&&t.type_!==3&&!dt(t.assigned_,r)?s.concat(r):void 0,c=Me(e,i,a);if(on(n,r,c),le(c))e.canAutoFreeze_=!1;else return}else o&&n.add(i);if(ne(i)&&!Le(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Me(e,i),(!t||!t.scope_.parent_)&&Re(e,i)}}function Re(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&mt(t,n)}function Sr(e,t){let n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:an(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=r,s=yt;n&&(i=[r],s=Ce);let{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}var yt={get(e,t){if(t===k)return e;let n=te(e);if(!dt(n,t))return Ar(e,n,t);let r=n[t];return e.finalized_||!ne(r)?r:r===ct(e.base_,t)?(ut(e),e.copy_[t]=ht(r,e)):r},has(e,t){return t in te(e)},ownKeys(e){return Reflect.ownKeys(te(e))},set(e,t,n){let r=cn(te(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){let i=ct(te(e),t),s=i?.[k];if(s&&s.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(hr(n,i)&&(n!==void 0||dt(e.base_,t)))return!0;ut(e),gt(e)}return e.copy_[t]===n&&(n!==void 0||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty(e,t){return ct(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ut(e),gt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let n=te(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:r.enumerable,value:n[t]}},defineProperty(){M(11)},getPrototypeOf(e){return fe(e.base_)},setPrototypeOf(){M(12)}},Ce={};Ne(yt,(e,t)=>{Ce[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});Ce.deleteProperty=function(e,t){return Ce.set.call(this,e,t,void 0)};Ce.set=function(e,t,n){return yt.set.call(this,e[0],t,n,e[0])};function ct(e,t){let n=e[k];return(n?te(n):e)[t]}function Ar(e,t,n){let r=cn(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}function cn(e,t){if(!(t in e))return;let n=fe(e);for(;n;){let r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=fe(n)}}function gt(e){e.modified_||(e.modified_=!0,e.parent_&&gt(e.parent_))}function ut(e){e.copy_||(e.copy_=ft(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var Nr=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,r)=>{if(typeof t=="function"&&typeof n!="function"){let s=n;n=t;let o=this;return function(c=s,...d){return o.produce(c,u=>n.call(this,u,...d))}}typeof n!="function"&&M(6),r!==void 0&&typeof r!="function"&&M(7);let i;if(ne(t)){let s=en(this),o=ht(t,void 0),a=!0;try{i=n(o),a=!1}finally{a?lt(s):pt(s)}return Qt(s,r),tn(i,s)}else if(!t||typeof t!="object"){if(i=n(t),i===void 0&&(i=t),i===rn&&(i=void 0),this.autoFreeze_&&mt(i,!0),r){let s=[],o=[];re("Patches").generateReplacementPatches_(t,i,s,o),r(s,o)}return i}else M(1,t)},this.produceWithPatches=(t,n)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let r,i;return[this.produce(t,n,(o,a)=>{r=o,i=a}),r,i]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){ne(e)||M(8),le(e)&&(e=wr(e));let t=en(this),n=ht(e,void 0);return n[k].isManual_=!0,pt(t),n}finishDraft(e,t){let n=e&&e[k];(!n||!n.isManual_)&&M(9);let{scope_:r}=n;return Qt(r,t),tn(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){let i=t[n];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}n>-1&&(t=t.slice(n+1));let r=re("Patches").applyPatches_;return le(e)?r(e,t):this.produce(e,i=>r(i,t))}};function ht(e,t){let n=je(e)?re("MapSet").proxyMap_(e,t):Ke(e)?re("MapSet").proxySet_(e,t):Sr(e,t);return(t?t.scope_:an()).drafts_.push(n),n}function wr(e){return le(e)||M(10,e),un(e)}function un(e){if(!ne(e)||Le(e))return e;let t=e[k],n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=ft(e,t.scope_.immer_.useStrictShallowCopy_)}else n=ft(e,!0);return Ne(n,(r,i)=>{on(n,r,un(i))}),t&&(t.finalized_=!1),n}var D=new Nr,dn=D.produce,no=D.produceWithPatches.bind(D),ro=D.setAutoFreeze.bind(D),io=D.setUseStrictShallowCopy.bind(D),so=D.applyPatches.bind(D),oo=D.createDraft.bind(D),ao=D.finishDraft.bind(D);var $n=y(Un()),Gn=(e,t)=>new Dt(e,t),Dt=class{constructor(t,n){this.getGuestFrameDocumentTitle=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title;this.getGuestFrameDocumentHtml=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML;this.getCurrentDocumentNode=()=>{let t=this.store.getState(),n=t?.cr?.nodes?.documentNode;return t?.cr?.nodes?.byContextPath[n]};this.getCurrentDocumentParentNode=()=>{let t=this.store.getState(),n=this.getCurrentDocumentNode();return t?.cr?.nodes?.byContextPath[n.parent]};this.getCurrentDocumentNodeType=()=>{let t=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(t?.nodeType)};this.getCurrentDocumentTargetAudience=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return t?await this.processClientEval(t):null};this.getCurrentDocumentPageBriefing=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return t?await this.processClientEval(t):null};this.getCurrentDocumentFocusKeyword=async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return t?await this.processClientEval(t):null};this.processClientEval=async(t,n=null,r=null)=>{if(typeof t=="string"&&(t.startsWith("SidekickClientEval:")||t.startsWith("ClientEval:")))try{n=n??this.getCurrentDocumentNode();let i=_e.selectors.UI.Inspector.transientValues(this.store.getState());n=this.generateNodeForContext(n,i),r=r??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),a=await this.getImageMetadata,c=Object.getPrototypeOf(async function(){}).constructor;return await new c("node,parentNode,documentTitle,documentContent,AssetUri","return "+t.replace("SidekickClientEval:","").replace("ClientEval:",""))(n,r,s,o,a)}catch(i){throw i instanceof E?i:(console.error(i),new E('An error occurred while trying to evaluate "'+t+'"',1694682118365,t))}return t};this.processObjectWithClientEval=async(t,n=null,r=null)=>(await Promise.all(Object.keys(t).map(async i=>{let s=t[i];typeof s=="string"&&(t[i]=await this.processClientEval(s,n,r)),typeof s=="object"&&s!==null&&(t[i]=await this.processObjectWithClientEval(s,n,r)),Array.isArray(s)&&(t[i]=await Promise.all(s.map(async o=>await this.processObjectWithClientEval(o,n,r))))})),t);this.getImageMetadata=async t=>{if(!t||!t?.__identity)throw new E("The property does not have a valid image.",1694595562191);let{loadImageMetadata:n}=Xt.get().endpoints,r,i;try{let o=await n(t?.__identity);r=o?.originalImageResourceUri,i=o?.previewImageResourceUri}catch{throw new E("Could not fetch image object.",1694595598880)}if(!r||r==="")throw new E("The given image does not have a correct url.",1694595462402);let s=[];return s.push(this.prependConfiguredDomainToImageUri(r)),i&&s.push(this.prependConfiguredDomainToImageUri(i)),s};this.globalRegistry=t,this.store=n,this.nodeTypesRegistry=t.get("@neos-project/neos-ui-contentrepository"),this.externalService=t.get("NEOSidekick.AiAssistant").get("externalService")}prependConfiguredDomainToImageUri(t){let n=this.globalRegistry.get("NEOSidekick.AiAssistant").get("configuration").domain;return t=t.replace("http://","").replace("https://").split("/"),t.shift(),t.unshift(n),t.join("/")}getCurrentlyFocusedNodePathAndProperty(){let t=this.store.getState(),n=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),r=t?.cr?.nodes?.focused?.contextPaths[0],i=r?_e.selectors.CR.Nodes.nodeByContextPath(t)(r):null;return{nodePath:r,node:i,property:t?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:i?n.get(i?.nodeType):null,parentNode:i?_e.selectors.CR.Nodes.nodesByContextPathSelector(t)[i.parent]:null}}evaluateNodeTypeConfigurationAndStartGeneration(t,n,r,i=null){if(!r||n[0]==="_")return;let s=r.properties[n];if(!s?.options?.sidekick?.onCreate)return;try{if(!s?.ui?.inlineEditable)throw new E("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new E("This feature is not available in the free version.","1688157373215")}catch(c){this.store.dispatch(_e.actions.UI.FlashMessages.add(c?.code??c?.message,c?.code?i18nRegistry.translate("NEOSidekick.AiAssistant:Error:"+c.code):c?.message,c?.severity??"error"))}let o=JSON.parse(JSON.stringify(s.options.sidekick.onCreate)),a=this.globalRegistry.get("NEOSidekick.AiAssistant").get("assistantService");this.processObjectWithClientEval(o,t,i).then(c=>{let d={version:"1.0",eventName:"call-module",data:{platform:"neos",target:{nodePath:t.contextPath,propertyName:n},...c}};a.sendMessageToIframe(d)})}generateNodeForContext(t,n){return n?dn(t,r=>{let i=(0,$n.default)(n,s=>s?.value);r.properties=Object.assign({},r.properties,i)}):t}};var qn=y(De()),Ee=y(Y()),Jn=(e,t)=>function*(){yield(0,qn.takeEvery)(Ee.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(n){n.payload.feedbackEnvelope.feedbacks.forEach(r=>{if(r.type!=="Neos.Neos.Ui:NodeCreated")return;let i=e.get("@neos-project/neos-ui-contentrepository"),s=e.get("i18n"),o=e.get("NEOSidekick.AiAssistant").get("contentService"),a=e.get("NEOSidekick.AiAssistant").get("assistantService"),c=e.get("NEOSidekick.AiAssistant").get("externalService"),d=t.getState(),u=Ee.selectors.CR.Nodes.nodesByContextPathSelector(d)[r.payload.contextPath],g=Ee.selectors.CR.Nodes.nodesByContextPathSelector(d)[u.parent],p=i.get(u.nodeType);Object.keys(p.properties).forEach(l=>{o.evaluateNodeTypeConfigurationAndStartGeneration(u,l,p,g)})})})};var Yn=y(De()),Vn=y(Y()),Xn=(e,t)=>function*(){yield(0,Yn.takeEvery)(Vn.actionTypes.CR.Nodes.REMOVE,function*(n){console.log("Payload: ",n);let r=e.get("NEOSidekick.AiAssistant").get("assistantService");if(r.currentlyHandledNodePath===n.payload){r.resetCurrentlyHandledNodePath();let i={version:"1.0",eventName:"cancel-call-module"};console.log("Message: ",i),r.sendMessageToIframe(i)}})};var Zn=y(Y()),Qn=(e,t)=>new Ft(e,t),Ft=class{constructor(t,n){this.sendMessageToIframe=t=>{if(this.currentlyHandledNodePath&&["page-changed","page-updated"].indexOf(t?.eventName)>-1)return;if(this.currentlyHandledNodePath&&["call-module"].indexOf(t?.eventName)>-1){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}t?.eventName==="call-module"&&(this.currentlyHandledNodePath=t?.data?.target?.nodePath);let n=setInterval(()=>{let r=document.getElementById("neosidekickAssistant");if(r.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",t),r.contentWindow.postMessage(t,"*"),clearInterval(n),t?.eventName==="call-module"&&this.resetCurrentlyHandledNodePathDebounced();else{console.log("not loaded, waiting...");return}},250)};this.listenToMessages=()=>{let t=setInterval(()=>{let n=document.getElementById("neosidekickAssistant");if(n?.dataset?.hasOwnProperty("loaded"))window.addEventListener("message",i=>{let s=n.contentWindow;i.source===s&&(console.log(i),this.handleMessage(i))}),clearInterval(t);else return},250)};this.handleMessage=t=>{if(console.info("Handle Sidekick Message: "+t.data.eventName),t?.data?.eventName==="write-content"){let{nodePath:n,propertyName:r,value:i,isFinished:s}=t.data.data;this.currentlyHandledNodePath=n,this.changePropertyValue(n,r,i,s)}else if(t?.data?.eventName==="stopped-generation")this.resetTypingCaret(),this.resetCurrentlyHandledNodePath();else if(t?.data?.eventName==="error"){let n=t?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+n,"error",n),this.resetTypingCaret(),this.resetCurrentlyHandledNodePath()}this.resetCurrentlyHandledNodePathDebounced()};this.changePropertyValue=(t,n,r,i=!1)=>{let a=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(`[data-__neos-editable-node-contextpath="${t}"][data-__neos-property="${n}"]`);if(!a){this.resetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(t)){a.classList.remove("typing-caret"),this.resetCurrentlyHandledNodePath();return}a?.ckeditorInstance?.setData(r),a?.classList.toggle("typing-caret",!i),i&&this.resetCurrentlyHandledNodePath()};this.globalRegistry=t,this.store=n,this.currentlyHandledNodePath=null}resetTypingCaret(){let r=(document.getElementsByName("neos-content-main")[0]?.contentDocument).querySelector(".typing-caret");r&&r.classList.remove("typing-caret")}resetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetCurrentlyHandledNodePathDebounced(){let t,n=1e3;return()=>{clearTimeout(t),t=setTimeout(()=>{this.currentlyHandledNodePath=null},n)}}addFlashMessage(t,n,r="error",i=null){let s=this.globalRegistry.get("i18n");this.store.dispatch(Zn.actions.UI.FlashMessages.add(t,s.translate("NEOSidekick.AiAssistant:Error:"+t,n,{0:i}),r))}};var xe=y(Ae()),It=y(Fe()),nt=y(Se()),er=y(Ie());var Z=class extends xe.PureComponent{constructor(n){super(n);this.state={show:!1,enabled:!0};this.evaluateFocusedNodeAndPropertyAndShowButton=(n=5)=>{let{nodeType:r,property:i}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();if(!r||!i){if(n===0)return;setTimeout(()=>this.evaluateFocusedNodeAndPropertyAndShowButton(n-1),100);return}let s=r.properties[i];this.setState({show:s?.ui?.inlineEditable===!0&&s?.options?.sidekick?.onCreate!==void 0})};this.onClick=()=>{this.setState({enabled:!1});let{node:n,nodeType:r,parentNode:i,property:s}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();this.props.contentService.evaluateNodeTypeConfigurationAndStartGeneration(n,s,r,i),setTimeout(()=>{this.setState({enabled:!0})},2500)}}componentDidMount(){this.evaluateFocusedNodeAndPropertyAndShowButton()}render(){let{i18nRegistry:n}=this.props;return this.state.show?xe.default.createElement(nt.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:n.translate("NEOSidekick.AiAssistant:Main:regenerate")},xe.default.createElement(nt.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),"\xA0",n.translate("NEOSidekick.AiAssistant:Main:regenerate")):""}};Z.propTypes={contentService:It.default.object.isRequired,i18nRegistry:It.default.object.isRequired},Z=ce([(0,er.neos)(e=>({contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:e.get("i18n")}))],Z);function nr(e){return new Promise(t=>setTimeout(t,e))}jt("NEOSidekick.AiAssistant",{},(e,{store:t,frontendConfiguration:n})=>{let r=n["NEOSidekick.AiAssistant"];if(r===null||r.enabled===!1)return;if(!r.hasOwnProperty("defaultLanguage")||!r.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}e.set("NEOSidekick.AiAssistant",new J),e.get("NEOSidekick.AiAssistant").set("configuration",r);let i=Vt(n);e.get("NEOSidekick.AiAssistant").set("externalService",i);let s=Gn(e,t);e.get("NEOSidekick.AiAssistant").set("contentService",s);let o=Qn(e,t);e.get("NEOSidekick.AiAssistant").set("assistantService",o),o.listenToMessages();let a=e.get("containers"),c=a.get("App"),d=x=>{let f=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[v,m]=F.default.useState(f?.open),w=T=>{m(T),f.open=T,localStorage.setItem("NEOSidekick",JSON.stringify(f))},[A,G]=F.default.useState(f?.fullscreen),h=T=>{G(T),f.fullscreen=T,localStorage.setItem("NEOSidekick",JSON.stringify(f))},N=(T,rt,it)=>{if(T)return F.default.createElement(Te.IconButton,{icon:rt?"compress":"expand",onClick:it})},I=(T,rt,it)=>{if(!rt)return F.default.createElement(Te.IconButton,{icon:T?"chevron-circle-right":"chevron-circle-left",onClick:it})},Rt=(0,Mt.useSelector)(ae.selectors.CR.ContentDimensions.active),rr=(0,Mt.useSelector)(T=>T?.user?.preferences?.interfaceLanguage),K=new URL(`${r.apiDomain}/chat/`);return K.searchParams.append("contentLanguage",Rt.language?Rt.language[0]:r.defaultLanguage),K.searchParams.append("interfaceLanguage",rr),K.searchParams.append("userId",r.userId),K.searchParams.append("plattform","neos"),K.searchParams.append("domain",r.domain),K.searchParams.append("siteName",r.siteName),r?.referral&&K.searchParams.append("referral",r?.referral),r?.apiKey&&K.searchParams.append("apikey",r?.apiKey),F.default.createElement("div",{className:`neosidekick_appWrapper ${v?"neosidekick_appWrapper--sidebar-open":""}  ${A?"neosidekick_appWrapper--sidebar-fullscreen":""}`},F.default.createElement(c,{...x}),F.default.createElement("div",{className:"neosidekick_sideBar"},F.default.createElement("div",{className:"neosidekick_sideBar__title"},F.default.createElement(Te.Headline,{className:`neosidekick_sideBar__title-headline ${v?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),F.default.createElement("div",null,N(v,A,()=>h(!A)),I(v,A,()=>w(!v)))),F.default.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${v?"neosidekick_sideBar__frame--open":""}`,src:K.toString(),allow:"clipboard-write",onLoad:T=>T.target.dataset.loaded=!0})))};a.set("App",d);let u=!1,g=function*(){yield(0,tr.takeLatest)([ae.actionTypes.UI.ContentCanvas.SET_SRC,ae.actionTypes.UI.ContentCanvas.RELOAD,ae.actionTypes.CR.Nodes.MERGE],async function*(x){x.type===ae.actionTypes.UI.ContentCanvas.SET_SRC&&(u=!0),yield nr(500);let f=e.get("@neos-project/neos-ui-contentrepository"),v=t.getState(),m=v?.ui?.contentCanvas?.previewUrl,w=s.getCurrentDocumentNode(),A=w?.contextPath,G=Object.values(v?.cr?.nodes?.byContextPath||{}).filter(h=>{let N=f.getRole("document");if(!N)throw new Error("Document role is not loaded!");let I=f.getSubTypesOf(N);return A&&h.contextPath.indexOf(A.split("@")[0])===0&&(h.contextPath===A||!I.includes(h.nodeType))});o.sendMessageToIframe({version:"1.0",eventName:u?"page-changed":"page-updated",data:{url:m,title:w?.properties?.title||s.getGuestFrameDocumentTitle(),content:s.getGuestFrameDocumentHtml(),structuredContent:G,targetAudience:await s.getCurrentDocumentTargetAudience(),pageBriefing:await s.getCurrentDocumentPageBriefing(),focusKeyword:await s.getCurrentDocumentFocusKeyword()}}),u=!1})},p=e.get("sagas");p.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:g}),p.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:Jn(e,t)}),p.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:Xn(e,t)});let l=e.get("inspector").get("editors");l.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:L}),l.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:z}),e.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:regenerate",{component:Z,isVisible:()=>!0},"end")});})();
//# sourceMappingURL=Plugin.js.map
