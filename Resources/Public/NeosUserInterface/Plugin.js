(()=>{var G=Object.create;var x=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var Z=(e,t)=>()=>(e&&(t=e(e=0)),t);var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ee=(e,t,r,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of z(t))!Q.call(e,d)&&d!==r&&x(e,d,{get:()=>t[d],enumerable:!(u=Y(t,d))||u.enumerable});return e};var k=(e,t,r)=>(r=e!=null?G(X(e)):{},ee(t||!e||!e.__esModule?x(r,"default",{value:e,enumerable:!0}):r,e));function o(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var p=Z(()=>{});var F=y((ve,W)=>{p();W.exports=o("NeosProjectPackages")().ReactUiComponents});var B=y((Ee,j)=>{p();j.exports=o("NeosProjectPackages")().NeosUiReduxStore});var T=y((Re,L)=>{p();L.exports=o("vendor")().React});var D=y((We,K)=>{p();K.exports=o("vendor")().reactRedux});var M=y((je,U)=>{p();U.exports=o("vendor")().reduxSagaEffects});p();var I=o("manifest");var S=k(F()),f=k(B()),n=k(T()),P=k(D()),H=k(M());function $(e){return new Promise(t=>setTimeout(t,e))}I("NEOSidekick.AiAssistant",{},(e,t)=>{let r=null,u=new XMLHttpRequest;if(u.open("GET","/neosidekick/aiassistant/configuration",!1),u.withCredentials=!0,u.addEventListener("load",g=>{let s=g.target;s?.status>=200&&s?.status<=299&&(r=JSON.parse(s.responseText))}),u.send(),r===null)return;let d=e.get("containers"),J=d.get("App"),V=g=>{let s=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[c,E]=n.useState(s?.open),N=a=>{E(a),s.open=a,localStorage.setItem("NEOSidekick",JSON.stringify(s))},[l,w]=n.useState(s?.fullscreen),h=a=>{w(a),s.fullscreen=a,localStorage.setItem("NEOSidekick",JSON.stringify(s))},C=(a,O,v)=>{if(a)return n.createElement(S.IconButton,{icon:O?"compress":"expand",onClick:v})},_=(a,O,v)=>{if(!O)return n.createElement(S.IconButton,{icon:a?"chevron-circle-right":"chevron-circle-left",onClick:v})},m=(0,P.useSelector)(f.selectors.CR.ContentDimensions.active),b=(0,P.useSelector)(a=>a?.user?.preferences?.interfaceLanguage),i=new URL("https://api.neosidekick.com/chat/");return i.searchParams.append("contentLanguage",m.language?m.language[0]:""),i.searchParams.append("interfaceLanguage",b),i.searchParams.append("userId",r.userId),i.searchParams.append("plattform","neos"),i.searchParams.append("domain",r.domain),i.searchParams.append("siteName",r.siteName),r?.referral&&i.searchParams.append("referral",r?.referral),r?.apikey&&i.searchParams.append("apikey",r?.apikey),n.createElement("div",{className:`neosidekick_appWrapper ${c?"neosidekick_appWrapper--sidebar-open":""}  ${l?"neosidekick_appWrapper--sidebar-fullscreen":""}`},n.createElement(J,{...g}),n.createElement("div",{className:"neosidekick_sideBar"},n.createElement("div",{className:"neosidekick_sideBar__title"},n.createElement(S.Headline,{className:`neosidekick_sideBar__title-headline ${c?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),n.createElement("div",null,C(c,l,()=>h(!l)),_(c,l,()=>N(!c)))),n.createElement("iframe",{className:`neosidekick_sideBar__frame ${c?"neosidekick_sideBar__frame--open":""}`,src:i.toString(),allow:"clipboard-write"})))};d.set("App",V);let A=!1,q=function*(){yield(0,H.takeLatest)([f.actionTypes.UI.ContentCanvas.SET_SRC,f.actionTypes.UI.ContentCanvas.RELOAD,f.actionTypes.CR.Nodes.MERGE],function*(g){g.type===f.actionTypes.UI.ContentCanvas.SET_SRC&&(A=!0),yield $(500);let s=e.get("@neos-project/neos-ui-contentrepository"),c=t.store.getState(),N=document.getElementsByName("neos-content-main")[0]?.contentDocument,l=document.getElementsByClassName("neosidekick_sideBar__frame")[0],w=c?.ui?.contentCanvas?.previewUrl,h=c?.cr?.nodes?.documentNode,C=Object.values(c?.cr?.nodes?.byContextPath||{}).filter(m=>{let b=s.getRole("document");if(!b)throw new Error("Document role is not loaded!");let i=s.getSubTypesOf(b);return h&&m.contextPath.indexOf(h.split("@")[0])===0&&(m.contextPath===h||!i.includes(m.nodeType))}),_={version:"1.0",eventName:A?"page-changed":"page-updated",data:{url:w,title:N?.title,content:N?.body?.innerHTML,structuredContent:C}};console.log(_),l.contentWindow.postMessage(_,"*"),A=!1})};e.get("sagas").set("NEOSidekick.AiAssistant/debug",{saga:q})});})();
//# sourceMappingURL=Plugin.js.map
