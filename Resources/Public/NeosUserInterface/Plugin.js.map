{
  "version": 3,
  "sources": ["../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/readFromConsumerApi.ts", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/react-ui-components/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/neos-ui-redux-store/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/vendor/react/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/vendor/react-redux/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/vendor/redux-saga-effects/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/vendor/prop-types/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/neos-ui-decorators/index.js", "../../Private/NeosUserInterface/node_modules/lodash.mapvalues/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/neos-ui-editors/index.js", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/index.ts", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/registry/AbstractRegistry.ts", "../../Private/NeosUserInterface/node_modules/@neos-project/positional-array-sorter/src/positionalArraySorter.ts", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/registry/SynchronousRegistry.ts", "../../Private/NeosUserInterface/src/manifest.tsx", "../../Private/NeosUserInterface/src/Editors/MagicTextFieldEditor.tsx", "../../Private/NeosUserInterface/src/Editors/MagicTextAreaEditor.tsx", "../../Private/NeosUserInterface/src/AiAssistantError.ts", "../../Private/NeosUserInterface/src/ExternalService.ts", "../../Private/NeosUserInterface/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/neos-ui-backend-connector/index.js", "../../Private/NeosUserInterface/src/ContentService.ts", "../../Private/NeosUserInterface/node_modules/immer/src/utils/env.ts", "../../Private/NeosUserInterface/node_modules/immer/src/utils/errors.ts", "../../Private/NeosUserInterface/node_modules/immer/src/utils/common.ts", "../../Private/NeosUserInterface/node_modules/immer/src/utils/plugins.ts", "../../Private/NeosUserInterface/node_modules/immer/src/core/scope.ts", "../../Private/NeosUserInterface/node_modules/immer/src/core/finalize.ts", "../../Private/NeosUserInterface/node_modules/immer/src/core/proxy.ts", "../../Private/NeosUserInterface/node_modules/immer/src/core/immerClass.ts", "../../Private/NeosUserInterface/node_modules/immer/src/core/current.ts", "../../Private/NeosUserInterface/node_modules/immer/src/plugins/patches.ts", "../../Private/NeosUserInterface/node_modules/immer/src/plugins/mapset.ts", "../../Private/NeosUserInterface/node_modules/immer/src/immer.ts", "../../Private/NeosUserInterface/src/Sagas/NodeCreated.ts", "../../Private/NeosUserInterface/src/Sagas/NodeRemoved.ts", "../../Private/NeosUserInterface/src/Service/AssistantService.ts", "../../Private/NeosUserInterface/src/Components/RegenerateButton.tsx"],
  "sourcesContent": [null, null, null, null, null, null, null, null, "/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used to compose bitmasks for comparison styles. */\nvar UNORDERED_COMPARE_FLAG = 1,\n    PARTIAL_COMPARE_FLAG = 2;\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0,\n    MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/,\n    reLeadingDot = /^\\./,\n    rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    return freeProcess && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * A specialized version of `_.some` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {boolean} Returns `true` if any element passes the predicate check,\n *  else `false`.\n */\nfunction arraySome(array, predicate) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (predicate(array[index], index, array)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * The base implementation of `_.property` without support for deep paths.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction baseProperty(key) {\n  return function(object) {\n    return object == null ? undefined : object[key];\n  };\n}\n\n/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    Uint8Array = root.Uint8Array,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView'),\n    Map = getNative(root, 'Map'),\n    Promise = getNative(root, 'Promise'),\n    Set = getNative(root, 'Set'),\n    WeakMap = getNative(root, 'WeakMap'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values ? values.length : 0;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\n/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  this.__data__ = new ListCache(entries);\n}\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n}\n\n/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  return this.__data__['delete'](key);\n}\n\n/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\n/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var cache = this.__data__;\n  if (cache instanceof ListCache) {\n    var pairs = cache.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      return this;\n    }\n    cache = this.__data__ = new MapCache(pairs);\n  }\n  cache.set(key, value);\n  return this;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  // Safari 9 makes `arguments.length` enumerable in strict mode.\n  var result = (isArray(value) || isArguments(value))\n    ? baseTimes(value.length, String)\n    : [];\n\n  var length = result.length,\n      skipIndexes = !!length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (key == 'length' || isIndex(key, length)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `baseForOwn` which iterates over `object`\n * properties returned by `keysFunc` and invokes `iteratee` for each property.\n * Iteratee functions may exit iteration early by explicitly returning `false`.\n *\n * @private\n * @param {Object} object The object to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @param {Function} keysFunc The function to get the keys of `object`.\n * @returns {Object} Returns `object`.\n */\nvar baseFor = createBaseFor();\n\n/**\n * The base implementation of `_.forOwn` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The object to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Object} Returns `object`.\n */\nfunction baseForOwn(object, iteratee) {\n  return object && baseFor(object, iteratee, keys);\n}\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\n/**\n * The base implementation of `getTag`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  return objectToString.call(value);\n}\n\n/**\n * The base implementation of `_.hasIn` without support for deep paths.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {Array|string} key The key to check.\n * @returns {boolean} Returns `true` if `key` exists, else `false`.\n */\nfunction baseHasIn(object, key) {\n  return object != null && key in Object(object);\n}\n\n/**\n * The base implementation of `_.isEqual` which supports partial comparisons\n * and tracks traversed objects.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {boolean} [bitmask] The bitmask of comparison flags.\n *  The bitmask may be composed of the following flags:\n *     1 - Unordered comparison\n *     2 - Partial comparison\n * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n */\nfunction baseIsEqual(value, other, customizer, bitmask, stack) {\n  if (value === other) {\n    return true;\n  }\n  if (value == null || other == null || (!isObject(value) && !isObjectLike(other))) {\n    return value !== value && other !== other;\n  }\n  return baseIsEqualDeep(value, other, baseIsEqual, customizer, bitmask, stack);\n}\n\n/**\n * A specialized version of `baseIsEqual` for arrays and objects which performs\n * deep comparisons and tracks traversed objects enabling objects with circular\n * references to be compared.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {number} [bitmask] The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction baseIsEqualDeep(object, other, equalFunc, customizer, bitmask, stack) {\n  var objIsArr = isArray(object),\n      othIsArr = isArray(other),\n      objTag = arrayTag,\n      othTag = arrayTag;\n\n  if (!objIsArr) {\n    objTag = getTag(object);\n    objTag = objTag == argsTag ? objectTag : objTag;\n  }\n  if (!othIsArr) {\n    othTag = getTag(other);\n    othTag = othTag == argsTag ? objectTag : othTag;\n  }\n  var objIsObj = objTag == objectTag && !isHostObject(object),\n      othIsObj = othTag == objectTag && !isHostObject(other),\n      isSameTag = objTag == othTag;\n\n  if (isSameTag && !objIsObj) {\n    stack || (stack = new Stack);\n    return (objIsArr || isTypedArray(object))\n      ? equalArrays(object, other, equalFunc, customizer, bitmask, stack)\n      : equalByTag(object, other, objTag, equalFunc, customizer, bitmask, stack);\n  }\n  if (!(bitmask & PARTIAL_COMPARE_FLAG)) {\n    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),\n        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');\n\n    if (objIsWrapped || othIsWrapped) {\n      var objUnwrapped = objIsWrapped ? object.value() : object,\n          othUnwrapped = othIsWrapped ? other.value() : other;\n\n      stack || (stack = new Stack);\n      return equalFunc(objUnwrapped, othUnwrapped, customizer, bitmask, stack);\n    }\n  }\n  if (!isSameTag) {\n    return false;\n  }\n  stack || (stack = new Stack);\n  return equalObjects(object, other, equalFunc, customizer, bitmask, stack);\n}\n\n/**\n * The base implementation of `_.isMatch` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The object to inspect.\n * @param {Object} source The object of property values to match.\n * @param {Array} matchData The property names, values, and compare flags to match.\n * @param {Function} [customizer] The function to customize comparisons.\n * @returns {boolean} Returns `true` if `object` is a match, else `false`.\n */\nfunction baseIsMatch(object, source, matchData, customizer) {\n  var index = matchData.length,\n      length = index,\n      noCustomizer = !customizer;\n\n  if (object == null) {\n    return !length;\n  }\n  object = Object(object);\n  while (index--) {\n    var data = matchData[index];\n    if ((noCustomizer && data[2])\n          ? data[1] !== object[data[0]]\n          : !(data[0] in object)\n        ) {\n      return false;\n    }\n  }\n  while (++index < length) {\n    data = matchData[index];\n    var key = data[0],\n        objValue = object[key],\n        srcValue = data[1];\n\n    if (noCustomizer && data[2]) {\n      if (objValue === undefined && !(key in object)) {\n        return false;\n      }\n    } else {\n      var stack = new Stack;\n      if (customizer) {\n        var result = customizer(objValue, srcValue, key, object, source, stack);\n      }\n      if (!(result === undefined\n            ? baseIsEqual(srcValue, objValue, customizer, UNORDERED_COMPARE_FLAG | PARTIAL_COMPARE_FLAG, stack)\n            : result\n          )) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[objectToString.call(value)];\n}\n\n/**\n * The base implementation of `_.iteratee`.\n *\n * @private\n * @param {*} [value=_.identity] The value to convert to an iteratee.\n * @returns {Function} Returns the iteratee.\n */\nfunction baseIteratee(value) {\n  // Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.\n  // See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.\n  if (typeof value == 'function') {\n    return value;\n  }\n  if (value == null) {\n    return identity;\n  }\n  if (typeof value == 'object') {\n    return isArray(value)\n      ? baseMatchesProperty(value[0], value[1])\n      : baseMatches(value);\n  }\n  return property(value);\n}\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.matches` which doesn't clone `source`.\n *\n * @private\n * @param {Object} source The object of property values to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatches(source) {\n  var matchData = getMatchData(source);\n  if (matchData.length == 1 && matchData[0][2]) {\n    return matchesStrictComparable(matchData[0][0], matchData[0][1]);\n  }\n  return function(object) {\n    return object === source || baseIsMatch(object, source, matchData);\n  };\n}\n\n/**\n * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.\n *\n * @private\n * @param {string} path The path of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatchesProperty(path, srcValue) {\n  if (isKey(path) && isStrictComparable(srcValue)) {\n    return matchesStrictComparable(toKey(path), srcValue);\n  }\n  return function(object) {\n    var objValue = get(object, path);\n    return (objValue === undefined && objValue === srcValue)\n      ? hasIn(object, path)\n      : baseIsEqual(srcValue, objValue, undefined, UNORDERED_COMPARE_FLAG | PARTIAL_COMPARE_FLAG);\n  };\n}\n\n/**\n * A specialized version of `baseProperty` which supports deep paths.\n *\n * @private\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction basePropertyDeep(path) {\n  return function(object) {\n    return baseGet(object, path);\n  };\n}\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value) {\n  return isArray(value) ? value : stringToPath(value);\n}\n\n/**\n * Creates a base function for methods like `_.forIn` and `_.forOwn`.\n *\n * @private\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {Function} Returns the new base function.\n */\nfunction createBaseFor(fromRight) {\n  return function(object, iteratee, keysFunc) {\n    var index = -1,\n        iterable = Object(object),\n        props = keysFunc(object),\n        length = props.length;\n\n    while (length--) {\n      var key = props[fromRight ? length : ++index];\n      if (iteratee(iterable[key], key, iterable) === false) {\n        break;\n      }\n    }\n    return object;\n  };\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for arrays with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Array} array The array to compare.\n * @param {Array} other The other array to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} customizer The function to customize comparisons.\n * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} stack Tracks traversed `array` and `other` objects.\n * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n */\nfunction equalArrays(array, other, equalFunc, customizer, bitmask, stack) {\n  var isPartial = bitmask & PARTIAL_COMPARE_FLAG,\n      arrLength = array.length,\n      othLength = other.length;\n\n  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {\n    return false;\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(array);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var index = -1,\n      result = true,\n      seen = (bitmask & UNORDERED_COMPARE_FLAG) ? new SetCache : undefined;\n\n  stack.set(array, other);\n  stack.set(other, array);\n\n  // Ignore non-index properties.\n  while (++index < arrLength) {\n    var arrValue = array[index],\n        othValue = other[index];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, arrValue, index, other, array, stack)\n        : customizer(arrValue, othValue, index, array, other, stack);\n    }\n    if (compared !== undefined) {\n      if (compared) {\n        continue;\n      }\n      result = false;\n      break;\n    }\n    // Recursively compare arrays (susceptible to call stack limits).\n    if (seen) {\n      if (!arraySome(other, function(othValue, othIndex) {\n            if (!seen.has(othIndex) &&\n                (arrValue === othValue || equalFunc(arrValue, othValue, customizer, bitmask, stack))) {\n              return seen.add(othIndex);\n            }\n          })) {\n        result = false;\n        break;\n      }\n    } else if (!(\n          arrValue === othValue ||\n            equalFunc(arrValue, othValue, customizer, bitmask, stack)\n        )) {\n      result = false;\n      break;\n    }\n  }\n  stack['delete'](array);\n  stack['delete'](other);\n  return result;\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for comparing objects of\n * the same `toStringTag`.\n *\n * **Note:** This function only supports comparing values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {string} tag The `toStringTag` of the objects to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} customizer The function to customize comparisons.\n * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalByTag(object, other, tag, equalFunc, customizer, bitmask, stack) {\n  switch (tag) {\n    case dataViewTag:\n      if ((object.byteLength != other.byteLength) ||\n          (object.byteOffset != other.byteOffset)) {\n        return false;\n      }\n      object = object.buffer;\n      other = other.buffer;\n\n    case arrayBufferTag:\n      if ((object.byteLength != other.byteLength) ||\n          !equalFunc(new Uint8Array(object), new Uint8Array(other))) {\n        return false;\n      }\n      return true;\n\n    case boolTag:\n    case dateTag:\n    case numberTag:\n      // Coerce booleans to `1` or `0` and dates to milliseconds.\n      // Invalid dates are coerced to `NaN`.\n      return eq(+object, +other);\n\n    case errorTag:\n      return object.name == other.name && object.message == other.message;\n\n    case regexpTag:\n    case stringTag:\n      // Coerce regexes to strings and treat strings, primitives and objects,\n      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n      // for more details.\n      return object == (other + '');\n\n    case mapTag:\n      var convert = mapToArray;\n\n    case setTag:\n      var isPartial = bitmask & PARTIAL_COMPARE_FLAG;\n      convert || (convert = setToArray);\n\n      if (object.size != other.size && !isPartial) {\n        return false;\n      }\n      // Assume cyclic values are equal.\n      var stacked = stack.get(object);\n      if (stacked) {\n        return stacked == other;\n      }\n      bitmask |= UNORDERED_COMPARE_FLAG;\n\n      // Recursively compare objects (susceptible to call stack limits).\n      stack.set(object, other);\n      var result = equalArrays(convert(object), convert(other), equalFunc, customizer, bitmask, stack);\n      stack['delete'](object);\n      return result;\n\n    case symbolTag:\n      if (symbolValueOf) {\n        return symbolValueOf.call(object) == symbolValueOf.call(other);\n      }\n  }\n  return false;\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for objects with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} customizer The function to customize comparisons.\n * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalObjects(object, other, equalFunc, customizer, bitmask, stack) {\n  var isPartial = bitmask & PARTIAL_COMPARE_FLAG,\n      objProps = keys(object),\n      objLength = objProps.length,\n      othProps = keys(other),\n      othLength = othProps.length;\n\n  if (objLength != othLength && !isPartial) {\n    return false;\n  }\n  var index = objLength;\n  while (index--) {\n    var key = objProps[index];\n    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {\n      return false;\n    }\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(object);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var result = true;\n  stack.set(object, other);\n  stack.set(other, object);\n\n  var skipCtor = isPartial;\n  while (++index < objLength) {\n    key = objProps[index];\n    var objValue = object[key],\n        othValue = other[key];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, objValue, key, other, object, stack)\n        : customizer(objValue, othValue, key, object, other, stack);\n    }\n    // Recursively compare objects (susceptible to call stack limits).\n    if (!(compared === undefined\n          ? (objValue === othValue || equalFunc(objValue, othValue, customizer, bitmask, stack))\n          : compared\n        )) {\n      result = false;\n      break;\n    }\n    skipCtor || (skipCtor = key == 'constructor');\n  }\n  if (result && !skipCtor) {\n    var objCtor = object.constructor,\n        othCtor = other.constructor;\n\n    // Non `Object` object instances with different constructors are not equal.\n    if (objCtor != othCtor &&\n        ('constructor' in object && 'constructor' in other) &&\n        !(typeof objCtor == 'function' && objCtor instanceof objCtor &&\n          typeof othCtor == 'function' && othCtor instanceof othCtor)) {\n      result = false;\n    }\n  }\n  stack['delete'](object);\n  stack['delete'](other);\n  return result;\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the property names, values, and compare flags of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the match data of `object`.\n */\nfunction getMatchData(object) {\n  var result = keys(object),\n      length = result.length;\n\n  while (length--) {\n    var key = result[length],\n        value = object[key];\n\n    result[length] = [key, value, isStrictComparable(value)];\n  }\n  return result;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11,\n// for data views in Edge < 14, and promises in Node.js.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = objectToString.call(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : undefined;\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\n/**\n * Checks if `path` exists on `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @param {Function} hasFunc The function to check properties.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n */\nfunction hasPath(object, path, hasFunc) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var result,\n      index = -1,\n      length = path.length;\n\n  while (++index < length) {\n    var key = toKey(path[index]);\n    if (!(result = object != null && hasFunc(object, key))) {\n      break;\n    }\n    object = object[key];\n  }\n  if (result) {\n    return result;\n  }\n  var length = object ? object.length : 0;\n  return !!length && isLength(length) && isIndex(key, length) &&\n    (isArray(object) || isArguments(object));\n}\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\n/**\n * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` if suitable for strict\n *  equality comparisons, else `false`.\n */\nfunction isStrictComparable(value) {\n  return value === value && !isObject(value);\n}\n\n/**\n * A specialized version of `matchesProperty` for source values suitable\n * for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction matchesStrictComparable(key, srcValue) {\n  return function(object) {\n    if (object == null) {\n      return false;\n    }\n    return object[key] === srcValue &&\n      (srcValue !== undefined || (key in Object(object)));\n  };\n}\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoize(function(string) {\n  string = toString(string);\n\n  var result = [];\n  if (reLeadingDot.test(string)) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, string) {\n    result.push(quote ? string.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result);\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Assign cache to `_.memoize`.\nmemoize.Cache = MapCache;\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\n/**\n * Checks if `path` is a direct or inherited property of `object`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n * @example\n *\n * var object = _.create({ 'a': _.create({ 'b': 2 }) });\n *\n * _.hasIn(object, 'a');\n * // => true\n *\n * _.hasIn(object, 'a.b');\n * // => true\n *\n * _.hasIn(object, ['a', 'b']);\n * // => true\n *\n * _.hasIn(object, 'b');\n * // => false\n */\nfunction hasIn(object, path) {\n  return object != null && hasPath(object, path, baseHasIn);\n}\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\n/**\n * Creates an object with the same keys as `object` and values generated\n * by running each own enumerable string keyed property of `object` thru\n * `iteratee`. The iteratee is invoked with three arguments:\n * (value, key, object).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Object\n * @param {Object} object The object to iterate over.\n * @param {Function} [iteratee=_.identity] The function invoked per iteration.\n * @returns {Object} Returns the new mapped object.\n * @see _.mapKeys\n * @example\n *\n * var users = {\n *   'fred':    { 'user': 'fred',    'age': 40 },\n *   'pebbles': { 'user': 'pebbles', 'age': 1 }\n * };\n *\n * _.mapValues(users, function(o) { return o.age; });\n * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n *\n * // The `_.property` iteratee shorthand.\n * _.mapValues(users, 'age');\n * // => { 'fred': 40, 'pebbles': 1 } (iteration order is not guaranteed)\n */\nfunction mapValues(object, iteratee) {\n  var result = {};\n  iteratee = baseIteratee(iteratee, 3);\n\n  baseForOwn(object, function(value, key, object) {\n    result[key] = iteratee(value, key, object);\n  });\n  return result;\n}\n\n/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\n/**\n * Creates a function that returns the value at `path` of a given object.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n * @example\n *\n * var objects = [\n *   { 'a': { 'b': 2 } },\n *   { 'a': { 'b': 1 } }\n * ];\n *\n * _.map(objects, _.property('a.b'));\n * // => [2, 1]\n *\n * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');\n * // => [1, 2]\n */\nfunction property(path) {\n  return isKey(path) ? baseProperty(toKey(path)) : basePropertyDeep(path);\n}\n\nmodule.exports = mapValues;\n", null, null, null, null, null, "import manifest, {SynchronousRegistry} from \"@neos-project/neos-ui-extensibility\";\nimport {Headline, IconButton} from \"@neos-project/react-ui-components\";\nimport {actionTypes, selectors} from '@neos-project/neos-ui-redux-store';\nimport React from 'react';\nimport {useSelector} from 'react-redux';\nimport {takeLatest} from 'redux-saga/effects';\nimport MagicTextFieldEditor from './Editors/MagicTextFieldEditor';\nimport MagicTextAreaEditor from './Editors/MagicTextAreaEditor';\nimport {createExternalService} from './ExternalService';\nimport {createContentService} from './ContentService';\nimport {createWatchNodeCreatedSaga} from \"./Sagas/NodeCreated\";\nimport {createWatchNodeRemovedSaga} from \"./Sagas/NodeRemoved\"\nimport {createAssistantService} from \"./Service/AssistantService\";\nimport RegenerateButton from './Components/RegenerateButton'\nimport {TextField, TextArea} from '@neos-project/neos-ui-editors'\n\nimport \"./style.css\";\n\nexport default function delay(timeInMilliseconds: number): Promise<void> {\n    // @ts-ignore\n    return new Promise(resolve => setTimeout(resolve, timeInMilliseconds));\n}\n\nmanifest(\"NEOSidekick.AiAssistant\", {}, (globalRegistry, {store, frontendConfiguration}) => {\n    const editorsRegistry = globalRegistry.get('inspector').get('editors');\n    // Initially register default editors\n    editorsRegistry.set('NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor', {\n        component: TextField\n    });\n    editorsRegistry.set('NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor', {\n        component: TextArea\n    });\n\n    const configuration = frontendConfiguration['NEOSidekick.AiAssistant'];\n    if (configuration === null || configuration.enabled === false) {\n        return\n    }\n\n    if (!configuration.hasOwnProperty('defaultLanguage') || !configuration['defaultLanguage']) {\n        console.error('Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.')\n        return;\n    }\n\n    globalRegistry.set('NEOSidekick.AiAssistant', new SynchronousRegistry(\"\"))\n    globalRegistry.get('NEOSidekick.AiAssistant').set('configuration', configuration)\n    const externalService = createExternalService(frontendConfiguration);\n    globalRegistry.get('NEOSidekick.AiAssistant').set('externalService', externalService)\n    const contentService = createContentService(globalRegistry, store);\n    globalRegistry.get('NEOSidekick.AiAssistant').set('contentService', contentService)\n    const assistantService = createAssistantService(globalRegistry, store)\n    globalRegistry.get('NEOSidekick.AiAssistant').set('assistantService', assistantService)\n\n    assistantService.listenToMessages()\n\n    const containerRegistry = globalRegistry.get('containers');\n    const App = containerRegistry.get('App');\n\tconst WrappedApp = (props: Record<string, unknown>) => {\n        const state = localStorage.getItem('NEOSidekick') ? JSON.parse(localStorage.getItem('NEOSidekick')) : { open: true, fullscreen: false };\n\t\tconst [isOpen, setOpen] = React.useState(state?.open);\n        const setOpenAndPersistState = (open) => {\n            setOpen(open);\n            state.open = open;\n            localStorage.setItem('NEOSidekick', JSON.stringify(state));\n        }\n\n        const [isFullscreen, setFullscreen] = React.useState(state?.fullscreen);\n        const setFullscreenAndPersistState = (fullscreen) => {\n            setFullscreen(fullscreen);\n            state.fullscreen = fullscreen;\n            localStorage.setItem('NEOSidekick', JSON.stringify(state));\n        }\n\n        const fullscreenButton = (isOpen, isFullscreen, onClick) => {\n            if (isOpen) {\n                return <IconButton icon={isFullscreen ? \"compress\" : \"expand\"} onClick={onClick} />\n            }\n        }\n        const toggleButton = (isOpen, isFullscreen, onClick) => {\n            if (!isFullscreen) {\n                return <IconButton icon={isOpen ? \"chevron-circle-right\" : \"chevron-circle-left\"} onClick={onClick} />\n            }\n        }\n\n\t\tconst activeContentDimensions = useSelector(selectors.CR.ContentDimensions.active);\n\t\tconst interfaceLanguage = useSelector((state) => state?.user?.preferences?.interfaceLanguage);\n        const iframeSrc = new URL(`${configuration.apiDomain}/chat/`);\n        iframeSrc.searchParams.append('contentLanguage', activeContentDimensions.language ? activeContentDimensions.language[0] : configuration['defaultLanguage']);\n        iframeSrc.searchParams.append('interfaceLanguage', interfaceLanguage);\n        iframeSrc.searchParams.append('userId', configuration.userId);\n        iframeSrc.searchParams.append('plattform', 'neos');\n        iframeSrc.searchParams.append('domain', configuration.domain);\n        iframeSrc.searchParams.append('siteName', configuration.siteName)\n        if (configuration?.referral) {\n            iframeSrc.searchParams.append('referral', configuration?.referral);\n        }\n        if (configuration?.apiKey) {\n            iframeSrc.searchParams.append('apikey', configuration?.apiKey);\n        }\n\n        return <div className={`neosidekick_appWrapper ${isOpen ? \"neosidekick_appWrapper--sidebar-open\" : \"\"}  ${isFullscreen ? \"neosidekick_appWrapper--sidebar-fullscreen\" : \"\"}`}>\n\t\t\t<App {...props} />\n            <div className=\"neosidekick_sideBar\">\n\t\t\t\t<div className=\"neosidekick_sideBar__title\">\n\t\t\t\t\t<Headline className={`neosidekick_sideBar__title-headline ${isOpen ? \"neosidekick_sideBar__title-headline--open\" : \"\"}`}>AI Sidekick</Headline>\n\t\t\t\t\t<div>\n                        {fullscreenButton(isOpen, isFullscreen, () => setFullscreenAndPersistState(!isFullscreen))}\n                        {toggleButton(isOpen, isFullscreen, () => setOpenAndPersistState(!isOpen))}\n                    </div>\n\t\t\t\t</div>\n                <iframe id=\"neosidekickAssistant\" className={`neosidekick_sideBar__frame ${isOpen ? \"neosidekick_sideBar__frame--open\" : \"\"}`} src={iframeSrc.toString()} allow=\"clipboard-write\" onLoad={(e) => e.target.dataset.loaded = true} />\n            </div>\n\t\t</div>\n\t}\n\tcontainerRegistry.set('App', WrappedApp);\n\n    let requiredChangedEvent = false\n    const watchDocumentNodeChange = function * () {\n        yield takeLatest([actionTypes.UI.ContentCanvas.SET_SRC, actionTypes.UI.ContentCanvas.RELOAD, actionTypes.CR.Nodes.MERGE], async function * (action) {\n            if (action.type === actionTypes.UI.ContentCanvas.SET_SRC) {\n                requiredChangedEvent = true;\n            }\n            yield delay(500)\n\n            const nodeTypesRegistry = globalRegistry.get('@neos-project/neos-ui-contentrepository')\n            const state = store.getState();\n\n            const previewUrl = state?.ui?.contentCanvas?.previewUrl\n            const currentDocumentNode = contentService.getCurrentDocumentNode()\n            const currentDocumentNodePath = currentDocumentNode?.contextPath\n            // @ts-ignore\n            const relevantNodes = Object.values(state?.cr?.nodes?.byContextPath || {}).filter(node => {\n                const documentRole = nodeTypesRegistry.getRole('document');\n                if (!documentRole) {\n                    throw new Error('Document role is not loaded!');\n                }\n                const documentSubNodeTypes = nodeTypesRegistry.getSubTypesOf(documentRole);\n                // only get nodes that are children of the current document node\n                return currentDocumentNodePath &&\n                    node.contextPath.indexOf(currentDocumentNodePath.split('@')[0]) === 0 &&\n                    (node.contextPath === currentDocumentNodePath || !documentSubNodeTypes.includes(node.nodeType))\n            })\n\n            assistantService.sendMessageToIframe({\n                version: '1.0',\n                eventName: requiredChangedEvent ? 'page-changed' : 'page-updated',\n                data: {\n                    'url': previewUrl,\n                    'title': currentDocumentNode?.properties?.title || contentService.getGuestFrameDocumentTitle(),\n                    'content': contentService.getGuestFrameDocumentHtml(),\n                    'structuredContent': relevantNodes,\n                    'targetAudience': await contentService.getCurrentDocumentTargetAudience(),\n                    'pageBriefing': await contentService.getCurrentDocumentPageBriefing(),\n                    'focusKeyword': await contentService.getCurrentDocumentFocusKeyword()\n                },\n            })\n            requiredChangedEvent = false;\n        });\n    }\n\n    const sagasRegistry = globalRegistry.get('sagas')\n    sagasRegistry.set('NEOSidekick.AiAssistant/watchDocumentNodeChange', {saga: watchDocumentNodeChange})\n    sagasRegistry.set('NEOSidekick.AiAssistant/watchNodeCreated', {saga: createWatchNodeCreatedSaga(globalRegistry, store)})\n    sagasRegistry.set('NEOSidekick.AiAssistant/watchNodeRemoved', {saga: createWatchNodeRemovedSaga(globalRegistry, store)})\n\n    // Register editors with generate button\n    editorsRegistry.set('NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor', {\n        component: MagicTextFieldEditor\n    });\n    editorsRegistry.set('NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor', {\n        component: MagicTextAreaEditor\n    });\n\n    // Regenerate Button in Secondary Toolbar\n    const ckEditorRegistry = globalRegistry.get('ckEditor5');\n    const richtextToolbar = ckEditorRegistry.get('richtextToolbar');\n    richtextToolbar.set('NEOSidekick.AiAssistant:generate', {\n        component: RegenerateButton,\n        isVisible: () => {\n            return true\n        },\n    }, 'end');\n});\n", "import React, {Component} from 'react';\nimport {connect} from 'react-redux';\nimport PropTypes from 'prop-types';\nimport {neos} from '@neos-project/neos-ui-decorators';\nimport {Button, Icon, TextInput} from '@neos-project/react-ui-components';\nimport {actions, selectors} from '@neos-project/neos-ui-redux-store';\n\nconst defaultOptions = {\n    autoFocus: false,\n    disabled: false,\n    maxlength: null,\n    readonly: false\n};\n\n@neos(globalRegistry => ({\n    i18nRegistry: globalRegistry.get('i18n'),\n    externalService: globalRegistry.get('NEOSidekick.AiAssistant').get('externalService'),\n    contentService: globalRegistry.get('NEOSidekick.AiAssistant').get('contentService'),\n    frontendConfiguration: globalRegistry.get('NEOSidekick.AiAssistant').get('configuration')\n}))\n@connect(state => {\n    return state => {\n        const activeContentDimensions = selectors.CR.ContentDimensions.active(state);\n        const node = selectors.CR.Nodes.focusedSelector(state);\n        const parentNode = selectors.CR.Nodes.nodeByContextPath(state)(node.parent);\n        return {activeContentDimensions, node, parentNode}\n    }\n}, {\n    addFlashMessage: actions.UI.FlashMessages.add\n})\nexport default class MagicTextFieldEditor extends Component<any, any> {\n    constructor(props) {\n        super(props);\n    }\n\n    static propTypes = {\n        className: PropTypes.string,\n        value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n        commit: PropTypes.func.isRequired,\n        options: PropTypes.object,\n        onKeyPress: PropTypes.func,\n        onEnterKey: PropTypes.func,\n        id: PropTypes.string,\n\n        activeContentDimensions: PropTypes.object.isRequired,\n        node: PropTypes.object,\n        parentNode: PropTypes.object,\n\n        i18nRegistry: PropTypes.object.isRequired,\n        externalService: PropTypes.object.isRequired,\n        contentService: PropTypes.object.isRequired,\n        addFlashMessage: PropTypes.func.isRequired,\n        frontendConfiguration: PropTypes.object\n    };\n\n    static defaultProps = {\n        options: {}\n    };\n\n    state = {\n        loading: false\n    }\n\n    getIcon = (loading) => {\n        if (loading) {\n            return <Icon icon=\"spinner\" size=\"\" fixedWidth padded=\"right\" spin={true} />\n        } else {\n            return <Icon icon=\"magic\" size=\"\" fixedWidth padded=\"right\" />\n        }\n    }\n\n    fetch = async (module: string, userInput: object) => {\n        const {\n            commit,\n            externalService,\n            contentService,\n            activeContentDimensions,\n            addFlashMessage,\n            i18nRegistry,\n            node,\n            parentNode,\n            frontendConfiguration\n        } = this.props;\n        this.setState({loading: true});\n        try {\n            // Process SidekickClientEval und ClientEval\n            userInput = await contentService.processObjectWithClientEval(Object.assign({}, userInput), node, parentNode)\n            // Map to external format\n            userInput = Object.keys(userInput).map((identifier: string) => ({\"identifier\": identifier, \"value\": userInput[identifier]}))\n            const generatedValue = await externalService.generate(module, activeContentDimensions.language ? activeContentDimensions.language[0] : frontendConfiguration.defaultLanguage, userInput)\n            commit(generatedValue)\n        } catch (e) {\n            addFlashMessage(e?.code ?? e?.message, e?.code ? i18nRegistry.translate('NEOSidekick.AiAssistant:Error:' + e.code, e.message, {0: e.externalMessage}) : e.message, e?.severity ?? 'error')\n        } finally {\n            this.setState({loading: false});\n        }\n    }\n\n    render () {\n        const {\n            id,\n            value,\n            className,\n            commit,\n            options,\n            i18nRegistry,\n            onKeyPress,\n            onEnterKey\n        } = this.props;\n\n        const finalOptions = Object.assign({}, defaultOptions, options);\n        // Placeholder text must be unescaped in case html entities were used\n        const placeholder = options && options.placeholder && i18nRegistry.translate(unescape(options.placeholder));\n        const showGenerateButton = !(\n            finalOptions.readonly || finalOptions.disabled\n        );\n\n        return (\n            <div style={{display: 'flex', flexDirection: 'column'}} className={className}>\n                <div>\n                    <TextInput\n                        id={id}\n                        value={value}\n                        onChange={commit}\n                        disabled={finalOptions.disabled || this.state.loading}\n                        maxLength={finalOptions.maxlength}\n                        readOnly={finalOptions.readonly}\n                        placeholder={placeholder}\n                        onKeyPress={onKeyPress}\n                        onEnterKey={onEnterKey}\n                    />\n                </div>\n                {showGenerateButton ? (\n                    <div style={{'margin-top': '4px'}}>\n                        <Button\n                            className=\"generateBtn\"\n                            size=\"regular\"\n                            icon={this.state.loading ? 'hourglass' : 'magic'}\n                            style=\"neutral\"\n                            hoverStyle=\"clean\"\n                            disabled={this.state.loading}\n                            onClick={async () => await this.fetch(finalOptions.module, finalOptions.arguments ?? {})}\n                        >\n                            {i18nRegistry.translate('NEOSidekick.AiAssistant:Main:generateWithSidekick')}&nbsp;\n                            {this.getIcon(this.state.loading)}\n                        </Button>\n                    </div>\n                ) : null}\n            </div>\n        );\n    }\n}\n", "import React, {Component} from 'react';\nimport {connect} from 'react-redux';\nimport PropTypes from 'prop-types';\nimport {neos} from '@neos-project/neos-ui-decorators';\nimport {Button, Icon, TextArea} from '@neos-project/react-ui-components';\nimport {actions, selectors} from '@neos-project/neos-ui-redux-store';\n\nconst defaultOptions = {\n    autoFocus: false,\n    disabled: false,\n    maxlength: null,\n    readonly: false\n};\n\n@neos(globalRegistry => ({\n    i18nRegistry: globalRegistry.get('i18n'),\n    externalService: globalRegistry.get('NEOSidekick.AiAssistant').get('externalService'),\n    contentService: globalRegistry.get('NEOSidekick.AiAssistant').get('contentService'),\n    frontendConfiguration: globalRegistry.get('NEOSidekick.AiAssistant').get('configuration')\n}))\n@connect(state => {\n    return state => {\n        const activeContentDimensions = selectors.CR.ContentDimensions.active(state);\n        const node = selectors.CR.Nodes.focusedSelector(state);\n        const parentNode = selectors.CR.Nodes.nodeByContextPath(state)(node.parent);\n        return {activeContentDimensions, node, parentNode}\n    }\n}, {\n    addFlashMessage: actions.UI.FlashMessages.add\n})\nexport default class MagicTextAreaEditor extends Component<any, any> {\n    constructor(props) {\n        super(props);\n        this.state = {loading: false}\n    }\n    static propTypes = {\n        className: PropTypes.string,\n        value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n        commit: PropTypes.func.isRequired,\n        options: PropTypes.object,\n        onKeyPress: PropTypes.func,\n        onEnterKey: PropTypes.func,\n        id: PropTypes.string,\n\n        activeContentDimensions: PropTypes.object.isRequired,\n        node: PropTypes.object,\n        parentNode: PropTypes.object,\n\n        i18nRegistry: PropTypes.object.isRequired,\n        externalService: PropTypes.object.isRequired,\n        contentService: PropTypes.object.isRequired,\n        addFlashMessage: PropTypes.func.isRequired,\n        frontendConfiguration: PropTypes.object\n    };\n\n    static defaultProps = {\n        options: {}\n    };\n\n    getIcon = (loading) => {\n        if (loading) {\n            return <Icon icon=\"spinner\" size=\"\" fixedWidth padded=\"right\" spin={true} />\n        } else {\n            return <Icon icon=\"magic\" size=\"\" fixedWidth padded=\"right\" />\n        }\n    }\n\n    fetch = async (module: string, userInput: object) => {\n        const {\n            commit,\n            externalService,\n            contentService,\n            activeContentDimensions,\n            addFlashMessage,\n            i18nRegistry,\n            node,\n            parentNode,\n            frontendConfiguration\n        } = this.props;\n        this.setState({loading: true});\n        try {\n            // Process SidekickClientEval und ClientEval\n            userInput = await contentService.processObjectWithClientEval(Object.assign({}, userInput), node, parentNode)\n            // Map to external format\n            userInput = Object.keys(userInput).map((identifier: string) => ({\"identifier\": identifier, \"value\": userInput[identifier]}))\n            const generatedValue = await externalService.generate(module, activeContentDimensions.language ? activeContentDimensions.language[0] : frontendConfiguration.defaultLanguage, userInput)\n            commit(generatedValue)\n        } catch (e) {\n            addFlashMessage(e?.code ?? e?.message, e?.code ? i18nRegistry.translate('NEOSidekick.AiAssistant:Error:' + e.code, e.message, {0: e.externalMessage}) : e.message, e?.severity ?? 'error')\n        } finally {\n            this.setState({loading: false});\n        }\n    }\n\n    render () {\n        const {\n            id,\n            value,\n            className,\n            commit,\n            options,\n            i18nRegistry,\n            onKeyPress,\n            onEnterKey\n        } = this.props;\n\n        const finalOptions = Object.assign({}, defaultOptions, options);\n        // Placeholder text must be unescaped in case html entities were used\n        const placeholder = options && options.placeholder && i18nRegistry.translate(unescape(options.placeholder));\n        const showGenerateButton = !(\n            finalOptions.readonly || finalOptions.disabled\n        );\n\n        return (\n            <div style={{display: 'flex', flexDirection: 'column'}} className={className}>\n                <div>\n                    <TextArea\n                        id={id}\n                        value={value}\n                        onChange={commit}\n                        disabled={finalOptions.disabled || this.state.loading}\n                        maxLength={finalOptions.maxlength}\n                        readOnly={finalOptions.readonly}\n                        placeholder={placeholder}\n                        minRows={finalOptions.minRows}\n                        expandedRows={finalOptions.expandedRows}\n                        onKeyPress={onKeyPress}\n                        onEnterKey={onEnterKey}\n                    />\n                </div>\n                {showGenerateButton ? (\n                    <div>\n                        <Button\n                            className=\"generateBtn\"\n                            size=\"regular\"\n                            icon={this.state.loading ? 'hourglass' : 'magic'}\n                            style=\"neutral\"\n                            hoverStyle=\"clean\"\n                            disabled={this.state.loading}\n                            onClick={async () => await this.fetch(finalOptions.module, finalOptions.arguments ?? {})}\n                        >\n                            {i18nRegistry.translate('NEOSidekick.AiAssistant:Main:generateWithSidekick')}&nbsp;\n                            {this.getIcon(this.state.loading)}\n                        </Button>\n                    </div>\n                ) : null}\n            </div>\n        );\n    }\n}\n", "export default class AiAssistantError extends Error {\n    public readonly code: string\n    public readonly severity: string = 'error'\n    public readonly externalMessage: string\n    constructor(message: string, code: string, externalMessage: string) {\n        super(message)\n        this.code = code\n        this.externalMessage = externalMessage\n    }\n}\n", "import AiAssistantError from \"./AiAssistantError\";\nexport const createExternalService = (frontendConfiguration): ExternalService => {\n    const configuration = frontendConfiguration['NEOSidekick.AiAssistant'];\n    return new ExternalService(configuration['apiDomain'], configuration['apiKey'])\n}\n\nexport class ExternalService {\n    private readonly apiDomain: string = ''\n    private readonly apiKey: string = ''\n\n    constructor(apiDomain: string, apiKey: string) {\n        this.apiDomain = apiDomain\n        this.apiKey = apiKey\n    }\n\n    hasApiKey = () => {\n        return this.apiKey !== null && this.apiKey !== ''\n    }\n\n    generate = async (module: string, language: string, user_input: object = {}) => {\n        if (!this.apiKey) {\n            throw new AiAssistantError('This feature is not available in the free version.', '1688157373215')\n        }\n\n        const response = await fetch(`${this.apiDomain}/api/v1/chat?language=${language}`, {\n            method: \"POST\", // or 'PUT'\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": `Bearer ${this.apiKey}`,\n                \"Accept\": \"application/json\"\n            },\n            body: JSON.stringify({\n                module,\n                platform: \"neos\",\n                user_input\n            })\n        });\n\n        const jsonData = await response.json()\n\n        if (response.status === 401) {\n            throw new AiAssistantError('The NEOSidekick api key provided is not valid.', '1688158193038')\n        } else if (response.status < 200 || response.status >= 400) {\n            throw new AiAssistantError('An error occurred while asking NEOSidekick.', '1688158257149', jsonData?.message)\n        }\n\n        let message = jsonData?.data?.message?.message\n        // Truncate obsolete quotation marks\n        if(message.startsWith('\"') && message.endsWith('\"')) {\n            message = message.substr(1, message.length-2);\n        }\n        return message\n    }\n}\n", null, "import {SynchronousMetaRegistry} from \"@neos-project/neos-ui-extensibility\";\nimport {Node, NodeType} from '@neos-project/neos-ts-interfaces';\nimport {Store} from 'react-redux'\nimport backend from '@neos-project/neos-ui-backend-connector';\nimport AiAssistantError from './AiAssistantError'\nimport {actions, selectors} from '@neos-project/neos-ui-redux-store';\nimport {produce} from 'immer';\nimport mapValues from 'lodash.mapvalues';\n\nexport const createContentService = (globalRegistry: SynchronousMetaRegistry<any>, store: Store): ContentService => {\n    return new ContentService(globalRegistry, store)\n}\n\nexport class ContentService {\n    private globalRegistry: SynchronousMetaRegistry<any>;\n    private store: Store;\n    public nodeTypesRegistry;\n    public externalService;\n\n\n    constructor(globalRegistry: SynchronousMetaRegistry<any>, store: Store) {\n        this.globalRegistry = globalRegistry\n        this.store = store\n        this.nodeTypesRegistry = globalRegistry.get('@neos-project/neos-ui-contentrepository')\n        this.externalService = globalRegistry.get('NEOSidekick.AiAssistant').get('externalService')\n    }\n\n    getGuestFrameDocumentTitle = (): string => {\n        const guestFrame = document.getElementsByName('neos-content-main')[0];\n        // @ts-ignore\n        const guestFrameDocument = guestFrame?.contentDocument;\n        return guestFrameDocument?.title\n    }\n\n    getGuestFrameDocumentHtml = (): string => {\n        const guestFrame = document.getElementsByName('neos-content-main')[0];\n        // @ts-ignore\n        const guestFrameDocument = guestFrame?.contentDocument;\n        return guestFrameDocument?.body?.innerHTML;\n    }\n\n    getCurrentDocumentNode = (): Node => {\n        const state = this.store.getState()\n        const currentDocumentNodePath = state?.cr?.nodes?.documentNode\n        return state?.cr?.nodes?.byContextPath[currentDocumentNodePath]\n    }\n\n    getCurrentDocumentParentNode = (): Node => {\n        const state = this.store.getState()\n        const currentDocumentNode = this.getCurrentDocumentNode()\n        return state?.cr?.nodes?.byContextPath[currentDocumentNode.parent]\n    }\n\n    getCurrentDocumentNodeType = (): NodeType => {\n        const currentDocumentNode = this.getCurrentDocumentNode()\n        return this.globalRegistry.get('@neos-project/neos-ui-contentrepository').get(currentDocumentNode?.nodeType)\n    }\n\n    getCurrentDocumentTargetAudience = async (): string => {\n        const targetAudience = this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience\n        if (targetAudience) {\n            return await this.processClientEval(targetAudience)\n        }\n        return null\n    }\n\n    getCurrentDocumentPageBriefing = async (): string => {\n        const pageBriefing = this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing\n        if (pageBriefing) {\n            return await this.processClientEval(pageBriefing)\n        }\n        return null\n    }\n\n    getCurrentDocumentFocusKeyword = async (): string => {\n        const focusKeyword = this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword\n        if (focusKeyword) {\n            return await this.processClientEval(focusKeyword)\n        }\n\n        return null\n    }\n\n    processClientEval = async (value: string, node: Node = null, parentNode: Node = null): string => {\n        if (typeof value === 'string' && (value.startsWith('SidekickClientEval:') || value.startsWith('ClientEval:'))) {\n            try {\n                node = node ?? this.getCurrentDocumentNode()\n\n                const transientValues = selectors.UI.Inspector.transientValues(this.store.getState())\n                node = this.generateNodeForContext(node, transientValues)\n\n                parentNode = parentNode ?? this.getCurrentDocumentParentNode()\n                const documentTitle = this.getGuestFrameDocumentTitle()\n                const documentContent = this.getGuestFrameDocumentHtml()\n                // Functions\n                const AssetUri = await this.getImageMetadata\n                const AsyncFunction = Object.getPrototypeOf(async function () {\n                }).constructor\n                const evaluateFn = new AsyncFunction('node,parentNode,documentTitle,documentContent,AssetUri', 'return ' + value.replace('SidekickClientEval:', '').replace('ClientEval:', ''));\n                return await evaluateFn(node, parentNode, documentTitle, documentContent, AssetUri)\n            } catch (e) {\n                if (e instanceof AiAssistantError) {\n                    throw e\n                } else {\n                    console.error(e)\n                    throw new AiAssistantError('An error occurred while trying to evaluate \"' + value + '\"', 1694682118365, value)\n                }\n            }\n        }\n        return value;\n    }\n\n    processObjectWithClientEval = async (obj: object, node: Node = null, parentNode: Node = null): object => {\n        await Promise.all(Object.keys(obj).map(async key => {\n            const value: any = obj[key]\n            if (typeof value === 'string') {\n                obj[key] = await this.processClientEval(value, node, parentNode)\n            }\n\n            if (typeof value === 'object' && value !== null) {\n                obj[key] = await this.processObjectWithClientEval(value, node, parentNode)\n            }\n\n            if (Array.isArray(value)) {\n                obj[key] = await Promise.all(value.map(async itemValue => {\n                    return await this.processObjectWithClientEval(itemValue, node, parentNode)\n                }))\n            }\n        }))\n        return obj\n    }\n\n    private getImageMetadata = async (propertyValue: any): string => {\n        if (!propertyValue || !propertyValue?.__identity) {\n            throw new AiAssistantError('The property does not have a valid image.', 1694595562191)\n        }\n\n        // Fetch image object\n        const {loadImageMetadata} = backend.get().endpoints;\n        let imageUri, previewUri\n        try {\n            const image = await loadImageMetadata(propertyValue?.__identity)\n            imageUri = image?.originalImageResourceUri\n            previewUri = image?.previewImageResourceUri\n\n        } catch (e) {\n            throw new AiAssistantError('Could not fetch image object.', 1694595598880)\n        }\n\n        if (!imageUri || imageUri === '') {\n            throw new AiAssistantError('The given image does not have a correct url.', 1694595462402)\n        }\n\n        let imagesArray = []\n        imagesArray.push(this.prependConfiguredDomainToImageUri(imageUri))\n        if (previewUri) {\n            imagesArray.push(this.prependConfiguredDomainToImageUri(previewUri))\n        }\n        return imagesArray\n    }\n\n    private prependConfiguredDomainToImageUri(imageUri) {\n        // Make sure that the imageUri has a domain prepended\n        // Get instance domain from configuration\n        const instanceDomain = this.globalRegistry.get('NEOSidekick.AiAssistant').get('configuration').domain\n        // Remove the scheme and split URL into parts\n        imageUri = imageUri.replace('http://', '').replace('https://').split('/')\n        // Remove the domain\n        imageUri.shift()\n        // Add the domain from configuration\n        imageUri.unshift(instanceDomain)\n        // Re-join the array to an URL and return\n        return imageUri.join('/')\n    }\n\n    public getCurrentlyFocusedNodePathAndProperty () {\n        const state = this.store.getState()\n        const nodeTypesRegistry = this.globalRegistry.get('@neos-project/neos-ui-contentrepository')\n        const nodePath = state?.cr?.nodes?.focused?.contextPaths[0]\n        const node = nodePath ? selectors.CR.Nodes.nodeByContextPath(state)(nodePath) : null\n        return {\n            nodePath,\n            node,\n            property: state?.ui?.contentCanvas?.currentlyEditedPropertyName,\n            nodeType: node ? nodeTypesRegistry.get(node?.nodeType) : null,\n            parentNode: node ? selectors.CR.Nodes.nodesByContextPathSelector(state)[node.parent] : null\n        }\n    }\n\n    public evaluateNodeTypeConfigurationAndStartGeneration(node: Node, propertyName: string, nodeType: NodeType, parentNode: Node = null, isOnCreate = false)\n    {\n        if (!nodeType) {\n            return;\n        }\n\n        if (propertyName[0] === '_') {\n            return;\n        }\n\n        const propertyConfiguration = nodeType.properties[propertyName]\n        try {\n            // Warn about legacy configuration\n            if (propertyConfiguration?.options?.sidekick?.onCreate?.module) {\n                throw new AiAssistantError('Please do not use options.sidekick.onCreate.module anymore. Read the docs to find out about the new configuration.', '1696264259260')\n            }\n\n            if (!propertyConfiguration?.options?.sidekick?.module) {\n                return;\n            }\n\n            if (isOnCreate && propertyConfiguration?.options?.sidekick?.onCreate !== true) {\n                return;\n            }\n\n            if (!propertyConfiguration?.ui?.inlineEditable) {\n                throw new AiAssistantError('You can only generate content on inline editable properties', '1688395273728')\n            }\n\n            if (!this.externalService.hasApiKey()) {\n                throw new AiAssistantError('This feature is not available in the free version.', '1688157373215')\n            }\n        } catch (e) {\n            const i18nRegistry = this.globalRegistry.get('i18n')\n            this.store.dispatch(actions.UI.FlashMessages.add(e?.code ?? e?.message, e?.code ? i18nRegistry.translate('NEOSidekick.AiAssistant:Error:' + e.code) : e?.message, e?.severity ?? 'error'))\n            return;\n        }\n\n        const configuration = JSON.parse(JSON.stringify(propertyConfiguration.options.sidekick))\n        const assistantService = this.globalRegistry.get('NEOSidekick.AiAssistant').get('assistantService')\n        this.processObjectWithClientEval(configuration, node, parentNode)\n            .then(processedData => {\n                const message = {\n                    version: '1.0',\n                    eventName: 'call-module',\n                    data: {\n                        'platform': 'neos',\n                        'target': {\n                            'nodePath': node.contextPath,\n                            'propertyName': propertyName\n                        },\n                        ...processedData\n                    }\n                }\n                assistantService.sendMessageToIframe(message)\n            })\n    }\n\n    private generateNodeForContext(node, transientValues) {\n        if (transientValues) {\n            return produce(node, draft => {\n                const mappedTransientValues = mapValues(transientValues, item => item?.value);\n                draft.properties = Object.assign({}, draft.properties, mappedTransientValues);\n            });\n        }\n\n        return node;\n    }\n}\n", "// Should be no imports here!\n\n/**\n * The sentinel value returned by producers to replace the draft with undefined.\n */\nexport const NOTHING: unique symbol = Symbol.for(\"immer-nothing\")\n\n/**\n * To let Immer treat your class instances as plain immutable objects\n * (albeit with a custom prototype), you must define either an instance property\n * or a static property on each of your custom classes.\n *\n * Otherwise, your class instance will never be drafted, which means it won't be\n * safe to mutate in a produce callback.\n */\nexport const DRAFTABLE: unique symbol = Symbol.for(\"immer-draftable\")\n\nexport const DRAFT_STATE: unique symbol = Symbol.for(\"immer-state\")\n", "export const errors =\n\tprocess.env.NODE_ENV !== \"production\"\n\t\t? [\n\t\t\t\t// All error codes, starting by 0:\n\t\t\t\tfunction(plugin: string) {\n\t\t\t\t\treturn `The plugin for '${plugin}' has not been loaded into Immer. To enable the plugin, import and call \\`enable${plugin}()\\` when initializing your application.`\n\t\t\t\t},\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${thing}'`\n\t\t\t\t},\n\t\t\t\t\"This object has been frozen and should not be mutated\",\n\t\t\t\tfunction(data: any) {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t\"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? \" +\n\t\t\t\t\t\tdata\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t\t\"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.\",\n\t\t\t\t\"Immer forbids circular references\",\n\t\t\t\t\"The first or second argument to `produce` must be a function\",\n\t\t\t\t\"The third argument to `produce` must be a function or undefined\",\n\t\t\t\t\"First argument to `createDraft` must be a plain object, an array, or an immerable object\",\n\t\t\t\t\"First argument to `finishDraft` must be a draft returned by `createDraft`\",\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `'current' expects a draft, got: ${thing}`\n\t\t\t\t},\n\t\t\t\t\"Object.defineProperty() cannot be used on an Immer draft\",\n\t\t\t\t\"Object.setPrototypeOf() cannot be used on an Immer draft\",\n\t\t\t\t\"Immer only supports deleting array indices\",\n\t\t\t\t\"Immer only supports setting array indices and the 'length' property\",\n\t\t\t\tfunction(thing: string) {\n\t\t\t\t\treturn `'original' expects a draft, got: ${thing}`\n\t\t\t\t}\n\t\t\t\t// Note: if more errors are added, the errorOffset in Patches.ts should be increased\n\t\t\t\t// See Patches.ts for additional errors\n\t\t  ]\n\t\t: []\n\nexport function die(error: number, ...args: any[]): never {\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\tconst e = errors[error]\n\t\tconst msg = typeof e === \"function\" ? e.apply(null, args as any) : e\n\t\tthrow new Error(`[Immer] ${msg}`)\n\t}\n\tthrow new Error(\n\t\t`[Immer] minified error nr: ${error}. Full error at: https://bit.ly/3cXEKWf`\n\t)\n}\n", "import {\n\tDRAFT_STATE,\n\tDRAFTABLE,\n\tObjectish,\n\tDrafted,\n\tAnyObject,\n\tAnyMap,\n\tAnySet,\n\tImmerState,\n\tArchType,\n\tdie\n} from \"../internal\"\n\nexport const getPrototypeOf = Object.getPrototypeOf\n\n/** Returns true if the given value is an Immer draft */\n/*#__PURE__*/\nexport function isDraft(value: any): boolean {\n\treturn !!value && !!value[DRAFT_STATE]\n}\n\n/** Returns true if the given value can be drafted by Immer */\n/*#__PURE__*/\nexport function isDraftable(value: any): boolean {\n\tif (!value) return false\n\treturn (\n\t\tisPlainObject(value) ||\n\t\tArray.isArray(value) ||\n\t\t!!value[DRAFTABLE] ||\n\t\t!!value.constructor?.[DRAFTABLE] ||\n\t\tisMap(value) ||\n\t\tisSet(value)\n\t)\n}\n\nconst objectCtorString = Object.prototype.constructor.toString()\n/*#__PURE__*/\nexport function isPlainObject(value: any): boolean {\n\tif (!value || typeof value !== \"object\") return false\n\tconst proto = getPrototypeOf(value)\n\tif (proto === null) {\n\t\treturn true\n\t}\n\tconst Ctor =\n\t\tObject.hasOwnProperty.call(proto, \"constructor\") && proto.constructor\n\n\tif (Ctor === Object) return true\n\n\treturn (\n\t\ttypeof Ctor == \"function\" &&\n\t\tFunction.toString.call(Ctor) === objectCtorString\n\t)\n}\n\n/** Get the underlying object that is represented by the given draft */\n/*#__PURE__*/\nexport function original<T>(value: T): T | undefined\nexport function original(value: Drafted<any>): any {\n\tif (!isDraft(value)) die(15, value)\n\treturn value[DRAFT_STATE].base_\n}\n\nexport function each<T extends Objectish>(\n\tobj: T,\n\titer: (key: string | number, value: any, source: T) => void,\n\tenumerableOnly?: boolean\n): void\nexport function each(obj: any, iter: any) {\n\tif (getArchtype(obj) === ArchType.Object) {\n\t\tObject.entries(obj).forEach(([key, value]) => {\n\t\t\titer(key, value, obj)\n\t\t})\n\t} else {\n\t\tobj.forEach((entry: any, index: any) => iter(index, entry, obj))\n\t}\n}\n\n/*#__PURE__*/\nexport function getArchtype(thing: any): ArchType {\n\tconst state: undefined | ImmerState = thing[DRAFT_STATE]\n\treturn state\n\t\t? state.type_\n\t\t: Array.isArray(thing)\n\t\t? ArchType.Array\n\t\t: isMap(thing)\n\t\t? ArchType.Map\n\t\t: isSet(thing)\n\t\t? ArchType.Set\n\t\t: ArchType.Object\n}\n\n/*#__PURE__*/\nexport function has(thing: any, prop: PropertyKey): boolean {\n\treturn getArchtype(thing) === ArchType.Map\n\t\t? thing.has(prop)\n\t\t: Object.prototype.hasOwnProperty.call(thing, prop)\n}\n\n/*#__PURE__*/\nexport function get(thing: AnyMap | AnyObject, prop: PropertyKey): any {\n\t// @ts-ignore\n\treturn getArchtype(thing) === ArchType.Map ? thing.get(prop) : thing[prop]\n}\n\n/*#__PURE__*/\nexport function set(thing: any, propOrOldValue: PropertyKey, value: any) {\n\tconst t = getArchtype(thing)\n\tif (t === ArchType.Map) thing.set(propOrOldValue, value)\n\telse if (t === ArchType.Set) {\n\t\tthing.add(value)\n\t} else thing[propOrOldValue] = value\n}\n\n/*#__PURE__*/\nexport function is(x: any, y: any): boolean {\n\t// From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n\tif (x === y) {\n\t\treturn x !== 0 || 1 / x === 1 / y\n\t} else {\n\t\treturn x !== x && y !== y\n\t}\n}\n\n/*#__PURE__*/\nexport function isMap(target: any): target is AnyMap {\n\treturn target instanceof Map\n}\n\n/*#__PURE__*/\nexport function isSet(target: any): target is AnySet {\n\treturn target instanceof Set\n}\n/*#__PURE__*/\nexport function latest(state: ImmerState): any {\n\treturn state.copy_ || state.base_\n}\n\n/*#__PURE__*/\nexport function shallowCopy(base: any, strict: boolean) {\n\tif (isMap(base)) {\n\t\treturn new Map(base)\n\t}\n\tif (isSet(base)) {\n\t\treturn new Set(base)\n\t}\n\tif (Array.isArray(base)) return Array.prototype.slice.call(base)\n\n\tif (!strict && isPlainObject(base)) {\n\t\tif (!getPrototypeOf(base)) {\n\t\t\tconst obj = Object.create(null)\n\t\t\treturn Object.assign(obj, base)\n\t\t}\n\t\treturn {...base}\n\t}\n\n\tconst descriptors = Object.getOwnPropertyDescriptors(base)\n\tdelete descriptors[DRAFT_STATE as any]\n\tlet keys = Reflect.ownKeys(descriptors)\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tconst key: any = keys[i]\n\t\tconst desc = descriptors[key]\n\t\tif (desc.writable === false) {\n\t\t\tdesc.writable = true\n\t\t\tdesc.configurable = true\n\t\t}\n\t\t// like object.assign, we will read any _own_, get/set accessors. This helps in dealing\n\t\t// with libraries that trap values, like mobx or vue\n\t\t// unlike object.assign, non-enumerables will be copied as well\n\t\tif (desc.get || desc.set)\n\t\t\tdescriptors[key] = {\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true, // could live with !!desc.set as well here...\n\t\t\t\tenumerable: desc.enumerable,\n\t\t\t\tvalue: base[key]\n\t\t\t}\n\t}\n\treturn Object.create(getPrototypeOf(base), descriptors)\n}\n\n/**\n * Freezes draftable objects. Returns the original object.\n * By default freezes shallowly, but if the second argument is `true` it will freeze recursively.\n *\n * @param obj\n * @param deep\n */\nexport function freeze<T>(obj: T, deep?: boolean): T\nexport function freeze<T>(obj: any, deep: boolean = false): T {\n\tif (isFrozen(obj) || isDraft(obj) || !isDraftable(obj)) return obj\n\tif (getArchtype(obj) > 1 /* Map or Set */) {\n\t\tobj.set = obj.add = obj.clear = obj.delete = dontMutateFrozenCollections as any\n\t}\n\tObject.freeze(obj)\n\tif (deep) each(obj, (_key, value) => freeze(value, true), true)\n\treturn obj\n}\n\nfunction dontMutateFrozenCollections() {\n\tdie(2)\n}\n\nexport function isFrozen(obj: any): boolean {\n\treturn Object.isFrozen(obj)\n}\n", "import {\n\tImmerState,\n\tPatch,\n\tDrafted,\n\tImmerBaseState,\n\tAnyMap,\n\tAnySet,\n\tArchType,\n\tdie\n} from \"../internal\"\n\n/** Plugin utilities */\nconst plugins: {\n\tPatches?: {\n\t\tgeneratePatches_(\n\t\t\tstate: ImmerState,\n\t\t\tbasePath: PatchPath,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tgenerateReplacementPatches_(\n\t\t\tbase: any,\n\t\t\treplacement: any,\n\t\t\tpatches: Patch[],\n\t\t\tinversePatches: Patch[]\n\t\t): void\n\t\tapplyPatches_<T>(draft: T, patches: Patch[]): T\n\t}\n\tMapSet?: {\n\t\tproxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T\n\t\tproxySet_<T extends AnySet>(target: T, parent?: ImmerState): T\n\t}\n} = {}\n\ntype Plugins = typeof plugins\n\nexport function getPlugin<K extends keyof Plugins>(\n\tpluginKey: K\n): Exclude<Plugins[K], undefined> {\n\tconst plugin = plugins[pluginKey]\n\tif (!plugin) {\n\t\tdie(0, pluginKey)\n\t}\n\t// @ts-ignore\n\treturn plugin\n}\n\nexport function loadPlugin<K extends keyof Plugins>(\n\tpluginKey: K,\n\timplementation: Plugins[K]\n): void {\n\tif (!plugins[pluginKey]) plugins[pluginKey] = implementation\n}\n/** Map / Set plugin */\n\nexport interface MapState extends ImmerBaseState {\n\ttype_: ArchType.Map\n\tcopy_: AnyMap | undefined\n\tassigned_: Map<any, boolean> | undefined\n\tbase_: AnyMap\n\trevoked_: boolean\n\tdraft_: Drafted<AnyMap, MapState>\n}\n\nexport interface SetState extends ImmerBaseState {\n\ttype_: ArchType.Set\n\tcopy_: AnySet | undefined\n\tbase_: AnySet\n\tdrafts_: Map<any, Drafted> // maps the original value to the draft value in the new set\n\trevoked_: boolean\n\tdraft_: Drafted<AnySet, SetState>\n}\n\n/** Patches plugin */\n\nexport type PatchPath = (string | number)[]\n", "import {\n\tPatch,\n\tPatchListener,\n\tDrafted,\n\tImmer,\n\tDRAFT_STATE,\n\tImmerState,\n\tArchType,\n\tgetPlugin\n} from \"../internal\"\n\n/** Each scope represents a `produce` call. */\n\nexport interface ImmerScope {\n\tpatches_?: Patch[]\n\tinversePatches_?: Patch[]\n\tcanAutoFreeze_: boolean\n\tdrafts_: any[]\n\tparent_?: ImmerScope\n\tpatchListener_?: PatchListener\n\timmer_: Immer\n\tunfinalizedDrafts_: number\n}\n\nlet currentScope: ImmerScope | undefined\n\nexport function getCurrentScope() {\n\treturn currentScope!\n}\n\nfunction createScope(\n\tparent_: ImmerScope | undefined,\n\timmer_: Immer\n): ImmerScope {\n\treturn {\n\t\tdrafts_: [],\n\t\tparent_,\n\t\timmer_,\n\t\t// Whenever the modified draft contains a draft from another scope, we\n\t\t// need to prevent auto-freezing so the unowned draft can be finalized.\n\t\tcanAutoFreeze_: true,\n\t\tunfinalizedDrafts_: 0\n\t}\n}\n\nexport function usePatchesInScope(\n\tscope: ImmerScope,\n\tpatchListener?: PatchListener\n) {\n\tif (patchListener) {\n\t\tgetPlugin(\"Patches\") // assert we have the plugin\n\t\tscope.patches_ = []\n\t\tscope.inversePatches_ = []\n\t\tscope.patchListener_ = patchListener\n\t}\n}\n\nexport function revokeScope(scope: ImmerScope) {\n\tleaveScope(scope)\n\tscope.drafts_.forEach(revokeDraft)\n\t// @ts-ignore\n\tscope.drafts_ = null\n}\n\nexport function leaveScope(scope: ImmerScope) {\n\tif (scope === currentScope) {\n\t\tcurrentScope = scope.parent_\n\t}\n}\n\nexport function enterScope(immer: Immer) {\n\treturn (currentScope = createScope(currentScope, immer))\n}\n\nfunction revokeDraft(draft: Drafted) {\n\tconst state: ImmerState = draft[DRAFT_STATE]\n\tif (state.type_ === ArchType.Object || state.type_ === ArchType.Array)\n\t\tstate.revoke_()\n\telse state.revoked_ = true\n}\n", "import {\n\tImmerScope,\n\tDRAFT_STATE,\n\tisDraftable,\n\tNOTHING,\n\tPatchPath,\n\teach,\n\thas,\n\tfreeze,\n\tImmerState,\n\tisDraft,\n\tSetState,\n\tset,\n\tArchType,\n\tgetPlugin,\n\tdie,\n\trevokeScope,\n\tisFrozen\n} from \"../internal\"\n\nexport function processResult(result: any, scope: ImmerScope) {\n\tscope.unfinalizedDrafts_ = scope.drafts_.length\n\tconst baseDraft = scope.drafts_![0]\n\tconst isReplaced = result !== undefined && result !== baseDraft\n\tif (isReplaced) {\n\t\tif (baseDraft[DRAFT_STATE].modified_) {\n\t\t\trevokeScope(scope)\n\t\t\tdie(4)\n\t\t}\n\t\tif (isDraftable(result)) {\n\t\t\t// Finalize the result in case it contains (or is) a subset of the draft.\n\t\t\tresult = finalize(scope, result)\n\t\t\tif (!scope.parent_) maybeFreeze(scope, result)\n\t\t}\n\t\tif (scope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(\n\t\t\t\tbaseDraft[DRAFT_STATE].base_,\n\t\t\t\tresult,\n\t\t\t\tscope.patches_,\n\t\t\t\tscope.inversePatches_!\n\t\t\t)\n\t\t}\n\t} else {\n\t\t// Finalize the base draft.\n\t\tresult = finalize(scope, baseDraft, [])\n\t}\n\trevokeScope(scope)\n\tif (scope.patches_) {\n\t\tscope.patchListener_!(scope.patches_, scope.inversePatches_!)\n\t}\n\treturn result !== NOTHING ? result : undefined\n}\n\nfunction finalize(rootScope: ImmerScope, value: any, path?: PatchPath) {\n\t// Don't recurse in tho recursive data structures\n\tif (isFrozen(value)) return value\n\n\tconst state: ImmerState = value[DRAFT_STATE]\n\t// A plain object, might need freezing, might contain drafts\n\tif (!state) {\n\t\teach(\n\t\t\tvalue,\n\t\t\t(key, childValue) =>\n\t\t\t\tfinalizeProperty(rootScope, state, value, key, childValue, path),\n\t\t\ttrue // See #590, don't recurse into non-enumerable of non drafted objects\n\t\t)\n\t\treturn value\n\t}\n\t// Never finalize drafts owned by another scope.\n\tif (state.scope_ !== rootScope) return value\n\t// Unmodified draft, return the (frozen) original\n\tif (!state.modified_) {\n\t\tmaybeFreeze(rootScope, state.base_, true)\n\t\treturn state.base_\n\t}\n\t// Not finalized yet, let's do that now\n\tif (!state.finalized_) {\n\t\tstate.finalized_ = true\n\t\tstate.scope_.unfinalizedDrafts_--\n\t\tconst result = state.copy_\n\t\t// Finalize all children of the copy\n\t\t// For sets we clone before iterating, otherwise we can get in endless loop due to modifying during iteration, see #628\n\t\t// To preserve insertion order in all cases we then clear the set\n\t\t// And we let finalizeProperty know it needs to re-add non-draft children back to the target\n\t\tlet resultEach = result\n\t\tlet isSet = false\n\t\tif (state.type_ === ArchType.Set) {\n\t\t\tresultEach = new Set(result)\n\t\t\tresult.clear()\n\t\t\tisSet = true\n\t\t}\n\t\teach(resultEach, (key, childValue) =>\n\t\t\tfinalizeProperty(rootScope, state, result, key, childValue, path, isSet)\n\t\t)\n\t\t// everything inside is frozen, we can freeze here\n\t\tmaybeFreeze(rootScope, result, false)\n\t\t// first time finalizing, let's create those patches\n\t\tif (path && rootScope.patches_) {\n\t\t\tgetPlugin(\"Patches\").generatePatches_(\n\t\t\t\tstate,\n\t\t\t\tpath,\n\t\t\t\trootScope.patches_,\n\t\t\t\trootScope.inversePatches_!\n\t\t\t)\n\t\t}\n\t}\n\treturn state.copy_\n}\n\nfunction finalizeProperty(\n\trootScope: ImmerScope,\n\tparentState: undefined | ImmerState,\n\ttargetObject: any,\n\tprop: string | number,\n\tchildValue: any,\n\trootPath?: PatchPath,\n\ttargetIsSet?: boolean\n) {\n\tif (process.env.NODE_ENV !== \"production\" && childValue === targetObject)\n\t\tdie(5)\n\tif (isDraft(childValue)) {\n\t\tconst path =\n\t\t\trootPath &&\n\t\t\tparentState &&\n\t\t\tparentState!.type_ !== ArchType.Set && // Set objects are atomic since they have no keys.\n\t\t\t!has((parentState as Exclude<ImmerState, SetState>).assigned_!, prop) // Skip deep patches for assigned keys.\n\t\t\t\t? rootPath!.concat(prop)\n\t\t\t\t: undefined\n\t\t// Drafts owned by `scope` are finalized here.\n\t\tconst res = finalize(rootScope, childValue, path)\n\t\tset(targetObject, prop, res)\n\t\t// Drafts from another scope must prevented to be frozen\n\t\t// if we got a draft back from finalize, we're in a nested produce and shouldn't freeze\n\t\tif (isDraft(res)) {\n\t\t\trootScope.canAutoFreeze_ = false\n\t\t} else return\n\t} else if (targetIsSet) {\n\t\ttargetObject.add(childValue)\n\t}\n\t// Search new objects for unfinalized drafts. Frozen objects should never contain drafts.\n\tif (isDraftable(childValue) && !isFrozen(childValue)) {\n\t\tif (!rootScope.immer_.autoFreeze_ && rootScope.unfinalizedDrafts_ < 1) {\n\t\t\t// optimization: if an object is not a draft, and we don't have to\n\t\t\t// deepfreeze everything, and we are sure that no drafts are left in the remaining object\n\t\t\t// cause we saw and finalized all drafts already; we can stop visiting the rest of the tree.\n\t\t\t// This benefits especially adding large data tree's without further processing.\n\t\t\t// See add-data.js perf test\n\t\t\treturn\n\t\t}\n\t\tfinalize(rootScope, childValue)\n\t\t// immer deep freezes plain objects, so if there is no parent state, we freeze as well\n\t\tif (!parentState || !parentState.scope_.parent_)\n\t\t\tmaybeFreeze(rootScope, childValue)\n\t}\n}\n\nfunction maybeFreeze(scope: ImmerScope, value: any, deep = false) {\n\t// we never freeze for a non-root scope; as it would prevent pruning for drafts inside wrapping objects\n\tif (!scope.parent_ && scope.immer_.autoFreeze_ && scope.canAutoFreeze_) {\n\t\tfreeze(value, deep)\n\t}\n}\n", "import {\n\teach,\n\thas,\n\tis,\n\tisDraftable,\n\tshallowCopy,\n\tlatest,\n\tImmerBaseState,\n\tImmerState,\n\tDrafted,\n\tAnyObject,\n\tAnyArray,\n\tObjectish,\n\tgetCurrentScope,\n\tgetPrototypeOf,\n\tDRAFT_STATE,\n\tdie,\n\tcreateProxy,\n\tArchType,\n\tImmerScope\n} from \"../internal\"\n\ninterface ProxyBaseState extends ImmerBaseState {\n\tassigned_: {\n\t\t[property: string]: boolean\n\t}\n\tparent_?: ImmerState\n\trevoke_(): void\n}\n\nexport interface ProxyObjectState extends ProxyBaseState {\n\ttype_: ArchType.Object\n\tbase_: any\n\tcopy_: any\n\tdraft_: Drafted<AnyObject, ProxyObjectState>\n}\n\nexport interface ProxyArrayState extends ProxyBaseState {\n\ttype_: ArchType.Array\n\tbase_: AnyArray\n\tcopy_: AnyArray | null\n\tdraft_: Drafted<AnyArray, ProxyArrayState>\n}\n\ntype ProxyState = ProxyObjectState | ProxyArrayState\n\n/**\n * Returns a new draft of the `base` object.\n *\n * The second argument is the parent draft-state (used internally).\n */\nexport function createProxyProxy<T extends Objectish>(\n\tbase: T,\n\tparent?: ImmerState\n): Drafted<T, ProxyState> {\n\tconst isArray = Array.isArray(base)\n\tconst state: ProxyState = {\n\t\ttype_: isArray ? ArchType.Array : (ArchType.Object as any),\n\t\t// Track which produce call this is associated with.\n\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t// True for both shallow and deep changes.\n\t\tmodified_: false,\n\t\t// Used during finalization.\n\t\tfinalized_: false,\n\t\t// Track which properties have been assigned (true) or deleted (false).\n\t\tassigned_: {},\n\t\t// The parent draft state.\n\t\tparent_: parent,\n\t\t// The base state.\n\t\tbase_: base,\n\t\t// The base proxy.\n\t\tdraft_: null as any, // set below\n\t\t// The base copy with any updated values.\n\t\tcopy_: null,\n\t\t// Called by the `produce` function.\n\t\trevoke_: null as any,\n\t\tisManual_: false\n\t}\n\n\t// the traps must target something, a bit like the 'real' base.\n\t// but also, we need to be able to determine from the target what the relevant state is\n\t// (to avoid creating traps per instance to capture the state in closure,\n\t// and to avoid creating weird hidden properties as well)\n\t// So the trick is to use 'state' as the actual 'target'! (and make sure we intercept everything)\n\t// Note that in the case of an array, we put the state in an array to have better Reflect defaults ootb\n\tlet target: T = state as any\n\tlet traps: ProxyHandler<object | Array<any>> = objectTraps\n\tif (isArray) {\n\t\ttarget = [state] as any\n\t\ttraps = arrayTraps\n\t}\n\n\tconst {revoke, proxy} = Proxy.revocable(target, traps)\n\tstate.draft_ = proxy as any\n\tstate.revoke_ = revoke\n\treturn proxy as any\n}\n\n/**\n * Object drafts\n */\nexport const objectTraps: ProxyHandler<ProxyState> = {\n\tget(state, prop) {\n\t\tif (prop === DRAFT_STATE) return state\n\n\t\tconst source = latest(state)\n\t\tif (!has(source, prop)) {\n\t\t\t// non-existing or non-own property...\n\t\t\treturn readPropFromProto(state, source, prop)\n\t\t}\n\t\tconst value = source[prop]\n\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\treturn value\n\t\t}\n\t\t// Check for existing draft in modified state.\n\t\t// Assigned values are never drafted. This catches any drafts we created, too.\n\t\tif (value === peek(state.base_, prop)) {\n\t\t\tprepareCopy(state)\n\t\t\treturn (state.copy_![prop as any] = createProxy(value, state))\n\t\t}\n\t\treturn value\n\t},\n\thas(state, prop) {\n\t\treturn prop in latest(state)\n\t},\n\townKeys(state) {\n\t\treturn Reflect.ownKeys(latest(state))\n\t},\n\tset(\n\t\tstate: ProxyObjectState,\n\t\tprop: string /* strictly not, but helps TS */,\n\t\tvalue\n\t) {\n\t\tconst desc = getDescriptorFromProto(latest(state), prop)\n\t\tif (desc?.set) {\n\t\t\t// special case: if this write is captured by a setter, we have\n\t\t\t// to trigger it with the correct context\n\t\t\tdesc.set.call(state.draft_, value)\n\t\t\treturn true\n\t\t}\n\t\tif (!state.modified_) {\n\t\t\t// the last check is because we need to be able to distinguish setting a non-existing to undefined (which is a change)\n\t\t\t// from setting an existing property with value undefined to undefined (which is not a change)\n\t\t\tconst current = peek(latest(state), prop)\n\t\t\t// special case, if we assigning the original value to a draft, we can ignore the assignment\n\t\t\tconst currentState: ProxyObjectState = current?.[DRAFT_STATE]\n\t\t\tif (currentState && currentState.base_ === value) {\n\t\t\t\tstate.copy_![prop] = value\n\t\t\t\tstate.assigned_[prop] = false\n\t\t\t\treturn true\n\t\t\t}\n\t\t\tif (is(value, current) && (value !== undefined || has(state.base_, prop)))\n\t\t\t\treturn true\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t}\n\n\t\tif (\n\t\t\t(state.copy_![prop] === value &&\n\t\t\t\t// special case: handle new props with value 'undefined'\n\t\t\t\t(value !== undefined || prop in state.copy_)) ||\n\t\t\t// special case: NaN\n\t\t\t(Number.isNaN(value) && Number.isNaN(state.copy_![prop]))\n\t\t)\n\t\t\treturn true\n\n\t\t// @ts-ignore\n\t\tstate.copy_![prop] = value\n\t\tstate.assigned_[prop] = true\n\t\treturn true\n\t},\n\tdeleteProperty(state, prop: string) {\n\t\t// The `undefined` check is a fast path for pre-existing keys.\n\t\tif (peek(state.base_, prop) !== undefined || prop in state.base_) {\n\t\t\tstate.assigned_[prop] = false\n\t\t\tprepareCopy(state)\n\t\t\tmarkChanged(state)\n\t\t} else {\n\t\t\t// if an originally not assigned property was deleted\n\t\t\tdelete state.assigned_[prop]\n\t\t}\n\t\tif (state.copy_) {\n\t\t\tdelete state.copy_[prop]\n\t\t}\n\t\treturn true\n\t},\n\t// Note: We never coerce `desc.value` into an Immer draft, because we can't make\n\t// the same guarantee in ES5 mode.\n\tgetOwnPropertyDescriptor(state, prop) {\n\t\tconst owner = latest(state)\n\t\tconst desc = Reflect.getOwnPropertyDescriptor(owner, prop)\n\t\tif (!desc) return desc\n\t\treturn {\n\t\t\twritable: true,\n\t\t\tconfigurable: state.type_ !== ArchType.Array || prop !== \"length\",\n\t\t\tenumerable: desc.enumerable,\n\t\t\tvalue: owner[prop]\n\t\t}\n\t},\n\tdefineProperty() {\n\t\tdie(11)\n\t},\n\tgetPrototypeOf(state) {\n\t\treturn getPrototypeOf(state.base_)\n\t},\n\tsetPrototypeOf() {\n\t\tdie(12)\n\t}\n}\n\n/**\n * Array drafts\n */\n\nconst arrayTraps: ProxyHandler<[ProxyArrayState]> = {}\neach(objectTraps, (key, fn) => {\n\t// @ts-ignore\n\tarrayTraps[key] = function() {\n\t\targuments[0] = arguments[0][0]\n\t\treturn fn.apply(this, arguments)\n\t}\n})\narrayTraps.deleteProperty = function(state, prop) {\n\tif (process.env.NODE_ENV !== \"production\" && isNaN(parseInt(prop as any)))\n\t\tdie(13)\n\t// @ts-ignore\n\treturn arrayTraps.set!.call(this, state, prop, undefined)\n}\narrayTraps.set = function(state, prop, value) {\n\tif (\n\t\tprocess.env.NODE_ENV !== \"production\" &&\n\t\tprop !== \"length\" &&\n\t\tisNaN(parseInt(prop as any))\n\t)\n\t\tdie(14)\n\treturn objectTraps.set!.call(this, state[0], prop, value, state[0])\n}\n\n// Access a property without creating an Immer draft.\nfunction peek(draft: Drafted, prop: PropertyKey) {\n\tconst state = draft[DRAFT_STATE]\n\tconst source = state ? latest(state) : draft\n\treturn source[prop]\n}\n\nfunction readPropFromProto(state: ImmerState, source: any, prop: PropertyKey) {\n\tconst desc = getDescriptorFromProto(source, prop)\n\treturn desc\n\t\t? `value` in desc\n\t\t\t? desc.value\n\t\t\t: // This is a very special case, if the prop is a getter defined by the\n\t\t\t  // prototype, we should invoke it with the draft as context!\n\t\t\t  desc.get?.call(state.draft_)\n\t\t: undefined\n}\n\nfunction getDescriptorFromProto(\n\tsource: any,\n\tprop: PropertyKey\n): PropertyDescriptor | undefined {\n\t// 'in' checks proto!\n\tif (!(prop in source)) return undefined\n\tlet proto = getPrototypeOf(source)\n\twhile (proto) {\n\t\tconst desc = Object.getOwnPropertyDescriptor(proto, prop)\n\t\tif (desc) return desc\n\t\tproto = getPrototypeOf(proto)\n\t}\n\treturn undefined\n}\n\nexport function markChanged(state: ImmerState) {\n\tif (!state.modified_) {\n\t\tstate.modified_ = true\n\t\tif (state.parent_) {\n\t\t\tmarkChanged(state.parent_)\n\t\t}\n\t}\n}\n\nexport function prepareCopy(state: {\n\tbase_: any\n\tcopy_: any\n\tscope_: ImmerScope\n}) {\n\tif (!state.copy_) {\n\t\tstate.copy_ = shallowCopy(\n\t\t\tstate.base_,\n\t\t\tstate.scope_.immer_.useStrictShallowCopy_\n\t\t)\n\t}\n}\n", "import {\n\tIProduceWithPatches,\n\tIProduce,\n\tImmerState,\n\tDrafted,\n\tisDraftable,\n\tprocessResult,\n\tPatch,\n\tObjectish,\n\tDRAFT_STATE,\n\tDraft,\n\tPatchListener,\n\tisDraft,\n\tisMap,\n\tisSet,\n\tcreateProxyProxy,\n\tgetPlugin,\n\tdie,\n\tenterScope,\n\trevokeScope,\n\tleaveScope,\n\tusePatchesInScope,\n\tgetCurrentScope,\n\tNOTHING,\n\tfreeze,\n\tcurrent\n} from \"../internal\"\n\ninterface ProducersFns {\n\tproduce: IProduce\n\tproduceWithPatches: IProduceWithPatches\n}\n\nexport class Immer implements ProducersFns {\n\tautoFreeze_: boolean = true\n\tuseStrictShallowCopy_: boolean = false\n\n\tconstructor(config?: {autoFreeze?: boolean; useStrictShallowCopy?: boolean}) {\n\t\tif (typeof config?.autoFreeze === \"boolean\")\n\t\t\tthis.setAutoFreeze(config!.autoFreeze)\n\t\tif (typeof config?.useStrictShallowCopy === \"boolean\")\n\t\t\tthis.setUseStrictShallowCopy(config!.useStrictShallowCopy)\n\t}\n\n\t/**\n\t * The `produce` function takes a value and a \"recipe function\" (whose\n\t * return value often depends on the base state). The recipe function is\n\t * free to mutate its first argument however it wants. All mutations are\n\t * only ever applied to a __copy__ of the base state.\n\t *\n\t * Pass only a function to create a \"curried producer\" which relieves you\n\t * from passing the recipe function every time.\n\t *\n\t * Only plain objects and arrays are made mutable. All other objects are\n\t * considered uncopyable.\n\t *\n\t * Note: This function is __bound__ to its `Immer` instance.\n\t *\n\t * @param {any} base - the initial state\n\t * @param {Function} recipe - function that receives a proxy of the base state as first argument and which can be freely modified\n\t * @param {Function} patchListener - optional function that will be called with all the patches produced here\n\t * @returns {any} a new state, or the initial state if nothing was modified\n\t */\n\tproduce: IProduce = (base: any, recipe?: any, patchListener?: any) => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\" && typeof recipe !== \"function\") {\n\t\t\tconst defaultBase = recipe\n\t\t\trecipe = base\n\n\t\t\tconst self = this\n\t\t\treturn function curriedProduce(\n\t\t\t\tthis: any,\n\t\t\t\tbase = defaultBase,\n\t\t\t\t...args: any[]\n\t\t\t) {\n\t\t\t\treturn self.produce(base, (draft: Drafted) => recipe.call(this, draft, ...args)) // prettier-ignore\n\t\t\t}\n\t\t}\n\n\t\tif (typeof recipe !== \"function\") die(6)\n\t\tif (patchListener !== undefined && typeof patchListener !== \"function\")\n\t\t\tdie(7)\n\n\t\tlet result\n\n\t\t// Only plain objects, arrays, and \"immerable classes\" are drafted.\n\t\tif (isDraftable(base)) {\n\t\t\tconst scope = enterScope(this)\n\t\t\tconst proxy = createProxy(base, undefined)\n\t\t\tlet hasError = true\n\t\t\ttry {\n\t\t\t\tresult = recipe(proxy)\n\t\t\t\thasError = false\n\t\t\t} finally {\n\t\t\t\t// finally instead of catch + rethrow better preserves original stack\n\t\t\t\tif (hasError) revokeScope(scope)\n\t\t\t\telse leaveScope(scope)\n\t\t\t}\n\t\t\tusePatchesInScope(scope, patchListener)\n\t\t\treturn processResult(result, scope)\n\t\t} else if (!base || typeof base !== \"object\") {\n\t\t\tresult = recipe(base)\n\t\t\tif (result === undefined) result = base\n\t\t\tif (result === NOTHING) result = undefined\n\t\t\tif (this.autoFreeze_) freeze(result, true)\n\t\t\tif (patchListener) {\n\t\t\t\tconst p: Patch[] = []\n\t\t\t\tconst ip: Patch[] = []\n\t\t\t\tgetPlugin(\"Patches\").generateReplacementPatches_(base, result, p, ip)\n\t\t\t\tpatchListener(p, ip)\n\t\t\t}\n\t\t\treturn result\n\t\t} else die(1, base)\n\t}\n\n\tproduceWithPatches: IProduceWithPatches = (base: any, recipe?: any): any => {\n\t\t// curried invocation\n\t\tif (typeof base === \"function\") {\n\t\t\treturn (state: any, ...args: any[]) =>\n\t\t\t\tthis.produceWithPatches(state, (draft: any) => base(draft, ...args))\n\t\t}\n\n\t\tlet patches: Patch[], inversePatches: Patch[]\n\t\tconst result = this.produce(base, recipe, (p: Patch[], ip: Patch[]) => {\n\t\t\tpatches = p\n\t\t\tinversePatches = ip\n\t\t})\n\t\treturn [result, patches!, inversePatches!]\n\t}\n\n\tcreateDraft<T extends Objectish>(base: T): Draft<T> {\n\t\tif (!isDraftable(base)) die(8)\n\t\tif (isDraft(base)) base = current(base)\n\t\tconst scope = enterScope(this)\n\t\tconst proxy = createProxy(base, undefined)\n\t\tproxy[DRAFT_STATE].isManual_ = true\n\t\tleaveScope(scope)\n\t\treturn proxy as any\n\t}\n\n\tfinishDraft<D extends Draft<any>>(\n\t\tdraft: D,\n\t\tpatchListener?: PatchListener\n\t): D extends Draft<infer T> ? T : never {\n\t\tconst state: ImmerState = draft && (draft as any)[DRAFT_STATE]\n\t\tif (!state || !state.isManual_) die(9)\n\t\tconst {scope_: scope} = state\n\t\tusePatchesInScope(scope, patchListener)\n\t\treturn processResult(undefined, scope)\n\t}\n\n\t/**\n\t * Pass true to automatically freeze all copies created by Immer.\n\t *\n\t * By default, auto-freezing is enabled.\n\t */\n\tsetAutoFreeze(value: boolean) {\n\t\tthis.autoFreeze_ = value\n\t}\n\n\t/**\n\t * Pass true to enable strict shallow copy.\n\t *\n\t * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n\t */\n\tsetUseStrictShallowCopy(value: boolean) {\n\t\tthis.useStrictShallowCopy_ = value\n\t}\n\n\tapplyPatches<T extends Objectish>(base: T, patches: Patch[]): T {\n\t\t// If a patch replaces the entire state, take that replacement as base\n\t\t// before applying patches\n\t\tlet i: number\n\t\tfor (i = patches.length - 1; i >= 0; i--) {\n\t\t\tconst patch = patches[i]\n\t\t\tif (patch.path.length === 0 && patch.op === \"replace\") {\n\t\t\t\tbase = patch.value\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\t// If there was a patch that replaced the entire state, start from the\n\t\t// patch after that.\n\t\tif (i > -1) {\n\t\t\tpatches = patches.slice(i + 1)\n\t\t}\n\n\t\tconst applyPatchesImpl = getPlugin(\"Patches\").applyPatches_\n\t\tif (isDraft(base)) {\n\t\t\t// N.B: never hits if some patch a replacement, patches are never drafts\n\t\t\treturn applyPatchesImpl(base, patches)\n\t\t}\n\t\t// Otherwise, produce a copy of the base state.\n\t\treturn this.produce(base, (draft: Drafted) =>\n\t\t\tapplyPatchesImpl(draft, patches)\n\t\t)\n\t}\n}\n\nexport function createProxy<T extends Objectish>(\n\tvalue: T,\n\tparent?: ImmerState\n): Drafted<T, ImmerState> {\n\t// precondition: createProxy should be guarded by isDraftable, so we know we can safely draft\n\tconst draft: Drafted = isMap(value)\n\t\t? getPlugin(\"MapSet\").proxyMap_(value, parent)\n\t\t: isSet(value)\n\t\t? getPlugin(\"MapSet\").proxySet_(value, parent)\n\t\t: createProxyProxy(value, parent)\n\n\tconst scope = parent ? parent.scope_ : getCurrentScope()\n\tscope.drafts_.push(draft)\n\treturn draft\n}\n", "import {\n\tdie,\n\tisDraft,\n\tshallowCopy,\n\teach,\n\tDRAFT_STATE,\n\tset,\n\tImmerState,\n\tisDraftable,\n\tisFrozen\n} from \"../internal\"\n\n/** Takes a snapshot of the current state of a draft and finalizes it (but without freezing). This is a great utility to print the current state during debugging (no Proxies in the way). The output of current can also be safely leaked outside the producer. */\nexport function current<T>(value: T): T\nexport function current(value: any): any {\n\tif (!isDraft(value)) die(10, value)\n\treturn currentImpl(value)\n}\n\nfunction currentImpl(value: any): any {\n\tif (!isDraftable(value) || isFrozen(value)) return value\n\tconst state: ImmerState | undefined = value[DRAFT_STATE]\n\tlet copy: any\n\tif (state) {\n\t\tif (!state.modified_) return state.base_\n\t\t// Optimization: avoid generating new drafts during copying\n\t\tstate.finalized_ = true\n\t\tcopy = shallowCopy(value, state.scope_.immer_.useStrictShallowCopy_)\n\t} else {\n\t\tcopy = shallowCopy(value, true)\n\t}\n\t// recurse\n\teach(copy, (key, childValue) => {\n\t\tset(copy, key, currentImpl(childValue))\n\t})\n\tif (state) {\n\t\tstate.finalized_ = false\n\t}\n\treturn copy\n}\n", "import {immerable} from \"../immer\"\nimport {\n\tImmerState,\n\tPatch,\n\tSetState,\n\tProxyArrayState,\n\tMapState,\n\tProxyObjectState,\n\tPatchPath,\n\tget,\n\teach,\n\thas,\n\tgetArchtype,\n\tgetPrototypeOf,\n\tisSet,\n\tisMap,\n\tloadPlugin,\n\tArchType,\n\tdie,\n\tisDraft,\n\tisDraftable,\n\tNOTHING,\n\terrors\n} from \"../internal\"\n\nexport function enablePatches() {\n\tconst errorOffset = 16\n\tif (process.env.NODE_ENV !== \"production\") {\n\t\terrors.push(\n\t\t\t'Sets cannot have \"replace\" patches.',\n\t\t\tfunction(op: string) {\n\t\t\t\treturn \"Unsupported patch operation: \" + op\n\t\t\t},\n\t\t\tfunction(path: string) {\n\t\t\t\treturn \"Cannot apply patch, path doesn't resolve: \" + path\n\t\t\t},\n\t\t\t\"Patching reserved attributes like __proto__, prototype and constructor is not allowed\"\n\t\t)\n\t}\n\n\tconst REPLACE = \"replace\"\n\tconst ADD = \"add\"\n\tconst REMOVE = \"remove\"\n\n\tfunction generatePatches_(\n\t\tstate: ImmerState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t): void {\n\t\tswitch (state.type_) {\n\t\t\tcase ArchType.Object:\n\t\t\tcase ArchType.Map:\n\t\t\t\treturn generatePatchesFromAssigned(\n\t\t\t\t\tstate,\n\t\t\t\t\tbasePath,\n\t\t\t\t\tpatches,\n\t\t\t\t\tinversePatches\n\t\t\t\t)\n\t\t\tcase ArchType.Array:\n\t\t\t\treturn generateArrayPatches(state, basePath, patches, inversePatches)\n\t\t\tcase ArchType.Set:\n\t\t\t\treturn generateSetPatches(\n\t\t\t\t\t(state as any) as SetState,\n\t\t\t\t\tbasePath,\n\t\t\t\t\tpatches,\n\t\t\t\t\tinversePatches\n\t\t\t\t)\n\t\t}\n\t}\n\n\tfunction generateArrayPatches(\n\t\tstate: ProxyArrayState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tlet {base_, assigned_} = state\n\t\tlet copy_ = state.copy_!\n\n\t\t// Reduce complexity by ensuring `base` is never longer.\n\t\tif (copy_.length < base_.length) {\n\t\t\t// @ts-ignore\n\t\t\t;[base_, copy_] = [copy_, base_]\n\t\t\t;[patches, inversePatches] = [inversePatches, patches]\n\t\t}\n\n\t\t// Process replaced indices.\n\t\tfor (let i = 0; i < base_.length; i++) {\n\t\t\tif (assigned_[i] && copy_[i] !== base_[i]) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: REPLACE,\n\t\t\t\t\tpath,\n\t\t\t\t\t// Need to maybe clone it, as it can in fact be the original value\n\t\t\t\t\t// due to the base/copy inversion at the start of this function\n\t\t\t\t\tvalue: clonePatchValueIfNeeded(copy_[i])\n\t\t\t\t})\n\t\t\t\tinversePatches.push({\n\t\t\t\t\top: REPLACE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue: clonePatchValueIfNeeded(base_[i])\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\t// Process added indices.\n\t\tfor (let i = base_.length; i < copy_.length; i++) {\n\t\t\tconst path = basePath.concat([i])\n\t\t\tpatches.push({\n\t\t\t\top: ADD,\n\t\t\t\tpath,\n\t\t\t\t// Need to maybe clone it, as it can in fact be the original value\n\t\t\t\t// due to the base/copy inversion at the start of this function\n\t\t\t\tvalue: clonePatchValueIfNeeded(copy_[i])\n\t\t\t})\n\t\t}\n\t\tfor (let i = copy_.length - 1; base_.length <= i; --i) {\n\t\t\tconst path = basePath.concat([i])\n\t\t\tinversePatches.push({\n\t\t\t\top: REMOVE,\n\t\t\t\tpath\n\t\t\t})\n\t\t}\n\t}\n\n\t// This is used for both Map objects and normal objects.\n\tfunction generatePatchesFromAssigned(\n\t\tstate: MapState | ProxyObjectState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tconst {base_, copy_} = state\n\t\teach(state.assigned_!, (key, assignedValue) => {\n\t\t\tconst origValue = get(base_, key)\n\t\t\tconst value = get(copy_!, key)\n\t\t\tconst op = !assignedValue ? REMOVE : has(base_, key) ? REPLACE : ADD\n\t\t\tif (origValue === value && op === REPLACE) return\n\t\t\tconst path = basePath.concat(key as any)\n\t\t\tpatches.push(op === REMOVE ? {op, path} : {op, path, value})\n\t\t\tinversePatches.push(\n\t\t\t\top === ADD\n\t\t\t\t\t? {op: REMOVE, path}\n\t\t\t\t\t: op === REMOVE\n\t\t\t\t\t? {op: ADD, path, value: clonePatchValueIfNeeded(origValue)}\n\t\t\t\t\t: {op: REPLACE, path, value: clonePatchValueIfNeeded(origValue)}\n\t\t\t)\n\t\t})\n\t}\n\n\tfunction generateSetPatches(\n\t\tstate: SetState,\n\t\tbasePath: PatchPath,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t) {\n\t\tlet {base_, copy_} = state\n\n\t\tlet i = 0\n\t\tbase_.forEach((value: any) => {\n\t\t\tif (!copy_!.has(value)) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: REMOVE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t\tinversePatches.unshift({\n\t\t\t\t\top: ADD,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t}\n\t\t\ti++\n\t\t})\n\t\ti = 0\n\t\tcopy_!.forEach((value: any) => {\n\t\t\tif (!base_.has(value)) {\n\t\t\t\tconst path = basePath.concat([i])\n\t\t\t\tpatches.push({\n\t\t\t\t\top: ADD,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t\tinversePatches.unshift({\n\t\t\t\t\top: REMOVE,\n\t\t\t\t\tpath,\n\t\t\t\t\tvalue\n\t\t\t\t})\n\t\t\t}\n\t\t\ti++\n\t\t})\n\t}\n\n\tfunction generateReplacementPatches_(\n\t\tbaseValue: any,\n\t\treplacement: any,\n\t\tpatches: Patch[],\n\t\tinversePatches: Patch[]\n\t): void {\n\t\tpatches.push({\n\t\t\top: REPLACE,\n\t\t\tpath: [],\n\t\t\tvalue: replacement === NOTHING ? undefined : replacement\n\t\t})\n\t\tinversePatches.push({\n\t\t\top: REPLACE,\n\t\t\tpath: [],\n\t\t\tvalue: baseValue\n\t\t})\n\t}\n\n\tfunction applyPatches_<T>(draft: T, patches: Patch[]): T {\n\t\tpatches.forEach(patch => {\n\t\t\tconst {path, op} = patch\n\n\t\t\tlet base: any = draft\n\t\t\tfor (let i = 0; i < path.length - 1; i++) {\n\t\t\t\tconst parentType = getArchtype(base)\n\t\t\t\tlet p = path[i]\n\t\t\t\tif (typeof p !== \"string\" && typeof p !== \"number\") {\n\t\t\t\t\tp = \"\" + p\n\t\t\t\t}\n\n\t\t\t\t// See #738, avoid prototype pollution\n\t\t\t\tif (\n\t\t\t\t\t(parentType === ArchType.Object || parentType === ArchType.Array) &&\n\t\t\t\t\t(p === \"__proto__\" || p === \"constructor\")\n\t\t\t\t)\n\t\t\t\t\tdie(errorOffset + 3)\n\t\t\t\tif (typeof base === \"function\" && p === \"prototype\")\n\t\t\t\t\tdie(errorOffset + 3)\n\t\t\t\tbase = get(base, p)\n\t\t\t\tif (typeof base !== \"object\") die(errorOffset + 2, path.join(\"/\"))\n\t\t\t}\n\n\t\t\tconst type = getArchtype(base)\n\t\t\tconst value = deepClonePatchValue(patch.value) // used to clone patch to ensure original patch is not modified, see #411\n\t\t\tconst key = path[path.length - 1]\n\t\t\tswitch (op) {\n\t\t\t\tcase REPLACE:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.set(key, value)\n\t\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\tdie(errorOffset)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// if value is an object, then it's assigned by reference\n\t\t\t\t\t\t\t// in the following add or remove ops, the value field inside the patch will also be modifyed\n\t\t\t\t\t\t\t// so we use value from the cloned patch\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\treturn (base[key] = value)\n\t\t\t\t\t}\n\t\t\t\tcase ADD:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Array:\n\t\t\t\t\t\t\treturn key === \"-\"\n\t\t\t\t\t\t\t\t? base.push(value)\n\t\t\t\t\t\t\t\t: base.splice(key as any, 0, value)\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.set(key, value)\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\treturn base.add(value)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn (base[key] = value)\n\t\t\t\t\t}\n\t\t\t\tcase REMOVE:\n\t\t\t\t\tswitch (type) {\n\t\t\t\t\t\tcase ArchType.Array:\n\t\t\t\t\t\t\treturn base.splice(key as any, 1)\n\t\t\t\t\t\tcase ArchType.Map:\n\t\t\t\t\t\t\treturn base.delete(key)\n\t\t\t\t\t\tcase ArchType.Set:\n\t\t\t\t\t\t\treturn base.delete(patch.value)\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn delete base[key]\n\t\t\t\t\t}\n\t\t\t\tdefault:\n\t\t\t\t\tdie(errorOffset + 1, op)\n\t\t\t}\n\t\t})\n\n\t\treturn draft\n\t}\n\n\t// optimize: this is quite a performance hit, can we detect intelligently when it is needed?\n\t// E.g. auto-draft when new objects from outside are assigned and modified?\n\t// (See failing test when deepClone just returns obj)\n\tfunction deepClonePatchValue<T>(obj: T): T\n\tfunction deepClonePatchValue(obj: any) {\n\t\tif (!isDraftable(obj)) return obj\n\t\tif (Array.isArray(obj)) return obj.map(deepClonePatchValue)\n\t\tif (isMap(obj))\n\t\t\treturn new Map(\n\t\t\t\tArray.from(obj.entries()).map(([k, v]) => [k, deepClonePatchValue(v)])\n\t\t\t)\n\t\tif (isSet(obj)) return new Set(Array.from(obj).map(deepClonePatchValue))\n\t\tconst cloned = Object.create(getPrototypeOf(obj))\n\t\tfor (const key in obj) cloned[key] = deepClonePatchValue(obj[key])\n\t\tif (has(obj, immerable)) cloned[immerable] = obj[immerable]\n\t\treturn cloned\n\t}\n\n\tfunction clonePatchValueIfNeeded<T>(obj: T): T {\n\t\tif (isDraft(obj)) {\n\t\t\treturn deepClonePatchValue(obj)\n\t\t} else return obj\n\t}\n\n\tloadPlugin(\"Patches\", {\n\t\tapplyPatches_,\n\t\tgeneratePatches_,\n\t\tgenerateReplacementPatches_\n\t})\n}\n", "// types only!\nimport {\n\tImmerState,\n\tAnyMap,\n\tAnySet,\n\tMapState,\n\tSetState,\n\tDRAFT_STATE,\n\tgetCurrentScope,\n\tlatest,\n\tisDraftable,\n\tcreateProxy,\n\tloadPlugin,\n\tmarkChanged,\n\tdie,\n\tArchType,\n\teach\n} from \"../internal\"\n\nexport function enableMapSet() {\n\tclass DraftMap extends Map {\n\t\t[DRAFT_STATE]: MapState\n\n\t\tconstructor(target: AnyMap, parent?: ImmerState) {\n\t\t\tsuper()\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ArchType.Map,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tassigned_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this as any,\n\t\t\t\tisManual_: false,\n\t\t\t\trevoked_: false\n\t\t\t}\n\t\t}\n\n\t\tget size(): number {\n\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t}\n\n\t\thas(key: any): boolean {\n\t\t\treturn latest(this[DRAFT_STATE]).has(key)\n\t\t}\n\n\t\tset(key: any, value: any) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (!latest(state).has(key) || latest(state).get(key) !== value) {\n\t\t\t\tprepareMapCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t\tstate.copy_!.set(key, value)\n\t\t\t\tstate.assigned_!.set(key, true)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tdelete(key: any): boolean {\n\t\t\tif (!this.has(key)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareMapCopy(state)\n\t\t\tmarkChanged(state)\n\t\t\tif (state.base_.has(key)) {\n\t\t\t\tstate.assigned_!.set(key, false)\n\t\t\t} else {\n\t\t\t\tstate.assigned_!.delete(key)\n\t\t\t}\n\t\t\tstate.copy_!.delete(key)\n\t\t\treturn true\n\t\t}\n\n\t\tclear() {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (latest(state).size) {\n\t\t\t\tprepareMapCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.assigned_ = new Map()\n\t\t\t\teach(state.base_, key => {\n\t\t\t\t\tstate.assigned_!.set(key, false)\n\t\t\t\t})\n\t\t\t\tstate.copy_!.clear()\n\t\t\t}\n\t\t}\n\n\t\tforEach(cb: (value: any, key: any, self: any) => void, thisArg?: any) {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tlatest(state).forEach((_value: any, key: any, _map: any) => {\n\t\t\t\tcb.call(thisArg, this.get(key), key, this)\n\t\t\t})\n\t\t}\n\n\t\tget(key: any): any {\n\t\t\tconst state: MapState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tconst value = latest(state).get(key)\n\t\t\tif (state.finalized_ || !isDraftable(value)) {\n\t\t\t\treturn value\n\t\t\t}\n\t\t\tif (value !== state.base_.get(key)) {\n\t\t\t\treturn value // either already drafted or reassigned\n\t\t\t}\n\t\t\t// despite what it looks, this creates a draft only once, see above condition\n\t\t\tconst draft = createProxy(value, state)\n\t\t\tprepareMapCopy(state)\n\t\t\tstate.copy_!.set(key, draft)\n\t\t\treturn draft\n\t\t}\n\n\t\tkeys(): IterableIterator<any> {\n\t\t\treturn latest(this[DRAFT_STATE]).keys()\n\t\t}\n\n\t\tvalues(): IterableIterator<any> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[Symbol.iterator]: () => this.values(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\tentries(): IterableIterator<[any, any]> {\n\t\t\tconst iterator = this.keys()\n\t\t\treturn {\n\t\t\t\t[Symbol.iterator]: () => this.entries(),\n\t\t\t\tnext: () => {\n\t\t\t\t\tconst r = iterator.next()\n\t\t\t\t\t/* istanbul ignore next */\n\t\t\t\t\tif (r.done) return r\n\t\t\t\t\tconst value = this.get(r.value)\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdone: false,\n\t\t\t\t\t\tvalue: [r.value, value]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} as any\n\t\t}\n\n\t\t[Symbol.iterator]() {\n\t\t\treturn this.entries()\n\t\t}\n\t}\n\n\tfunction proxyMap_<T extends AnyMap>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftMap(target, parent)\n\t}\n\n\tfunction prepareMapCopy(state: MapState) {\n\t\tif (!state.copy_) {\n\t\t\tstate.assigned_ = new Map()\n\t\t\tstate.copy_ = new Map(state.base_)\n\t\t}\n\t}\n\n\tclass DraftSet extends Set {\n\t\t[DRAFT_STATE]: SetState\n\t\tconstructor(target: AnySet, parent?: ImmerState) {\n\t\t\tsuper()\n\t\t\tthis[DRAFT_STATE] = {\n\t\t\t\ttype_: ArchType.Set,\n\t\t\t\tparent_: parent,\n\t\t\t\tscope_: parent ? parent.scope_ : getCurrentScope()!,\n\t\t\t\tmodified_: false,\n\t\t\t\tfinalized_: false,\n\t\t\t\tcopy_: undefined,\n\t\t\t\tbase_: target,\n\t\t\t\tdraft_: this,\n\t\t\t\tdrafts_: new Map(),\n\t\t\t\trevoked_: false,\n\t\t\t\tisManual_: false\n\t\t\t}\n\t\t}\n\n\t\tget size(): number {\n\t\t\treturn latest(this[DRAFT_STATE]).size\n\t\t}\n\n\t\thas(value: any): boolean {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\t// bit of trickery here, to be able to recognize both the value, and the draft of its value\n\t\t\tif (!state.copy_) {\n\t\t\t\treturn state.base_.has(value)\n\t\t\t}\n\t\t\tif (state.copy_.has(value)) return true\n\t\t\tif (state.drafts_.has(value) && state.copy_.has(state.drafts_.get(value)))\n\t\t\t\treturn true\n\t\t\treturn false\n\t\t}\n\n\t\tadd(value: any): any {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (!this.has(value)) {\n\t\t\t\tprepareSetCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.copy_!.add(value)\n\t\t\t}\n\t\t\treturn this\n\t\t}\n\n\t\tdelete(value: any): any {\n\t\t\tif (!this.has(value)) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\tmarkChanged(state)\n\t\t\treturn (\n\t\t\t\tstate.copy_!.delete(value) ||\n\t\t\t\t(state.drafts_.has(value)\n\t\t\t\t\t? state.copy_!.delete(state.drafts_.get(value))\n\t\t\t\t\t: /* istanbul ignore next */ false)\n\t\t\t)\n\t\t}\n\n\t\tclear() {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tif (latest(state).size) {\n\t\t\t\tprepareSetCopy(state)\n\t\t\t\tmarkChanged(state)\n\t\t\t\tstate.copy_!.clear()\n\t\t\t}\n\t\t}\n\n\t\tvalues(): IterableIterator<any> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.values()\n\t\t}\n\n\t\tentries(): IterableIterator<[any, any]> {\n\t\t\tconst state: SetState = this[DRAFT_STATE]\n\t\t\tassertUnrevoked(state)\n\t\t\tprepareSetCopy(state)\n\t\t\treturn state.copy_!.entries()\n\t\t}\n\n\t\tkeys(): IterableIterator<any> {\n\t\t\treturn this.values()\n\t\t}\n\n\t\t[Symbol.iterator]() {\n\t\t\treturn this.values()\n\t\t}\n\n\t\tforEach(cb: any, thisArg?: any) {\n\t\t\tconst iterator = this.values()\n\t\t\tlet result = iterator.next()\n\t\t\twhile (!result.done) {\n\t\t\t\tcb.call(thisArg, result.value, result.value, this)\n\t\t\t\tresult = iterator.next()\n\t\t\t}\n\t\t}\n\t}\n\tfunction proxySet_<T extends AnySet>(target: T, parent?: ImmerState): T {\n\t\t// @ts-ignore\n\t\treturn new DraftSet(target, parent)\n\t}\n\n\tfunction prepareSetCopy(state: SetState) {\n\t\tif (!state.copy_) {\n\t\t\t// create drafts for all entries to preserve insertion order\n\t\t\tstate.copy_ = new Set()\n\t\t\tstate.base_.forEach(value => {\n\t\t\t\tif (isDraftable(value)) {\n\t\t\t\t\tconst draft = createProxy(value, state)\n\t\t\t\t\tstate.drafts_.set(value, draft)\n\t\t\t\t\tstate.copy_!.add(draft)\n\t\t\t\t} else {\n\t\t\t\t\tstate.copy_!.add(value)\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tfunction assertUnrevoked(state: any /*ES5State | MapState | SetState*/) {\n\t\tif (state.revoked_) die(3, JSON.stringify(latest(state)))\n\t}\n\n\tloadPlugin(\"MapSet\", {proxyMap_, proxySet_})\n}\n", "import {\n\tIProduce,\n\tIProduceWithPatches,\n\tImmer,\n\tDraft,\n\tImmutable\n} from \"./internal\"\n\nexport {\n\tDraft,\n\tImmutable,\n\tPatch,\n\tPatchListener,\n\toriginal,\n\tcurrent,\n\tisDraft,\n\tisDraftable,\n\tNOTHING as nothing,\n\tDRAFTABLE as immerable,\n\tfreeze,\n\tObjectish\n} from \"./internal\"\n\nconst immer = new Immer()\n\n/**\n * The `produce` function takes a value and a \"recipe function\" (whose\n * return value often depends on the base state). The recipe function is\n * free to mutate its first argument however it wants. All mutations are\n * only ever applied to a __copy__ of the base state.\n *\n * Pass only a function to create a \"curried producer\" which relieves you\n * from passing the recipe function every time.\n *\n * Only plain objects and arrays are made mutable. All other objects are\n * considered uncopyable.\n *\n * Note: This function is __bound__ to its `Immer` instance.\n *\n * @param {any} base - the initial state\n * @param {Function} producer - function that receives a proxy of the base state as first argument and which can be freely modified\n * @param {Function} patchListener - optional function that will be called with all the patches produced here\n * @returns {any} a new state, or the initial state if nothing was modified\n */\nexport const produce: IProduce = immer.produce\n\n/**\n * Like `produce`, but `produceWithPatches` always returns a tuple\n * [nextState, patches, inversePatches] (instead of just the next state)\n */\nexport const produceWithPatches: IProduceWithPatches = immer.produceWithPatches.bind(\n\timmer\n)\n\n/**\n * Pass true to automatically freeze all copies created by Immer.\n *\n * Always freeze by default, even in production mode\n */\nexport const setAutoFreeze = immer.setAutoFreeze.bind(immer)\n\n/**\n * Pass true to enable strict shallow copy.\n *\n * By default, immer does not copy the object descriptors such as getter, setter and non-enumrable properties.\n */\nexport const setUseStrictShallowCopy = immer.setUseStrictShallowCopy.bind(immer)\n\n/**\n * Apply an array of Immer patches to the first argument.\n *\n * This function is a producer, which means copy-on-write is in effect.\n */\nexport const applyPatches = immer.applyPatches.bind(immer)\n\n/**\n * Create an Immer draft from the given base state, which may be a draft itself.\n * The draft can be modified until you finalize it with the `finishDraft` function.\n */\nexport const createDraft = immer.createDraft.bind(immer)\n\n/**\n * Finalize an Immer draft from a `createDraft` call, returning the base state\n * (if no changes were made) or a modified copy. The draft must *not* be\n * mutated afterwards.\n *\n * Pass a function as the 2nd argument to generate Immer patches based on the\n * changes that were made.\n */\nexport const finishDraft = immer.finishDraft.bind(immer)\n\n/**\n * This function is actually a no-op, but can be used to cast an immutable type\n * to an draft type and make TypeScript happy\n *\n * @param value\n */\nexport function castDraft<T>(value: T): Draft<T> {\n\treturn value as any\n}\n\n/**\n * This function is actually a no-op, but can be used to cast a mutable type\n * to an immutable type and make TypeScript happy\n * @param value\n */\nexport function castImmutable<T>(value: T): Immutable<T> {\n\treturn value as any\n}\n\nexport {Immer}\n\nexport {enablePatches} from \"./plugins/patches\"\nexport {enableMapSet} from \"./plugins/mapset\"\n", "import {takeEvery} from 'redux-saga/effects';\nimport {actionTypes, selectors} from '@neos-project/neos-ui-redux-store';\nimport {ContentService} from '../ContentService'\nimport {AssistantService} from \"../Service/AssistantService\";\nimport {ExternalService} from \"../ExternalService\";\n\nexport const createWatchNodeCreatedSaga = (globalRegistry, store) => {\n    return function * (){\n        yield takeEvery(actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK, function * (action) {\n            action.payload.feedbackEnvelope.feedbacks.forEach(feedback => {\n                if (feedback.type !== 'Neos.Neos.Ui:NodeCreated') {\n                    return;\n                }\n\n                const createdNodeContextPath = feedback.payload.contextPath\n                const createdNodePath = createdNodeContextPath.split('@')[0]\n\n                // Get nodesByContextPath in store\n                const state = store.getState()\n                const nodesByContextPath = selectors.CR.Nodes.nodesByContextPathSelector(state);\n\n                // Get services\n                const nodeTypesRegistry = globalRegistry.get('@neos-project/neos-ui-contentrepository')\n                const i18nRegistry = globalRegistry.get('i18n')\n                const contentService: ContentService = globalRegistry.get('NEOSidekick.AiAssistant').get('contentService')\n                const assistantService: AssistantService = globalRegistry.get('NEOSidekick.AiAssistant').get('assistantService')\n                const externalService: ExternalService = globalRegistry.get('NEOSidekick.AiAssistant').get('externalService')\n\n                Object.keys(nodesByContextPath).forEach(nodeContextPath => {\n                    const nodePath = nodeContextPath.split('@')[0]\n                    if (!nodePath.startsWith(createdNodePath)) {\n                        return;\n                    }\n\n                    const node = nodesByContextPath[nodeContextPath]\n                    const parentNode = nodesByContextPath[node.parent]\n                    const nodeType = nodeTypesRegistry.get(node.nodeType)\n\n                    Object.keys(nodeType.properties).forEach((propertyName) => {\n                        contentService.evaluateNodeTypeConfigurationAndStartGeneration(node, propertyName, nodeType, parentNode, true)\n                    })\n                })\n            })\n        })\n    }\n}\n", "import {takeEvery} from 'redux-saga/effects';\nimport {actionTypes} from '@neos-project/neos-ui-redux-store';\n\nexport const createWatchNodeRemovedSaga = (globalRegistry, store) => {\n    return function * (){\n        yield takeEvery(actionTypes.CR.Nodes.REMOVE, function * (action) {\n            console.log('Payload: ', action)\n\n            const assistantService = globalRegistry.get('NEOSidekick.AiAssistant').get('assistantService')\n            if (assistantService.currentlyHandledNodePath === action.payload) {\n                assistantService.resetCurrentlyHandledNodePath()\n                const message = {\n                    version: '1.0',\n                    eventName: 'cancel-call-module'\n                }\n                console.log('Message: ', message)\n                assistantService.sendMessageToIframe(message)\n            }\n        })\n    }\n}\n", "import {SynchronousMetaRegistry} from \"@neos-project/neos-ui-extensibility\";\nimport {Store} from 'react-redux'\nimport {actions} from '@neos-project/neos-ui-redux-store'\n\nexport const createAssistantService = (globalRegistry: SynchronousMetaRegistry<any>, store: Store): AssistantService => {\n    return new AssistantService(globalRegistry, store)\n}\n\nexport class AssistantService {\n    private globalRegistry: SynchronousMetaRegistry<any>;\n    private store: Store;\n    public currentlyHandledNodePath: string;\n    constructor(globalRegistry: SynchronousMetaRegistry<any>, store: Store) {\n        this.globalRegistry = globalRegistry\n        this.store = store\n        this.currentlyHandledNodePath = null\n    }\n\n    sendMessageToIframe = (message): void => {\n        // If busy, ignore all page-changed and page-updated events silently\n        if (this.currentlyHandledNodePath && ['page-changed', 'page-updated'].indexOf(message?.eventName) > -1) {\n            return\n        }\n\n        // If busy, disallow further call-module events and show error\n        if (this.currentlyHandledNodePath && ['call-module'].indexOf(message?.eventName) > -1) {\n            this.addFlashMessage('1695668144026', 'You cannot start two text generations at the same time.')\n            return\n        }\n\n        if (message?.eventName === 'call-module') {\n            this.currentlyHandledNodePath = message?.data?.target?.nodePath\n        }\n\n        const checkLoadedStatusAndSendMessage = setInterval(() => {\n            const assistantFrame = document.getElementById('neosidekickAssistant')\n            const isLoaded = assistantFrame.dataset.hasOwnProperty('loaded')\n            if (isLoaded) {\n                console.log('loaded, sending message to frame', message)\n                // @ts-ignore\n                assistantFrame.contentWindow.postMessage(message, '*')\n                clearInterval(checkLoadedStatusAndSendMessage)\n\n                if (message?.eventName === 'call-module') {\n                    // If nothing happens for a while, reset handledNodePath\n                    this.resetCurrentlyHandledNodePathDebounced()\n                }\n            } else {\n                console.log('not loaded, waiting...')\n                return\n            }\n        }, 250)\n    }\n\n    listenToMessages = (): void => {\n        const checkLoadedStatusAndSendMessage = setInterval(() => {\n            const assistantFrame = document.getElementById('neosidekickAssistant')\n            const isLoaded = assistantFrame?.dataset?.hasOwnProperty('loaded')\n            if (isLoaded) {\n                window.addEventListener('message', message => {\n                    const iframe = assistantFrame.contentWindow\n                    if (message.source === iframe) {\n                        console.log(message)\n                        this.handleMessage(message)\n                    }\n                });\n                clearInterval(checkLoadedStatusAndSendMessage)\n            } else {\n                return\n            }\n        }, 250)\n    }\n\n    private handleMessage = (message): void => {\n        console.info('Handle Sidekick Message: ' + message.data.eventName)\n        if (message?.data?.eventName === 'write-content') {\n            const {nodePath, propertyName, value, isFinished} = message.data.data;\n            // Make sure the handledNodePath is set while we alter the content\n            this.currentlyHandledNodePath = nodePath\n            this.changePropertyValue(nodePath, propertyName, value, isFinished)\n        } else if (message?.data?.eventName === 'stopped-generation') {\n            this.resetTypingCaret()\n            this.resetCurrentlyHandledNodePath()\n        } else if (message?.data?.eventName === 'error') {\n            const errorMessage = message?.data?.data?.message;\n            this.addFlashMessage('1688158257149', 'An error occurred while asking NEOSidekick: ' + errorMessage, 'error', errorMessage)\n            this.resetTypingCaret()\n            this.resetCurrentlyHandledNodePath()\n        }\n        // Make sure that the handledNodePath is reset eventually\n        this.resetCurrentlyHandledNodePathDebounced()\n    }\n\n    private resetTypingCaret() {\n        const guestFrame = document.getElementsByName('neos-content-main')[0];\n        // @ts-ignore\n        const guestFrameDocument = guestFrame?.contentDocument;\n        const inlineFieldWithTypingCaret = guestFrameDocument.querySelector(`.typing-caret`)\n        if (inlineFieldWithTypingCaret) {\n            inlineFieldWithTypingCaret.classList.remove('typing-caret')\n        }\n    }\n\n    private changePropertyValue = (nodePath: string, propertyName: string, propertyValue: string, isFinished: bool = false): void => {\n        const guestFrame = document.getElementsByName('neos-content-main')[0];\n        // @ts-ignore\n        const guestFrameDocument = guestFrame?.contentDocument;\n        const inlineField = guestFrameDocument.querySelector(`[data-__neos-editable-node-contextpath=\"${nodePath}\"][data-__neos-property=\"${propertyName}\"]`)\n        if (!inlineField) {\n            this.resetCurrentlyHandledNodePath()\n            return;\n        }\n        // Check if node is still present\n        const state = this.store.getState()\n        if (!state?.cr?.nodes?.byContextPath.hasOwnProperty(nodePath)) {\n            inlineField.classList.remove('typing-caret')\n            this.resetCurrentlyHandledNodePath()\n            return;\n        }\n        // @ts-ignore\n        inlineField?.ckeditorInstance?.setData(propertyValue)\n        inlineField?.classList.toggle('typing-caret', !isFinished)\n\n        if (isFinished) {\n            this.resetCurrentlyHandledNodePath()\n        }\n    }\n\n    public resetCurrentlyHandledNodePath(): void\n    {\n        this.currentlyHandledNodePath = null\n    }\n\n    public resetCurrentlyHandledNodePathDebounced(): void\n    {\n        let timer, timeout = 1000\n        return () => {\n            clearTimeout(timer)\n            timer = setTimeout(() => {\n                this.currentlyHandledNodePath = null\n            }, timeout)\n        }\n    }\n\n    private addFlashMessage(code: string, message: string, severity: string = 'error', externalMessage: string = null): void {\n        const i18nRegistry = this.globalRegistry.get('i18n')\n        this.store.dispatch(actions.UI.FlashMessages.add(code, i18nRegistry.translate('NEOSidekick.AiAssistant:Error:' + code, message, {0: externalMessage}), severity))\n    }\n}\n", "import React, {PureComponent} from 'react';\nimport PropTypes from 'prop-types';\nimport {Button, Icon} from '@neos-project/react-ui-components';\nimport {neos} from '@neos-project/neos-ui-decorators';\n\n@neos(globalRegistry => ({\n    contentService: globalRegistry.get('NEOSidekick.AiAssistant').get('contentService'),\n    i18nRegistry: globalRegistry.get('i18n'),\n}))\nexport default class RegenerateButton extends PureComponent {\n    static propTypes = {\n        contentService: PropTypes.object.isRequired,\n        i18nRegistry: PropTypes.object.isRequired,\n    };\n\n    state = {\n        show: false,\n        enabled: true\n    }\n\n    constructor(props) {\n        super(props);\n    }\n\n    componentDidMount() {\n        this.evaluateFocusedNodeAndPropertyAndShowButton()\n    }\n\n    private evaluateFocusedNodeAndPropertyAndShowButton = (retries = 5) => {\n        const {nodeType, property} = this.props.contentService.getCurrentlyFocusedNodePathAndProperty()\n        if (!nodeType || !property) {\n            if (retries === 0) {\n                return;\n            }\n\n            setTimeout(() => this.evaluateFocusedNodeAndPropertyAndShowButton(retries - 1), 100);\n            return;\n        }\n\n        const propertyConfiguration = nodeType.properties[property];\n        this.setState({show: propertyConfiguration?.ui?.inlineEditable === true && propertyConfiguration?.options?.sidekick?.module !== undefined})\n    }\n\n    onClick = () => {\n        // Disable button\n        this.setState({enabled: false})\n        const {node, nodeType, parentNode, property} = this.props.contentService.getCurrentlyFocusedNodePathAndProperty()\n        this.props.contentService.evaluateNodeTypeConfigurationAndStartGeneration(node, property, nodeType, parentNode)\n\n        // Renable button after 2500ms\n        setTimeout(() => {\n            this.setState({enabled: true})\n        }, 2500)\n    }\n\n    render() {\n        const {\n            i18nRegistry\n        } = this.props;\n\n        return (this.state.show ? <Button disabled={!this.state.enabled} style=\"transparent\" hoverStyle=\"brand\" onClick={this.onClick} isActive={Boolean(this.props.isActive)} title={i18nRegistry.translate('NEOSidekick.AiAssistant:Main:generate')}>\n            <Icon icon=\"magic\" size=\"\" fixedWidth padded=\"right\" />\n            {i18nRegistry.translate('NEOSidekick.AiAssistant:Main:generate')}\n        </Button> : '');\n    }\n}\n"],
  "mappings": "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",
  "names": ["readFromConsumerApi", "key", "args", "init_readFromConsumerApi", "__esmMin", "require_react_ui_components", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_neos_ui_redux_store", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_react", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_react_redux", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_redux_saga_effects", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_prop_types", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_neos_ui_decorators", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_lodash", "__commonJSMin", "exports", "module", "LARGE_ARRAY_SIZE", "FUNC_ERROR_TEXT", "HASH_UNDEFINED", "UNORDERED_COMPARE_FLAG", "PARTIAL_COMPARE_FLAG", "INFINITY", "MAX_SAFE_INTEGER", "argsTag", "arrayTag", "boolTag", "dateTag", "errorTag", "funcTag", "genTag", "mapTag", "numberTag", "objectTag", "promiseTag", "regexpTag", "setTag", "stringTag", "symbolTag", "weakMapTag", "arrayBufferTag", "dataViewTag", "float32Tag", "float64Tag", "int8Tag", "int16Tag", "int32Tag", "uint8Tag", "uint8ClampedTag", "uint16Tag", "uint32Tag", "reIsDeepProp", "reIsPlainProp", "reLeadingDot", "rePropName", "reRegExpChar", "reEscapeChar", "reIsHostCtor", "reIsUint", "typedArrayTags", "freeGlobal", "freeSelf", "root", "freeExports", "freeModule", "moduleExports", "freeProcess", "nodeUtil", "nodeIsTypedArray", "arraySome", "array", "predicate", "index", "length", "baseProperty", "key", "object", "baseTimes", "n", "iteratee", "result", "baseUnary", "func", "value", "getValue", "isHostObject", "mapToArray", "map", "overArg", "transform", "arg", "setToArray", "set", "arrayProto", "funcProto", "objectProto", "coreJsData", "maskSrcKey", "uid", "funcToString", "hasOwnProperty", "objectToString", "reIsNative", "Symbol", "Uint8Array", "propertyIsEnumerable", "splice", "nativeKeys", "DataView", "getNative", "Map", "Promise", "Set", "WeakMap", "nativeCreate", "dataViewCtorString", "toSource", "mapCtorString", "promiseCtorString", "setCtorString", "weakMapCtorString", "symbolProto", "symbolValueOf", "symbolToString", "Hash", "entries", "entry", "hashClear", "hashDelete", "hashGet", "data", "hashHas", "hashSet", "ListCache", "listCacheClear", "listCacheDelete", "assocIndexOf", "lastIndex", "listCacheGet", "listCacheHas", "listCacheSet", "MapCache", "mapCacheClear", "mapCacheDelete", "getMapData", "mapCacheGet", "mapCacheHas", "mapCacheSet", "SetCache", "values", "setCacheAdd", "setCacheHas", "Stack", "stackClear", "stackDelete", "stackGet", "stackHas", "stackSet", "cache", "pairs", "arrayLikeKeys", "inherited", "isArray", "isArguments", "skipIndexes", "isIndex", "eq", "baseFor", "createBaseFor", "baseForOwn", "keys", "baseGet", "path", "isKey", "castPath", "toKey", "baseGetTag", "baseHasIn", "baseIsEqual", "other", "customizer", "bitmask", "stack", "isObject", "isObjectLike", "baseIsEqualDeep", "equalFunc", "objIsArr", "othIsArr", "objTag", "othTag", "getTag", "objIsObj", "othIsObj", "isSameTag", "isTypedArray", "equalArrays", "equalByTag", "objIsWrapped", "othIsWrapped", "objUnwrapped", "othUnwrapped", "equalObjects", "baseIsMatch", "source", "matchData", "noCustomizer", "objValue", "srcValue", "baseIsNative", "isMasked", "pattern", "isFunction", "baseIsTypedArray", "isLength", "baseIteratee", "identity", "baseMatchesProperty", "baseMatches", "property", "baseKeys", "isPrototype", "getMatchData", "matchesStrictComparable", "isStrictComparable", "get", "hasIn", "basePropertyDeep", "baseToString", "isSymbol", "stringToPath", "fromRight", "keysFunc", "iterable", "props", "isPartial", "arrLength", "othLength", "stacked", "seen", "arrValue", "othValue", "compared", "othIndex", "tag", "convert", "objProps", "objLength", "othProps", "skipCtor", "objCtor", "othCtor", "isKeyable", "Ctor", "ctorString", "hasPath", "hasFunc", "type", "proto", "memoize", "string", "toString", "match", "number", "quote", "resolver", "memoized", "args", "isArrayLikeObject", "isArrayLike", "defaultValue", "mapValues", "require_neos_ui_editors", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "init_readFromConsumerApi", "AbstractRegistry", "description", "positionalArraySorter", "subject", "position", "idKey", "positionAccessor", "value", "indexMapping", "middleKeys", "startKeys", "endKeys", "beforeKeys", "afterKeys", "item", "index", "key", "positionValue", "invalid", "weightMatch", "weight", "match", "reference", "numberPosition", "resultStart", "resultMiddle", "resultEnd", "processedKeys", "sortedWeights", "dict", "asc", "weights", "x", "a", "b", "addToResults", "keys", "result", "beforeWeights", "i", "afterWeights", "positionalArraySorter_default", "SynchronousRegistry", "AbstractRegistry", "description", "key", "value", "position", "entry", "indexOfItemWithTheSameKey", "item", "result", "searchKey", "unsortedChildren", "positionalArraySorter_default", "dist_default", "readFromConsumerApi", "import_react_ui_components", "import_neos_ui_redux_store", "import_react", "import_react_redux", "import_effects", "import_react", "import_react_redux", "import_prop_types", "import_neos_ui_decorators", "import_react_ui_components", "import_neos_ui_redux_store", "defaultOptions", "MagicTextFieldEditor", "props", "loading", "React", "module", "userInput", "commit", "externalService", "contentService", "activeContentDimensions", "addFlashMessage", "i18nRegistry", "node", "parentNode", "frontendConfiguration", "identifier", "generatedValue", "e", "id", "value", "className", "options", "onKeyPress", "onEnterKey", "finalOptions", "placeholder", "showGenerateButton", "PropTypes", "__decorateClass", "globalRegistry", "state", "import_react", "import_react_redux", "import_prop_types", "import_neos_ui_decorators", "import_react_ui_components", "import_neos_ui_redux_store", "defaultOptions", "MagicTextAreaEditor", "props", "loading", "React", "module", "userInput", "commit", "externalService", "contentService", "activeContentDimensions", "addFlashMessage", "i18nRegistry", "node", "parentNode", "frontendConfiguration", "identifier", "generatedValue", "e", "id", "value", "className", "options", "onKeyPress", "onEnterKey", "finalOptions", "placeholder", "showGenerateButton", "PropTypes", "__decorateClass", "globalRegistry", "state", "AiAssistantError", "message", "code", "externalMessage", "createExternalService", "frontendConfiguration", "configuration", "ExternalService", "apiDomain", "apiKey", "module", "language", "user_input", "AiAssistantError", "response", "jsonData", "message", "init_readFromConsumerApi", "neos_ui_backend_connector_default", "readFromConsumerApi", "fetchWithErrorHandling", "import_neos_ui_redux_store", "NOTHING", "DRAFTABLE", "DRAFT_STATE", "die", "error", "args", "getPrototypeOf", "isDraft", "value", "DRAFT_STATE", "isDraftable", "isPlainObject", "DRAFTABLE", "isMap", "isSet", "objectCtorString", "proto", "Ctor", "each", "obj", "iter", "getArchtype", "key", "value", "entry", "index", "thing", "state", "DRAFT_STATE", "isMap", "isSet", "has", "prop", "set", "thing", "propOrOldValue", "value", "t", "getArchtype", "is", "x", "y", "isMap", "target", "isSet", "latest", "state", "shallowCopy", "base", "strict", "isPlainObject", "getPrototypeOf", "descriptors", "DRAFT_STATE", "keys", "key", "desc", "freeze", "obj", "deep", "isFrozen", "isDraft", "isDraftable", "dontMutateFrozenCollections", "each", "_key", "die", "plugins", "getPlugin", "pluginKey", "plugin", "currentScope", "getCurrentScope", "createScope", "parent_", "immer_", "usePatchesInScope", "scope", "patchListener", "getPlugin", "revokeScope", "leaveScope", "revokeDraft", "enterScope", "immer", "draft", "state", "DRAFT_STATE", "processResult", "result", "baseDraft", "die", "isDraftable", "finalize", "maybeFreeze", "NOTHING", "rootScope", "value", "path", "isFrozen", "each", "key", "childValue", "finalizeProperty", "resultEach", "isSet", "parentState", "targetObject", "prop", "rootPath", "targetIsSet", "isDraft", "has", "res", "set", "deep", "freeze", "createProxyProxy", "base", "parent", "isArray", "target", "traps", "objectTraps", "arrayTraps", "revoke", "proxy", "source", "latest", "readPropFromProto", "peek", "prepareCopy", "createProxy", "desc", "getDescriptorFromProto", "current", "currentState", "is", "markChanged", "owner", "getPrototypeOf", "fn", "proto", "shallowCopy", "Immer", "config", "recipe", "defaultBase", "self", "args", "hasError", "p", "ip", "patches", "inversePatches", "i", "patch", "applyPatchesImpl", "isMap", "currentImpl", "copy", "immer", "Immer", "produce", "produceWithPatches", "setAutoFreeze", "setUseStrictShallowCopy", "applyPatches", "createDraft", "finishDraft", "import_lodash", "createContentService", "globalRegistry", "store", "ContentService", "state", "currentDocumentNodePath", "currentDocumentNode", "targetAudience", "pageBriefing", "focusKeyword", "value", "node", "parentNode", "transientValues", "documentTitle", "documentContent", "AssetUri", "AsyncFunction", "e", "AiAssistantError", "obj", "key", "itemValue", "propertyValue", "loadImageMetadata", "neos_ui_backend_connector_default", "imageUri", "previewUri", "image", "imagesArray", "instanceDomain", "nodeTypesRegistry", "nodePath", "propertyName", "nodeType", "isOnCreate", "propertyConfiguration", "i18nRegistry", "configuration", "assistantService", "processedData", "message", "produce", "draft", "mappedTransientValues", "mapValues", "item", "import_effects", "import_neos_ui_redux_store", "createWatchNodeCreatedSaga", "globalRegistry", "store", "action", "feedback", "createdNodePath", "state", "nodesByContextPath", "nodeTypesRegistry", "i18nRegistry", "contentService", "assistantService", "externalService", "nodeContextPath", "node", "parentNode", "nodeType", "propertyName", "import_effects", "import_neos_ui_redux_store", "createWatchNodeRemovedSaga", "globalRegistry", "store", "action", "assistantService", "message", "import_neos_ui_redux_store", "createAssistantService", "globalRegistry", "store", "AssistantService", "message", "checkLoadedStatusAndSendMessage", "assistantFrame", "iframe", "nodePath", "propertyName", "value", "isFinished", "errorMessage", "propertyValue", "inlineField", "inlineFieldWithTypingCaret", "timer", "timeout", "code", "severity", "externalMessage", "i18nRegistry", "import_react", "import_prop_types", "import_react_ui_components", "import_neos_ui_decorators", "RegenerateButton", "props", "retries", "nodeType", "property", "propertyConfiguration", "node", "parentNode", "i18nRegistry", "React", "PropTypes", "__decorateClass", "globalRegistry", "import_neos_ui_editors", "delay", "timeInMilliseconds", "resolve", "dist_default", "globalRegistry", "store", "frontendConfiguration", "editorsRegistry", "configuration", "SynchronousRegistry", "externalService", "createExternalService", "contentService", "createContentService", "assistantService", "createAssistantService", "containerRegistry", "App", "WrappedApp", "props", "state", "isOpen", "setOpen", "React", "setOpenAndPersistState", "open", "isFullscreen", "setFullscreen", "setFullscreenAndPersistState", "fullscreen", "fullscreenButton", "onClick", "toggleButton", "activeContentDimensions", "interfaceLanguage", "iframeSrc", "e", "requiredChangedEvent", "watchDocumentNodeChange", "action", "nodeTypesRegistry", "previewUrl", "currentDocumentNode", "currentDocumentNodePath", "relevantNodes", "node", "documentRole", "documentSubNodeTypes", "sagasRegistry", "createWatchNodeCreatedSaga", "createWatchNodeRemovedSaga", "MagicTextFieldEditor", "MagicTextAreaEditor", "RegenerateButton"]
}
