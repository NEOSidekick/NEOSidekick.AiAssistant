(()=>{var ke=Object.create;var ee=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var Ce=Object.getOwnPropertyNames;var xe=Object.getPrototypeOf,Ae=Object.prototype.hasOwnProperty;var Pe=(t,e)=>()=>(t&&(e=t(t=0)),e);var F=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var be=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ce(e))!Ae.call(t,r)&&r!==n&&ee(t,r,{get:()=>e[r],enumerable:!(s=re(e,r))||s.enumerable});return t};var v=(t,e,n)=>(n=t!=null?ke(xe(t)):{},be(e||!t||!t.__esModule?ee(n,"default",{value:t,enumerable:!0}):n,t));var M=(t,e,n,s)=>{for(var r=s>1?void 0:s?re(e,n):e,p=t.length-1,a;p>=0;p--)(a=t[p])&&(r=(s?a(e,n,r):a(r))||r);return s&&r&&ee(e,n,r),r};function N(t){return(...e)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${t}`])return window["@Neos:HostPluginAPI"][`@${t}`](...e);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var I=Pe(()=>{});var z=F((Ze,ae)=>{I();ae.exports=N("NeosProjectPackages")().ReactUiComponents});var G=F((tt,ce)=>{I();ce.exports=N("NeosProjectPackages")().NeosUiReduxStore});var J=F((st,de)=>{I();de.exports=N("vendor")().React});var V=F((rt,le)=>{I();le.exports=N("vendor")().reactRedux});var ue=F((at,pe)=>{I();pe.exports=N("vendor")().reduxSagaEffects});var ne=F((dt,me)=>{I();me.exports=N("vendor")().PropTypes});var se=F((pt,fe)=>{I();fe.exports=N("NeosProjectPackages")().NeosUiDecorators});I();var q=class{constructor(e){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=e}};var Oe=(t,e="position",n="key")=>{let s=typeof e=="string"?o=>o[e]:e,r={},p={},a={},S={},d={},f={};t.forEach((o,g)=>{let u=o[n]?o[n]:String(g);r[u]=g;let C=s(o),y=String(C||g),_=!1;if(y.startsWith("start")){let c=y.match(/start\s+(\d+)/),i=c&&c[1]?Number(c[1]):0;a[i]||(a[i]=[]),a[i].push(u)}else if(y.startsWith("end")){let c=y.match(/end\s+(\d+)/),i=c&&c[1]?Number(c[1]):0;S[i]||(S[i]=[]),S[i].push(u)}else if(y.startsWith("before")){let c=y.match(/before\s+(\S+)(\s+(\d+))?/);if(!c)_=!0;else{let i=c[1],h=c[3]?Number(c[3]):0;d[i]||(d[i]={}),d[i][h]||(d[i][h]=[]),d[i][h].push(u)}}else if(y.startsWith("after")){let c=y.match(/after\s+(\S+)(\s+(\d+))?/);if(!c)_=!0;else{let i=c[1],h=c[3]?Number(c[3]):0;f[i]||(f[i]={}),f[i][h]||(f[i][h]=[]),f[i][h].push(u)}}else _=!0;if(_){let c=parseFloat(y);(isNaN(c)||!isFinite(c))&&(c=g),p[c]||(p[c]=[]),p[c].push(u)}});let l=[],P=[],b=[],k=[],m=(o,g)=>{let u=Object.keys(o).map(C=>Number(C)).sort((C,y)=>C-y);return g?u:u.reverse()},w=(o,g)=>{o.forEach(u=>{if(!(k.indexOf(u)>=0)){if(k.push(u),d[u]){let C=m(d[u],!0);for(let y of C)w(d[u][y],g)}if(g.push(u),f[u]){let C=m(f[u],!1);for(let y of C)w(f[u][y],g)}}})};for(let o of m(a,!1))w(a[o],l);for(let o of m(p,!0))w(p[o],P);for(let o of m(S,!0))w(S[o],b);for(let o of Object.keys(d))if(!(k.indexOf(o)>=0))for(let g of m(d[o],!1))w(d[o][g],l);for(let o of Object.keys(f))if(!(k.indexOf(o)>=0))for(let g of m(f[o],!1))w(f[o][g],P);return[...l,...P,...b].map(o=>r[o]).map(o=>t[o])},te=Oe;var K=class extends q{constructor(e){super(e),this._registry=[]}set(e,n,s=0){if(typeof e!="string")throw new Error("Key must be a string");if(typeof s!="string"&&typeof s!="number")throw new Error("Position must be a string or a number");let r={key:e,value:n};s&&(r.position=s);let p=this._registry.findIndex(a=>a.key===e);return p===-1?this._registry.push(r):this._registry[p]=r,n}get(e){if(typeof e!="string")return console.error("Key must be a string"),null;let n=this._registry.find(s=>s.key===e);return n?n.value:null}_getChildrenWrapped(e){let n=this._registry.filter(s=>s.key.indexOf(e+"/")===0);return te(n)}getChildrenAsObject(e){let n={};return this._getChildrenWrapped(e).forEach(s=>{n[s.key]=s.value}),n}getChildren(e){return this._getChildrenWrapped(e).map(n=>n.value)}has(e){return typeof e!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(n=>n.key===e)}_getAllWrapped(){return te(this._registry)}getAllAsObject(){let e={};return this._getAllWrapped().forEach(n=>{e[n.key]=n.value}),e}getAllAsList(){return this._getAllWrapped().map(e=>Object.assign({id:e.key},e.value))}};var ie=N("manifest");var $=v(z()),L=v(G()),O=v(J()),oe=v(V()),ve=v(ue());var D=v(J()),ge=v(V()),x=v(ne()),he=v(se()),R=v(z()),Y=v(G());var De={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},j=class extends D.PureComponent{constructor(n){super(n);this.state={loading:!1};this.getIcon=n=>n?D.default.createElement(R.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):D.default.createElement(R.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async n=>{let{commit:s,externalService:r,contentService:p,nodesByContextPath:a,currentDocumentNodePath:S,activeContentDimensions:d}=this.props;this.setState({loading:!0});let f=a[S]?.properties?.title,l=p.getGuestFrameDocumentHtml(),P=await r.generate(n,d.language?d.language[0]:"",f,l);s(P),this.setState({loading:!1})}}render(){let{id:n,value:s,className:r,commit:p,options:a,i18nRegistry:S,onKeyPress:d,onEnterKey:f}=this.props,l=Object.assign({},De,a),P=a&&a.placeholder&&S.translate(unescape(a.placeholder)),b=!(l.readonly||l.disabled);return D.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:r},D.default.createElement("div",null,D.default.createElement(R.TextInput,{id:n,value:s,onChange:p,disabled:l.disabled||this.state.loading,maxLength:l.maxlength,readOnly:l.readonly,placeholder:P,onKeyPress:d,onEnterKey:f})),b?D.default.createElement("div",null,D.default.createElement(R.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(l.module)},S.translate("NEOSidekick.AiAssistant:Main:generateMetaDescription"),"\xA0",this.getIcon(this.state.loading))):null)}};j.propTypes={className:x.default.string,value:x.default.oneOfType([x.default.string,x.default.number]),commit:x.default.func.isRequired,options:x.default.object,onKeyPress:x.default.func,onEnterKey:x.default.func,id:x.default.string,nodesByContextPath:x.default.object,currentDocumentNodePath:x.default.string,activeContentDimensions:x.default.object.isRequired,i18nRegistry:x.default.object.isRequired,externalService:x.default.object.isRequired,contentService:x.default.object.isRequired},j.defaultProps={options:{}},j=M([(0,he.neos)(t=>({i18nRegistry:t.get("i18n"),externalService:t.get("NEOSidekick.AiAssistant").get("externalService"),contentService:t.get("NEOSidekick.AiAssistant").get("contentService")})),(0,ge.connect)(t=>({nodesByContextPath:Y.selectors.CR.Nodes.nodesByContextPathSelector(t),currentDocumentNodePath:Y.selectors.CR.Nodes.documentNodeContextPathSelector(t),activeContentDimensions:Y.selectors.CR.ContentDimensions.active(t)}))],j);var E=v(J()),ye=v(V()),A=v(ne()),Se=v(se()),W=v(z()),Q=v(G());var Ee={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},B=class extends E.Component{constructor(n){super(n);this.getIcon=n=>n?E.default.createElement(W.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):E.default.createElement(W.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"});this.fetch=async n=>{let{commit:s,externalService:r,contentService:p,nodesByContextPath:a,currentDocumentNodePath:S,activeContentDimensions:d}=this.props;this.setState({loading:!0});let f=a[S]?.properties?.title,l=p.getGuestFrameDocumentHtml(),P=await r.generate(n,d.language?d.language[0]:"",f,l);s(P),this.setState({loading:!1})};this.state={loading:!1}}render(){let{id:n,value:s,className:r,commit:p,options:a,i18nRegistry:S,onKeyPress:d,onEnterKey:f}=this.props,l=Object.assign({},Ee,a),P=a&&a.placeholder&&S.translate(unescape(a.placeholder)),b=!(l.readonly||l.disabled);return E.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:r},E.default.createElement("div",null,E.default.createElement(W.TextArea,{id:n,value:s,onChange:p,disabled:l.disabled||this.state.loading,maxLength:l.maxlength,readOnly:l.readonly,placeholder:P,minRows:l.minRows,expandedRows:l.expandedRows,onKeyPress:d,onEnterKey:f})),b?E.default.createElement("div",null,E.default.createElement(W.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(l.module)},S.translate("NEOSidekick.AiAssistant:Main:generateMetaDescription"),"\xA0",this.getIcon(this.state.loading))):null)}};B.propTypes={className:A.default.string,value:A.default.oneOfType([A.default.string,A.default.number]),commit:A.default.func.isRequired,options:A.default.object,onKeyPress:A.default.func,onEnterKey:A.default.func,id:A.default.string,nodesByContextPath:A.default.object,currentDocumentNodePath:A.default.string,activeContentDimensions:A.default.object.isRequired,i18nRegistry:A.default.object.isRequired,externalService:A.default.object.isRequired,contentService:A.default.object.isRequired},B.defaultProps={options:{}},B=M([(0,Se.neos)(t=>({i18nRegistry:t.get("i18n"),externalService:t.get("NEOSidekick.AiAssistant").get("externalService"),contentService:t.get("NEOSidekick.AiAssistant").get("contentService")})),(0,ye.connect)(t=>({nodesByContextPath:Q.selectors.CR.Nodes.nodesByContextPathSelector(t),currentDocumentNodePath:Q.selectors.CR.Nodes.documentNodeContextPathSelector(t),activeContentDimensions:Q.selectors.CR.ContentDimensions.active(t)}))],B);var H=class{constructor(e,n){this.apiDomain="";this.apiKey="";this.generate=async(e,n,s,r)=>(await(await fetch(`${this.apiDomain}/api/v1/chat?language=${n}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:"meta_description",platform:"neos",user_input:[{identifier:"title",value:s},{identifier:"content",value:r}]})})).json())?.data?.message?.message;this.apiDomain=e,this.apiKey=n}};var U=class{constructor(){this.getGuestFrameDocumentHtml=()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML}};function Ne(t){return new Promise(e=>setTimeout(e,t))}ie("NEOSidekick.AiAssistant",{},(t,{store:e,frontendConfiguration:n})=>{let s=n["NEOSidekick.AiAssistant"];if(s===null||s.enabled===!1)return;let r=t.get("containers"),p=r.get("App"),a=b=>{let k=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[m,w]=O.default.useState(k?.open),T=h=>{w(h),k.open=h,localStorage.setItem("NEOSidekick",JSON.stringify(k))},[o,g]=O.default.useState(k?.fullscreen),u=h=>{g(h),k.fullscreen=h,localStorage.setItem("NEOSidekick",JSON.stringify(k))},C=(h,X,Z)=>{if(h)return O.default.createElement($.IconButton,{icon:X?"compress":"expand",onClick:Z})},y=(h,X,Z)=>{if(!X)return O.default.createElement($.IconButton,{icon:h?"chevron-circle-right":"chevron-circle-left",onClick:Z})},_=(0,oe.useSelector)(L.selectors.CR.ContentDimensions.active),c=(0,oe.useSelector)(h=>h?.user?.preferences?.interfaceLanguage),i=new URL(`${s.apiDomain}/chat/`);return i.searchParams.append("contentLanguage",_.language?_.language[0]:""),i.searchParams.append("interfaceLanguage",c),i.searchParams.append("userId",s.userId),i.searchParams.append("plattform","neos"),i.searchParams.append("domain",s.domain),i.searchParams.append("siteName",s.siteName),s?.referral&&i.searchParams.append("referral",s?.referral),s?.apiKey&&i.searchParams.append("apikey",s?.apiKey),O.default.createElement("div",{className:`neosidekick_appWrapper ${m?"neosidekick_appWrapper--sidebar-open":""}  ${o?"neosidekick_appWrapper--sidebar-fullscreen":""}`},O.default.createElement(p,{...b}),O.default.createElement("div",{className:"neosidekick_sideBar"},O.default.createElement("div",{className:"neosidekick_sideBar__title"},O.default.createElement($.Headline,{className:`neosidekick_sideBar__title-headline ${m?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),O.default.createElement("div",null,C(m,o,()=>u(!o)),y(m,o,()=>T(!m)))),O.default.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${m?"neosidekick_sideBar__frame--open":""}`,src:i.toString(),allow:"clipboard-write",onLoad:h=>h.target.dataset.loaded=!0})))};r.set("App",a);let S=b=>{let k=setInterval(()=>{let m=document.getElementById("neosidekickAssistant");if(m.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",b),m.contentWindow.postMessage(b,"*"),clearInterval(k);else{console.log("not loaded, waiting...");return}},250)},d=!1,f=function*(){yield(0,ve.takeLatest)([L.actionTypes.UI.ContentCanvas.SET_SRC,L.actionTypes.UI.ContentCanvas.RELOAD,L.actionTypes.CR.Nodes.MERGE],function*(b){b.type===L.actionTypes.UI.ContentCanvas.SET_SRC&&(d=!0),yield Ne(500);let k=t.get("@neos-project/neos-ui-contentrepository"),m=e.getState(),T=document.getElementsByName("neos-content-main")[0]?.contentDocument,o=m?.ui?.contentCanvas?.previewUrl,g=m?.cr?.nodes?.documentNode,u=Object.values(m?.cr?.nodes?.byContextPath||{}).filter(C=>{let y=k.getRole("document");if(!y)throw new Error("Document role is not loaded!");let _=k.getSubTypesOf(y);return g&&C.contextPath.indexOf(g.split("@")[0])===0&&(C.contextPath===g||!_.includes(C.nodeType))});S({version:"1.0",eventName:d?"page-changed":"page-updated",data:{url:o,title:m?.cr?.nodes?.byContextPath[g]?.properties?.title||T?.title,content:T?.body?.innerHTML,structuredContent:u}}),d=!1})};t.get("sagas").set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:f});let P=t.get("inspector").get("editors");P.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:j}),P.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:B}),t.set("NEOSidekick.AiAssistant",new K("test")),t.get("NEOSidekick.AiAssistant").set("externalService",new H(s.apiDomain,s.apiKey)),t.get("NEOSidekick.AiAssistant").set("contentService",new U),console.log(t)});})();
//# sourceMappingURL=Plugin.js.map
