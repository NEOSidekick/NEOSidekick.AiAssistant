"use strict";(()=>{var gn=Object.create;var Me=Object.defineProperty;var Wt=Object.getOwnPropertyDescriptor;var hn=Object.getOwnPropertyNames;var mn=Object.getPrototypeOf,yn=Object.prototype.hasOwnProperty;var _n=(e,t,r)=>t in e?Me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var vn=(e,t)=>()=>(e&&(t=e(e=0)),t);var z=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Sn=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of hn(t))!yn.call(e,i)&&i!==r&&Me(e,i,{get:()=>t[i],enumerable:!(n=Wt(t,i))||n.enumerable});return e};var h=(e,t,r)=>(r=e!=null?gn(mn(e)):{},Sn(t||!e||!e.__esModule?Me(r,"default",{value:e,enumerable:!0}):r,e));var q=(e,t,r,n)=>{for(var i=n>1?void 0:n?Wt(t,r):t,s=e.length-1,o;s>=0;s--)(o=e[s])&&(i=(n?o(t,r,i):o(i))||i);return n&&i&&Me(t,r,i),i};var u=(e,t,r)=>(_n(e,typeof t!="symbol"?t+"":t,r),r);function C(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var M=vn(()=>{});var R=z((Qs,Bt)=>{M();Bt.exports=C("NeosProjectPackages")().NeosUiReduxStore});var Dr=z((Ce,de)=>{var Dn=200,Mn="Expected a function",xt="__lodash_hash_undefined__",Je=1,fe=2,ur=1/0,dr=9007199254740991,Be="[object Arguments]",Ct="[object Array]",fr="[object Boolean]",lr="[object Date]",pr="[object Error]",gr="[object Function]",In="[object GeneratorFunction]",Ke="[object Map]",hr="[object Number]",ue="[object Object]",er="[object Promise]",mr="[object RegExp]",Ue="[object Set]",yr="[object String]",_r="[object Symbol]",At="[object WeakMap]",vr="[object ArrayBuffer]",He="[object DataView]",Rn="[object Float32Array]",Wn="[object Float64Array]",jn="[object Int8Array]",zn="[object Int16Array]",Ln="[object Int32Array]",Bn="[object Uint8Array]",Kn="[object Uint8ClampedArray]",Un="[object Uint16Array]",Hn="[object Uint32Array]",Gn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$n=/^\w*$/,qn=/^\./,Jn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Yn=/[\\^$.*+?()[\]{}|]/g,Vn=/\\(\\)?/g,Xn=/^\[object .+?Constructor\]$/,Zn=/^(?:0|[1-9]\d*)$/,v={};v[Rn]=v[Wn]=v[jn]=v[zn]=v[Ln]=v[Bn]=v[Kn]=v[Un]=v[Hn]=!0;v[Be]=v[Ct]=v[vr]=v[fr]=v[He]=v[lr]=v[pr]=v[gr]=v[Ke]=v[hr]=v[ue]=v[mr]=v[Ue]=v[yr]=v[At]=!1;var Sr=typeof global=="object"&&global&&global.Object===Object&&global,Qn=typeof self=="object"&&self&&self.Object===Object&&self,V=Sr||Qn||Function("return this")(),br=typeof Ce=="object"&&Ce&&!Ce.nodeType&&Ce,tr=br&&typeof de=="object"&&de&&!de.nodeType&&de,ei=tr&&tr.exports===br,rr=ei&&Sr.process,nr=function(){try{return rr&&rr.binding("util")}catch{}}(),ir=nr&&nr.isTypedArray;function ti(e,t){for(var r=-1,n=e?e.length:0;++r<n;)if(t(e[r],r,e))return!0;return!1}function ri(e){return function(t){return t?.[e]}}function ni(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}function ii(e){return function(t){return e(t)}}function si(e,t){return e?.[t]}function wt(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function oi(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function ai(e,t){return function(r){return e(t(r))}}function ci(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var ui=Array.prototype,di=Function.prototype,Ye=Object.prototype,St=V["__core-js_shared__"],sr=function(){var e=/[^.]+$/.exec(St&&St.keys&&St.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Cr=di.toString,B=Ye.hasOwnProperty,le=Ye.toString,fi=RegExp("^"+Cr.call(B).replace(Yn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),or=V.Symbol,ar=V.Uint8Array,li=Ye.propertyIsEnumerable,pi=ui.splice,gi=ai(Object.keys,Object),Nt=pe(V,"DataView"),Ae=pe(V,"Map"),Pt=pe(V,"Promise"),Et=pe(V,"Set"),Ot=pe(V,"WeakMap"),we=pe(Object,"create"),hi=ie(Nt),mi=ie(Ae),yi=ie(Pt),_i=ie(Et),vi=ie(Ot),Ge=or?or.prototype:void 0,bt=Ge?Ge.valueOf:void 0,cr=Ge?Ge.toString:void 0;function re(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Si(){this.__data__=we?we(null):{}}function bi(e){return this.has(e)&&delete this.__data__[e]}function Ci(e){var t=this.__data__;if(we){var r=t[e];return r===xt?void 0:r}return B.call(t,e)?t[e]:void 0}function Ai(e){var t=this.__data__;return we?t[e]!==void 0:B.call(t,e)}function wi(e,t){var r=this.__data__;return r[e]=we&&t===void 0?xt:t,this}re.prototype.clear=Si;re.prototype.delete=bi;re.prototype.get=Ci;re.prototype.has=Ai;re.prototype.set=wi;function K(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Ni(){this.__data__=[]}function Pi(e){var t=this.__data__,r=Ve(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():pi.call(t,r,1),!0}function Ei(e){var t=this.__data__,r=Ve(t,e);return r<0?void 0:t[r][1]}function Oi(e){return Ve(this.__data__,e)>-1}function xi(e,t){var r=this.__data__,n=Ve(r,e);return n<0?r.push([e,t]):r[n][1]=t,this}K.prototype.clear=Ni;K.prototype.delete=Pi;K.prototype.get=Ei;K.prototype.has=Oi;K.prototype.set=xi;function U(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function Fi(){this.__data__={hash:new re,map:new(Ae||K),string:new re}}function ki(e){return Xe(this,e).delete(e)}function Ti(e){return Xe(this,e).get(e)}function Di(e){return Xe(this,e).has(e)}function Mi(e,t){return Xe(this,e).set(e,t),this}U.prototype.clear=Fi;U.prototype.delete=ki;U.prototype.get=Ti;U.prototype.has=Di;U.prototype.set=Mi;function $e(e){var t=-1,r=e?e.length:0;for(this.__data__=new U;++t<r;)this.add(e[t])}function Ii(e){return this.__data__.set(e,xt),this}function Ri(e){return this.__data__.has(e)}$e.prototype.add=$e.prototype.push=Ii;$e.prototype.has=Ri;function L(e){this.__data__=new K(e)}function Wi(){this.__data__=new K}function ji(e){return this.__data__.delete(e)}function zi(e){return this.__data__.get(e)}function Li(e){return this.__data__.has(e)}function Bi(e,t){var r=this.__data__;if(r instanceof K){var n=r.__data__;if(!Ae||n.length<Dn-1)return n.push([e,t]),this;r=this.__data__=new U(n)}return r.set(e,t),this}L.prototype.clear=Wi;L.prototype.delete=ji;L.prototype.get=zi;L.prototype.has=Li;L.prototype.set=Bi;function Ki(e,t){var r=ne(e)||Fr(e)?ni(e.length,String):[],n=r.length,i=!!n;for(var s in e)(t||B.call(e,s))&&!(i&&(s=="length"||Pr(s,n)))&&r.push(s);return r}function Ve(e,t){for(var r=e.length;r--;)if(xr(e[r][0],t))return r;return-1}var Ui=ns();function Hi(e,t){return e&&Ui(e,t,qe)}function Ar(e,t){t=Ze(t,e)?[t]:wr(t);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Qe(t[r++])];return r&&r==n?e:void 0}function Gi(e){return le.call(e)}function $i(e,t){return e!=null&&t in Object(e)}function Ft(e,t,r,n,i){return e===t?!0:e==null||t==null||!et(e)&&!tt(t)?e!==e&&t!==t:qi(e,t,Ft,r,n,i)}function qi(e,t,r,n,i,s){var o=ne(e),a=ne(t),c=Ct,f=Ct;o||(c=Y(e),c=c==Be?ue:c),a||(f=Y(t),f=f==Be?ue:f);var d=c==ue&&!wt(e),m=f==ue&&!wt(t),g=c==f;if(g&&!d)return s||(s=new L),o||ps(e)?Nr(e,t,r,n,i,s):is(e,t,c,r,n,i,s);if(!(i&fe)){var l=d&&B.call(e,"__wrapped__"),y=m&&B.call(t,"__wrapped__");if(l||y){var _=l?e.value():e,E=y?t.value():t;return s||(s=new L),r(_,E,n,i,s)}}return g?(s||(s=new L),ss(e,t,r,n,i,s)):!1}function Ji(e,t,r,n){var i=r.length,s=i,o=!n;if(e==null)return!s;for(e=Object(e);i--;){var a=r[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<s;){a=r[i];var c=a[0],f=e[c],d=a[1];if(o&&a[2]){if(f===void 0&&!(c in e))return!1}else{var m=new L;if(n)var g=n(f,d,c,e,t,m);if(!(g===void 0?Ft(d,f,n,Je|fe,m):g))return!1}}return!0}function Yi(e){if(!et(e)||us(e))return!1;var t=Tr(e)||wt(e)?fi:Xn;return t.test(ie(e))}function Vi(e){return tt(e)&&Tt(e.length)&&!!v[le.call(e)]}function Xi(e){return typeof e=="function"?e:e==null?_s:typeof e=="object"?ne(e)?es(e[0],e[1]):Qi(e):vs(e)}function Zi(e){if(!ds(e))return gi(e);var t=[];for(var r in Object(e))B.call(e,r)&&r!="constructor"&&t.push(r);return t}function Qi(e){var t=os(e);return t.length==1&&t[0][2]?Or(t[0][0],t[0][1]):function(r){return r===e||Ji(r,e,t)}}function es(e,t){return Ze(e)&&Er(t)?Or(Qe(e),t):function(r){var n=hs(r,e);return n===void 0&&n===t?ms(r,e):Ft(t,n,void 0,Je|fe)}}function ts(e){return function(t){return Ar(t,e)}}function rs(e){if(typeof e=="string")return e;if(Dt(e))return cr?cr.call(e):"";var t=e+"";return t=="0"&&1/e==-ur?"-0":t}function wr(e){return ne(e)?e:fs(e)}function ns(e){return function(t,r,n){for(var i=-1,s=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(r(s[c],c,s)===!1)break}return t}}function Nr(e,t,r,n,i,s){var o=i&fe,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var f=s.get(e);if(f&&s.get(t))return f==t;var d=-1,m=!0,g=i&Je?new $e:void 0;for(s.set(e,t),s.set(t,e);++d<a;){var l=e[d],y=t[d];if(n)var _=o?n(y,l,d,t,e,s):n(l,y,d,e,t,s);if(_!==void 0){if(_)continue;m=!1;break}if(g){if(!ti(t,function(E,p){if(!g.has(p)&&(l===E||r(l,E,n,i,s)))return g.add(p)})){m=!1;break}}else if(!(l===y||r(l,y,n,i,s))){m=!1;break}}return s.delete(e),s.delete(t),m}function is(e,t,r,n,i,s,o){switch(r){case He:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case vr:return!(e.byteLength!=t.byteLength||!n(new ar(e),new ar(t)));case fr:case lr:case hr:return xr(+e,+t);case pr:return e.name==t.name&&e.message==t.message;case mr:case yr:return e==t+"";case Ke:var a=oi;case Ue:var c=s&fe;if(a||(a=ci),e.size!=t.size&&!c)return!1;var f=o.get(e);if(f)return f==t;s|=Je,o.set(e,t);var d=Nr(a(e),a(t),n,i,s,o);return o.delete(e),d;case _r:if(bt)return bt.call(e)==bt.call(t)}return!1}function ss(e,t,r,n,i,s){var o=i&fe,a=qe(e),c=a.length,f=qe(t),d=f.length;if(c!=d&&!o)return!1;for(var m=c;m--;){var g=a[m];if(!(o?g in t:B.call(t,g)))return!1}var l=s.get(e);if(l&&s.get(t))return l==t;var y=!0;s.set(e,t),s.set(t,e);for(var _=o;++m<c;){g=a[m];var E=e[g],p=t[g];if(n)var O=o?n(p,E,g,t,e,s):n(E,p,g,e,t,s);if(!(O===void 0?E===p||r(E,p,n,i,s):O)){y=!1;break}_||(_=g=="constructor")}if(y&&!_){var S=e.constructor,x=t.constructor;S!=x&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof x=="function"&&x instanceof x)&&(y=!1)}return s.delete(e),s.delete(t),y}function Xe(e,t){var r=e.__data__;return cs(t)?r[typeof t=="string"?"string":"hash"]:r.map}function os(e){for(var t=qe(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Er(i)]}return t}function pe(e,t){var r=si(e,t);return Yi(r)?r:void 0}var Y=Gi;(Nt&&Y(new Nt(new ArrayBuffer(1)))!=He||Ae&&Y(new Ae)!=Ke||Pt&&Y(Pt.resolve())!=er||Et&&Y(new Et)!=Ue||Ot&&Y(new Ot)!=At)&&(Y=function(e){var t=le.call(e),r=t==ue?e.constructor:void 0,n=r?ie(r):void 0;if(n)switch(n){case hi:return He;case mi:return Ke;case yi:return er;case _i:return Ue;case vi:return At}return t});function as(e,t,r){t=Ze(t,e)?[t]:wr(t);for(var n,i=-1,o=t.length;++i<o;){var s=Qe(t[i]);if(!(n=e!=null&&r(e,s)))break;e=e[s]}if(n)return n;var o=e?e.length:0;return!!o&&Tt(o)&&Pr(s,o)&&(ne(e)||Fr(e))}function Pr(e,t){return t=t??dr,!!t&&(typeof e=="number"||Zn.test(e))&&e>-1&&e%1==0&&e<t}function Ze(e,t){if(ne(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Dt(e)?!0:$n.test(e)||!Gn.test(e)||t!=null&&e in Object(t)}function cs(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function us(e){return!!sr&&sr in e}function ds(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Ye;return e===r}function Er(e){return e===e&&!et(e)}function Or(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var fs=kt(function(e){e=gs(e);var t=[];return qn.test(e)&&t.push(""),e.replace(Jn,function(r,n,i,s){t.push(i?s.replace(Vn,"$1"):n||r)}),t});function Qe(e){if(typeof e=="string"||Dt(e))return e;var t=e+"";return t=="0"&&1/e==-ur?"-0":t}function ie(e){if(e!=null){try{return Cr.call(e)}catch{}try{return e+""}catch{}}return""}function kt(e,t){if(typeof e!="function"||t&&typeof t!="function")throw new TypeError(Mn);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var o=e.apply(this,n);return r.cache=s.set(i,o),o};return r.cache=new(kt.Cache||U),r}kt.Cache=U;function xr(e,t){return e===t||e!==e&&t!==t}function Fr(e){return ls(e)&&B.call(e,"callee")&&(!li.call(e,"callee")||le.call(e)==Be)}var ne=Array.isArray;function kr(e){return e!=null&&Tt(e.length)&&!Tr(e)}function ls(e){return tt(e)&&kr(e)}function Tr(e){var t=et(e)?le.call(e):"";return t==gr||t==In}function Tt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=dr}function et(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function tt(e){return!!e&&typeof e=="object"}function Dt(e){return typeof e=="symbol"||tt(e)&&le.call(e)==_r}var ps=ir?ii(ir):Vi;function gs(e){return e==null?"":rs(e)}function hs(e,t,r){var n=e==null?void 0:Ar(e,t);return n===void 0?r:n}function ms(e,t){return e!=null&&as(e,t,$i)}function qe(e){return kr(e)?Ki(e):Zi(e)}function ys(e,t){var r={};return t=Xi(t,3),Hi(e,function(n,i,s){r[i]=t(n,i,s)}),r}function _s(e){return e}function vs(e){return Ze(e)?ri(Qe(e)):ts(e)}de.exports=ys});var Wr=z((ho,Rr)=>{M();Rr.exports=C("NeosProjectPackages")().NeosUiEditors});var he=z((yo,jr)=>{M();jr.exports=C("vendor")().React});var Ne=z((vo,zr)=>{M();zr.exports=C("vendor")().reactRedux});var Pe=z((bo,Lr)=>{M();Lr.exports=C("vendor")().PropTypes});var Ee=z((Ao,Br)=>{M();Br.exports=C("NeosProjectPackages")().NeosUiDecorators});var Oe=z((No,Kr)=>{M();Kr.exports=C("NeosProjectPackages")().ReactUiComponents});var it=z((jo,Zr)=>{M();Zr.exports=C("vendor")().reduxSagaEffects});M();var _e=class{constructor(t){this.SERIAL_VERSION_UID="d8a5aa78-978e-11e6-ae22-56b6b6499611",this.description=t}};var bn=(e,t="position",r="key")=>{let n=typeof t=="string"?p=>p[t]:t,i={},s={},o={},a={},c={},f={};e.forEach((p,O)=>{let S=p[r]?p[r]:String(O);i[S]=O;let x=n(p),F=String(x||O),De=!1;if(F.startsWith("start")){let b=F.match(/start\s+(\d+)/),A=b&&b[1]?Number(b[1]):0;o[A]||(o[A]=[]),o[A].push(S)}else if(F.startsWith("end")){let b=F.match(/end\s+(\d+)/),A=b&&b[1]?Number(b[1]):0;a[A]||(a[A]=[]),a[A].push(S)}else if(F.startsWith("before")){let b=F.match(/before\s+(\S+)(\s+(\d+))?/);if(!b)De=!0;else{let A=b[1],Z=b[3]?Number(b[3]):0;c[A]||(c[A]={}),c[A][Z]||(c[A][Z]=[]),c[A][Z].push(S)}}else if(F.startsWith("after")){let b=F.match(/after\s+(\S+)(\s+(\d+))?/);if(!b)De=!0;else{let A=b[1],Z=b[3]?Number(b[3]):0;f[A]||(f[A]={}),f[A][Z]||(f[A][Z]=[]),f[A][Z].push(S)}}else De=!0;if(De){let b=parseFloat(F);(isNaN(b)||!isFinite(b))&&(b=O),s[b]||(s[b]=[]),s[b].push(S)}});let d=[],m=[],g=[],l=[],y=(p,O)=>{let S=Object.keys(p).map(x=>Number(x)).sort((x,F)=>x-F);return O?S:S.reverse()},_=(p,O)=>{p.forEach(S=>{if(!(l.indexOf(S)>=0)){if(l.push(S),c[S]){let x=y(c[S],!0);for(let F of x)_(c[S][F],O)}if(O.push(S),f[S]){let x=y(f[S],!1);for(let F of x)_(f[S][F],O)}}})};for(let p of y(o,!1))_(o[p],d);for(let p of y(s,!0))_(s[p],m);for(let p of y(a,!0))_(a[p],g);for(let p of Object.keys(c))if(!(l.indexOf(p)>=0))for(let O of y(c[p],!1))_(c[p][O],d);for(let p of Object.keys(f))if(!(l.indexOf(p)>=0))for(let O of y(f[p],!1))_(f[p][O],m);return[...d,...m,...g].map(p=>i[p]).map(p=>e[p])},ct=bn;var J=class extends _e{constructor(t){super(t),this._registry=[]}set(t,r,n=0){if(typeof t!="string")throw new Error("Key must be a string");if(typeof n!="string"&&typeof n!="number")throw new Error("Position must be a string or a number");let i={key:t,value:r};n&&(i.position=n);let s=this._registry.findIndex(o=>o.key===t);return s===-1?this._registry.push(i):this._registry[s]=i,r}get(t){if(typeof t!="string")return console.error("Key must be a string"),null;let r=this._registry.find(n=>n.key===t);return r?r.value:null}_getChildrenWrapped(t){let r=this._registry.filter(n=>n.key.indexOf(t+"/")===0);return ct(r)}getChildrenAsObject(t){let r={};return this._getChildrenWrapped(t).forEach(n=>{r[n.key]=n.value}),r}getChildren(t){return this._getChildrenWrapped(t).map(r=>r.value)}has(t){return typeof t!="string"?(console.error("Key must be a string"),!1):!!this._registry.find(r=>r.key===t)}_getAllWrapped(){return ct(this._registry)}getAllAsObject(){let t={};return this._getAllWrapped().forEach(r=>{t[r.key]=r.value}),t}getAllAsList(){return this._getAllWrapped().map(t=>Object.assign({id:t.key},t.value))}};var jt=C("manifest");var w=class extends Error{constructor(r,n,i=""){super(r);u(this,"code");u(this,"severity","error");u(this,"externalMessage");this.code=n,this.externalMessage=i}};var zt=e=>{let t=e["NEOSidekick.AiAssistant"];return new ut(t.apiDomain,t.apiKey)},ut=class{constructor(t,r){u(this,"apiDomain","");u(this,"apiKey","");u(this,"hasApiKey",()=>this.apiKey!==null&&this.apiKey!=="");u(this,"generate",async(t,r,n={})=>{if(!this.apiKey)throw new w("This feature is not available in the free version.","1688157373215");let i=await fetch(`${this.apiDomain}/api/v1/chat?language=${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,Accept:"application/json"},body:JSON.stringify({module:t,platform:"neos",user_input:n})}),s=await i.json();if(i.status===401)throw new w("The NEOSidekick api key provided is not valid.","1688158193038");if(i.status<200||i.status>=400)throw new w("An error occurred while asking NEOSidekick.","1688158257149",s?.message);let o=s?.data?.message?.message;return o.startsWith('"')&&o.endsWith('"')&&(o=o.substr(1,o.length-2)),o});this.apiDomain=t,this.apiKey=r}};M();var Lt=C("NeosProjectPackages")().NeosUiBackendConnectorDefault,{fetchWithErrorHandling:Vs}=C("NeosProjectPackages")().NeosUiBackendConnector;var ge=h(R());var qt=Symbol.for("immer-nothing"),Kt=Symbol.for("immer-draftable"),T=Symbol.for("immer-state");function I(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var ae=Object.getPrototypeOf;function ce(e){return!!e&&!!e[T]}function ee(e){return e?Jt(e)||Array.isArray(e)||!!e[Kt]||!!e.constructor?.[Kt]||je(e)||ze(e):!1}var An=Object.prototype.constructor.toString();function Jt(e){if(!e||typeof e!="object")return!1;let t=ae(e);if(t===null)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===An}function ve(e,t){We(e)===0?Object.entries(e).forEach(([r,n])=>{t(r,n,e)}):e.forEach((r,n)=>t(n,r,e))}function We(e){let t=e[T];return t?t.type_:Array.isArray(e)?1:je(e)?2:ze(e)?3:0}function lt(e,t){return We(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Yt(e,t,r){let n=We(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function wn(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function je(e){return e instanceof Map}function ze(e){return e instanceof Set}function Q(e){return e.copy_||e.base_}function pt(e,t){if(je(e))return new Map(e);if(ze(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&Jt(e))return ae(e)?{...e}:Object.assign(Object.create(null),e);let r=Object.getOwnPropertyDescriptors(e);delete r[T];let n=Reflect.ownKeys(r);for(let i=0;i<n.length;i++){let s=n[i],o=r[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[s]})}return Object.create(ae(e),r)}function _t(e,t=!1){return Le(e)||ce(e)||!ee(e)||(We(e)>1&&(e.set=e.add=e.clear=e.delete=Nn),Object.freeze(e),t&&ve(e,(r,n)=>_t(n,!0),!0)),e}function Nn(){I(2)}function Le(e){return Object.isFrozen(e)}var Pn={};function te(e){let t=Pn[e];return t||I(0,e),t}var Se;function Vt(){return Se}function En(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Ut(e,t){t&&(te("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function gt(e){ht(e),e.drafts_.forEach(On),e.drafts_=null}function ht(e){e===Se&&(Se=e.parent_)}function Ht(e){return Se=En(Se,e)}function On(e){let t=e[T];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function Gt(e,t){t.unfinalizedDrafts_=t.drafts_.length;let r=t.drafts_[0];return e!==void 0&&e!==r?(r[T].modified_&&(gt(t),I(4)),ee(e)&&(e=Ie(t,e),t.parent_||Re(t,e)),t.patches_&&te("Patches").generateReplacementPatches_(r[T].base_,e,t.patches_,t.inversePatches_)):e=Ie(t,r,[]),gt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==qt?e:void 0}function Ie(e,t,r){if(Le(t))return t;let n=t[T];if(!n)return ve(t,(i,s)=>$t(e,n,t,i,s,r),!0),t;if(n.scope_!==e)return t;if(!n.modified_)return Re(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;let i=n.copy_,s=i,o=!1;n.type_===3&&(s=new Set(i),i.clear(),o=!0),ve(s,(a,c)=>$t(e,n,i,a,c,r,o)),Re(e,i,!1),r&&e.patches_&&te("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function $t(e,t,r,n,i,s,o){if(ce(i)){let a=s&&t&&t.type_!==3&&!lt(t.assigned_,n)?s.concat(n):void 0,c=Ie(e,i,a);if(Yt(r,n,c),ce(c))e.canAutoFreeze_=!1;else return}else o&&r.add(i);if(ee(i)&&!Le(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ie(e,i),(!t||!t.scope_.parent_)&&Re(e,i)}}function Re(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&_t(t,r)}function xn(e,t){let r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:Vt(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},i=n,s=vt;r&&(i=[n],s=be);let{revoke:o,proxy:a}=Proxy.revocable(i,s);return n.draft_=a,n.revoke_=o,a}var vt={get(e,t){if(t===T)return e;let r=Q(e);if(!lt(r,t))return Fn(e,r,t);let n=r[t];return e.finalized_||!ee(n)?n:n===dt(e.base_,t)?(ft(e),e.copy_[t]=yt(n,e)):n},has(e,t){return t in Q(e)},ownKeys(e){return Reflect.ownKeys(Q(e))},set(e,t,r){let n=Xt(Q(e),t);if(n?.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){let i=dt(Q(e),t),s=i?.[T];if(s&&s.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(wn(r,i)&&(r!==void 0||lt(e.base_,t)))return!0;ft(e),mt(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return dt(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,ft(e),mt(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){let r=Q(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){I(11)},getPrototypeOf(e){return ae(e.base_)},setPrototypeOf(){I(12)}},be={};ve(vt,(e,t)=>{be[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});be.deleteProperty=function(e,t){return be.set.call(this,e,t,void 0)};be.set=function(e,t,r){return vt.set.call(this,e[0],t,r,e[0])};function dt(e,t){let r=e[T];return(r?Q(r):e)[t]}function Fn(e,t,r){let n=Xt(t,r);return n?"value"in n?n.value:n.get?.call(e.draft_):void 0}function Xt(e,t){if(!(t in e))return;let r=ae(e);for(;r;){let n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=ae(r)}}function mt(e){e.modified_||(e.modified_=!0,e.parent_&&mt(e.parent_))}function ft(e){e.copy_||(e.copy_=pt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var kn=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){let s=r;r=t;let o=this;return function(c=s,...f){return o.produce(c,d=>r.call(this,d,...f))}}typeof r!="function"&&I(6),n!==void 0&&typeof n!="function"&&I(7);let i;if(ee(t)){let s=Ht(this),o=yt(t,void 0),a=!0;try{i=r(o),a=!1}finally{a?gt(s):ht(s)}return Ut(s,n),Gt(i,s)}else if(!t||typeof t!="object"){if(i=r(t),i===void 0&&(i=t),i===qt&&(i=void 0),this.autoFreeze_&&_t(i,!0),n){let s=[],o=[];te("Patches").generateReplacementPatches_(t,i,s,o),n(s,o)}return i}else I(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(o,...a)=>this.produceWithPatches(o,c=>t(c,...a));let n,i;return[this.produce(t,r,(o,a)=>{n=o,i=a}),n,i]},typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof e?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){ee(e)||I(8),ce(e)&&(e=Tn(e));let t=Ht(this),r=yt(e,void 0);return r[T].isManual_=!0,ht(t),r}finishDraft(e,t){let r=e&&e[T];(!r||!r.isManual_)&&I(9);let{scope_:n}=r;return Ut(n,t),Gt(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let i=t[r];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}r>-1&&(t=t.slice(r+1));let n=te("Patches").applyPatches_;return ce(e)?n(e,t):this.produce(e,i=>n(i,t))}};function yt(e,t){let r=je(e)?te("MapSet").proxyMap_(e,t):ze(e)?te("MapSet").proxySet_(e,t):xn(e,t);return(t?t.scope_:Vt()).drafts_.push(r),r}function Tn(e){return ce(e)||I(10,e),Zt(e)}function Zt(e){if(!ee(e)||Le(e))return e;let t=e[T],r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=pt(e,t.scope_.immer_.useStrictShallowCopy_)}else r=pt(e,!0);return ve(r,(n,i)=>{Yt(r,n,Zt(i))}),t&&(t.finalized_=!1),r}var D=new kn,Qt=D.produce,eo=D.produceWithPatches.bind(D),to=D.setAutoFreeze.bind(D),ro=D.setUseStrictShallowCopy.bind(D),no=D.applyPatches.bind(D),io=D.createDraft.bind(D),so=D.finishDraft.bind(D);var Mr=h(Dr());var Ir=(e,t)=>new Mt(e,t),Mt=class{constructor(t,r){u(this,"globalRegistry");u(this,"store");u(this,"nodeTypesRegistry");u(this,"externalService");u(this,"getGuestFrameDocumentTitle",()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.title);u(this,"getGuestFrameDocumentHtml",()=>document.getElementsByName("neos-content-main")[0]?.contentDocument?.body?.innerHTML);u(this,"getCurrentDocumentNode",()=>{let t=this.store.getState(),r=t?.cr?.nodes?.documentNode;return t?.cr?.nodes?.byContextPath[r]});u(this,"getCurrentDocumentParentNode",()=>{let t=this.store.getState(),r=this.getCurrentDocumentNode();return t?.cr?.nodes?.byContextPath[r.parent]});u(this,"getCurrentDocumentNodeType",()=>{let t=this.getCurrentDocumentNode();return this.globalRegistry.get("@neos-project/neos-ui-contentrepository").get(t?.nodeType)});u(this,"getCurrentDocumentTargetAudience",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.targetAudience;return t?await this.processClientEval(t):null});u(this,"getCurrentDocumentPageBriefing",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.pageBriefing;return t?await this.processClientEval(t):null});u(this,"getCurrentDocumentFocusKeyword",async()=>{let t=this.getCurrentDocumentNodeType()?.options?.sidekick?.focusKeyword;return t?await this.processClientEval(t):null});u(this,"processClientEval",async(t,r=null,n=null)=>{if(typeof t=="string"&&(t.startsWith("SidekickClientEval:")||t.startsWith("ClientEval:")))try{r=r??this.getCurrentDocumentNode();let i=ge.selectors.UI.Inspector.transientValues(this.store.getState());r=this.generateNodeForContext(r,i),n=n??this.getCurrentDocumentParentNode();let s=this.getGuestFrameDocumentTitle(),o=this.getGuestFrameDocumentHtml(),a=await this.getImageMetadata,c=Object.getPrototypeOf(async function(){}).constructor;return await new c("node,parentNode,documentTitle,documentContent,AssetUri","return "+t.replace("SidekickClientEval:","").replace("ClientEval:",""))(r,n,s,o,a)}catch(i){throw i instanceof w?i:(console.error(i),new w('An error occurred while trying to evaluate "'+t+'"',"1694682118365",t))}return t});u(this,"processValueWithClientEval",async(t,r=null,n=null)=>{if(typeof t=="string")return this.processClientEval(t,r,n);if(typeof t=="object"&&t!==null)return this.processObjectWithClientEval(t,r,n);if(Array.isArray(t))return Promise.all(t.map(async i=>this.processObjectWithClientEval(i,r,n)))});u(this,"processObjectWithClientEval",async(t,r=null,n=null)=>{let i={};return await Promise.all(Object.keys(t).map(async s=>{let o=t[s];i[s]=await this.processValueWithClientEval(o,r,n)})),i});u(this,"getImageMetadata",async t=>{if(!t||!t?.__identity)throw new w("The property does not have a valid image.","1694595562191");let{loadImageMetadata:r}=Lt.get().endpoints,n,i;try{let o=await r(t?.__identity);n=o?.originalImageResourceUri,i=o?.previewImageResourceUri}catch{throw new w("Could not fetch image object.","1694595598880")}if(!n||n==="")throw new w("The given image does not have a correct url.","1694595462402");let s=[];return s.push(this.prependConfiguredDomainToImageUri(n)),i&&s.push(this.prependConfiguredDomainToImageUri(i)),s});this.globalRegistry=t,this.store=r,this.nodeTypesRegistry=t.get("@neos-project/neos-ui-contentrepository"),this.externalService=t.get("NEOSidekick.AiAssistant").get("externalService")}prependConfiguredDomainToImageUri(t){let r=this.globalRegistry.get("NEOSidekick.AiAssistant").get("configuration").domain;return t=t.replace("http://","").replace("https://").split("/"),t.shift(),t.unshift(r),t.join("/")}getCurrentlyFocusedNodePathAndProperty(){let t=this.store.getState(),r=this.globalRegistry.get("@neos-project/neos-ui-contentrepository"),n=t?.cr?.nodes?.focused?.contextPaths[0],i=n?ge.selectors.CR.Nodes.nodeByContextPath(t)(n):null;return{nodePath:n,node:i,property:t?.ui?.contentCanvas?.currentlyEditedPropertyName,nodeType:i?r.get(i?.nodeType):null,parentNode:i?ge.selectors.CR.Nodes.nodesByContextPathSelector(t)[i.parent]:null}}async evaluateNodeTypeConfigurationAndStartGeneration(t,r,n,i=null,s=!1){if(!n||r[0]==="_")return;let o=n.properties[r];try{if(o?.options?.sidekick?.onCreate?.module)throw new w("Please do not use options.sidekick.onCreate.module anymore. Read the docs to find out about the new configuration.","1696264259260");if(!o?.options?.sidekick?.module||s&&o?.options?.sidekick?.onCreate!==!0)return;if(!o?.ui?.inlineEditable)throw new w("You can only generate content on inline editable properties","1688395273728");if(!this.externalService.hasApiKey())throw new w("This feature is not available in the free version.","1688157373215")}catch(d){let m=this.globalRegistry.get("i18n");this.store.dispatch(ge.actions.UI.FlashMessages.add(d?.code??d?.message,d?.code?m.translate("NEOSidekick.AiAssistant:Error:"+d.code):d?.message,d?.severity??"error"));return}let a=JSON.parse(JSON.stringify(o.options.sidekick)),c=this.globalRegistry.get("NEOSidekick.AiAssistant").get("contentCanvasService"),f=await this.processObjectWithClientEval(a,t,i);c.streamGenerationIntoInlineProperty(t.contextPath,r,f)}generateNodeForContext(t,r){return r?Qt(t,n=>{let i=(0,Mr.default)(r,s=>s?.value);n.properties=Object.assign({},n.properties,i)}):t}};var rt=h(Wr());var W=h(he()),Ur=h(Ne()),N=h(Pe()),Hr=h(Ee()),se=h(Oe()),me=h(R());var Ss={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},H=class extends W.Component{constructor(r){super(r);u(this,"state",{loading:!1});u(this,"getIcon",r=>r?W.default.createElement(se.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):W.default.createElement(se.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}));u(this,"fetch",async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:f,node:d,parentNode:m,frontendConfiguration:g}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,d,m),n=Object.keys(n).map(y=>({identifier:y,value:n[y]}));let l=await s.generate(r,a.language?a.language[0]:g.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?f.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}})}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:f}=this.props,d=Object.assign({},Ss,o),m=o&&o.placeholder&&a.translate(unescape(o.placeholder)),g=!(d.readonly||d.disabled);return W.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},W.default.createElement("div",null,W.default.createElement(se.TextInput,{id:r,value:n,onChange:s,disabled:d.disabled||this.state.loading,maxLength:d.maxlength,readOnly:d.readonly,placeholder:m,onKeyPress:c,onEnterKey:f})),g?W.default.createElement("div",{style:{"margin-top":"4px"}},W.default.createElement(se.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(d.module,d.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};u(H,"propTypes",{className:N.default.string,value:N.default.oneOfType([N.default.string,N.default.number]),commit:N.default.func.isRequired,options:N.default.object,onKeyPress:N.default.func,onEnterKey:N.default.func,id:N.default.string,activeContentDimensions:N.default.object.isRequired,node:N.default.object,parentNode:N.default.object,i18nRegistry:N.default.object.isRequired,externalService:N.default.object.isRequired,contentService:N.default.object.isRequired,addFlashMessage:N.default.func.isRequired,frontendConfiguration:N.default.object}),u(H,"defaultProps",{options:{}}),H=q([(0,Hr.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Ur.connect)(e=>t=>{let r=me.selectors.CR.ContentDimensions.active(t),n=me.selectors.CR.Nodes.focusedSelector(t),i=me.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:me.actions.UI.FlashMessages.add})],H);var j=h(he()),Gr=h(Ne()),P=h(Pe()),$r=h(Ee()),oe=h(Oe()),ye=h(R());var bs={autoFocus:!1,disabled:!1,maxlength:null,readonly:!1},G=class extends j.Component{constructor(r){super(r);u(this,"getIcon",r=>r?j.default.createElement(oe.Icon,{icon:"spinner",size:"",fixedWidth:!0,padded:"right",spin:!0}):j.default.createElement(oe.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}));u(this,"fetch",async(r,n)=>{let{commit:i,externalService:s,contentService:o,activeContentDimensions:a,addFlashMessage:c,i18nRegistry:f,node:d,parentNode:m,frontendConfiguration:g}=this.props;this.setState({loading:!0});try{n=await o.processObjectWithClientEval(n,d,m),n=Object.keys(n).map(y=>({identifier:y,value:n[y]}));let l=await s.generate(r,a.language?a.language[0]:g.defaultLanguage,n);i(l)}catch(l){c(l?.code??l?.message,l?.code?f.translate("NEOSidekick.AiAssistant:Error:"+l.code,l.message,{0:l.externalMessage}):l.message,l?.severity??"error")}finally{this.setState({loading:!1})}});this.state={loading:!1}}render(){let{id:r,value:n,className:i,commit:s,options:o,i18nRegistry:a,onKeyPress:c,onEnterKey:f}=this.props,d=Object.assign({},bs,o),m=o&&o.placeholder&&a.translate(unescape(o.placeholder)),g=!(d.readonly||d.disabled);return j.default.createElement("div",{style:{display:"flex",flexDirection:"column"},className:i},j.default.createElement("div",null,j.default.createElement(oe.TextArea,{id:r,value:n,onChange:s,disabled:d.disabled||this.state.loading,maxLength:d.maxlength,readOnly:d.readonly,placeholder:m,minRows:d.minRows,expandedRows:d.expandedRows,onKeyPress:c,onEnterKey:f})),g?j.default.createElement("div",null,j.default.createElement(oe.Button,{className:"generateBtn",size:"regular",icon:this.state.loading?"hourglass":"magic",style:"neutral",hoverStyle:"clean",disabled:this.state.loading,onClick:async()=>await this.fetch(d.module,d.arguments??{})},a.translate("NEOSidekick.AiAssistant:Main:generateWithSidekick"),"\xA0",this.getIcon(this.state.loading))):null)}};u(G,"propTypes",{className:P.default.string,value:P.default.oneOfType([P.default.string,P.default.number]),commit:P.default.func.isRequired,options:P.default.object,onKeyPress:P.default.func,onEnterKey:P.default.func,id:P.default.string,activeContentDimensions:P.default.object.isRequired,node:P.default.object,parentNode:P.default.object,i18nRegistry:P.default.object.isRequired,externalService:P.default.object.isRequired,contentService:P.default.object.isRequired,addFlashMessage:P.default.func.isRequired,frontendConfiguration:P.default.object}),u(G,"defaultProps",{options:{}}),G=q([(0,$r.neos)(e=>({i18nRegistry:e.get("i18n"),externalService:e.get("NEOSidekick.AiAssistant").get("externalService"),contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),frontendConfiguration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Gr.connect)(e=>t=>{let r=ye.selectors.CR.ContentDimensions.active(t),n=ye.selectors.CR.Nodes.focusedSelector(t),i=ye.selectors.CR.Nodes.nodeByContextPath(t)(n.parent);return{activeContentDimensions:r,node:n,parentNode:i}},{addFlashMessage:ye.actions.UI.FlashMessages.add})],G);var qr=(e,t)=>{let r=e.get("inspector").get("editors");r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextFieldEditor",{component:t?H:rt.TextField}),r.set("NEOSidekick.AiAssistant/Inspector/Editors/MagicTextAreaEditor",{component:t?G:rt.TextArea})};var k=h(he()),Fe=h(Oe());var nt=h(he()),Jr=h(Ne()),xe=h(Pe()),Yr=h(R()),Vr=h(Ee());var $=class extends nt.PureComponent{getUri(){let{configuration:t,activeContentDimensions:r,interfaceLanguage:n}=this.props,i=new URL(`${t.apiDomain}/chat/`);return i.searchParams.append("contentLanguage",r.language?r.language[0]:t.defaultLanguage),i.searchParams.append("interfaceLanguage",n),i.searchParams.append("userId",t.userId),i.searchParams.append("plattform","neos"),i.searchParams.append("domain",t.domain),i.searchParams.append("siteName",t.siteName),t?.referral&&i.searchParams.append("referral",t?.referral),t?.apiKey&&i.searchParams.append("apikey",t?.apiKey),i}render(){let{className:t}=this.props;return nt.default.createElement("iframe",{id:"neosidekickAssistant",className:t,src:this.getUri().toString(),allow:"clipboard-write",onLoad:r=>r.target.dataset.loaded=!0})}};u($,"propTypes",{configuration:xe.default.object.isRequired,activeContentDimensions:xe.default.object.isRequired,interfaceLanguage:xe.default.object.isRequired,className:xe.default.string}),$=q([(0,Vr.neos)(e=>({configuration:e.get("NEOSidekick.AiAssistant").get("configuration")})),(0,Jr.connect)(e=>({activeContentDimensions:Yr.selectors.CR.ContentDimensions.active(e),interfaceLanguage:t=>t?.user?.preferences?.interfaceLanguage}),{})],$);var Xr=(e,t)=>{let r=e.get("containers"),n=r.get("App");if(!t.chatSidebarEnabled){r.set("App",s=>k.default.createElement("div",null,k.default.createElement(n,{...s}),k.default.createElement($,{className:"neosidekick__frame--hidden"})));return}let i=s=>{let o=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[a,c]=k.default.useState(o?.open),f=_=>{c(_),o.open=_,localStorage.setItem("NEOSidekick",JSON.stringify(o))},[d,m]=k.default.useState(o?.fullscreen),g=_=>{m(_),o.fullscreen=_,localStorage.setItem("NEOSidekick",JSON.stringify(o))},l=(_,E,p)=>_?k.default.createElement(Fe.IconButton,{icon:E?"compress":"expand",onClick:p}):"",y=(_,E,p)=>E?"":k.default.createElement(Fe.IconButton,{icon:_?"chevron-circle-right":"chevron-circle-left",onClick:p});return k.default.createElement("div",{className:`neosidekick_appWrapper ${a?"neosidekick_appWrapper--sidebar-open":""}  ${d?"neosidekick_appWrapper--sidebar-fullscreen":""}`},k.default.createElement(n,{...s}),k.default.createElement("div",{className:"neosidekick_sideBar"},k.default.createElement("div",{className:"neosidekick_sideBar__title"},k.default.createElement(Fe.Headline,{className:`neosidekick_sideBar__title-headline ${a?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),k.default.createElement("div",null,l(a,d,()=>g(!d)),y(a,d,()=>f(!a)))),k.default.createElement($,{className:`neosidekick_sideBar__frame ${a?"neosidekick_sideBar__frame--open":""}`})))};r.set("App",i)};var ke=h(R()),sn=h(it());var Qr=h(it()),st=h(R()),en=(e,t)=>function*(){yield(0,Qr.takeEvery)(st.actionTypes.ServerFeedback.HANDLE_SERVER_FEEDBACK,function*(r){r.payload.feedbackEnvelope.feedbacks.forEach(n=>{if(n.type!=="Neos.Neos.Ui:NodeCreated")return;let s=n.payload.contextPath.split("@")[0],o=t.getState(),a=st.selectors.CR.Nodes.nodesByContextPathSelector(o),c=e.get("@neos-project/neos-ui-contentrepository"),f=e.get("NEOSidekick.AiAssistant").get("contentService");Object.keys(a).forEach(d=>{if(!d.split("@")[0].startsWith(s))return;let g=a[d],l=a[g.parent],y=c.get(g.nodeType);Object.keys(y.properties).forEach(_=>{f.evaluateNodeTypeConfigurationAndStartGeneration(g,_,y,l,!0)})})})})};var tn=h(it()),rn=h(R()),nn=(e,t)=>function*(){yield(0,tn.takeEvery)(rn.actionTypes.CR.Nodes.REMOVE,function*(r){e.get("NEOSidekick.AiAssistant").get("contentCanvasService").onNodeRemoved(r.payload)})};function Cs(e){return new Promise(t=>setTimeout(t,e))}var on=(e,t,r,n)=>{let i=!1,s=function*(){yield(0,sn.takeLatest)([ke.actionTypes.UI.ContentCanvas.SET_SRC,ke.actionTypes.UI.ContentCanvas.RELOAD,ke.actionTypes.CR.Nodes.MERGE],async function*(a){a.type===ke.actionTypes.UI.ContentCanvas.SET_SRC&&(i=!0),yield Cs(500);let c=e.get("@neos-project/neos-ui-contentrepository"),f=t.getState(),d=f?.ui?.contentCanvas?.previewUrl,m=n.getCurrentDocumentNode(),g=m?.contextPath,l=Object.values(f?.cr?.nodes?.byContextPath||{}).filter(_=>{let E=c.getRole("document");if(!E)throw new Error("Document role is not loaded!");let p=c.getSubTypesOf(E);return g&&_.contextPath.indexOf(g.split("@")[0])===0&&(_.contextPath===g||!p.includes(_.nodeType))}),y={url:d,title:m?.properties?.title||n.getGuestFrameDocumentTitle(),content:n.getGuestFrameDocumentHtml(),structuredContent:l,targetAudience:await n.getCurrentDocumentTargetAudience(),pageBriefing:await n.getCurrentDocumentPageBriefing(),focusKeyword:await n.getCurrentDocumentFocusKeyword()};r.updateWebContext(i,y),i=!1})},o=e.get("sagas");o.set("NEOSidekick.AiAssistant/watchDocumentNodeChange",{saga:s}),o.set("NEOSidekick.AiAssistant/watchNodeCreated",{saga:en(e,t)}),o.set("NEOSidekick.AiAssistant/watchNodeRemoved",{saga:nn(e,t)})};var Te=h(he()),an=h(Ne()),ot=h(Pe()),at=h(Oe()),cn=h(Ee()),un=h(R());var X=class extends Te.PureComponent{constructor(r){super(r);u(this,"state",{show:!1,enabled:!0});u(this,"evaluateFocusedNodeAndPropertyAndShowButton",(r=5)=>{let{nodeType:n,property:i}=this.props.contentService.getCurrentlyFocusedNodePathAndProperty();if(!n||!i){if(r===0)return;setTimeout(()=>this.evaluateFocusedNodeAndPropertyAndShowButton(r-1),100);return}let s=n.properties[i];this.setState({show:s?.ui?.inlineEditable===!0&&s?.options?.sidekick?.module!==void 0})});u(this,"onClick",async()=>{let{addFlashMessage:r,i18nRegistry:n,contentService:i}=this.props;try{this.setState({enabled:!1});let{node:s,nodeType:o,parentNode:a,property:c}=i.getCurrentlyFocusedNodePathAndProperty();await i.evaluateNodeTypeConfigurationAndStartGeneration(s,c,o,a)}catch(s){r(s?.code??s?.message,s?.code?n.translate("NEOSidekick.AiAssistant:Error:"+s.code,s.message,{0:s.externalMessage}):s.message,s?.severity??"error")}finally{setTimeout(()=>{this.setState({enabled:!0})},2500)}})}componentDidMount(){this.evaluateFocusedNodeAndPropertyAndShowButton()}render(){let{i18nRegistry:r}=this.props;return this.state.show?Te.default.createElement(at.Button,{disabled:!this.state.enabled,style:"transparent",hoverStyle:"brand",onClick:this.onClick,isActive:!!this.props.isActive,title:r.translate("NEOSidekick.AiAssistant:Main:generate")},Te.default.createElement(at.Icon,{icon:"magic",size:"",fixedWidth:!0,padded:"right"}),r.translate("NEOSidekick.AiAssistant:Main:generate")):""}};u(X,"propTypes",{contentService:ot.default.object.isRequired,i18nRegistry:ot.default.object.isRequired,addFlashMessage:ot.default.func.isRequired}),X=q([(0,cn.neos)(e=>({contentService:e.get("NEOSidekick.AiAssistant").get("contentService"),i18nRegistry:e.get("i18n")})),(0,an.connect)(()=>{},{addFlashMessage:un.actions.UI.FlashMessages.add})],X);var dn=e=>{e.get("ckEditor5").get("richtextToolbar").set("NEOSidekick.AiAssistant:generate",{component:X,isVisible:()=>!0},"end")};var fn=h(R());var ln=(e,t,r)=>new It(e,t,r),It=class{constructor(t,r,n){u(this,"globalRegistry");u(this,"store");u(this,"iFrameApiService");u(this,"currentlyHandledNodePath",null);u(this,"streamGenerationIntoInlineProperty",(t,r,n)=>{if(this.currentlyHandledNodePath){this.addFlashMessage("1695668144026","You cannot start two text generations at the same time.");return}this.iFrameApiService.callModule({platform:"neos",target:{nodePath:t,propertyName:r},...n})});u(this,"onNodeRemoved",t=>{this.currentlyHandledNodePath===t&&(this.iFrameApiService.cancelCallModule(),this.unsetCurrentlyHandledNodePath())});u(this,"handleMessage",t=>{switch(t?.data?.eventName){case"write-content":let{nodePath:r,propertyName:n,value:i,isFinished:s}=t.data.data;this.currentlyHandledNodePath=r,console.info(r+": "+i),this.setPropertyValue(r,n,i),s&&this.handleStreamingFinished();break;case"stopped-generation":this.handleStreamingFinished();break;case"error":let o=t?.data?.data?.message;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+o,"error",o),this.handleStreamingFinished();break;default:let a="Unknown message event: "+t?.data?.eventName;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+a,"error",a),this.handleStreamingFinished()}});u(this,"handleStreamingFinished",()=>{this.resetTypingCaret(),this.unsetCurrentlyHandledNodePath(),this.iFrameApiService.setStreamingFinished()});u(this,"setPropertyValue",(t,r,n)=>{let o=document.getElementsByName("neos-content-main")[0]?.contentDocument?.querySelector(`[data-__neos-editable-node-contextpath="${t}"][data-__neos-property="${r}"]`);if(!o){let c="Could not find inline field for nodePath: "+t+" and propertyName: "+r;this.addFlashMessage("1688158257149","An error occurred while asking NEOSidekick: "+c,"error",c),this.unsetCurrentlyHandledNodePath();return}if(!this.store.getState()?.cr?.nodes?.byContextPath.hasOwnProperty(t)){this.handleStreamingFinished();return}o.ckeditorInstance?.setData(n),o.classList.add("typing-caret")});this.globalRegistry=t,this.store=r,this.iFrameApiService=n,this.iFrameApiService.listenToMessages(this.handleMessage)}unsetCurrentlyHandledNodePath(){this.currentlyHandledNodePath=null}resetTypingCaret(){let n=document.getElementsByName("neos-content-main")[0]?.contentDocument?.querySelector(".typing-caret");n&&n.classList.remove("typing-caret")}addFlashMessage(t,r,n="error",i){let s=this.globalRegistry.get("i18n");this.store.dispatch(fn.actions.UI.FlashMessages.add(t,s.translate("NEOSidekick.AiAssistant:Error:"+t,r,{0:i}),n))}};var pn=()=>new Rt,Rt=class{constructor(){u(this,"isStreaming",!1);u(this,"unsyncedWebContextIsNewPage");u(this,"unsyncedWebContextData");u(this,"callModule",t=>{if(this.isStreaming)throw new w("You cannot start two text generations at the same time.","1695668144026");this.isStreaming=!0;let r={version:"1.0",eventName:"call-module",data:t};this.sendMessage(r)});u(this,"setStreamingFinished",()=>{this.isStreaming=!1,this.unsyncedWebContextData&&(this.updateWebContext(this.unsyncedWebContextIsNewPage||!1,this.unsyncedWebContextData),this.unsyncedWebContextData=void 0,this.unsyncedWebContextIsNewPage=void 0)});u(this,"cancelCallModule",()=>{let t={version:"1.0",eventName:"cancel-call-module"};this.setStreamingFinished(),this.sendMessage(t)});u(this,"updateWebContext",(t,r)=>{if(this.isStreaming){this.unsyncedWebContextIsNewPage=t,this.unsyncedWebContextData=r;return}let n={version:"1.0",eventName:t?"page-changed":"page-updated",data:r};this.sendMessage(n)});u(this,"listenToMessages",t=>{let r=this.getAssistantFrame();r?window.addEventListener("message",n=>{n.source===r.contentWindow&&t(n)}):setTimeout(()=>this.listenToMessages(t),250)});u(this,"sendMessage",(t,r)=>{let n=this.getAssistantFrame();n?(console.log("loaded, sending message to frame",t),n.contentWindow?.postMessage(t,"*"),r&&r()):(console.log("not loaded, waiting..."),setTimeout(()=>this.sendMessage(t,r),250))});u(this,"getAssistantFrame",()=>{let t=document.getElementById("neosidekickAssistant");return t?.dataset.hasOwnProperty("loaded")&&t.contentWindow?t:null})}};jt("NEOSidekick.AiAssistant",{},(e,{store:t,frontendConfiguration:r})=>{let n=r["NEOSidekick.AiAssistant"],i=!!n&&n.enabled!==!1;if(qr(e,i),!i)return;if(!n.hasOwnProperty("defaultLanguage")||!n.defaultLanguage){console.error("Could not initialize AiAssistant: defaultLanguage is not configured correctly, see README.");return}e.set("NEOSidekick.AiAssistant",new J(""));let s=e.get("NEOSidekick.AiAssistant");s.set("configuration",n);let o=zt(r);s.set("externalService",o);let a=Ir(e,t);s.set("contentService",a);let c=pn(e,t);s.set("iFrameApiService",c);let f=ln(e,t,c);s.set("contentCanvasService",f),Xr(e,n),on(e,t,c,a),dn(e)});})();
//# sourceMappingURL=Plugin.js.map
