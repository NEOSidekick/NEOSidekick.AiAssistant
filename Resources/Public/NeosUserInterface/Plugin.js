(()=>{var Y=Object.create;var E=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Q=Object.getPrototypeOf,Z=Object.prototype.hasOwnProperty;var ee=(e,t)=>()=>(e&&(t=e(e=0)),t);var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var te=(e,t,s,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of X(t))!Z.call(e,d)&&d!==s&&E(e,d,{get:()=>t[d],enumerable:!(p=z(t,d))||p.enumerable});return e};var k=(e,t,s)=>(s=e!=null?Y(Q(e)):{},te(t||!e||!e.__esModule?E(s,"default",{value:e,enumerable:!0}):s,e));function i(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var l=ee(()=>{});var W=y((Pe,I)=>{l();I.exports=i("NeosProjectPackages")().ReactUiComponents});var L=y((xe,F)=>{l();F.exports=i("NeosProjectPackages")().NeosUiReduxStore});var j=y((Ie,T)=>{l();T.exports=i("vendor")().React});var K=y((Fe,B)=>{l();B.exports=i("vendor")().reactRedux});var D=y((Te,M)=>{l();M.exports=i("vendor")().reduxSagaEffects});l();var R=i("manifest");var S=k(W()),f=k(L()),a=k(j()),P=k(K()),U=k(D());function H(e){return new Promise(t=>setTimeout(t,e))}R("NEOSidekick.AiAssistant",{},(e,t)=>{let s=null,p=new XMLHttpRequest;if(p.open("GET","/neosidekick/aiassistant/configuration",!1),p.withCredentials=!0,p.addEventListener("load",u=>{let r=u.target;r?.status>=200&&r?.status<=299&&(s=JSON.parse(r.responseText))}),p.send(),s===null)return;let d=e.get("containers"),$=d.get("App"),J=u=>{let r=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[o,_]=a.useState(r?.open),b=n=>{_(n),r.open=n,localStorage.setItem("NEOSidekick",JSON.stringify(r))},[m,g]=a.useState(r?.fullscreen),C=n=>{g(n),r.fullscreen=n,localStorage.setItem("NEOSidekick",JSON.stringify(r))},h=(n,O,v)=>{if(n)return a.createElement(S.IconButton,{icon:O?"compress":"expand",onClick:v})},A=(n,O,v)=>{if(!O)return a.createElement(S.IconButton,{icon:n?"chevron-circle-right":"chevron-circle-left",onClick:v})},N=(0,P.useSelector)(f.selectors.CR.ContentDimensions.active),G=(0,P.useSelector)(n=>n?.user?.preferences?.interfaceLanguage),c=new URL("https://api.neosidekick.com/chat/");return c.searchParams.append("contentLanguage",N.language?N.language[0]:""),c.searchParams.append("interfaceLanguage",G),c.searchParams.append("userId",s.userId),c.searchParams.append("plattform","neos"),c.searchParams.append("domain",s.domain),c.searchParams.append("siteName",s.siteName),s?.referral&&c.searchParams.append("referral",s?.referral),s?.apikey&&c.searchParams.append("apikey",s?.apikey),a.createElement("div",{className:`neosidekick_appWrapper ${o?"neosidekick_appWrapper--sidebar-open":""}  ${m?"neosidekick_appWrapper--sidebar-fullscreen":""}`},a.createElement($,{...u}),a.createElement("div",{className:"neosidekick_sideBar"},a.createElement("div",{className:"neosidekick_sideBar__title"},a.createElement(S.Headline,{className:`neosidekick_sideBar__title-headline ${o?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),a.createElement("div",null,h(o,m,()=>C(!m)),A(o,m,()=>b(!o)))),a.createElement("iframe",{id:"neosidekickAssistant",className:`neosidekick_sideBar__frame ${o?"neosidekick_sideBar__frame--open":""}`,src:c.toString(),allow:"clipboard-write",onLoad:n=>n.target.dataset.loaded=!0})))};d.set("App",J);let V=u=>{let r=setInterval(()=>{let o=document.getElementById("neosidekickAssistant");if(o.dataset.hasOwnProperty("loaded"))console.log("loaded, sending message to frame",u),o.contentWindow.postMessage(u,"*"),clearInterval(r);else{console.log("not loaded, waiting...");return}},250)},w=!1,q=function*(){yield(0,U.takeLatest)([f.actionTypes.UI.ContentCanvas.SET_SRC,f.actionTypes.UI.ContentCanvas.RELOAD,f.actionTypes.CR.Nodes.MERGE],function*(u){u.type===f.actionTypes.UI.ContentCanvas.SET_SRC&&(w=!0),yield H(500);let r=e.get("@neos-project/neos-ui-contentrepository"),o=t.store.getState(),b=document.getElementsByName("neos-content-main")[0]?.contentDocument,m=o?.ui?.contentCanvas?.previewUrl,g=o?.cr?.nodes?.documentNode,C=Object.values(o?.cr?.nodes?.byContextPath||{}).filter(h=>{let A=r.getRole("document");if(!A)throw new Error("Document role is not loaded!");let N=r.getSubTypesOf(A);return g&&h.contextPath.indexOf(g.split("@")[0])===0&&(h.contextPath===g||!N.includes(h.nodeType))});V({version:"1.0",eventName:w?"page-changed":"page-updated",data:{url:m,title:o?.cr?.nodes?.byContextPath[g]?.properties?.title||b?.title,content:b?.body?.innerHTML,structuredContent:C}}),w=!1})};e.get("sagas").set("NEOSidekick.AiAssistant/debug",{saga:q})});})();
//# sourceMappingURL=Plugin.js.map
