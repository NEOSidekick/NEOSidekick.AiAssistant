(()=>{var G=Object.create;var x=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var X=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var Z=(e,t)=>()=>(e&&(t=e(e=0)),t);var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ee=(e,t,r,p)=>{if(t&&typeof t=="object"||typeof t=="function")for(let d of z(t))!Q.call(e,d)&&d!==r&&x(e,d,{get:()=>t[d],enumerable:!(p=Y(t,d))||p.enumerable});return e};var k=(e,t,r)=>(r=e!=null?G(X(e)):{},ee(t||!e||!e.__esModule?x(r,"default",{value:e,enumerable:!0}):r,e));function o(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var u=Z(()=>{});var F=y((Pe,W)=>{u();W.exports=o("NeosProjectPackages")().ReactUiComponents});var B=y((Ee,j)=>{u();j.exports=o("NeosProjectPackages")().NeosUiReduxStore});var T=y((Re,L)=>{u();L.exports=o("vendor")().React});var D=y((We,K)=>{u();K.exports=o("vendor")().reactRedux});var M=y((je,U)=>{u();U.exports=o("vendor")().reduxSagaEffects});u();var I=o("manifest");var S=k(F()),f=k(B()),n=k(T()),v=k(D()),H=k(M());function $(e){return new Promise(t=>setTimeout(t,e))}I("NEOSidekick.AiAssistant",{},(e,t)=>{let r=null,p=new XMLHttpRequest;if(p.open("GET","/neosidekick/aiassistant/configuration",!1),p.withCredentials=!0,p.addEventListener("load",h=>{let s=h.target;s?.status>=200&&s?.status<=299&&(r=JSON.parse(s.responseText))}),p.send(),r===null)return;let d=e.get("containers"),J=d.get("App"),V=h=>{let s=localStorage.getItem("NEOSidekick")?JSON.parse(localStorage.getItem("NEOSidekick")):{open:!0,fullscreen:!1},[i,E]=n.useState(s?.open),b=c=>{E(c),s.open=c,localStorage.setItem("NEOSidekick",JSON.stringify(s))},[l,C]=n.useState(s?.fullscreen),m=c=>{C(c),s.fullscreen=c,localStorage.setItem("NEOSidekick",JSON.stringify(s))},w=(c,O,P)=>{if(c)return n.createElement(S.IconButton,{icon:O?"compress":"expand",onClick:P})},N=(c,O,P)=>{if(!O)return n.createElement(S.IconButton,{icon:c?"chevron-circle-right":"chevron-circle-left",onClick:P})},g=(0,v.useSelector)(f.selectors.CR.ContentDimensions.active),_=(0,v.useSelector)(c=>c?.user?.preferences?.interfaceLanguage),a=new URL("https://api.neosidekick.com/chat/");return a.searchParams.append("contentLanguage",g.language?g.language[0]:""),a.searchParams.append("interfaceLanguage",_),a.searchParams.append("userId",r.userId),a.searchParams.append("plattform","neos"),a.searchParams.append("domain",r.domain),a.searchParams.append("siteName",r.siteName),r?.referral&&a.searchParams.append("referral",r?.referral),r?.apikey&&a.searchParams.append("apikey",r?.apikey),n.createElement("div",{className:`neosidekick_appWrapper ${i?"neosidekick_appWrapper--sidebar-open":""}  ${l?"neosidekick_appWrapper--sidebar-fullscreen":""}`},n.createElement(J,{...h}),n.createElement("div",{className:"neosidekick_sideBar"},n.createElement("div",{className:"neosidekick_sideBar__title"},n.createElement(S.Headline,{className:`neosidekick_sideBar__title-headline ${i?"neosidekick_sideBar__title-headline--open":""}`},"AI Sidekick"),n.createElement("div",null,w(i,l,()=>m(!l)),N(i,l,()=>b(!i)))),n.createElement("iframe",{className:`neosidekick_sideBar__frame ${i?"neosidekick_sideBar__frame--open":""}`,src:a.toString(),allow:"clipboard-write"})))};d.set("App",V);let A=!1,q=function*(){yield(0,H.takeLatest)([f.actionTypes.UI.ContentCanvas.SET_SRC,f.actionTypes.UI.ContentCanvas.RELOAD,f.actionTypes.CR.Nodes.MERGE],function*(h){h.type===f.actionTypes.UI.ContentCanvas.SET_SRC&&(A=!0),yield $(500);let s=e.get("@neos-project/neos-ui-contentrepository"),i=t.store.getState(),b=document.getElementsByName("neos-content-main")[0]?.contentDocument,l=document.getElementsByClassName("neosidekick_sideBar__frame")[0],C=i?.ui?.contentCanvas?.previewUrl,m=i?.cr?.nodes?.documentNode,w=Object.values(i?.cr?.nodes?.byContextPath||{}).filter(g=>{let _=s.getRole("document");if(!_)throw new Error("Document role is not loaded!");let a=s.getSubTypesOf(_);return m&&g.contextPath.indexOf(m.split("@")[0])===0&&(g.contextPath===m||!a.includes(g.nodeType))}),N={version:"1.0",eventName:A?"page-changed":"page-updated",data:{url:C,title:i?.cr?.nodes?.byContextPath[m]?.properties?.title||b?.title,content:b?.body?.innerHTML,structuredContent:w}};console.log(N),l.contentWindow.postMessage(N,"*"),A=!1})};e.get("sagas").set("NEOSidekick.AiAssistant/debug",{saga:q})});})();
//# sourceMappingURL=Plugin.js.map
